[0m16:25:46.291696 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d17535bf40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d173fc8160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d173fc9c30>]}


============================== 16:25:46.301693 | c1e30686-722a-4858-86cf-5e913e890fe8 ==============================
[0m16:25:46.301693 [info ] [MainThread]: Running with dbt=1.5.0
[0m16:25:46.302405 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'printer_width': '80', 'log_cache_events': 'False', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'write_json': 'True', 'indirect_selection': 'eager', 'log_path': '/usr/app/logs', 'debug': 'False', 'profiles_dir': '.', 'target_path': 'None', 'partial_parse': 'True', 'use_colors': 'True', 'no_print': 'None', 'fail_fast': 'False', 'version_check': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'use_experimental_parser': 'False'}
[0m16:25:46.302904 [info ] [MainThread]: dbt version: 1.5.0
[0m16:25:46.303304 [info ] [MainThread]: python version: 3.10.19
[0m16:25:46.303686 [info ] [MainThread]: python path: /usr/local/bin/python3.10
[0m16:25:46.304067 [info ] [MainThread]: os info: Linux-6.8.0-90-generic-x86_64-with-glibc2.41
[0m16:25:46.304428 [info ] [MainThread]: Using profiles.yml file at ./profiles.yml
[0m16:25:46.304779 [info ] [MainThread]: Using dbt_project.yml file at /usr/app/dbt_project.yml
[0m16:25:46.305175 [info ] [MainThread]: Configuration:
[0m16:25:46.312350 [error] [MainThread]: Encountered an error:
Parsing Error
  Env var required but not provided: 'POSTGRES_USER'
[0m16:25:46.312999 [debug] [MainThread]: Command `dbt debug` failed at 16:25:46.312860 after 0.04 seconds
[0m16:25:46.313416 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d17535bf40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d1745cbfa0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d1745c9de0>]}
[0m16:25:46.313802 [debug] [MainThread]: Flushing usage events
[0m16:26:07.615191 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72fd7b2a9930>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72fd79cdbb80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72fd79cdba00>]}


============================== 16:26:07.618402 | 33a6e701-9560-4845-8e98-92f0ce53fa66 ==============================
[0m16:26:07.618402 [info ] [MainThread]: Running with dbt=1.5.0
[0m16:26:07.619075 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'log_format': 'default', 'target_path': 'None', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'cache_selected_only': 'False', 'static_parser': 'True', 'printer_width': '80', 'quiet': 'False', 'log_cache_events': 'False', 'no_print': 'None', 'debug': 'False', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'partial_parse': 'True', 'introspect': 'True', 'warn_error': 'None', 'log_path': '/usr/app/logs', 'write_json': 'True', 'version_check': 'True', 'profiles_dir': '.'}
[0m16:26:07.624468 [error] [MainThread]: Encountered an error:
Parsing Error
  Env var required but not provided: 'POSTGRES_USER'
[0m16:26:07.625173 [debug] [MainThread]: Command `dbt run` failed at 16:26:07.624951 after 0.02 seconds
[0m16:26:07.625524 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72fd7b2a9930>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72fd79b52e30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72fd79b51c90>]}
[0m16:26:07.625908 [debug] [MainThread]: Flushing usage events
[0m16:28:36.016913 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7255a8b910c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7255a75dfa30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7255a75dfa00>]}


============================== 16:28:36.020291 | 211b12ae-ae54-41c8-a18c-f699e7da72c0 ==============================
[0m16:28:36.020291 [info ] [MainThread]: Running with dbt=1.5.0
[0m16:28:36.020960 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'profiles_dir': '.', 'log_path': '/usr/app/logs', 'introspect': 'True', 'use_colors': 'True', 'no_print': 'None', 'printer_width': '80', 'cache_selected_only': 'False', 'debug': 'False', 'static_parser': 'True', 'quiet': 'False', 'fail_fast': 'False', 'warn_error': 'None', 'log_cache_events': 'False', 'version_check': 'True', 'target_path': 'None', 'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'write_json': 'True', 'send_anonymous_usage_stats': 'True', 'log_format': 'default', 'indirect_selection': 'eager'}
[0m16:28:36.021445 [info ] [MainThread]: dbt version: 1.5.0
[0m16:28:36.021825 [info ] [MainThread]: python version: 3.10.19
[0m16:28:36.022237 [info ] [MainThread]: python path: /usr/local/bin/python3.10
[0m16:28:36.022611 [info ] [MainThread]: os info: Linux-6.8.0-90-generic-x86_64-with-glibc2.41
[0m16:28:36.023035 [info ] [MainThread]: Using profiles.yml file at ./profiles.yml
[0m16:28:36.023479 [info ] [MainThread]: Using dbt_project.yml file at /usr/app/dbt_project.yml
[0m16:28:36.023837 [info ] [MainThread]: Configuration:
[0m16:28:36.258009 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m16:28:36.326413 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m16:28:36.327036 [info ] [MainThread]: Required dependencies:
[0m16:28:36.327539 [debug] [MainThread]: Executing "git --help"
[0m16:28:36.333942 [info ] [MainThread]:  - git [[31mERROR[0m]

[0m16:28:36.334476 [info ] [MainThread]: Connection:
[0m16:28:36.334976 [info ] [MainThread]:   host: postgres_bank
[0m16:28:36.335388 [info ] [MainThread]:   port: 5432
[0m16:28:36.335735 [info ] [MainThread]:   user: admin
[0m16:28:36.336080 [info ] [MainThread]:   database: bank_rates
[0m16:28:36.336505 [info ] [MainThread]:   schema: dwh
[0m16:28:36.336884 [info ] [MainThread]:   search_path: None
[0m16:28:36.337293 [info ] [MainThread]:   keepalives_idle: 0
[0m16:28:36.337651 [info ] [MainThread]:   sslmode: None
[0m16:28:36.338392 [debug] [MainThread]: Acquiring new postgres connection 'debug'
[0m16:28:36.338700 [debug] [MainThread]: Using postgres connection "debug"
[0m16:28:36.338982 [debug] [MainThread]: On debug: select 1 as id
[0m16:28:36.339264 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:28:36.476714 [debug] [MainThread]: SQL status: SELECT 1 in 0.0 seconds
[0m16:28:36.477978 [debug] [MainThread]: On debug: Close
[0m16:28:36.478476 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m16:28:36.478884 [info ] [MainThread]: [31m1 check failed:[0m
[0m16:28:36.479367 [info ] [MainThread]: Error from git --help: Could not find command, ensure it is in the user's PATH: "git"

[0m16:28:36.479996 [debug] [MainThread]: Command `dbt debug` failed at 16:28:36.479846 after 0.47 seconds
[0m16:28:36.480349 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m16:28:36.480690 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7255a8b910c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7255ab37fdf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7255a74f1d50>]}
[0m16:28:36.481106 [debug] [MainThread]: Flushing usage events
[0m16:28:56.781020 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71c93c759930>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71c93b1dfb80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71c93b1dfa00>]}


============================== 16:28:56.784234 | 74fb834a-9b92-42e8-bc8c-572862d8e6d0 ==============================
[0m16:28:56.784234 [info ] [MainThread]: Running with dbt=1.5.0
[0m16:28:56.784852 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'introspect': 'True', 'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'warn_error': 'None', 'log_format': 'default', 'profiles_dir': '.', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_path': '/usr/app/logs', 'no_print': 'None', 'version_check': 'True', 'use_experimental_parser': 'False', 'write_json': 'True', 'log_cache_events': 'False', 'printer_width': '80', 'use_colors': 'True', 'debug': 'False', 'static_parser': 'True', 'target_path': 'None', 'partial_parse': 'True', 'indirect_selection': 'eager'}
[0m16:28:56.896047 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '74fb834a-9b92-42e8-bc8c-572862d8e6d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71c93b1dfac0>]}
[0m16:28:56.917491 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '74fb834a-9b92-42e8-bc8c-572862d8e6d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71c93b0fb3a0>]}
[0m16:28:56.918605 [error] [MainThread]: Encountered an error:
Compilation Error
  dbt found 1 package(s) specified in packages.yml, but only 0 package(s) installed in dbt_packages. Run "dbt deps" to install package dependencies.
[0m16:28:56.919308 [debug] [MainThread]: Command `dbt run` failed at 16:28:56.919133 after 0.15 seconds
[0m16:28:56.919680 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71c93c759930>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71c93b0f9e70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71c93b0f9210>]}
[0m16:28:56.920014 [debug] [MainThread]: Flushing usage events
[0m16:30:27.218286 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764d812a19f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764d7fcafa90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764d7fcafb50>]}


============================== 16:30:27.221556 | 12e1a3cb-a9b0-4c69-ae3f-0ce6d22a5f62 ==============================
[0m16:30:27.221556 [info ] [MainThread]: Running with dbt=1.5.0
[0m16:30:27.222188 [debug] [MainThread]: running dbt with arguments {'log_path': '/usr/app/logs', 'static_parser': 'True', 'debug': 'False', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'log_format': 'default', 'warn_error': 'None', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'profiles_dir': '.', 'write_json': 'True', 'fail_fast': 'False', 'partial_parse': 'True', 'version_check': 'True', 'introspect': 'True', 'log_cache_events': 'False', 'use_colors': 'True', 'target_path': 'None', 'printer_width': '80', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'no_print': 'None', 'quiet': 'False'}
[0m16:30:27.258610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '12e1a3cb-a9b0-4c69-ae3f-0ce6d22a5f62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764d7fcafb50>]}
[0m16:30:27.259806 [debug] [MainThread]: Set downloads directory='/tmp/dbt-downloads-_1hw1vwb'
[0m16:30:27.260390 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m16:30:27.366817 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m16:30:27.368468 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m16:30:27.453572 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m16:30:27.464870 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m16:30:27.874332 [info ] [MainThread]: Installed from version 1.0.0
[0m16:30:27.874931 [info ] [MainThread]: Updated version available: 1.3.3
[0m16:30:27.875529 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': '12e1a3cb-a9b0-4c69-ae3f-0ce6d22a5f62', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764d7fb27610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764d7fb27ca0>]}
[0m16:30:27.875924 [info ] [MainThread]: 
[0m16:30:27.876330 [info ] [MainThread]: Updates available for packages: ['dbt-labs/dbt_utils']                 
Update your versions in packages.yml, then run dbt deps
[0m16:30:27.877185 [debug] [MainThread]: Command `dbt deps` succeeded at 16:30:27.877013 after 0.67 seconds
[0m16:30:27.877584 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764d812a19f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764d7fcafb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764d7fcafac0>]}
[0m16:30:27.877980 [debug] [MainThread]: Flushing usage events
[0m16:30:37.842360 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x799c1e5ed990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x799c1d0cbbe0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x799c1d0cba60>]}


============================== 16:30:37.845616 | 630a1a1f-fd4f-4fa7-961e-a2733996af42 ==============================
[0m16:30:37.845616 [info ] [MainThread]: Running with dbt=1.5.0
[0m16:30:37.846344 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'profiles_dir': '.', 'log_cache_events': 'False', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'version_check': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'introspect': 'True', 'fail_fast': 'False', 'partial_parse': 'True', 'static_parser': 'True', 'debug': 'False', 'write_json': 'True', 'log_path': '/usr/app/logs', 'log_format': 'default', 'target_path': 'None', 'use_experimental_parser': 'False', 'cache_selected_only': 'False'}
[0m16:30:37.957459 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '630a1a1f-fd4f-4fa7-961e-a2733996af42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x799c1d0cbb20>]}
[0m16:30:37.978631 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '630a1a1f-fd4f-4fa7-961e-a2733996af42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x799c1cff2aa0>]}
[0m16:30:37.999394 [debug] [MainThread]: checksum: 4568eb639a77b8fcb3a1f4a07856f42b1ff63f1376652889143968e1dbdafbda, vars: {}, profile: , target: , version: 1.5.0
[0m16:30:38.000126 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m16:30:38.000793 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '630a1a1f-fd4f-4fa7-961e-a2733996af42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x799c1cff36a0>]}
[0m16:30:38.991990 [debug] [MainThread]: 1699: static parser successfully parsed mart/metal_prices_analytics.sql
[0m16:30:39.008219 [debug] [MainThread]: 1699: static parser successfully parsed dds/dim_metals.sql
[0m16:30:39.012487 [debug] [MainThread]: 1699: static parser successfully parsed dds/fact_metal_prices.sql
[0m16:30:39.016274 [debug] [MainThread]: 1699: static parser successfully parsed staging/stg_cbr_precious_metals.sql
[0m16:30:39.066136 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '630a1a1f-fd4f-4fa7-961e-a2733996af42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x799c1c3efd30>]}
[0m16:30:39.073783 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '630a1a1f-fd4f-4fa7-961e-a2733996af42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x799c1cfecca0>]}
[0m16:30:39.074376 [info ] [MainThread]: Found 4 models, 0 tests, 0 snapshots, 0 analyses, 419 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m16:30:39.074820 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '630a1a1f-fd4f-4fa7-961e-a2733996af42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x799c1cff1240>]}
[0m16:30:39.076376 [info ] [MainThread]: 
[0m16:30:39.077317 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m16:30:39.078794 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m16:30:39.079740 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m16:30:39.092240 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m16:30:39.094583 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m16:30:39.095004 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m16:30:39.095412 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m16:30:39.095755 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:30:39.096094 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:30:39.110224 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.0 seconds
[0m16:30:39.110736 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.0 seconds
[0m16:30:39.112300 [debug] [ThreadPool]: On list_bank_rates: Close
[0m16:30:39.113668 [debug] [ThreadPool]: On list_bank_rates: Close
[0m16:30:39.117813 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m16:30:39.118720 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m16:30:39.119033 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:30:39.128266 [debug] [ThreadPool]: SQL status: SELECT 7 in 0.0 seconds
[0m16:30:39.129747 [debug] [ThreadPool]: On list_bank_rates: Close
[0m16:30:39.131279 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates, now create_bank_rates_dwh_dds)
[0m16:30:39.131963 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates, now create_bank_rates_dwh_staging)
[0m16:30:39.132870 [debug] [ThreadPool]: Creating schema "database: "bank_rates"
schema: "dwh_dds"
"
[0m16:30:39.133636 [debug] [ThreadPool]: Creating schema "database: "bank_rates"
schema: "dwh_staging"
"
[0m16:30:39.140100 [debug] [ThreadPool]: Using postgres connection "create_bank_rates_dwh_dds"
[0m16:30:39.142539 [debug] [ThreadPool]: Using postgres connection "create_bank_rates_dwh_staging"
[0m16:30:39.142949 [debug] [ThreadPool]: On create_bank_rates_dwh_dds: BEGIN
[0m16:30:39.143377 [debug] [ThreadPool]: On create_bank_rates_dwh_staging: BEGIN
[0m16:30:39.143712 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:30:39.144047 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:30:39.154312 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m16:30:39.154788 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m16:30:39.155235 [debug] [ThreadPool]: Using postgres connection "create_bank_rates_dwh_dds"
[0m16:30:39.155639 [debug] [ThreadPool]: Using postgres connection "create_bank_rates_dwh_staging"
[0m16:30:39.155990 [debug] [ThreadPool]: On create_bank_rates_dwh_dds: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "create_bank_rates_dwh_dds"} */
create schema if not exists "dwh_dds"
[0m16:30:39.156383 [debug] [ThreadPool]: On create_bank_rates_dwh_staging: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "create_bank_rates_dwh_staging"} */
create schema if not exists "dwh_staging"
[0m16:30:39.165240 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.0 seconds
[0m16:30:39.165625 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.0 seconds
[0m16:30:39.166762 [debug] [ThreadPool]: On create_bank_rates_dwh_dds: COMMIT
[0m16:30:39.167861 [debug] [ThreadPool]: On create_bank_rates_dwh_staging: COMMIT
[0m16:30:39.168249 [debug] [ThreadPool]: Using postgres connection "create_bank_rates_dwh_dds"
[0m16:30:39.168638 [debug] [ThreadPool]: Using postgres connection "create_bank_rates_dwh_staging"
[0m16:30:39.169003 [debug] [ThreadPool]: On create_bank_rates_dwh_dds: COMMIT
[0m16:30:39.169381 [debug] [ThreadPool]: On create_bank_rates_dwh_staging: COMMIT
[0m16:30:39.171253 [debug] [ThreadPool]: SQL status: COMMIT in 0.0 seconds
[0m16:30:39.171576 [debug] [ThreadPool]: On create_bank_rates_dwh_dds: Close
[0m16:30:39.173291 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_bank_rates_dwh_dds, now create_bank_rates_dwh_mart)
[0m16:30:39.173673 [debug] [ThreadPool]: SQL status: COMMIT in 0.0 seconds
[0m16:30:39.174693 [debug] [ThreadPool]: Creating schema "database: "bank_rates"
schema: "dwh_mart"
"
[0m16:30:39.175112 [debug] [ThreadPool]: On create_bank_rates_dwh_staging: Close
[0m16:30:39.177825 [debug] [ThreadPool]: Using postgres connection "create_bank_rates_dwh_mart"
[0m16:30:39.178966 [debug] [ThreadPool]: On create_bank_rates_dwh_mart: BEGIN
[0m16:30:39.179385 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:30:39.187722 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m16:30:39.188240 [debug] [ThreadPool]: Using postgres connection "create_bank_rates_dwh_mart"
[0m16:30:39.188597 [debug] [ThreadPool]: On create_bank_rates_dwh_mart: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "create_bank_rates_dwh_mart"} */
create schema if not exists "dwh_mart"
[0m16:30:39.189321 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.0 seconds
[0m16:30:39.190381 [debug] [ThreadPool]: On create_bank_rates_dwh_mart: COMMIT
[0m16:30:39.190732 [debug] [ThreadPool]: Using postgres connection "create_bank_rates_dwh_mart"
[0m16:30:39.191034 [debug] [ThreadPool]: On create_bank_rates_dwh_mart: COMMIT
[0m16:30:39.193663 [debug] [ThreadPool]: SQL status: COMMIT in 0.0 seconds
[0m16:30:39.193996 [debug] [ThreadPool]: On create_bank_rates_dwh_mart: Close
[0m16:30:39.196266 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_bank_rates_dwh_mart, now list_bank_rates_dwh_dds)
[0m16:30:39.197244 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_bank_rates_dwh_staging, now list_bank_rates_dwh_staging)
[0m16:30:39.204327 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dwh_dds"
[0m16:30:39.206950 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dwh_staging"
[0m16:30:39.207405 [debug] [ThreadPool]: On list_bank_rates_dwh_dds: BEGIN
[0m16:30:39.207812 [debug] [ThreadPool]: On list_bank_rates_dwh_staging: BEGIN
[0m16:30:39.208226 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:30:39.208604 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:30:39.218489 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m16:30:39.218945 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m16:30:39.219394 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dwh_dds"
[0m16:30:39.219782 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dwh_staging"
[0m16:30:39.220211 [debug] [ThreadPool]: On list_bank_rates_dwh_dds: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_dwh_dds"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dwh_dds'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dwh_dds'
  
[0m16:30:39.220580 [debug] [ThreadPool]: On list_bank_rates_dwh_staging: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_dwh_staging"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dwh_staging'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dwh_staging'
  
[0m16:30:39.225183 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.0 seconds
[0m16:30:39.225586 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.0 seconds
[0m16:30:39.226942 [debug] [ThreadPool]: On list_bank_rates_dwh_dds: ROLLBACK
[0m16:30:39.228278 [debug] [ThreadPool]: On list_bank_rates_dwh_staging: ROLLBACK
[0m16:30:39.228841 [debug] [ThreadPool]: On list_bank_rates_dwh_dds: Close
[0m16:30:39.229175 [debug] [ThreadPool]: On list_bank_rates_dwh_staging: Close
[0m16:30:39.230694 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates_dwh_dds, now list_bank_rates_dwh_mart)
[0m16:30:39.234470 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dwh_mart"
[0m16:30:39.234832 [debug] [ThreadPool]: On list_bank_rates_dwh_mart: BEGIN
[0m16:30:39.235155 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:30:39.243363 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m16:30:39.243785 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dwh_mart"
[0m16:30:39.244148 [debug] [ThreadPool]: On list_bank_rates_dwh_mart: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_dwh_mart"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dwh_mart'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dwh_mart'
  
[0m16:30:39.246753 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.0 seconds
[0m16:30:39.248025 [debug] [ThreadPool]: On list_bank_rates_dwh_mart: ROLLBACK
[0m16:30:39.248519 [debug] [ThreadPool]: On list_bank_rates_dwh_mart: Close
[0m16:30:39.255340 [debug] [MainThread]: Using postgres connection "master"
[0m16:30:39.255731 [debug] [MainThread]: On master: BEGIN
[0m16:30:39.256068 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:30:39.264423 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m16:30:39.264809 [debug] [MainThread]: Using postgres connection "master"
[0m16:30:39.265253 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m16:30:39.269927 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m16:30:39.271243 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '630a1a1f-fd4f-4fa7-961e-a2733996af42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x799c1bfe2890>]}
[0m16:30:39.271745 [debug] [MainThread]: On master: ROLLBACK
[0m16:30:39.272214 [debug] [MainThread]: Using postgres connection "master"
[0m16:30:39.272533 [debug] [MainThread]: On master: BEGIN
[0m16:30:39.273080 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m16:30:39.273431 [debug] [MainThread]: On master: COMMIT
[0m16:30:39.273767 [debug] [MainThread]: Using postgres connection "master"
[0m16:30:39.274066 [debug] [MainThread]: On master: COMMIT
[0m16:30:39.274451 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m16:30:39.274762 [debug] [MainThread]: On master: Close
[0m16:30:39.275484 [info ] [MainThread]: Concurrency: 2 threads (target='dev')
[0m16:30:39.275882 [info ] [MainThread]: 
[0m16:30:39.298144 [debug] [Thread-1 (]: Began running node model.bank_rates.stg_cbr_precious_metals
[0m16:30:39.298829 [info ] [Thread-1 (]: 1 of 4 START sql view model dwh_staging.stg_cbr_precious_metals ................ [RUN]
[0m16:30:39.299716 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_bank_rates_dwh_mart, now model.bank_rates.stg_cbr_precious_metals)
[0m16:30:39.300152 [debug] [Thread-1 (]: Began compiling node model.bank_rates.stg_cbr_precious_metals
[0m16:30:39.303661 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_rates.stg_cbr_precious_metals"
[0m16:30:39.304553 [debug] [Thread-1 (]: Timing info for model.bank_rates.stg_cbr_precious_metals (compile): 16:30:39.300382 => 16:30:39.304285
[0m16:30:39.305126 [debug] [Thread-1 (]: Began executing node model.bank_rates.stg_cbr_precious_metals
[0m16:30:39.344880 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_rates.stg_cbr_precious_metals"
[0m16:30:39.345794 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m16:30:39.346198 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: BEGIN
[0m16:30:39.346503 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:30:39.355405 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m16:30:39.355828 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m16:30:39.356222 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */

  create view "bank_rates"."dwh_staging"."stg_cbr_precious_metals__dbt_tmp"
    
    
  as (
    

SELECT 
    record_date::DATE as trade_date,
    metal_code::INTEGER as metal_code,
    CASE 
        WHEN metal_code = 1 THEN 'Ð—Ð¾Ð»Ð¾Ñ‚Ð¾'
        WHEN metal_code = 2 THEN 'Ð¡ÐµÑ€ÐµÐ±Ñ€Ð¾'
        WHEN metal_code = 3 THEN 'ÐŸÐ»Ð°Ñ‚Ð¸Ð½Ð°'
        WHEN metal_code = 4 THEN 'ÐŸÐ°Ð»Ð»Ð°Ð´Ð¸Ð¹'
        ELSE 'ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ð¹ Ð¼ÐµÑ‚Ð°Ð»Ð»'
    END as metal_name,
    buy_price::DECIMAL(10,2) as buy_price_rub,
    sell_price::DECIMAL(10,2) as sell_price_rub,
    load_timestamp::TIMESTAMP as loaded_at
FROM raw.cbr_precious_metals
  );
[0m16:30:39.381121 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.0 seconds
[0m16:30:39.388766 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m16:30:39.389303 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
alter table "bank_rates"."dwh_staging"."stg_cbr_precious_metals__dbt_tmp" rename to "stg_cbr_precious_metals"
[0m16:30:39.390096 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m16:30:39.407442 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: COMMIT
[0m16:30:39.407945 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m16:30:39.408368 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: COMMIT
[0m16:30:39.419796 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m16:30:39.426028 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m16:30:39.426521 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
drop view if exists "bank_rates"."dwh_staging"."stg_cbr_precious_metals__dbt_backup" cascade
[0m16:30:39.431606 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.0 seconds
[0m16:30:39.433202 [debug] [Thread-1 (]: Timing info for model.bank_rates.stg_cbr_precious_metals (execute): 16:30:39.305480 => 16:30:39.432982
[0m16:30:39.433587 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: Close
[0m16:30:39.434377 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '630a1a1f-fd4f-4fa7-961e-a2733996af42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x799c1c3ee2f0>]}
[0m16:30:39.435019 [info ] [Thread-1 (]: 1 of 4 OK created sql view model dwh_staging.stg_cbr_precious_metals ........... [[32mCREATE VIEW[0m in 0.14s]
[0m16:30:39.435868 [debug] [Thread-1 (]: Finished running node model.bank_rates.stg_cbr_precious_metals
[0m16:30:39.436866 [debug] [Thread-2 (]: Began running node model.bank_rates.dim_metals
[0m16:30:39.437239 [debug] [Thread-1 (]: Began running node model.bank_rates.fact_metal_prices
[0m16:30:39.437729 [info ] [Thread-2 (]: 2 of 4 START sql table model dwh_dds.dim_metals ................................ [RUN]
[0m16:30:39.438387 [info ] [Thread-1 (]: 3 of 4 START sql table model dwh_dds.fact_metal_prices ......................... [RUN]
[0m16:30:39.439234 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_bank_rates_dwh_staging, now model.bank_rates.dim_metals)
[0m16:30:39.439892 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.bank_rates.stg_cbr_precious_metals, now model.bank_rates.fact_metal_prices)
[0m16:30:39.440343 [debug] [Thread-2 (]: Began compiling node model.bank_rates.dim_metals
[0m16:30:39.440738 [debug] [Thread-1 (]: Began compiling node model.bank_rates.fact_metal_prices
[0m16:30:39.445507 [debug] [Thread-2 (]: Writing injected SQL for node "model.bank_rates.dim_metals"
[0m16:30:39.448969 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_rates.fact_metal_prices"
[0m16:30:39.449888 [debug] [Thread-1 (]: Timing info for model.bank_rates.fact_metal_prices (compile): 16:30:39.445823 => 16:30:39.449628
[0m16:30:39.450397 [debug] [Thread-2 (]: Timing info for model.bank_rates.dim_metals (compile): 16:30:39.441041 => 16:30:39.450133
[0m16:30:39.450764 [debug] [Thread-1 (]: Began executing node model.bank_rates.fact_metal_prices
[0m16:30:39.451225 [debug] [Thread-2 (]: Began executing node model.bank_rates.dim_metals
[0m16:30:39.480282 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_rates.fact_metal_prices"
[0m16:30:39.484514 [debug] [Thread-2 (]: Writing runtime sql for node "model.bank_rates.dim_metals"
[0m16:30:39.485480 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m16:30:39.485922 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m16:30:39.486377 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: BEGIN
[0m16:30:39.486783 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: BEGIN
[0m16:30:39.487173 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m16:30:39.487545 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:30:39.497322 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m16:30:39.497799 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m16:30:39.498311 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m16:30:39.498777 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m16:30:39.499243 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */

  
    

  create  table "bank_rates"."dwh_dds"."dim_metals__dbt_tmp"
  
  
    as
  
  (
    

SELECT DISTINCT
    metal_code,
    metal_name
FROM "bank_rates"."dwh_staging"."stg_cbr_precious_metals"
WHERE metal_code IS NOT NULL
  );
  
[0m16:30:39.499706 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */

  
    

  create  table "bank_rates"."dwh_dds"."fact_metal_prices__dbt_tmp"
  
  
    as
  
  (
    

SELECT 
    ROW_NUMBER() OVER (ORDER BY trade_date, metal_code) as price_id,
    trade_date,
    metal_code,
    metal_name,
    buy_price_rub,
    sell_price_rub,
    loaded_at,
    CURRENT_TIMESTAMP as dwh_loaded_at
FROM "bank_rates"."dwh_staging"."stg_cbr_precious_metals"
WHERE trade_date IS NOT NULL
  AND metal_code IS NOT NULL
  );
  
[0m16:30:39.760252 [debug] [Thread-2 (]: SQL status: SELECT 4 in 0.0 seconds
[0m16:30:39.766853 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m16:30:39.767550 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
alter table "bank_rates"."dwh_dds"."dim_metals__dbt_tmp" rename to "dim_metals"
[0m16:30:39.768521 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m16:30:39.778699 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: COMMIT
[0m16:30:39.779293 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m16:30:39.779675 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: COMMIT
[0m16:30:39.789316 [debug] [Thread-1 (]: SQL status: SELECT 16796 in 0.0 seconds
[0m16:30:39.792924 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m16:30:39.793387 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
alter table "bank_rates"."dwh_dds"."fact_metal_prices__dbt_tmp" rename to "fact_metal_prices"
[0m16:30:39.794097 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m16:30:39.795994 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: COMMIT
[0m16:30:39.796389 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m16:30:39.796695 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: COMMIT
[0m16:30:39.989313 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m16:30:39.989967 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m16:30:39.994115 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m16:30:40.036440 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m16:30:40.037113 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
drop table if exists "bank_rates"."dwh_dds"."fact_metal_prices__dbt_backup" cascade
[0m16:30:40.037791 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
drop table if exists "bank_rates"."dwh_dds"."dim_metals__dbt_backup" cascade
[0m16:30:40.038676 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m16:30:40.039100 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m16:30:40.041029 [debug] [Thread-1 (]: Timing info for model.bank_rates.fact_metal_prices (execute): 16:30:39.451502 => 16:30:40.040705
[0m16:30:40.042866 [debug] [Thread-2 (]: Timing info for model.bank_rates.dim_metals (execute): 16:30:39.473072 => 16:30:40.042652
[0m16:30:40.043352 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: Close
[0m16:30:40.043824 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: Close
[0m16:30:40.044950 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '630a1a1f-fd4f-4fa7-961e-a2733996af42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x799c1bfdb5b0>]}
[0m16:30:40.046002 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '630a1a1f-fd4f-4fa7-961e-a2733996af42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x799c1bbc4040>]}
[0m16:30:40.046938 [info ] [Thread-1 (]: 3 of 4 OK created sql table model dwh_dds.fact_metal_prices .................... [[32mSELECT 16796[0m in 0.61s]
[0m16:30:40.047880 [info ] [Thread-2 (]: 2 of 4 OK created sql table model dwh_dds.dim_metals ........................... [[32mSELECT 4[0m in 0.61s]
[0m16:30:40.048743 [debug] [Thread-1 (]: Finished running node model.bank_rates.fact_metal_prices
[0m16:30:40.049421 [debug] [Thread-2 (]: Finished running node model.bank_rates.dim_metals
[0m16:30:40.050239 [debug] [Thread-1 (]: Began running node model.bank_rates.metal_prices_analytics
[0m16:30:40.050952 [info ] [Thread-1 (]: 4 of 4 START sql table model dwh_mart.metal_prices_analytics ................... [RUN]
[0m16:30:40.051729 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.bank_rates.fact_metal_prices, now model.bank_rates.metal_prices_analytics)
[0m16:30:40.052154 [debug] [Thread-1 (]: Began compiling node model.bank_rates.metal_prices_analytics
[0m16:30:40.056337 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_rates.metal_prices_analytics"
[0m16:30:40.057166 [debug] [Thread-1 (]: Timing info for model.bank_rates.metal_prices_analytics (compile): 16:30:40.052384 => 16:30:40.056881
[0m16:30:40.057590 [debug] [Thread-1 (]: Began executing node model.bank_rates.metal_prices_analytics
[0m16:30:40.062211 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_rates.metal_prices_analytics"
[0m16:30:40.062939 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m16:30:40.063398 [debug] [Thread-1 (]: On model.bank_rates.metal_prices_analytics: BEGIN
[0m16:30:40.063793 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:30:40.073190 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m16:30:40.073691 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m16:30:40.074170 [debug] [Thread-1 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */

  
    

  create  table "bank_rates"."dwh_mart"."metal_prices_analytics__dbt_tmp"
  
  
    as
  
  (
    

SELECT 
    f.trade_date,
    f.metal_name,
    f.buy_price_rub,
    f.sell_price_rub,
    ROUND((f.buy_price_rub + f.sell_price_rub) / 2, 2) as avg_price_rub,
    LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) as prev_buy_price,
    LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) as prev_sell_price,
    CASE 
        WHEN LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) IS NOT NULL 
        THEN ROUND((f.buy_price_rub - LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date)) / 
                   LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) * 100, 2)
        ELSE NULL 
    END as buy_price_change_percent,
    CASE 
        WHEN LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) IS NOT NULL 
        THEN ROUND((f.sell_price_rub - LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date)) / 
                   LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) * 100, 2)
        ELSE NULL 
    END as sell_price_change_percent
FROM "bank_rates"."dwh_dds"."fact_metal_prices" f
ORDER BY f.trade_date DESC, f.metal_name
  );
  
[0m16:30:40.152006 [debug] [Thread-1 (]: SQL status: SELECT 16796 in 0.0 seconds
[0m16:30:40.156247 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m16:30:40.156703 [debug] [Thread-1 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
alter table "bank_rates"."dwh_mart"."metal_prices_analytics__dbt_tmp" rename to "metal_prices_analytics"
[0m16:30:40.157477 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m16:30:40.159379 [debug] [Thread-1 (]: On model.bank_rates.metal_prices_analytics: COMMIT
[0m16:30:40.159782 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m16:30:40.160140 [debug] [Thread-1 (]: On model.bank_rates.metal_prices_analytics: COMMIT
[0m16:30:40.213311 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m16:30:40.216600 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m16:30:40.217138 [debug] [Thread-1 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
drop table if exists "bank_rates"."dwh_mart"."metal_prices_analytics__dbt_backup" cascade
[0m16:30:40.217893 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m16:30:40.219543 [debug] [Thread-1 (]: Timing info for model.bank_rates.metal_prices_analytics (execute): 16:30:40.057827 => 16:30:40.219345
[0m16:30:40.219920 [debug] [Thread-1 (]: On model.bank_rates.metal_prices_analytics: Close
[0m16:30:40.220725 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '630a1a1f-fd4f-4fa7-961e-a2733996af42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x799c1bbc4040>]}
[0m16:30:40.221436 [info ] [Thread-1 (]: 4 of 4 OK created sql table model dwh_mart.metal_prices_analytics .............. [[32mSELECT 16796[0m in 0.17s]
[0m16:30:40.222238 [debug] [Thread-1 (]: Finished running node model.bank_rates.metal_prices_analytics
[0m16:30:40.223867 [debug] [MainThread]: Using postgres connection "master"
[0m16:30:40.224246 [debug] [MainThread]: On master: BEGIN
[0m16:30:40.224545 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:30:40.233312 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m16:30:40.233689 [debug] [MainThread]: On master: COMMIT
[0m16:30:40.233957 [debug] [MainThread]: Using postgres connection "master"
[0m16:30:40.234223 [debug] [MainThread]: On master: COMMIT
[0m16:30:40.234635 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m16:30:40.234945 [debug] [MainThread]: On master: Close
[0m16:30:40.235773 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:30:40.236185 [debug] [MainThread]: Connection 'model.bank_rates.dim_metals' was properly closed.
[0m16:30:40.236513 [debug] [MainThread]: Connection 'model.bank_rates.metal_prices_analytics' was properly closed.
[0m16:30:40.236944 [info ] [MainThread]: 
[0m16:30:40.237431 [info ] [MainThread]: Finished running 1 view model, 3 table models in 0 hours 0 minutes and 1.16 seconds (1.16s).
[0m16:30:40.238721 [debug] [MainThread]: Command end result
[0m16:30:40.246068 [info ] [MainThread]: 
[0m16:30:40.246544 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:30:40.246930 [info ] [MainThread]: 
[0m16:30:40.247379 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m16:30:40.247965 [debug] [MainThread]: Command `dbt run` succeeded at 16:30:40.247844 after 2.41 seconds
[0m16:30:40.248329 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x799c1e5ed990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x799c1cfecca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x799c1bbbbd90>]}
[0m16:30:40.248690 [debug] [MainThread]: Flushing usage events
[0m16:33:36.793590 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72af01519a20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72aefffafac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72aefffafb80>]}


============================== 16:33:36.797070 | 0df9a4b8-c040-4c37-a148-e74434671511 ==============================
[0m16:33:36.797070 [info ] [MainThread]: Running with dbt=1.5.0
[0m16:33:36.797771 [debug] [MainThread]: running dbt with arguments {'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'debug': 'False', 'static_parser': 'True', 'profiles_dir': '.', 'log_format': 'default', 'log_cache_events': 'False', 'version_check': 'True', 'printer_width': '80', 'target_path': 'None', 'no_print': 'None', 'introspect': 'True', 'fail_fast': 'False', 'quiet': 'False', 'log_path': '/usr/app/logs', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'write_json': 'True', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'use_experimental_parser': 'False', 'warn_error': 'None'}
[0m16:33:36.831616 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0df9a4b8-c040-4c37-a148-e74434671511', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72aefffafb80>]}
[0m16:33:36.840448 [debug] [MainThread]: Command `dbt clean` succeeded at 16:33:36.840287 after 0.06 seconds
[0m16:33:36.840864 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72af01519a20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72aefffafb80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72aefffafaf0>]}
[0m16:33:36.841284 [debug] [MainThread]: Flushing usage events
[0m16:33:39.413967 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76ab4cf21990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76ab4b9cfbe0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76ab4b9cfa60>]}


============================== 16:33:39.417502 | 38242b46-4a14-4f61-b621-3ab770289a77 ==============================
[0m16:33:39.417502 [info ] [MainThread]: Running with dbt=1.5.0
[0m16:33:39.418163 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'printer_width': '80', 'log_path': '/usr/app/logs', 'debug': 'False', 'target_path': 'None', 'use_experimental_parser': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'profiles_dir': '.', 'version_check': 'True', 'log_cache_events': 'False', 'static_parser': 'True', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'write_json': 'True', 'log_format': 'default', 'use_colors': 'True', 'partial_parse': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False'}
[0m16:33:39.531503 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '38242b46-4a14-4f61-b621-3ab770289a77', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76ab4b9cfb20>]}
[0m16:33:39.552853 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '38242b46-4a14-4f61-b621-3ab770289a77', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76ab4b8f1000>]}
[0m16:33:39.553863 [error] [MainThread]: Encountered an error:
Compilation Error
  dbt found 1 package(s) specified in packages.yml, but only 0 package(s) installed in dbt_packages. Run "dbt deps" to install package dependencies.
[0m16:33:39.554684 [debug] [MainThread]: Command `dbt run` failed at 16:33:39.554491 after 0.15 seconds
[0m16:33:39.555094 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76ab4cf21990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76ab4b8f00a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76ab4b8f2890>]}
[0m16:33:39.555423 [debug] [MainThread]: Flushing usage events
[0m16:35:34.190300 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f38e0cd960>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f38cbcfa00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f38cbcfac0>]}


============================== 16:35:34.193635 | 47a0e5b9-0b51-4acb-801d-f061757e9c47 ==============================
[0m16:35:34.193635 [info ] [MainThread]: Running with dbt=1.5.0
[0m16:35:34.194330 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'printer_width': '80', 'log_path': '/usr/app/logs', 'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'profiles_dir': '.', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'log_cache_events': 'False', 'static_parser': 'True', 'use_experimental_parser': 'False', 'target_path': 'None', 'version_check': 'True', 'cache_selected_only': 'False', 'fail_fast': 'False', 'log_format': 'default', 'indirect_selection': 'eager', 'debug': 'False', 'warn_error': 'None', 'no_print': 'None', 'use_colors': 'True'}
[0m16:35:34.228182 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '47a0e5b9-0b51-4acb-801d-f061757e9c47', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f38cbcfac0>]}
[0m16:35:34.229379 [debug] [MainThread]: Set downloads directory='/tmp/dbt-downloads-mzb11jxv'
[0m16:35:34.229964 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m16:35:34.332098 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m16:35:34.333842 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m16:35:34.422459 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m16:35:34.434249 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m16:35:34.808901 [info ] [MainThread]: Installed from version 1.0.0
[0m16:35:34.809510 [info ] [MainThread]: Updated version available: 1.3.3
[0m16:35:34.810027 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': '47a0e5b9-0b51-4acb-801d-f061757e9c47', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f38ca47f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f38ca464a0>]}
[0m16:35:34.810471 [info ] [MainThread]: 
[0m16:35:34.810812 [info ] [MainThread]: Updates available for packages: ['dbt-labs/dbt_utils']                 
Update your versions in packages.yml, then run dbt deps
[0m16:35:34.811638 [debug] [MainThread]: Command `dbt deps` succeeded at 16:35:34.811493 after 0.63 seconds
[0m16:35:34.811954 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f38e0cd960>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f38cbcfac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f38cbcfa30>]}
[0m16:35:34.812305 [debug] [MainThread]: Flushing usage events
[0m16:35:41.323505 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f23c877d960>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f23c71cfbb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f23c71cfa30>]}


============================== 16:35:41.326820 | 3a8f711d-4721-4d19-a8cc-e86ac6546d16 ==============================
[0m16:35:41.326820 [info ] [MainThread]: Running with dbt=1.5.0
[0m16:35:41.327507 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'log_path': '/usr/app/logs', 'printer_width': '80', 'warn_error': 'None', 'cache_selected_only': 'False', 'debug': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'partial_parse': 'True', 'introspect': 'True', 'use_colors': 'True', 'log_format': 'default', 'log_cache_events': 'False', 'write_json': 'True', 'static_parser': 'True', 'use_experimental_parser': 'False', 'profiles_dir': '.', 'fail_fast': 'False', 'no_print': 'None', 'target_path': 'None'}
[0m16:35:41.437636 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3a8f711d-4721-4d19-a8cc-e86ac6546d16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f23c71cfaf0>]}
[0m16:35:41.458855 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3a8f711d-4721-4d19-a8cc-e86ac6546d16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f23c70f0fa0>]}
[0m16:35:41.477908 [debug] [MainThread]: checksum: 4568eb639a77b8fcb3a1f4a07856f42b1ff63f1376652889143968e1dbdafbda, vars: {}, profile: , target: , version: 1.5.0
[0m16:35:41.478601 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m16:35:41.479070 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '3a8f711d-4721-4d19-a8cc-e86ac6546d16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f23c70f3d30>]}
[0m16:35:42.378131 [debug] [MainThread]: 1699: static parser successfully parsed mart/metal_prices_analytics.sql
[0m16:35:42.394397 [debug] [MainThread]: 1699: static parser successfully parsed dds/dim_metals.sql
[0m16:35:42.398683 [debug] [MainThread]: 1699: static parser successfully parsed dds/fact_metal_prices.sql
[0m16:35:42.402525 [debug] [MainThread]: 1699: static parser successfully parsed staging/stg_cbr_precious_metals.sql
[0m16:35:42.454021 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3a8f711d-4721-4d19-a8cc-e86ac6546d16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f23c61efd00>]}
[0m16:35:42.461772 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3a8f711d-4721-4d19-a8cc-e86ac6546d16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f23c70f5060>]}
[0m16:35:42.462384 [info ] [MainThread]: Found 4 models, 0 tests, 0 snapshots, 0 analyses, 419 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m16:35:42.462820 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3a8f711d-4721-4d19-a8cc-e86ac6546d16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f23c70f59f0>]}
[0m16:35:42.464545 [info ] [MainThread]: 
[0m16:35:42.465427 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m16:35:42.466932 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m16:35:42.478290 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m16:35:42.481047 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m16:35:42.483668 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m16:35:42.484150 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m16:35:42.484574 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m16:35:42.484941 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:35:42.485282 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:35:42.501965 [debug] [ThreadPool]: SQL status: SELECT 10 in 0.0 seconds
[0m16:35:42.502481 [debug] [ThreadPool]: SQL status: SELECT 10 in 0.0 seconds
[0m16:35:42.504128 [debug] [ThreadPool]: On list_bank_rates: Close
[0m16:35:42.505579 [debug] [ThreadPool]: On list_bank_rates: Close
[0m16:35:42.509624 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m16:35:42.510637 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m16:35:42.511104 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:35:42.520260 [debug] [ThreadPool]: SQL status: SELECT 10 in 0.0 seconds
[0m16:35:42.521679 [debug] [ThreadPool]: On list_bank_rates: Close
[0m16:35:42.522976 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates, now create_bank_rates_public_mart)
[0m16:35:42.523677 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates, now create_bank_rates_public_dds)
[0m16:35:42.524397 [debug] [ThreadPool]: Creating schema "database: "bank_rates"
schema: "public_mart"
"
[0m16:35:42.525128 [debug] [ThreadPool]: Creating schema "database: "bank_rates"
schema: "public_dds"
"
[0m16:35:42.531732 [debug] [ThreadPool]: Using postgres connection "create_bank_rates_public_mart"
[0m16:35:42.534129 [debug] [ThreadPool]: Using postgres connection "create_bank_rates_public_dds"
[0m16:35:42.534545 [debug] [ThreadPool]: On create_bank_rates_public_mart: BEGIN
[0m16:35:42.534921 [debug] [ThreadPool]: On create_bank_rates_public_dds: BEGIN
[0m16:35:42.535301 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:35:42.535644 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:35:42.546361 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m16:35:42.546830 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m16:35:42.547297 [debug] [ThreadPool]: Using postgres connection "create_bank_rates_public_dds"
[0m16:35:42.547700 [debug] [ThreadPool]: Using postgres connection "create_bank_rates_public_mart"
[0m16:35:42.548076 [debug] [ThreadPool]: On create_bank_rates_public_dds: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "create_bank_rates_public_dds"} */
create schema if not exists "public_dds"
[0m16:35:42.548485 [debug] [ThreadPool]: On create_bank_rates_public_mart: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "create_bank_rates_public_mart"} */
create schema if not exists "public_mart"
[0m16:35:42.549381 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.0 seconds
[0m16:35:42.550519 [debug] [ThreadPool]: On create_bank_rates_public_mart: COMMIT
[0m16:35:42.550832 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.0 seconds
[0m16:35:42.551216 [debug] [ThreadPool]: Using postgres connection "create_bank_rates_public_mart"
[0m16:35:42.552261 [debug] [ThreadPool]: On create_bank_rates_public_dds: COMMIT
[0m16:35:42.552677 [debug] [ThreadPool]: On create_bank_rates_public_mart: COMMIT
[0m16:35:42.553018 [debug] [ThreadPool]: Using postgres connection "create_bank_rates_public_dds"
[0m16:35:42.553491 [debug] [ThreadPool]: On create_bank_rates_public_dds: COMMIT
[0m16:35:42.554552 [debug] [ThreadPool]: SQL status: COMMIT in 0.0 seconds
[0m16:35:42.554883 [debug] [ThreadPool]: On create_bank_rates_public_mart: Close
[0m16:35:42.556268 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_bank_rates_public_mart, now create_bank_rates_public_staging)
[0m16:35:42.556686 [debug] [ThreadPool]: SQL status: COMMIT in 0.0 seconds
[0m16:35:42.557380 [debug] [ThreadPool]: Creating schema "database: "bank_rates"
schema: "public_staging"
"
[0m16:35:42.557745 [debug] [ThreadPool]: On create_bank_rates_public_dds: Close
[0m16:35:42.560325 [debug] [ThreadPool]: Using postgres connection "create_bank_rates_public_staging"
[0m16:35:42.560826 [debug] [ThreadPool]: On create_bank_rates_public_staging: BEGIN
[0m16:35:42.562006 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:35:42.570535 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m16:35:42.570935 [debug] [ThreadPool]: Using postgres connection "create_bank_rates_public_staging"
[0m16:35:42.571331 [debug] [ThreadPool]: On create_bank_rates_public_staging: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "create_bank_rates_public_staging"} */
create schema if not exists "public_staging"
[0m16:35:42.572001 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.0 seconds
[0m16:35:42.573094 [debug] [ThreadPool]: On create_bank_rates_public_staging: COMMIT
[0m16:35:42.573444 [debug] [ThreadPool]: Using postgres connection "create_bank_rates_public_staging"
[0m16:35:42.573749 [debug] [ThreadPool]: On create_bank_rates_public_staging: COMMIT
[0m16:35:42.576659 [debug] [ThreadPool]: SQL status: COMMIT in 0.0 seconds
[0m16:35:42.576980 [debug] [ThreadPool]: On create_bank_rates_public_staging: Close
[0m16:35:42.579403 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_bank_rates_public_staging, now list_bank_rates_public_mart)
[0m16:35:42.580248 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_bank_rates_public_dds, now list_bank_rates_public_dds)
[0m16:35:42.587497 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_public_mart"
[0m16:35:42.590135 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_public_dds"
[0m16:35:42.590555 [debug] [ThreadPool]: On list_bank_rates_public_mart: BEGIN
[0m16:35:42.590907 [debug] [ThreadPool]: On list_bank_rates_public_dds: BEGIN
[0m16:35:42.591251 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:35:42.591555 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:35:42.601448 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m16:35:42.601957 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_public_dds"
[0m16:35:42.602374 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m16:35:42.602753 [debug] [ThreadPool]: On list_bank_rates_public_dds: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_public_dds"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_dds'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_dds'
  
[0m16:35:42.603230 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_public_mart"
[0m16:35:42.603691 [debug] [ThreadPool]: On list_bank_rates_public_mart: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_public_mart"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_mart'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_mart'
  
[0m16:35:42.606275 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.0 seconds
[0m16:35:42.606666 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.0 seconds
[0m16:35:42.608021 [debug] [ThreadPool]: On list_bank_rates_public_dds: ROLLBACK
[0m16:35:42.609334 [debug] [ThreadPool]: On list_bank_rates_public_mart: ROLLBACK
[0m16:35:42.609876 [debug] [ThreadPool]: On list_bank_rates_public_dds: Close
[0m16:35:42.610256 [debug] [ThreadPool]: On list_bank_rates_public_mart: Close
[0m16:35:42.611429 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates_public_dds, now list_bank_rates_public_staging)
[0m16:35:42.615474 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_public_staging"
[0m16:35:42.615839 [debug] [ThreadPool]: On list_bank_rates_public_staging: BEGIN
[0m16:35:42.616131 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:35:42.624115 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m16:35:42.624481 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_public_staging"
[0m16:35:42.624816 [debug] [ThreadPool]: On list_bank_rates_public_staging: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_public_staging"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public_staging'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public_staging'
  
[0m16:35:42.627426 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.0 seconds
[0m16:35:42.628738 [debug] [ThreadPool]: On list_bank_rates_public_staging: ROLLBACK
[0m16:35:42.629231 [debug] [ThreadPool]: On list_bank_rates_public_staging: Close
[0m16:35:42.635770 [debug] [MainThread]: Using postgres connection "master"
[0m16:35:42.636159 [debug] [MainThread]: On master: BEGIN
[0m16:35:42.636487 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:35:42.644862 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m16:35:42.645422 [debug] [MainThread]: Using postgres connection "master"
[0m16:35:42.645995 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m16:35:42.654442 [debug] [MainThread]: SQL status: SELECT 1 in 0.0 seconds
[0m16:35:42.656034 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3a8f711d-4721-4d19-a8cc-e86ac6546d16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f23c5de0670>]}
[0m16:35:42.656732 [debug] [MainThread]: On master: ROLLBACK
[0m16:35:42.657314 [debug] [MainThread]: Using postgres connection "master"
[0m16:35:42.657670 [debug] [MainThread]: On master: BEGIN
[0m16:35:42.658305 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m16:35:42.658683 [debug] [MainThread]: On master: COMMIT
[0m16:35:42.658964 [debug] [MainThread]: Using postgres connection "master"
[0m16:35:42.659319 [debug] [MainThread]: On master: COMMIT
[0m16:35:42.659727 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m16:35:42.660148 [debug] [MainThread]: On master: Close
[0m16:35:42.661069 [info ] [MainThread]: Concurrency: 2 threads (target='dev')
[0m16:35:42.661579 [info ] [MainThread]: 
[0m16:35:42.665875 [debug] [Thread-1 (]: Began running node model.bank_rates.stg_cbr_precious_metals
[0m16:35:42.666484 [info ] [Thread-1 (]: 1 of 4 START sql view model public_staging.stg_cbr_precious_metals ............. [RUN]
[0m16:35:42.667399 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_bank_rates_public_staging, now model.bank_rates.stg_cbr_precious_metals)
[0m16:35:42.667840 [debug] [Thread-1 (]: Began compiling node model.bank_rates.stg_cbr_precious_metals
[0m16:35:42.671745 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_rates.stg_cbr_precious_metals"
[0m16:35:42.672696 [debug] [Thread-1 (]: Timing info for model.bank_rates.stg_cbr_precious_metals (compile): 16:35:42.668228 => 16:35:42.672343
[0m16:35:42.673144 [debug] [Thread-1 (]: Began executing node model.bank_rates.stg_cbr_precious_metals
[0m16:35:42.715753 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_rates.stg_cbr_precious_metals"
[0m16:35:42.717102 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m16:35:42.717556 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: BEGIN
[0m16:35:42.717889 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:35:42.726856 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m16:35:42.727385 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m16:35:42.727835 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */

  create view "bank_rates"."public_staging"."stg_cbr_precious_metals__dbt_tmp"
    
    
  as (
    

SELECT 
    record_date::DATE as trade_date,
    metal_code::INTEGER as metal_code,
    CASE 
        WHEN metal_code = 1 THEN 'Ð—Ð¾Ð»Ð¾Ñ‚Ð¾'
        WHEN metal_code = 2 THEN 'Ð¡ÐµÑ€ÐµÐ±Ñ€Ð¾'
        WHEN metal_code = 3 THEN 'ÐŸÐ»Ð°Ñ‚Ð¸Ð½Ð°'
        WHEN metal_code = 4 THEN 'ÐŸÐ°Ð»Ð»Ð°Ð´Ð¸Ð¹'
        ELSE 'ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ð¹ Ð¼ÐµÑ‚Ð°Ð»Ð»'
    END as metal_name,
    buy_price::DECIMAL(10,2) as buy_price_rub,
    sell_price::DECIMAL(10,2) as sell_price_rub,
    load_timestamp::TIMESTAMP as loaded_at
FROM raw.cbr_precious_metals
  );
[0m16:35:42.729996 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.0 seconds
[0m16:35:42.737781 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m16:35:42.738270 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
alter table "bank_rates"."public_staging"."stg_cbr_precious_metals__dbt_tmp" rename to "stg_cbr_precious_metals"
[0m16:35:42.739015 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m16:35:42.756094 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: COMMIT
[0m16:35:42.756703 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m16:35:42.757219 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: COMMIT
[0m16:35:42.760044 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m16:35:42.766048 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m16:35:42.766530 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
drop view if exists "bank_rates"."public_staging"."stg_cbr_precious_metals__dbt_backup" cascade
[0m16:35:42.767165 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.0 seconds
[0m16:35:42.768803 [debug] [Thread-1 (]: Timing info for model.bank_rates.stg_cbr_precious_metals (execute): 16:35:42.673379 => 16:35:42.768590
[0m16:35:42.769229 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: Close
[0m16:35:42.770003 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a8f711d-4721-4d19-a8cc-e86ac6546d16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f23c5de3a00>]}
[0m16:35:42.770677 [info ] [Thread-1 (]: 1 of 4 OK created sql view model public_staging.stg_cbr_precious_metals ........ [[32mCREATE VIEW[0m in 0.10s]
[0m16:35:42.771492 [debug] [Thread-1 (]: Finished running node model.bank_rates.stg_cbr_precious_metals
[0m16:35:42.772633 [debug] [Thread-2 (]: Began running node model.bank_rates.dim_metals
[0m16:35:42.773075 [debug] [Thread-1 (]: Began running node model.bank_rates.fact_metal_prices
[0m16:35:42.773646 [info ] [Thread-2 (]: 2 of 4 START sql table model public_dds.dim_metals ............................. [RUN]
[0m16:35:42.774338 [info ] [Thread-1 (]: 3 of 4 START sql table model public_dds.fact_metal_prices ...................... [RUN]
[0m16:35:42.775239 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_bank_rates_public_mart, now model.bank_rates.dim_metals)
[0m16:35:42.775945 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.bank_rates.stg_cbr_precious_metals, now model.bank_rates.fact_metal_prices)
[0m16:35:42.776403 [debug] [Thread-2 (]: Began compiling node model.bank_rates.dim_metals
[0m16:35:42.776832 [debug] [Thread-1 (]: Began compiling node model.bank_rates.fact_metal_prices
[0m16:35:42.781767 [debug] [Thread-2 (]: Writing injected SQL for node "model.bank_rates.dim_metals"
[0m16:35:42.785218 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_rates.fact_metal_prices"
[0m16:35:42.786175 [debug] [Thread-1 (]: Timing info for model.bank_rates.fact_metal_prices (compile): 16:35:42.782128 => 16:35:42.785884
[0m16:35:42.786684 [debug] [Thread-2 (]: Timing info for model.bank_rates.dim_metals (compile): 16:35:42.777157 => 16:35:42.786435
[0m16:35:42.787035 [debug] [Thread-1 (]: Began executing node model.bank_rates.fact_metal_prices
[0m16:35:42.787483 [debug] [Thread-2 (]: Began executing node model.bank_rates.dim_metals
[0m16:35:42.816836 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_rates.fact_metal_prices"
[0m16:35:42.821010 [debug] [Thread-2 (]: Writing runtime sql for node "model.bank_rates.dim_metals"
[0m16:35:42.821927 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m16:35:42.822434 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m16:35:42.822810 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: BEGIN
[0m16:35:42.823245 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: BEGIN
[0m16:35:42.823645 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:35:42.824018 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m16:35:42.836481 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m16:35:42.836915 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m16:35:42.837353 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m16:35:42.837776 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m16:35:42.838283 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */

  
    

  create  table "bank_rates"."public_dds"."dim_metals__dbt_tmp"
  
  
    as
  
  (
    

SELECT DISTINCT
    metal_code,
    metal_name
FROM "bank_rates"."public_staging"."stg_cbr_precious_metals"
WHERE metal_code IS NOT NULL
  );
  
[0m16:35:42.838768 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */

  
    

  create  table "bank_rates"."public_dds"."fact_metal_prices__dbt_tmp"
  
  
    as
  
  (
    

SELECT 
    ROW_NUMBER() OVER (ORDER BY trade_date, metal_code) as price_id,
    trade_date,
    metal_code,
    metal_name,
    buy_price_rub,
    sell_price_rub,
    loaded_at,
    CURRENT_TIMESTAMP as dwh_loaded_at
FROM "bank_rates"."public_staging"."stg_cbr_precious_metals"
WHERE trade_date IS NOT NULL
  AND metal_code IS NOT NULL
  );
  
[0m16:35:42.859911 [debug] [Thread-2 (]: SQL status: SELECT 4 in 0.0 seconds
[0m16:35:42.866414 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m16:35:42.867045 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
alter table "bank_rates"."public_dds"."dim_metals__dbt_tmp" rename to "dim_metals"
[0m16:35:42.867994 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m16:35:42.877980 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: COMMIT
[0m16:35:42.878572 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m16:35:42.879091 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: COMMIT
[0m16:35:42.884928 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m16:35:42.889450 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m16:35:42.889897 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
drop table if exists "bank_rates"."public_dds"."dim_metals__dbt_backup" cascade
[0m16:35:42.890550 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m16:35:42.892237 [debug] [Thread-2 (]: Timing info for model.bank_rates.dim_metals (execute): 16:35:42.809487 => 16:35:42.892009
[0m16:35:42.892671 [debug] [Thread-1 (]: SQL status: SELECT 16796 in 0.0 seconds
[0m16:35:42.893045 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: Close
[0m16:35:42.897618 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m16:35:42.898523 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a8f711d-4721-4d19-a8cc-e86ac6546d16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f23c59b5cf0>]}
[0m16:35:42.898918 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
alter table "bank_rates"."public_dds"."fact_metal_prices__dbt_tmp" rename to "fact_metal_prices"
[0m16:35:42.899633 [info ] [Thread-2 (]: 2 of 4 OK created sql table model public_dds.dim_metals ........................ [[32mSELECT 4[0m in 0.12s]
[0m16:35:42.900716 [debug] [Thread-2 (]: Finished running node model.bank_rates.dim_metals
[0m16:35:42.901163 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m16:35:42.903221 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: COMMIT
[0m16:35:42.903654 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m16:35:42.904000 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: COMMIT
[0m16:35:42.908598 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m16:35:42.945972 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m16:35:42.946472 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
drop table if exists "bank_rates"."public_dds"."fact_metal_prices__dbt_backup" cascade
[0m16:35:42.947225 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m16:35:42.948916 [debug] [Thread-1 (]: Timing info for model.bank_rates.fact_metal_prices (execute): 16:35:42.787747 => 16:35:42.948711
[0m16:35:42.949295 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: Close
[0m16:35:42.950256 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a8f711d-4721-4d19-a8cc-e86ac6546d16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f23c59b4e50>]}
[0m16:35:42.951102 [info ] [Thread-1 (]: 3 of 4 OK created sql table model public_dds.fact_metal_prices ................. [[32mSELECT 16796[0m in 0.17s]
[0m16:35:42.951941 [debug] [Thread-1 (]: Finished running node model.bank_rates.fact_metal_prices
[0m16:35:42.952969 [debug] [Thread-2 (]: Began running node model.bank_rates.metal_prices_analytics
[0m16:35:42.953462 [info ] [Thread-2 (]: 4 of 4 START sql table model public_mart.metal_prices_analytics ................ [RUN]
[0m16:35:42.954238 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bank_rates.dim_metals, now model.bank_rates.metal_prices_analytics)
[0m16:35:42.954604 [debug] [Thread-2 (]: Began compiling node model.bank_rates.metal_prices_analytics
[0m16:35:42.958354 [debug] [Thread-2 (]: Writing injected SQL for node "model.bank_rates.metal_prices_analytics"
[0m16:35:42.959078 [debug] [Thread-2 (]: Timing info for model.bank_rates.metal_prices_analytics (compile): 16:35:42.954794 => 16:35:42.958819
[0m16:35:42.959454 [debug] [Thread-2 (]: Began executing node model.bank_rates.metal_prices_analytics
[0m16:35:42.963563 [debug] [Thread-2 (]: Writing runtime sql for node "model.bank_rates.metal_prices_analytics"
[0m16:35:42.964182 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m16:35:42.964563 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: BEGIN
[0m16:35:42.964872 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m16:35:42.973653 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m16:35:42.974089 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m16:35:42.974480 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */

  
    

  create  table "bank_rates"."public_mart"."metal_prices_analytics__dbt_tmp"
  
  
    as
  
  (
    

SELECT 
    f.trade_date,
    f.metal_name,
    f.buy_price_rub,
    f.sell_price_rub,
    ROUND((f.buy_price_rub + f.sell_price_rub) / 2, 2) as avg_price_rub,
    LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) as prev_buy_price,
    LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) as prev_sell_price,
    CASE 
        WHEN LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) IS NOT NULL 
        THEN ROUND((f.buy_price_rub - LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date)) / 
                   LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) * 100, 2)
        ELSE NULL 
    END as buy_price_change_percent,
    CASE 
        WHEN LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) IS NOT NULL 
        THEN ROUND((f.sell_price_rub - LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date)) / 
                   LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) * 100, 2)
        ELSE NULL 
    END as sell_price_change_percent
FROM "bank_rates"."public_dds"."fact_metal_prices" f
ORDER BY f.trade_date DESC, f.metal_name
  );
  
[0m16:35:43.036972 [debug] [Thread-2 (]: SQL status: SELECT 16796 in 0.0 seconds
[0m16:35:43.041863 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m16:35:43.042331 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
alter table "bank_rates"."public_mart"."metal_prices_analytics__dbt_tmp" rename to "metal_prices_analytics"
[0m16:35:43.043210 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m16:35:43.045554 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: COMMIT
[0m16:35:43.045947 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m16:35:43.046285 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: COMMIT
[0m16:35:43.047812 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m16:35:43.050691 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m16:35:43.051087 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
drop table if exists "bank_rates"."public_mart"."metal_prices_analytics__dbt_backup" cascade
[0m16:35:43.051704 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m16:35:43.053530 [debug] [Thread-2 (]: Timing info for model.bank_rates.metal_prices_analytics (execute): 16:35:42.959660 => 16:35:43.053279
[0m16:35:43.054038 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: Close
[0m16:35:43.055030 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a8f711d-4721-4d19-a8cc-e86ac6546d16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f23c59b7400>]}
[0m16:35:43.055935 [info ] [Thread-2 (]: 4 of 4 OK created sql table model public_mart.metal_prices_analytics ........... [[32mSELECT 16796[0m in 0.10s]
[0m16:35:43.056846 [debug] [Thread-2 (]: Finished running node model.bank_rates.metal_prices_analytics
[0m16:35:43.058618 [debug] [MainThread]: Using postgres connection "master"
[0m16:35:43.058967 [debug] [MainThread]: On master: BEGIN
[0m16:35:43.059319 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:35:43.068600 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m16:35:43.069005 [debug] [MainThread]: On master: COMMIT
[0m16:35:43.069352 [debug] [MainThread]: Using postgres connection "master"
[0m16:35:43.069650 [debug] [MainThread]: On master: COMMIT
[0m16:35:43.070038 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m16:35:43.070369 [debug] [MainThread]: On master: Close
[0m16:35:43.071044 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:35:43.071365 [debug] [MainThread]: Connection 'model.bank_rates.fact_metal_prices' was properly closed.
[0m16:35:43.071649 [debug] [MainThread]: Connection 'model.bank_rates.metal_prices_analytics' was properly closed.
[0m16:35:43.072037 [info ] [MainThread]: 
[0m16:35:43.072479 [info ] [MainThread]: Finished running 1 view model, 3 table models in 0 hours 0 minutes and 0.61 seconds (0.61s).
[0m16:35:43.073810 [debug] [MainThread]: Command end result
[0m16:35:43.082152 [info ] [MainThread]: 
[0m16:35:43.082651 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:35:43.083121 [info ] [MainThread]: 
[0m16:35:43.083577 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m16:35:43.084184 [debug] [MainThread]: Command `dbt run` succeeded at 16:35:43.084042 after 1.77 seconds
[0m16:35:43.084537 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f23c877d960>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f23c619a2c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f23c619b4c0>]}
[0m16:35:43.084880 [debug] [MainThread]: Flushing usage events
[0m16:37:54.217744 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1187201990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1185cdba30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1185cdbaf0>]}


============================== 16:37:54.221837 | 5778a73e-a717-4ad3-8445-0bebf9bd28e6 ==============================
[0m16:37:54.221837 [info ] [MainThread]: Running with dbt=1.5.0
[0m16:37:54.222572 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'fail_fast': 'False', 'version_check': 'True', 'no_print': 'None', 'introspect': 'True', 'partial_parse': 'True', 'profiles_dir': '.', 'indirect_selection': 'eager', 'write_json': 'True', 'quiet': 'False', 'printer_width': '80', 'debug': 'False', 'warn_error': 'None', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'use_colors': 'True', 'log_format': 'default', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'log_path': '/usr/app/logs', 'static_parser': 'True'}
[0m16:37:54.257770 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5778a73e-a717-4ad3-8445-0bebf9bd28e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1185cdbaf0>]}
[0m16:37:54.266772 [debug] [MainThread]: Command `dbt clean` succeeded at 16:37:54.266589 after 0.06 seconds
[0m16:37:54.267230 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1187201990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1185cdbaf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d1185cdba60>]}
[0m16:37:54.267601 [debug] [MainThread]: Flushing usage events
[0m16:39:06.466463 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7742d99bd960>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7742d83dfbb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7742d83dfa30>]}


============================== 16:39:06.469955 | f3834313-0d19-4c2f-afc1-12e9ba6e0dc5 ==============================
[0m16:39:06.469955 [info ] [MainThread]: Running with dbt=1.5.0
[0m16:39:06.470628 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'log_cache_events': 'False', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'no_print': 'None', 'printer_width': '80', 'indirect_selection': 'eager', 'introspect': 'True', 'version_check': 'True', 'quiet': 'False', 'log_format': 'default', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'fail_fast': 'False', 'cache_selected_only': 'False', 'use_colors': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'target_path': 'None', 'log_path': '/usr/app/logs', 'profiles_dir': '.'}
[0m16:39:06.587399 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f3834313-0d19-4c2f-afc1-12e9ba6e0dc5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7742d83dfaf0>]}
[0m16:39:06.609305 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f3834313-0d19-4c2f-afc1-12e9ba6e0dc5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7742d82fef80>]}
[0m16:39:06.610391 [error] [MainThread]: Encountered an error:
Compilation Error
  dbt found 1 package(s) specified in packages.yml, but only 0 package(s) installed in dbt_packages. Run "dbt deps" to install package dependencies.
[0m16:39:06.611143 [debug] [MainThread]: Command `dbt run` failed at 16:39:06.610926 after 0.15 seconds
[0m16:39:06.611546 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7742d99bd960>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7742d82fd3c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7742d82ff970>]}
[0m16:39:06.611896 [debug] [MainThread]: Flushing usage events
[0m16:39:44.669735 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b79cb765990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b79ca1afa30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b79ca1afaf0>]}


============================== 16:39:44.672965 | 12a7a4ca-5be1-4ec3-a370-c011b0dd5db0 ==============================
[0m16:39:44.672965 [info ] [MainThread]: Running with dbt=1.5.0
[0m16:39:44.673657 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'no_print': 'None', 'use_experimental_parser': 'False', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_format': 'default', 'partial_parse': 'True', 'introspect': 'True', 'cache_selected_only': 'False', 'target_path': 'None', 'fail_fast': 'False', 'debug': 'False', 'quiet': 'False', 'version_check': 'True', 'send_anonymous_usage_stats': 'True', 'log_path': '/usr/app/logs', 'log_cache_events': 'False', 'printer_width': '80', 'indirect_selection': 'eager', 'warn_error': 'None', 'static_parser': 'True', 'profiles_dir': '.'}
[0m16:39:44.708002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '12a7a4ca-5be1-4ec3-a370-c011b0dd5db0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b79ca1afaf0>]}
[0m16:39:44.709201 [debug] [MainThread]: Set downloads directory='/tmp/dbt-downloads-sdb_xx1h'
[0m16:39:44.709758 [debug] [MainThread]: Making package index registry request: GET https://hub.getdbt.com/api/v1/index.json
[0m16:39:44.807965 [debug] [MainThread]: Response from registry index: GET https://hub.getdbt.com/api/v1/index.json 200
[0m16:39:44.809634 [debug] [MainThread]: Making package registry request: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json
[0m16:39:44.943012 [debug] [MainThread]: Response from registry: GET https://hub.getdbt.com/api/v1/dbt-labs/dbt_utils.json 200
[0m16:39:44.954047 [info ] [MainThread]: Installing dbt-labs/dbt_utils
[0m16:39:45.330836 [info ] [MainThread]: Installed from version 1.0.0
[0m16:39:45.331482 [info ] [MainThread]: Updated version available: 1.3.3
[0m16:39:45.332072 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'package', 'label': '12a7a4ca-5be1-4ec3-a370-c011b0dd5db0', 'property_': 'install', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b79ca027df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b79ca0257b0>]}
[0m16:39:45.332535 [info ] [MainThread]: 
[0m16:39:45.332898 [info ] [MainThread]: Updates available for packages: ['dbt-labs/dbt_utils']                 
Update your versions in packages.yml, then run dbt deps
[0m16:39:45.333726 [debug] [MainThread]: Command `dbt deps` succeeded at 16:39:45.333591 after 0.67 seconds
[0m16:39:45.334088 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b79cb765990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b79ca1afaf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b79ca1afa60>]}
[0m16:39:45.334477 [debug] [MainThread]: Flushing usage events
[0m16:39:53.797789 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75cb8c87d990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75cb8b2dbbe0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75cb8b2dba60>]}


============================== 16:39:53.801294 | 5e76071f-ef07-44f4-a637-a159ebf6fba2 ==============================
[0m16:39:53.801294 [info ] [MainThread]: Running with dbt=1.5.0
[0m16:39:53.801984 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'write_json': 'True', 'warn_error': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'partial_parse': 'True', 'log_cache_events': 'False', 'fail_fast': 'False', 'quiet': 'False', 'printer_width': '80', 'debug': 'False', 'version_check': 'True', 'introspect': 'True', 'use_colors': 'True', 'target_path': 'None', 'log_path': '/usr/app/logs', 'no_print': 'None', 'profiles_dir': '.', 'static_parser': 'True'}
[0m16:39:53.917858 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5e76071f-ef07-44f4-a637-a159ebf6fba2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75cb8b2dbb20>]}
[0m16:39:53.939712 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5e76071f-ef07-44f4-a637-a159ebf6fba2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75cb8b1f6aa0>]}
[0m16:39:53.958373 [debug] [MainThread]: checksum: 4568eb639a77b8fcb3a1f4a07856f42b1ff63f1376652889143968e1dbdafbda, vars: {}, profile: , target: , version: 1.5.0
[0m16:39:53.958985 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m16:39:53.959600 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '5e76071f-ef07-44f4-a637-a159ebf6fba2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75cb8b1f76a0>]}
[0m16:39:54.845495 [debug] [MainThread]: 1699: static parser successfully parsed mart/metal_prices_analytics.sql
[0m16:39:54.860497 [debug] [MainThread]: 1699: static parser successfully parsed dds/dim_metals.sql
[0m16:39:54.864519 [debug] [MainThread]: 1699: static parser successfully parsed dds/fact_metal_prices.sql
[0m16:39:54.868116 [debug] [MainThread]: 1699: static parser successfully parsed staging/stg_cbr_precious_metals.sql
[0m16:39:54.917266 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5e76071f-ef07-44f4-a637-a159ebf6fba2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75cb8a193d30>]}
[0m16:39:54.924859 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5e76071f-ef07-44f4-a637-a159ebf6fba2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75cb8b1f8ca0>]}
[0m16:39:54.925385 [info ] [MainThread]: Found 4 models, 0 tests, 0 snapshots, 0 analyses, 419 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m16:39:54.925787 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5e76071f-ef07-44f4-a637-a159ebf6fba2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75cb8b1f7790>]}
[0m16:39:54.927331 [info ] [MainThread]: 
[0m16:39:54.928171 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m16:39:54.929613 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m16:39:54.930508 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m16:39:54.942840 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m16:39:54.944974 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m16:39:54.945446 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m16:39:54.945883 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m16:39:54.946254 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:39:54.946614 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:39:54.959982 [debug] [ThreadPool]: SQL status: SELECT 13 in 0.0 seconds
[0m16:39:54.960400 [debug] [ThreadPool]: SQL status: SELECT 13 in 0.0 seconds
[0m16:39:54.961902 [debug] [ThreadPool]: On list_bank_rates: Close
[0m16:39:54.963337 [debug] [ThreadPool]: On list_bank_rates: Close
[0m16:39:54.967760 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m16:39:54.968622 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m16:39:54.968935 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:39:54.977505 [debug] [ThreadPool]: SQL status: SELECT 13 in 0.0 seconds
[0m16:39:54.978843 [debug] [ThreadPool]: On list_bank_rates: Close
[0m16:39:54.980145 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates, now create_bank_rates_bank_rates_dbt_staging)
[0m16:39:54.980957 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates, now create_bank_rates_bank_rates_dbt_dds)
[0m16:39:54.981729 [debug] [ThreadPool]: Creating schema "database: "bank_rates"
schema: "bank_rates_dbt_staging"
"
[0m16:39:54.982439 [debug] [ThreadPool]: Creating schema "database: "bank_rates"
schema: "bank_rates_dbt_dds"
"
[0m16:39:54.988554 [debug] [ThreadPool]: Using postgres connection "create_bank_rates_bank_rates_dbt_staging"
[0m16:39:54.990842 [debug] [ThreadPool]: Using postgres connection "create_bank_rates_bank_rates_dbt_dds"
[0m16:39:54.991292 [debug] [ThreadPool]: On create_bank_rates_bank_rates_dbt_staging: BEGIN
[0m16:39:54.991766 [debug] [ThreadPool]: On create_bank_rates_bank_rates_dbt_dds: BEGIN
[0m16:39:54.992199 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:39:54.992542 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:39:55.002573 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m16:39:55.003046 [debug] [ThreadPool]: Using postgres connection "create_bank_rates_bank_rates_dbt_staging"
[0m16:39:55.003502 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m16:39:55.003814 [debug] [ThreadPool]: On create_bank_rates_bank_rates_dbt_staging: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "create_bank_rates_bank_rates_dbt_staging"} */
create schema if not exists "bank_rates_dbt_staging"
[0m16:39:55.004199 [debug] [ThreadPool]: Using postgres connection "create_bank_rates_bank_rates_dbt_dds"
[0m16:39:55.004643 [debug] [ThreadPool]: On create_bank_rates_bank_rates_dbt_dds: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "create_bank_rates_bank_rates_dbt_dds"} */
create schema if not exists "bank_rates_dbt_dds"
[0m16:39:55.005000 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.0 seconds
[0m16:39:55.005383 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.0 seconds
[0m16:39:55.006422 [debug] [ThreadPool]: On create_bank_rates_bank_rates_dbt_staging: COMMIT
[0m16:39:55.007460 [debug] [ThreadPool]: On create_bank_rates_bank_rates_dbt_dds: COMMIT
[0m16:39:55.007853 [debug] [ThreadPool]: Using postgres connection "create_bank_rates_bank_rates_dbt_staging"
[0m16:39:55.008310 [debug] [ThreadPool]: Using postgres connection "create_bank_rates_bank_rates_dbt_dds"
[0m16:39:55.008665 [debug] [ThreadPool]: On create_bank_rates_bank_rates_dbt_staging: COMMIT
[0m16:39:55.008979 [debug] [ThreadPool]: On create_bank_rates_bank_rates_dbt_dds: COMMIT
[0m16:39:55.014698 [debug] [ThreadPool]: SQL status: COMMIT in 0.0 seconds
[0m16:39:55.015074 [debug] [ThreadPool]: On create_bank_rates_bank_rates_dbt_staging: Close
[0m16:39:55.016487 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_bank_rates_bank_rates_dbt_staging, now create_bank_rates_bank_rates_dbt_mart)
[0m16:39:55.016964 [debug] [ThreadPool]: SQL status: COMMIT in 0.0 seconds
[0m16:39:55.017851 [debug] [ThreadPool]: Creating schema "database: "bank_rates"
schema: "bank_rates_dbt_mart"
"
[0m16:39:55.018283 [debug] [ThreadPool]: On create_bank_rates_bank_rates_dbt_dds: Close
[0m16:39:55.020864 [debug] [ThreadPool]: Using postgres connection "create_bank_rates_bank_rates_dbt_mart"
[0m16:39:55.021342 [debug] [ThreadPool]: On create_bank_rates_bank_rates_dbt_mart: BEGIN
[0m16:39:55.022558 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:39:55.030781 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m16:39:55.031189 [debug] [ThreadPool]: Using postgres connection "create_bank_rates_bank_rates_dbt_mart"
[0m16:39:55.031514 [debug] [ThreadPool]: On create_bank_rates_bank_rates_dbt_mart: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "create_bank_rates_bank_rates_dbt_mart"} */
create schema if not exists "bank_rates_dbt_mart"
[0m16:39:55.032264 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.0 seconds
[0m16:39:55.033301 [debug] [ThreadPool]: On create_bank_rates_bank_rates_dbt_mart: COMMIT
[0m16:39:55.033620 [debug] [ThreadPool]: Using postgres connection "create_bank_rates_bank_rates_dbt_mart"
[0m16:39:55.033892 [debug] [ThreadPool]: On create_bank_rates_bank_rates_dbt_mart: COMMIT
[0m16:39:55.036959 [debug] [ThreadPool]: SQL status: COMMIT in 0.0 seconds
[0m16:39:55.037305 [debug] [ThreadPool]: On create_bank_rates_bank_rates_dbt_mart: Close
[0m16:39:55.039690 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_bank_rates_bank_rates_dbt_mart, now list_bank_rates_bank_rates_dbt_staging)
[0m16:39:55.040579 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_bank_rates_bank_rates_dbt_dds, now list_bank_rates_bank_rates_dbt_dds)
[0m16:39:55.047545 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_bank_rates_dbt_staging"
[0m16:39:55.049790 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_bank_rates_dbt_dds"
[0m16:39:55.050231 [debug] [ThreadPool]: On list_bank_rates_bank_rates_dbt_staging: BEGIN
[0m16:39:55.050593 [debug] [ThreadPool]: On list_bank_rates_bank_rates_dbt_dds: BEGIN
[0m16:39:55.050940 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:39:55.051273 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:39:55.060870 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m16:39:55.061324 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m16:39:55.061711 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_bank_rates_dbt_staging"
[0m16:39:55.062121 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_bank_rates_dbt_dds"
[0m16:39:55.062509 [debug] [ThreadPool]: On list_bank_rates_bank_rates_dbt_staging: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_bank_rates_dbt_staging"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'bank_rates_dbt_staging'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'bank_rates_dbt_staging'
  
[0m16:39:55.062905 [debug] [ThreadPool]: On list_bank_rates_bank_rates_dbt_dds: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_bank_rates_dbt_dds"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'bank_rates_dbt_dds'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'bank_rates_dbt_dds'
  
[0m16:39:55.066748 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.0 seconds
[0m16:39:55.067032 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.0 seconds
[0m16:39:55.068433 [debug] [ThreadPool]: On list_bank_rates_bank_rates_dbt_dds: ROLLBACK
[0m16:39:55.069737 [debug] [ThreadPool]: On list_bank_rates_bank_rates_dbt_staging: ROLLBACK
[0m16:39:55.070282 [debug] [ThreadPool]: On list_bank_rates_bank_rates_dbt_dds: Close
[0m16:39:55.070600 [debug] [ThreadPool]: On list_bank_rates_bank_rates_dbt_staging: Close
[0m16:39:55.072029 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates_bank_rates_dbt_dds, now list_bank_rates_bank_rates_dbt_mart)
[0m16:39:55.075391 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_bank_rates_dbt_mart"
[0m16:39:55.075789 [debug] [ThreadPool]: On list_bank_rates_bank_rates_dbt_mart: BEGIN
[0m16:39:55.076087 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:39:55.084198 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m16:39:55.084636 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_bank_rates_dbt_mart"
[0m16:39:55.084981 [debug] [ThreadPool]: On list_bank_rates_bank_rates_dbt_mart: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_bank_rates_dbt_mart"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'bank_rates_dbt_mart'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'bank_rates_dbt_mart'
  
[0m16:39:55.087639 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.0 seconds
[0m16:39:55.088909 [debug] [ThreadPool]: On list_bank_rates_bank_rates_dbt_mart: ROLLBACK
[0m16:39:55.089415 [debug] [ThreadPool]: On list_bank_rates_bank_rates_dbt_mart: Close
[0m16:39:55.096074 [debug] [MainThread]: Using postgres connection "master"
[0m16:39:55.096481 [debug] [MainThread]: On master: BEGIN
[0m16:39:55.096810 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:39:55.105439 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m16:39:55.105850 [debug] [MainThread]: Using postgres connection "master"
[0m16:39:55.106233 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m16:39:55.112721 [debug] [MainThread]: SQL status: SELECT 2 in 0.0 seconds
[0m16:39:55.114179 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5e76071f-ef07-44f4-a637-a159ebf6fba2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75cb8a1f3010>]}
[0m16:39:55.114659 [debug] [MainThread]: On master: ROLLBACK
[0m16:39:55.115159 [debug] [MainThread]: Using postgres connection "master"
[0m16:39:55.115460 [debug] [MainThread]: On master: BEGIN
[0m16:39:55.116036 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m16:39:55.116445 [debug] [MainThread]: On master: COMMIT
[0m16:39:55.116747 [debug] [MainThread]: Using postgres connection "master"
[0m16:39:55.117023 [debug] [MainThread]: On master: COMMIT
[0m16:39:55.117424 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m16:39:55.117723 [debug] [MainThread]: On master: Close
[0m16:39:55.118448 [info ] [MainThread]: Concurrency: 2 threads (target='dev')
[0m16:39:55.118884 [info ] [MainThread]: 
[0m16:39:55.122467 [debug] [Thread-1 (]: Began running node model.bank_rates.stg_cbr_precious_metals
[0m16:39:55.123008 [info ] [Thread-1 (]: 1 of 4 START sql view model bank_rates_dbt_staging.stg_cbr_precious_metals ..... [RUN]
[0m16:39:55.123855 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_bank_rates_bank_rates_dbt_mart, now model.bank_rates.stg_cbr_precious_metals)
[0m16:39:55.124292 [debug] [Thread-1 (]: Began compiling node model.bank_rates.stg_cbr_precious_metals
[0m16:39:55.128037 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_rates.stg_cbr_precious_metals"
[0m16:39:55.128853 [debug] [Thread-1 (]: Timing info for model.bank_rates.stg_cbr_precious_metals (compile): 16:39:55.124518 => 16:39:55.128613
[0m16:39:55.129229 [debug] [Thread-1 (]: Began executing node model.bank_rates.stg_cbr_precious_metals
[0m16:39:55.169222 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_rates.stg_cbr_precious_metals"
[0m16:39:55.170227 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m16:39:55.170669 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: BEGIN
[0m16:39:55.171021 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:39:55.179837 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m16:39:55.180351 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m16:39:55.180812 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */

  create view "bank_rates"."bank_rates_dbt_staging"."stg_cbr_precious_metals__dbt_tmp"
    
    
  as (
    

SELECT 
    record_date::DATE as trade_date,
    metal_code::INTEGER as metal_code,
    CASE 
        WHEN metal_code = 1 THEN 'Ð—Ð¾Ð»Ð¾Ñ‚Ð¾'
        WHEN metal_code = 2 THEN 'Ð¡ÐµÑ€ÐµÐ±Ñ€Ð¾'
        WHEN metal_code = 3 THEN 'ÐŸÐ»Ð°Ñ‚Ð¸Ð½Ð°'
        WHEN metal_code = 4 THEN 'ÐŸÐ°Ð»Ð»Ð°Ð´Ð¸Ð¹'
        ELSE 'ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ð¹ Ð¼ÐµÑ‚Ð°Ð»Ð»'
    END as metal_name,
    buy_price::DECIMAL(10,2) as buy_price_rub,
    sell_price::DECIMAL(10,2) as sell_price_rub,
    load_timestamp::TIMESTAMP as loaded_at
FROM raw.cbr_precious_metals
  );
[0m16:39:55.183728 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.0 seconds
[0m16:39:55.191144 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m16:39:55.191556 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
alter table "bank_rates"."bank_rates_dbt_staging"."stg_cbr_precious_metals__dbt_tmp" rename to "stg_cbr_precious_metals"
[0m16:39:55.192227 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m16:39:55.208390 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: COMMIT
[0m16:39:55.208799 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m16:39:55.209114 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: COMMIT
[0m16:39:55.211642 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m16:39:55.217121 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m16:39:55.217522 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
drop view if exists "bank_rates"."bank_rates_dbt_staging"."stg_cbr_precious_metals__dbt_backup" cascade
[0m16:39:55.218118 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.0 seconds
[0m16:39:55.219726 [debug] [Thread-1 (]: Timing info for model.bank_rates.stg_cbr_precious_metals (execute): 16:39:55.129454 => 16:39:55.219513
[0m16:39:55.220123 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: Close
[0m16:39:55.221067 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e76071f-ef07-44f4-a637-a159ebf6fba2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75cb8a1f1690>]}
[0m16:39:55.221917 [info ] [Thread-1 (]: 1 of 4 OK created sql view model bank_rates_dbt_staging.stg_cbr_precious_metals  [[32mCREATE VIEW[0m in 0.10s]
[0m16:39:55.222803 [debug] [Thread-1 (]: Finished running node model.bank_rates.stg_cbr_precious_metals
[0m16:39:55.223958 [debug] [Thread-2 (]: Began running node model.bank_rates.dim_metals
[0m16:39:55.224523 [debug] [Thread-1 (]: Began running node model.bank_rates.fact_metal_prices
[0m16:39:55.225141 [info ] [Thread-2 (]: 2 of 4 START sql table model bank_rates_dbt_dds.dim_metals ..................... [RUN]
[0m16:39:55.225809 [info ] [Thread-1 (]: 3 of 4 START sql table model bank_rates_dbt_dds.fact_metal_prices .............. [RUN]
[0m16:39:55.226598 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_bank_rates_bank_rates_dbt_staging, now model.bank_rates.dim_metals)
[0m16:39:55.227243 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.bank_rates.stg_cbr_precious_metals, now model.bank_rates.fact_metal_prices)
[0m16:39:55.227761 [debug] [Thread-2 (]: Began compiling node model.bank_rates.dim_metals
[0m16:39:55.228210 [debug] [Thread-1 (]: Began compiling node model.bank_rates.fact_metal_prices
[0m16:39:55.232806 [debug] [Thread-2 (]: Writing injected SQL for node "model.bank_rates.dim_metals"
[0m16:39:55.236286 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_rates.fact_metal_prices"
[0m16:39:55.237180 [debug] [Thread-1 (]: Timing info for model.bank_rates.fact_metal_prices (compile): 16:39:55.233144 => 16:39:55.236920
[0m16:39:55.237681 [debug] [Thread-2 (]: Timing info for model.bank_rates.dim_metals (compile): 16:39:55.228490 => 16:39:55.237416
[0m16:39:55.238034 [debug] [Thread-1 (]: Began executing node model.bank_rates.fact_metal_prices
[0m16:39:55.238471 [debug] [Thread-2 (]: Began executing node model.bank_rates.dim_metals
[0m16:39:55.272261 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_rates.fact_metal_prices"
[0m16:39:55.272928 [debug] [Thread-2 (]: Writing runtime sql for node "model.bank_rates.dim_metals"
[0m16:39:55.273833 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m16:39:55.274297 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m16:39:55.274663 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: BEGIN
[0m16:39:55.275097 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: BEGIN
[0m16:39:55.275518 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:39:55.275899 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m16:39:55.286148 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m16:39:55.286735 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m16:39:55.287172 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m16:39:55.287642 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */

  
    

  create  table "bank_rates"."bank_rates_dbt_dds"."fact_metal_prices__dbt_tmp"
  
  
    as
  
  (
    

SELECT 
    ROW_NUMBER() OVER (ORDER BY trade_date, metal_code) as price_id,
    trade_date,
    metal_code,
    metal_name,
    buy_price_rub,
    sell_price_rub,
    loaded_at,
    CURRENT_TIMESTAMP as dwh_loaded_at
FROM "bank_rates"."bank_rates_dbt_staging"."stg_cbr_precious_metals"
WHERE trade_date IS NOT NULL
  AND metal_code IS NOT NULL
  );
  
[0m16:39:55.288088 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m16:39:55.288659 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */

  
    

  create  table "bank_rates"."bank_rates_dbt_dds"."dim_metals__dbt_tmp"
  
  
    as
  
  (
    

SELECT DISTINCT
    metal_code,
    metal_name
FROM "bank_rates"."bank_rates_dbt_staging"."stg_cbr_precious_metals"
WHERE metal_code IS NOT NULL
  );
  
[0m16:39:55.315188 [debug] [Thread-2 (]: SQL status: SELECT 4 in 0.0 seconds
[0m16:39:55.321418 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m16:39:55.322085 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
alter table "bank_rates"."bank_rates_dbt_dds"."dim_metals__dbt_tmp" rename to "dim_metals"
[0m16:39:55.323049 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m16:39:55.332642 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: COMMIT
[0m16:39:55.333271 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m16:39:55.333796 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: COMMIT
[0m16:39:55.341717 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m16:39:55.345509 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m16:39:55.346039 [debug] [Thread-1 (]: SQL status: SELECT 16796 in 0.0 seconds
[0m16:39:55.346475 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
drop table if exists "bank_rates"."bank_rates_dbt_dds"."dim_metals__dbt_backup" cascade
[0m16:39:55.351342 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m16:39:55.352008 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
alter table "bank_rates"."bank_rates_dbt_dds"."fact_metal_prices__dbt_tmp" rename to "fact_metal_prices"
[0m16:39:55.352536 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m16:39:55.354440 [debug] [Thread-2 (]: Timing info for model.bank_rates.dim_metals (execute): 16:39:55.254894 => 16:39:55.354228
[0m16:39:55.354855 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m16:39:55.355250 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: Close
[0m16:39:55.357132 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: COMMIT
[0m16:39:55.357668 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m16:39:55.358412 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e76071f-ef07-44f4-a637-a159ebf6fba2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75cb89dc4910>]}
[0m16:39:55.358850 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: COMMIT
[0m16:39:55.359562 [info ] [Thread-2 (]: 2 of 4 OK created sql table model bank_rates_dbt_dds.dim_metals ................ [[32mSELECT 4[0m in 0.13s]
[0m16:39:55.360518 [debug] [Thread-2 (]: Finished running node model.bank_rates.dim_metals
[0m16:39:55.365432 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m16:39:55.410291 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m16:39:55.410823 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
drop table if exists "bank_rates"."bank_rates_dbt_dds"."fact_metal_prices__dbt_backup" cascade
[0m16:39:55.411680 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m16:39:55.413496 [debug] [Thread-1 (]: Timing info for model.bank_rates.fact_metal_prices (execute): 16:39:55.238728 => 16:39:55.413284
[0m16:39:55.413876 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: Close
[0m16:39:55.414689 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e76071f-ef07-44f4-a637-a159ebf6fba2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75cb8a1eb6a0>]}
[0m16:39:55.415374 [info ] [Thread-1 (]: 3 of 4 OK created sql table model bank_rates_dbt_dds.fact_metal_prices ......... [[32mSELECT 16796[0m in 0.19s]
[0m16:39:55.416213 [debug] [Thread-1 (]: Finished running node model.bank_rates.fact_metal_prices
[0m16:39:55.417252 [debug] [Thread-2 (]: Began running node model.bank_rates.metal_prices_analytics
[0m16:39:55.417732 [info ] [Thread-2 (]: 4 of 4 START sql table model bank_rates_dbt_mart.metal_prices_analytics ........ [RUN]
[0m16:39:55.418521 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bank_rates.dim_metals, now model.bank_rates.metal_prices_analytics)
[0m16:39:55.418902 [debug] [Thread-2 (]: Began compiling node model.bank_rates.metal_prices_analytics
[0m16:39:55.422505 [debug] [Thread-2 (]: Writing injected SQL for node "model.bank_rates.metal_prices_analytics"
[0m16:39:55.423386 [debug] [Thread-2 (]: Timing info for model.bank_rates.metal_prices_analytics (compile): 16:39:55.419136 => 16:39:55.423097
[0m16:39:55.423785 [debug] [Thread-2 (]: Began executing node model.bank_rates.metal_prices_analytics
[0m16:39:55.427972 [debug] [Thread-2 (]: Writing runtime sql for node "model.bank_rates.metal_prices_analytics"
[0m16:39:55.428674 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m16:39:55.429102 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: BEGIN
[0m16:39:55.429468 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m16:39:55.438482 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m16:39:55.438992 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m16:39:55.439538 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */

  
    

  create  table "bank_rates"."bank_rates_dbt_mart"."metal_prices_analytics__dbt_tmp"
  
  
    as
  
  (
    

SELECT 
    f.trade_date,
    f.metal_name,
    f.buy_price_rub,
    f.sell_price_rub,
    ROUND((f.buy_price_rub + f.sell_price_rub) / 2, 2) as avg_price_rub,
    LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) as prev_buy_price,
    LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) as prev_sell_price,
    CASE 
        WHEN LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) IS NOT NULL 
        THEN ROUND((f.buy_price_rub - LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date)) / 
                   LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) * 100, 2)
        ELSE NULL 
    END as buy_price_change_percent,
    CASE 
        WHEN LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) IS NOT NULL 
        THEN ROUND((f.sell_price_rub - LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date)) / 
                   LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) * 100, 2)
        ELSE NULL 
    END as sell_price_change_percent
FROM "bank_rates"."bank_rates_dbt_dds"."fact_metal_prices" f
ORDER BY f.trade_date DESC, f.metal_name
  );
  
[0m16:39:55.541934 [debug] [Thread-2 (]: SQL status: SELECT 16796 in 0.0 seconds
[0m16:39:55.546192 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m16:39:55.546663 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
alter table "bank_rates"."bank_rates_dbt_mart"."metal_prices_analytics__dbt_tmp" rename to "metal_prices_analytics"
[0m16:39:55.547414 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m16:39:55.549151 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: COMMIT
[0m16:39:55.549539 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m16:39:55.549884 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: COMMIT
[0m16:39:55.564618 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m16:39:55.567516 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m16:39:55.567955 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
drop table if exists "bank_rates"."bank_rates_dbt_mart"."metal_prices_analytics__dbt_backup" cascade
[0m16:39:55.568583 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m16:39:55.570365 [debug] [Thread-2 (]: Timing info for model.bank_rates.metal_prices_analytics (execute): 16:39:55.424004 => 16:39:55.570097
[0m16:39:55.570858 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: Close
[0m16:39:55.571731 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e76071f-ef07-44f4-a637-a159ebf6fba2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75cb8a1ebbb0>]}
[0m16:39:55.572504 [info ] [Thread-2 (]: 4 of 4 OK created sql table model bank_rates_dbt_mart.metal_prices_analytics ... [[32mSELECT 16796[0m in 0.15s]
[0m16:39:55.573292 [debug] [Thread-2 (]: Finished running node model.bank_rates.metal_prices_analytics
[0m16:39:55.574906 [debug] [MainThread]: Using postgres connection "master"
[0m16:39:55.575277 [debug] [MainThread]: On master: BEGIN
[0m16:39:55.575560 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:39:55.584463 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m16:39:55.584866 [debug] [MainThread]: On master: COMMIT
[0m16:39:55.585232 [debug] [MainThread]: Using postgres connection "master"
[0m16:39:55.585529 [debug] [MainThread]: On master: COMMIT
[0m16:39:55.585935 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m16:39:55.586281 [debug] [MainThread]: On master: Close
[0m16:39:55.586919 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:39:55.587223 [debug] [MainThread]: Connection 'model.bank_rates.fact_metal_prices' was properly closed.
[0m16:39:55.587473 [debug] [MainThread]: Connection 'model.bank_rates.metal_prices_analytics' was properly closed.
[0m16:39:55.587806 [info ] [MainThread]: 
[0m16:39:55.588258 [info ] [MainThread]: Finished running 1 view model, 3 table models in 0 hours 0 minutes and 0.66 seconds (0.66s).
[0m16:39:55.589595 [debug] [MainThread]: Command end result
[0m16:39:55.598479 [info ] [MainThread]: 
[0m16:39:55.599014 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:39:55.599492 [info ] [MainThread]: 
[0m16:39:55.599948 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m16:39:55.600577 [debug] [MainThread]: Command `dbt run` succeeded at 16:39:55.600454 after 1.81 seconds
[0m16:39:55.600952 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75cb8c87d990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75cb8b1f8a00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75cb8a16e050>]}
[0m16:39:55.601384 [debug] [MainThread]: Flushing usage events
[0m16:42:44.519900 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b16c7195990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b16c5bdfa90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b16c5bdca90>]}


============================== 16:42:44.523105 | e08a4fa9-1248-4da3-9ac8-c61fb8a7e31c ==============================
[0m16:42:44.523105 [info ] [MainThread]: Running with dbt=1.5.0
[0m16:42:44.523783 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'no_print': 'None', 'fail_fast': 'False', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'use_experimental_parser': 'False', 'write_json': 'True', 'log_format': 'default', 'static_parser': 'True', 'quiet': 'False', 'log_cache_events': 'False', 'warn_error': 'None', 'send_anonymous_usage_stats': 'True', 'profiles_dir': '.', 'debug': 'False', 'partial_parse': 'True', 'version_check': 'True', 'printer_width': '80', 'cache_selected_only': 'False', 'log_path': '/usr/app/logs', 'introspect': 'True'}
[0m16:42:44.557939 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e08a4fa9-1248-4da3-9ac8-c61fb8a7e31c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b16c5bdca90>]}
[0m16:42:44.567570 [debug] [MainThread]: Command `dbt clean` succeeded at 16:42:44.567412 after 0.06 seconds
[0m16:42:44.567969 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b16c7195990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b16c5bdca90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b16c5bdfa60>]}
[0m16:42:44.568396 [debug] [MainThread]: Flushing usage events
[0m16:42:52.285400 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x794a4f61d930>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x794a4e0d8a30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x794a4e0da950>]}


============================== 16:42:52.288648 | 2d6caa00-d0bc-4cac-962e-30993bd7906a ==============================
[0m16:42:52.288648 [info ] [MainThread]: Running with dbt=1.5.0
[0m16:42:52.289319 [debug] [MainThread]: running dbt with arguments {'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_format': 'default', 'log_path': '/usr/app/logs', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'target_path': 'None', 'no_print': 'None', 'profiles_dir': '.', 'write_json': 'True', 'static_parser': 'True', 'use_colors': 'True', 'printer_width': '80', 'warn_error': 'None', 'fail_fast': 'False', 'log_cache_events': 'False', 'introspect': 'True', 'debug': 'False', 'use_experimental_parser': 'False', 'version_check': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False'}
[0m16:42:52.289741 [info ] [MainThread]: dbt version: 1.5.0
[0m16:42:52.290130 [info ] [MainThread]: python version: 3.10.19
[0m16:42:52.290580 [info ] [MainThread]: python path: /usr/local/bin/python3.10
[0m16:42:52.290948 [info ] [MainThread]: os info: Linux-6.8.0-90-generic-x86_64-with-glibc2.41
[0m16:42:52.291310 [info ] [MainThread]: Using profiles.yml file at ./profiles.yml
[0m16:42:52.291680 [info ] [MainThread]: Using dbt_project.yml file at /usr/app/dbt_project.yml
[0m16:42:52.292038 [info ] [MainThread]: Configuration:
[0m16:42:52.342955 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m16:42:52.407439 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m16:42:52.408047 [info ] [MainThread]: Required dependencies:
[0m16:42:52.408599 [debug] [MainThread]: Executing "git --help"
[0m16:42:52.410919 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--no-lazy-fetch]\n           [--no-optional-locks] [--no-advice] [--bare] [--git-dir=<path>]\n           [--work-tree=<path>] [--namespace=<name>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m16:42:52.411352 [debug] [MainThread]: STDERR: "b''"
[0m16:42:52.411592 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m16:42:52.411894 [info ] [MainThread]: Connection:
[0m16:42:52.412391 [info ] [MainThread]:   host: postgres_bank
[0m16:42:52.412764 [info ] [MainThread]:   port: 5432
[0m16:42:52.413161 [info ] [MainThread]:   user: admin
[0m16:42:52.413577 [info ] [MainThread]:   database: bank_rates
[0m16:42:52.413955 [info ] [MainThread]:   schema: bank_rates_dbt
[0m16:42:52.414348 [info ] [MainThread]:   search_path: None
[0m16:42:52.414733 [info ] [MainThread]:   keepalives_idle: 0
[0m16:42:52.415127 [info ] [MainThread]:   sslmode: None
[0m16:42:52.415780 [debug] [MainThread]: Acquiring new postgres connection 'debug'
[0m16:42:52.416091 [debug] [MainThread]: Using postgres connection "debug"
[0m16:42:52.416355 [debug] [MainThread]: On debug: select 1 as id
[0m16:42:52.416652 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:42:52.427644 [debug] [MainThread]: SQL status: SELECT 1 in 0.0 seconds
[0m16:42:52.428772 [debug] [MainThread]: On debug: Close
[0m16:42:52.429203 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m16:42:52.429703 [info ] [MainThread]: [32mAll checks passed![0m
[0m16:42:52.430406 [debug] [MainThread]: Command `dbt debug` succeeded at 16:42:52.430248 after 0.15 seconds
[0m16:42:52.430787 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m16:42:52.431232 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x794a4f61d930>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x794a4dfbb100>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x794a4dfeccd0>]}
[0m16:42:52.431741 [debug] [MainThread]: Flushing usage events
[0m16:42:59.943919 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a20ade2d9c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a20ac8cba60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a20ac8cbaf0>]}


============================== 16:42:59.947155 | 04675397-5ed3-4363-be9d-dbe5be9c435d ==============================
[0m16:42:59.947155 [info ] [MainThread]: Running with dbt=1.5.0
[0m16:42:59.947813 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'printer_width': '80', 'fail_fast': 'False', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'indirect_selection': 'eager', 'version_check': 'True', 'cache_selected_only': 'False', 'write_json': 'True', 'log_path': '/usr/app/logs', 'introspect': 'True', 'log_format': 'default', 'profiles_dir': '.', 'target_path': 'None', 'no_print': 'None', 'quiet': 'False', 'warn_error': 'None'}
[0m16:43:00.066251 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '04675397-5ed3-4363-be9d-dbe5be9c435d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a20ac8cbc40>]}
[0m16:43:00.091757 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '04675397-5ed3-4363-be9d-dbe5be9c435d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a20ac7f6320>]}
[0m16:43:00.103759 [debug] [MainThread]: checksum: 4568eb639a77b8fcb3a1f4a07856f42b1ff63f1376652889143968e1dbdafbda, vars: {}, profile: , target: , version: 1.5.0
[0m16:43:00.104391 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m16:43:00.104843 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '04675397-5ed3-4363-be9d-dbe5be9c435d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a20ac7f76d0>]}
[0m16:43:00.715622 [debug] [MainThread]: 1699: static parser successfully parsed mart/metal_prices_analytics.sql
[0m16:43:00.730748 [debug] [MainThread]: 1699: static parser successfully parsed dds/dim_metals.sql
[0m16:43:00.734724 [debug] [MainThread]: 1699: static parser successfully parsed dds/fact_metal_prices.sql
[0m16:43:00.738491 [debug] [MainThread]: 1699: static parser successfully parsed staging/stg_cbr_precious_metals.sql
[0m16:43:00.777437 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '04675397-5ed3-4363-be9d-dbe5be9c435d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a20abb54a60>]}
[0m16:43:00.783396 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '04675397-5ed3-4363-be9d-dbe5be9c435d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a20ac7f7be0>]}
[0m16:43:00.783912 [info ] [MainThread]: Found 4 models, 0 tests, 0 snapshots, 0 analyses, 307 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m16:43:00.784397 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '04675397-5ed3-4363-be9d-dbe5be9c435d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a20ae506380>]}
[0m16:43:00.785952 [info ] [MainThread]: 
[0m16:43:00.786872 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m16:43:00.788341 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m16:43:00.789180 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m16:43:00.801188 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m16:43:00.803280 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m16:43:00.803738 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m16:43:00.804153 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m16:43:00.804519 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:43:00.804845 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:43:00.818707 [debug] [ThreadPool]: SQL status: SELECT 16 in 0.0 seconds
[0m16:43:00.819109 [debug] [ThreadPool]: SQL status: SELECT 16 in 0.0 seconds
[0m16:43:00.820711 [debug] [ThreadPool]: On list_bank_rates: Close
[0m16:43:00.822173 [debug] [ThreadPool]: On list_bank_rates: Close
[0m16:43:00.825849 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m16:43:00.826872 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m16:43:00.827193 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:43:00.836007 [debug] [ThreadPool]: SQL status: SELECT 16 in 0.0 seconds
[0m16:43:00.837310 [debug] [ThreadPool]: On list_bank_rates: Close
[0m16:43:00.839271 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates, now list_bank_rates_bank_rates_dbt_mart)
[0m16:43:00.840217 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates, now list_bank_rates_bank_rates_dbt_staging)
[0m16:43:00.846587 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_bank_rates_dbt_mart"
[0m16:43:00.848740 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_bank_rates_dbt_staging"
[0m16:43:00.849173 [debug] [ThreadPool]: On list_bank_rates_bank_rates_dbt_mart: BEGIN
[0m16:43:00.849612 [debug] [ThreadPool]: On list_bank_rates_bank_rates_dbt_staging: BEGIN
[0m16:43:00.849965 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:43:00.850312 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:43:00.860659 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m16:43:00.861106 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m16:43:00.861473 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_bank_rates_dbt_mart"
[0m16:43:00.861841 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_bank_rates_dbt_staging"
[0m16:43:00.862203 [debug] [ThreadPool]: On list_bank_rates_bank_rates_dbt_mart: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_bank_rates_dbt_mart"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'bank_rates_dbt_mart'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'bank_rates_dbt_mart'
  
[0m16:43:00.862581 [debug] [ThreadPool]: On list_bank_rates_bank_rates_dbt_staging: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_bank_rates_dbt_staging"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'bank_rates_dbt_staging'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'bank_rates_dbt_staging'
  
[0m16:43:00.866315 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m16:43:00.866611 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m16:43:00.867976 [debug] [ThreadPool]: On list_bank_rates_bank_rates_dbt_staging: ROLLBACK
[0m16:43:00.869380 [debug] [ThreadPool]: On list_bank_rates_bank_rates_dbt_mart: ROLLBACK
[0m16:43:00.869917 [debug] [ThreadPool]: On list_bank_rates_bank_rates_dbt_staging: Close
[0m16:43:00.870240 [debug] [ThreadPool]: On list_bank_rates_bank_rates_dbt_mart: Close
[0m16:43:00.871694 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates_bank_rates_dbt_staging, now list_bank_rates_bank_rates_dbt_dds)
[0m16:43:00.875024 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_bank_rates_dbt_dds"
[0m16:43:00.875660 [debug] [ThreadPool]: On list_bank_rates_bank_rates_dbt_dds: BEGIN
[0m16:43:00.875938 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:43:00.884496 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m16:43:00.884853 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_bank_rates_dbt_dds"
[0m16:43:00.885224 [debug] [ThreadPool]: On list_bank_rates_bank_rates_dbt_dds: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_bank_rates_dbt_dds"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'bank_rates_dbt_dds'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'bank_rates_dbt_dds'
  
[0m16:43:00.887839 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m16:43:00.889182 [debug] [ThreadPool]: On list_bank_rates_bank_rates_dbt_dds: ROLLBACK
[0m16:43:00.889723 [debug] [ThreadPool]: On list_bank_rates_bank_rates_dbt_dds: Close
[0m16:43:00.895957 [debug] [MainThread]: Using postgres connection "master"
[0m16:43:00.896316 [debug] [MainThread]: On master: BEGIN
[0m16:43:00.896599 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:43:00.905266 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m16:43:00.905637 [debug] [MainThread]: Using postgres connection "master"
[0m16:43:00.906097 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m16:43:00.913067 [debug] [MainThread]: SQL status: SELECT 3 in 0.0 seconds
[0m16:43:00.914436 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '04675397-5ed3-4363-be9d-dbe5be9c435d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a20ac7efd30>]}
[0m16:43:00.914924 [debug] [MainThread]: On master: ROLLBACK
[0m16:43:00.915412 [debug] [MainThread]: Using postgres connection "master"
[0m16:43:00.915696 [debug] [MainThread]: On master: BEGIN
[0m16:43:00.916206 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m16:43:00.916518 [debug] [MainThread]: On master: COMMIT
[0m16:43:00.916773 [debug] [MainThread]: Using postgres connection "master"
[0m16:43:00.917044 [debug] [MainThread]: On master: COMMIT
[0m16:43:00.917425 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m16:43:00.917699 [debug] [MainThread]: On master: Close
[0m16:43:00.918377 [info ] [MainThread]: Concurrency: 2 threads (target='dev')
[0m16:43:00.918792 [info ] [MainThread]: 
[0m16:43:00.922360 [debug] [Thread-1 (]: Began running node model.bank_rates.stg_cbr_precious_metals
[0m16:43:00.922898 [info ] [Thread-1 (]: 1 of 4 START sql view model bank_rates_dbt_staging.stg_cbr_precious_metals ..... [RUN]
[0m16:43:00.923722 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_bank_rates_bank_rates_dbt_dds, now model.bank_rates.stg_cbr_precious_metals)
[0m16:43:00.924146 [debug] [Thread-1 (]: Began compiling node model.bank_rates.stg_cbr_precious_metals
[0m16:43:00.927361 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_rates.stg_cbr_precious_metals"
[0m16:43:00.928179 [debug] [Thread-1 (]: Timing info for model.bank_rates.stg_cbr_precious_metals (compile): 16:43:00.924368 => 16:43:00.927900
[0m16:43:00.928550 [debug] [Thread-1 (]: Began executing node model.bank_rates.stg_cbr_precious_metals
[0m16:43:00.967645 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_rates.stg_cbr_precious_metals"
[0m16:43:00.968577 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m16:43:00.969016 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: BEGIN
[0m16:43:00.969395 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:43:00.978435 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m16:43:00.978888 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m16:43:00.979308 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */

  create view "bank_rates"."bank_rates_dbt_staging"."stg_cbr_precious_metals__dbt_tmp"
    
    
  as (
    

SELECT 
    record_date::DATE as trade_date,
    metal_code::INTEGER as metal_code,
    CASE 
        WHEN metal_code = 1 THEN 'Ð—Ð¾Ð»Ð¾Ñ‚Ð¾'
        WHEN metal_code = 2 THEN 'Ð¡ÐµÑ€ÐµÐ±Ñ€Ð¾'
        WHEN metal_code = 3 THEN 'ÐŸÐ»Ð°Ñ‚Ð¸Ð½Ð°'
        WHEN metal_code = 4 THEN 'ÐŸÐ°Ð»Ð»Ð°Ð´Ð¸Ð¹'
        ELSE 'ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ð¹ Ð¼ÐµÑ‚Ð°Ð»Ð»'
    END as metal_name,
    buy_price::DECIMAL(10,2) as buy_price_rub,
    sell_price::DECIMAL(10,2) as sell_price_rub,
    load_timestamp::TIMESTAMP as loaded_at
FROM raw.cbr_precious_metals
  );
[0m16:43:00.981609 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.0 seconds
[0m16:43:00.989157 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m16:43:00.989614 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
alter table "bank_rates"."bank_rates_dbt_staging"."stg_cbr_precious_metals" rename to "stg_cbr_precious_metals__dbt_backup"
[0m16:43:00.990423 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m16:43:00.993775 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m16:43:00.994204 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
alter table "bank_rates"."bank_rates_dbt_staging"."stg_cbr_precious_metals__dbt_tmp" rename to "stg_cbr_precious_metals"
[0m16:43:00.994830 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m16:43:01.013613 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: COMMIT
[0m16:43:01.014138 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m16:43:01.014548 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: COMMIT
[0m16:43:01.016462 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m16:43:01.021892 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m16:43:01.022341 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
drop view if exists "bank_rates"."bank_rates_dbt_staging"."stg_cbr_precious_metals__dbt_backup" cascade
[0m16:43:01.026666 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.0 seconds
[0m16:43:01.028330 [debug] [Thread-1 (]: Timing info for model.bank_rates.stg_cbr_precious_metals (execute): 16:43:00.928761 => 16:43:01.028111
[0m16:43:01.028724 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: Close
[0m16:43:01.029687 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '04675397-5ed3-4363-be9d-dbe5be9c435d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a20abb127a0>]}
[0m16:43:01.030564 [info ] [Thread-1 (]: 1 of 4 OK created sql view model bank_rates_dbt_staging.stg_cbr_precious_metals  [[32mCREATE VIEW[0m in 0.11s]
[0m16:43:01.031378 [debug] [Thread-1 (]: Finished running node model.bank_rates.stg_cbr_precious_metals
[0m16:43:01.032466 [debug] [Thread-2 (]: Began running node model.bank_rates.dim_metals
[0m16:43:01.032863 [debug] [Thread-1 (]: Began running node model.bank_rates.fact_metal_prices
[0m16:43:01.033436 [info ] [Thread-2 (]: 2 of 4 START sql table model bank_rates_dbt_dds.dim_metals ..................... [RUN]
[0m16:43:01.034150 [info ] [Thread-1 (]: 3 of 4 START sql table model bank_rates_dbt_dds.fact_metal_prices .............. [RUN]
[0m16:43:01.034969 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_bank_rates_bank_rates_dbt_mart, now model.bank_rates.dim_metals)
[0m16:43:01.035671 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.bank_rates.stg_cbr_precious_metals, now model.bank_rates.fact_metal_prices)
[0m16:43:01.036137 [debug] [Thread-2 (]: Began compiling node model.bank_rates.dim_metals
[0m16:43:01.036550 [debug] [Thread-1 (]: Began compiling node model.bank_rates.fact_metal_prices
[0m16:43:01.040188 [debug] [Thread-2 (]: Writing injected SQL for node "model.bank_rates.dim_metals"
[0m16:43:01.044548 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_rates.fact_metal_prices"
[0m16:43:01.045452 [debug] [Thread-1 (]: Timing info for model.bank_rates.fact_metal_prices (compile): 16:43:01.040515 => 16:43:01.045204
[0m16:43:01.045945 [debug] [Thread-2 (]: Timing info for model.bank_rates.dim_metals (compile): 16:43:01.036859 => 16:43:01.045693
[0m16:43:01.046359 [debug] [Thread-1 (]: Began executing node model.bank_rates.fact_metal_prices
[0m16:43:01.046775 [debug] [Thread-2 (]: Began executing node model.bank_rates.dim_metals
[0m16:43:01.070664 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_rates.fact_metal_prices"
[0m16:43:01.075096 [debug] [Thread-2 (]: Writing runtime sql for node "model.bank_rates.dim_metals"
[0m16:43:01.076073 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m16:43:01.076581 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m16:43:01.076968 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: BEGIN
[0m16:43:01.077430 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: BEGIN
[0m16:43:01.077832 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m16:43:01.078254 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:43:01.090580 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m16:43:01.091017 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m16:43:01.091512 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m16:43:01.091973 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m16:43:01.092475 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */

  
    

  create  table "bank_rates"."bank_rates_dbt_dds"."dim_metals__dbt_tmp"
  
  
    as
  
  (
    

SELECT DISTINCT
    metal_code,
    metal_name
FROM "bank_rates"."bank_rates_dbt_staging"."stg_cbr_precious_metals"
WHERE metal_code IS NOT NULL
  );
  
[0m16:43:01.092925 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */

  
    

  create  table "bank_rates"."bank_rates_dbt_dds"."fact_metal_prices__dbt_tmp"
  
  
    as
  
  (
    

SELECT 
    ROW_NUMBER() OVER (ORDER BY trade_date, metal_code) as price_id,
    trade_date,
    metal_code,
    metal_name,
    buy_price_rub,
    sell_price_rub,
    loaded_at,
    CURRENT_TIMESTAMP as dwh_loaded_at
FROM "bank_rates"."bank_rates_dbt_staging"."stg_cbr_precious_metals"
WHERE trade_date IS NOT NULL
  AND metal_code IS NOT NULL
  );
  
[0m16:43:01.107578 [debug] [Thread-2 (]: SQL status: SELECT 4 in 0.0 seconds
[0m16:43:01.111531 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m16:43:01.112037 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
alter table "bank_rates"."bank_rates_dbt_dds"."dim_metals" rename to "dim_metals__dbt_backup"
[0m16:43:01.112965 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m16:43:01.116545 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m16:43:01.117039 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
alter table "bank_rates"."bank_rates_dbt_dds"."dim_metals__dbt_tmp" rename to "dim_metals"
[0m16:43:01.117926 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m16:43:01.125744 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: COMMIT
[0m16:43:01.126169 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m16:43:01.126517 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: COMMIT
[0m16:43:01.134992 [debug] [Thread-1 (]: SQL status: SELECT 16796 in 0.0 seconds
[0m16:43:01.138438 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m16:43:01.138849 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
alter table "bank_rates"."bank_rates_dbt_dds"."fact_metal_prices" rename to "fact_metal_prices__dbt_backup"
[0m16:43:01.139647 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m16:43:01.140030 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m16:43:01.142850 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m16:43:01.146090 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m16:43:01.146554 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
drop table if exists "bank_rates"."bank_rates_dbt_dds"."dim_metals__dbt_backup" cascade
[0m16:43:01.146987 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
alter table "bank_rates"."bank_rates_dbt_dds"."fact_metal_prices__dbt_tmp" rename to "fact_metal_prices"
[0m16:43:01.147805 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m16:43:01.149839 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: COMMIT
[0m16:43:01.150237 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m16:43:01.150571 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: COMMIT
[0m16:43:01.154042 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m16:43:01.155637 [debug] [Thread-2 (]: Timing info for model.bank_rates.dim_metals (execute): 16:43:01.070950 => 16:43:01.155394
[0m16:43:01.156033 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m16:43:01.156498 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: Close
[0m16:43:01.160232 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m16:43:01.160770 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
drop table if exists "bank_rates"."bank_rates_dbt_dds"."fact_metal_prices__dbt_backup" cascade
[0m16:43:01.161482 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '04675397-5ed3-4363-be9d-dbe5be9c435d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a20ab3101f0>]}
[0m16:43:01.162387 [info ] [Thread-2 (]: 2 of 4 OK created sql table model bank_rates_dbt_dds.dim_metals ................ [[32mSELECT 4[0m in 0.13s]
[0m16:43:01.163272 [debug] [Thread-2 (]: Finished running node model.bank_rates.dim_metals
[0m16:43:01.164622 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m16:43:01.166077 [debug] [Thread-1 (]: Timing info for model.bank_rates.fact_metal_prices (execute): 16:43:01.047032 => 16:43:01.165865
[0m16:43:01.166422 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: Close
[0m16:43:01.167169 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '04675397-5ed3-4363-be9d-dbe5be9c435d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a20ab313cd0>]}
[0m16:43:01.167802 [info ] [Thread-1 (]: 3 of 4 OK created sql table model bank_rates_dbt_dds.fact_metal_prices ......... [[32mSELECT 16796[0m in 0.13s]
[0m16:43:01.168678 [debug] [Thread-1 (]: Finished running node model.bank_rates.fact_metal_prices
[0m16:43:01.169588 [debug] [Thread-2 (]: Began running node model.bank_rates.metal_prices_analytics
[0m16:43:01.170198 [info ] [Thread-2 (]: 4 of 4 START sql table model bank_rates_dbt_mart.metal_prices_analytics ........ [RUN]
[0m16:43:01.170948 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bank_rates.dim_metals, now model.bank_rates.metal_prices_analytics)
[0m16:43:01.171391 [debug] [Thread-2 (]: Began compiling node model.bank_rates.metal_prices_analytics
[0m16:43:01.174699 [debug] [Thread-2 (]: Writing injected SQL for node "model.bank_rates.metal_prices_analytics"
[0m16:43:01.175424 [debug] [Thread-2 (]: Timing info for model.bank_rates.metal_prices_analytics (compile): 16:43:01.171613 => 16:43:01.175187
[0m16:43:01.175838 [debug] [Thread-2 (]: Began executing node model.bank_rates.metal_prices_analytics
[0m16:43:01.180360 [debug] [Thread-2 (]: Writing runtime sql for node "model.bank_rates.metal_prices_analytics"
[0m16:43:01.181029 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m16:43:01.181466 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: BEGIN
[0m16:43:01.181842 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m16:43:01.191551 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m16:43:01.192003 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m16:43:01.192575 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */

  
    

  create  table "bank_rates"."bank_rates_dbt_mart"."metal_prices_analytics__dbt_tmp"
  
  
    as
  
  (
    

SELECT 
    f.trade_date,
    f.metal_name,
    f.buy_price_rub,
    f.sell_price_rub,
    ROUND((f.buy_price_rub + f.sell_price_rub) / 2, 2) as avg_price_rub,
    LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) as prev_buy_price,
    LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) as prev_sell_price,
    CASE 
        WHEN LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) IS NOT NULL 
        THEN ROUND((f.buy_price_rub - LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date)) / 
                   LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) * 100, 2)
        ELSE NULL 
    END as buy_price_change_percent,
    CASE 
        WHEN LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) IS NOT NULL 
        THEN ROUND((f.sell_price_rub - LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date)) / 
                   LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) * 100, 2)
        ELSE NULL 
    END as sell_price_change_percent
FROM "bank_rates"."bank_rates_dbt_dds"."fact_metal_prices" f
ORDER BY f.trade_date DESC, f.metal_name
  );
  
[0m16:43:01.267673 [debug] [Thread-2 (]: SQL status: SELECT 16796 in 0.0 seconds
[0m16:43:01.271516 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m16:43:01.271983 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
alter table "bank_rates"."bank_rates_dbt_mart"."metal_prices_analytics" rename to "metal_prices_analytics__dbt_backup"
[0m16:43:01.272810 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m16:43:01.275973 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m16:43:01.276439 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
alter table "bank_rates"."bank_rates_dbt_mart"."metal_prices_analytics__dbt_tmp" rename to "metal_prices_analytics"
[0m16:43:01.277018 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m16:43:01.279204 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: COMMIT
[0m16:43:01.279634 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m16:43:01.280010 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: COMMIT
[0m16:43:01.296803 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m16:43:01.299982 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m16:43:01.300509 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
drop table if exists "bank_rates"."bank_rates_dbt_mart"."metal_prices_analytics__dbt_backup" cascade
[0m16:43:01.303996 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m16:43:01.305750 [debug] [Thread-2 (]: Timing info for model.bank_rates.metal_prices_analytics (execute): 16:43:01.176162 => 16:43:01.305535
[0m16:43:01.306169 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: Close
[0m16:43:01.306991 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '04675397-5ed3-4363-be9d-dbe5be9c435d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a20ab7fafb0>]}
[0m16:43:01.307708 [info ] [Thread-2 (]: 4 of 4 OK created sql table model bank_rates_dbt_mart.metal_prices_analytics ... [[32mSELECT 16796[0m in 0.14s]
[0m16:43:01.308622 [debug] [Thread-2 (]: Finished running node model.bank_rates.metal_prices_analytics
[0m16:43:01.310591 [debug] [MainThread]: Using postgres connection "master"
[0m16:43:01.310931 [debug] [MainThread]: On master: BEGIN
[0m16:43:01.311260 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:43:01.321184 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m16:43:01.321691 [debug] [MainThread]: On master: COMMIT
[0m16:43:01.322034 [debug] [MainThread]: Using postgres connection "master"
[0m16:43:01.322380 [debug] [MainThread]: On master: COMMIT
[0m16:43:01.322807 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m16:43:01.323151 [debug] [MainThread]: On master: Close
[0m16:43:01.323828 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:43:01.324147 [debug] [MainThread]: Connection 'model.bank_rates.fact_metal_prices' was properly closed.
[0m16:43:01.324436 [debug] [MainThread]: Connection 'model.bank_rates.metal_prices_analytics' was properly closed.
[0m16:43:01.324861 [info ] [MainThread]: 
[0m16:43:01.325323 [info ] [MainThread]: Finished running 1 view model, 3 table models in 0 hours 0 minutes and 0.54 seconds (0.54s).
[0m16:43:01.326691 [debug] [MainThread]: Command end result
[0m16:43:01.332702 [info ] [MainThread]: 
[0m16:43:01.333259 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:43:01.333763 [info ] [MainThread]: 
[0m16:43:01.334279 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m16:43:01.334886 [debug] [MainThread]: Command `dbt run` succeeded at 16:43:01.334757 after 1.40 seconds
[0m16:43:01.335282 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a20ade2d9c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a20ac7f7be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a20ac7f4a30>]}
[0m16:43:01.335671 [debug] [MainThread]: Flushing usage events
[0m16:45:30.516137 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765a4d4319f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765a4bedbaf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765a4bed8af0>]}


============================== 16:45:30.519425 | fe12f750-13e9-48ff-9c90-3a248509dd5b ==============================
[0m16:45:30.519425 [info ] [MainThread]: Running with dbt=1.5.0
[0m16:45:30.520104 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'partial_parse': 'True', 'target_path': 'None', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'no_print': 'None', 'cache_selected_only': 'False', 'log_cache_events': 'False', 'quiet': 'False', 'static_parser': 'True', 'log_path': '/usr/app/logs', 'indirect_selection': 'eager', 'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'write_json': 'True', 'use_colors': 'True', 'log_format': 'default', 'printer_width': '80', 'profiles_dir': '.', 'introspect': 'True', 'debug': 'False', 'use_experimental_parser': 'False'}
[0m16:45:30.554332 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fe12f750-13e9-48ff-9c90-3a248509dd5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765a4bed8af0>]}
[0m16:45:30.558445 [debug] [MainThread]: Command `dbt clean` succeeded at 16:45:30.558271 after 0.05 seconds
[0m16:45:30.558936 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765a4d4319f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765a4bed8af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x765a4bedbac0>]}
[0m16:45:30.559390 [debug] [MainThread]: Flushing usage events
[0m16:45:54.536945 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a62e1609990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a62e00d8a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a62e00da9b0>]}


============================== 16:45:54.540170 | d9cabcf1-a7f5-4d49-a8f9-2b9ddae24d91 ==============================
[0m16:45:54.540170 [info ] [MainThread]: Running with dbt=1.5.0
[0m16:45:54.540825 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'introspect': 'True', 'log_path': '/usr/app/logs', 'quiet': 'False', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'no_print': 'None', 'partial_parse': 'True', 'warn_error': 'None', 'use_colors': 'True', 'write_json': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'profiles_dir': '.', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'printer_width': '80', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'debug': 'False', 'log_format': 'default', 'log_cache_events': 'False'}
[0m16:45:54.541256 [info ] [MainThread]: dbt version: 1.5.0
[0m16:45:54.541600 [info ] [MainThread]: python version: 3.10.19
[0m16:45:54.541950 [info ] [MainThread]: python path: /usr/local/bin/python3.10
[0m16:45:54.542323 [info ] [MainThread]: os info: Linux-6.8.0-90-generic-x86_64-with-glibc2.41
[0m16:45:54.542679 [info ] [MainThread]: Using profiles.yml file at ./profiles.yml
[0m16:45:54.543065 [info ] [MainThread]: Using dbt_project.yml file at /usr/app/dbt_project.yml
[0m16:45:54.543468 [info ] [MainThread]: Configuration:
[0m16:45:54.592108 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m16:45:54.657715 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m16:45:54.658432 [info ] [MainThread]: Required dependencies:
[0m16:45:54.658940 [debug] [MainThread]: Executing "git --help"
[0m16:45:54.661305 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--no-lazy-fetch]\n           [--no-optional-locks] [--no-advice] [--bare] [--git-dir=<path>]\n           [--work-tree=<path>] [--namespace=<name>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m16:45:54.661719 [debug] [MainThread]: STDERR: "b''"
[0m16:45:54.662027 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m16:45:54.662435 [info ] [MainThread]: Connection:
[0m16:45:54.662898 [info ] [MainThread]:   host: postgres_bank
[0m16:45:54.663307 [info ] [MainThread]:   port: 5432
[0m16:45:54.663731 [info ] [MainThread]:   user: admin
[0m16:45:54.664130 [info ] [MainThread]:   database: bank_rates
[0m16:45:54.664538 [info ] [MainThread]:   schema: bank_rates_dbt
[0m16:45:54.664893 [info ] [MainThread]:   search_path: None
[0m16:45:54.665259 [info ] [MainThread]:   keepalives_idle: 0
[0m16:45:54.665612 [info ] [MainThread]:   sslmode: None
[0m16:45:54.666337 [debug] [MainThread]: Acquiring new postgres connection 'debug'
[0m16:45:54.666695 [debug] [MainThread]: Using postgres connection "debug"
[0m16:45:54.667005 [debug] [MainThread]: On debug: select 1 as id
[0m16:45:54.667311 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:45:54.678197 [debug] [MainThread]: SQL status: SELECT 1 in 0.0 seconds
[0m16:45:54.679338 [debug] [MainThread]: On debug: Close
[0m16:45:54.679744 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m16:45:54.680167 [info ] [MainThread]: [32mAll checks passed![0m
[0m16:45:54.680824 [debug] [MainThread]: Command `dbt debug` succeeded at 16:45:54.680667 after 0.15 seconds
[0m16:45:54.681187 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m16:45:54.681638 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a62e1609990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a62dff52350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a62e11216f0>]}
[0m16:45:54.682029 [debug] [MainThread]: Flushing usage events
[0m16:46:18.449846 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ff481590c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ff46bdf9a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ff46bdfa30>]}


============================== 16:46:18.453448 | e2710f39-51d4-4232-a5a5-0d34b5f5073f ==============================
[0m16:46:18.453448 [info ] [MainThread]: Running with dbt=1.5.0
[0m16:46:18.454212 [debug] [MainThread]: running dbt with arguments {'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'quiet': 'False', 'no_print': 'None', 'log_path': '/usr/app/logs', 'version_check': 'True', 'debug': 'False', 'partial_parse': 'True', 'write_json': 'True', 'log_format': 'default', 'log_cache_events': 'False', 'indirect_selection': 'eager', 'profiles_dir': '.', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'printer_width': '80', 'cache_selected_only': 'False', 'use_experimental_parser': 'False', 'static_parser': 'True'}
[0m16:46:18.565038 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e2710f39-51d4-4232-a5a5-0d34b5f5073f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ff46bdfb80>]}
[0m16:46:18.586952 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e2710f39-51d4-4232-a5a5-0d34b5f5073f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ff46aedd20>]}
[0m16:46:18.598230 [debug] [MainThread]: checksum: 4568eb639a77b8fcb3a1f4a07856f42b1ff63f1376652889143968e1dbdafbda, vars: {}, profile: , target: , version: 1.5.0
[0m16:46:18.598854 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m16:46:18.599307 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'e2710f39-51d4-4232-a5a5-0d34b5f5073f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ff46aefc70>]}
[0m16:46:19.204886 [debug] [MainThread]: 1699: static parser successfully parsed mart/metal_prices_analytics.sql
[0m16:46:19.220165 [debug] [MainThread]: 1699: static parser successfully parsed dds/dim_metals.sql
[0m16:46:19.224429 [debug] [MainThread]: 1699: static parser successfully parsed dds/fact_metal_prices.sql
[0m16:46:19.228342 [debug] [MainThread]: 1699: static parser successfully parsed staging/stg_cbr_precious_metals.sql
[0m16:46:19.265383 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e2710f39-51d4-4232-a5a5-0d34b5f5073f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ff45be0d60>]}
[0m16:46:19.271694 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e2710f39-51d4-4232-a5a5-0d34b5f5073f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ff45bac0d0>]}
[0m16:46:19.272236 [info ] [MainThread]: Found 4 models, 0 tests, 0 snapshots, 0 analyses, 307 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m16:46:19.272668 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e2710f39-51d4-4232-a5a5-0d34b5f5073f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ff487213f0>]}
[0m16:46:19.274176 [info ] [MainThread]: 
[0m16:46:19.275004 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m16:46:19.276436 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m16:46:19.277277 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m16:46:19.288933 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m16:46:19.290878 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m16:46:19.291451 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m16:46:19.291819 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m16:46:19.292188 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:46:19.292482 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:46:19.307551 [debug] [ThreadPool]: SQL status: SELECT 16 in 0.0 seconds
[0m16:46:19.307983 [debug] [ThreadPool]: SQL status: SELECT 16 in 0.0 seconds
[0m16:46:19.309640 [debug] [ThreadPool]: On list_bank_rates: Close
[0m16:46:19.310945 [debug] [ThreadPool]: On list_bank_rates: Close
[0m16:46:19.313909 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m16:46:19.314533 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m16:46:19.315409 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:46:19.324681 [debug] [ThreadPool]: SQL status: SELECT 16 in 0.0 seconds
[0m16:46:19.326108 [debug] [ThreadPool]: On list_bank_rates: Close
[0m16:46:19.327847 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates, now list_bank_rates_bank_rates_dbt_staging)
[0m16:46:19.328633 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates, now list_bank_rates_bank_rates_dbt_mart)
[0m16:46:19.334517 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_bank_rates_dbt_staging"
[0m16:46:19.336630 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_bank_rates_dbt_mart"
[0m16:46:19.337038 [debug] [ThreadPool]: On list_bank_rates_bank_rates_dbt_staging: BEGIN
[0m16:46:19.337414 [debug] [ThreadPool]: On list_bank_rates_bank_rates_dbt_mart: BEGIN
[0m16:46:19.337745 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:46:19.338139 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:46:19.347876 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m16:46:19.348352 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m16:46:19.348735 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_bank_rates_dbt_mart"
[0m16:46:19.349139 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_bank_rates_dbt_staging"
[0m16:46:19.349519 [debug] [ThreadPool]: On list_bank_rates_bank_rates_dbt_mart: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_bank_rates_dbt_mart"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'bank_rates_dbt_mart'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'bank_rates_dbt_mart'
  
[0m16:46:19.349946 [debug] [ThreadPool]: On list_bank_rates_bank_rates_dbt_staging: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_bank_rates_dbt_staging"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'bank_rates_dbt_staging'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'bank_rates_dbt_staging'
  
[0m16:46:19.353819 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m16:46:19.354189 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m16:46:19.355518 [debug] [ThreadPool]: On list_bank_rates_bank_rates_dbt_staging: ROLLBACK
[0m16:46:19.356816 [debug] [ThreadPool]: On list_bank_rates_bank_rates_dbt_mart: ROLLBACK
[0m16:46:19.357357 [debug] [ThreadPool]: On list_bank_rates_bank_rates_dbt_staging: Close
[0m16:46:19.357667 [debug] [ThreadPool]: On list_bank_rates_bank_rates_dbt_mart: Close
[0m16:46:19.359175 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates_bank_rates_dbt_staging, now list_bank_rates_bank_rates_dbt_dds)
[0m16:46:19.362203 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_bank_rates_dbt_dds"
[0m16:46:19.363264 [debug] [ThreadPool]: On list_bank_rates_bank_rates_dbt_dds: BEGIN
[0m16:46:19.363561 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:46:19.372188 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m16:46:19.372539 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_bank_rates_dbt_dds"
[0m16:46:19.372872 [debug] [ThreadPool]: On list_bank_rates_bank_rates_dbt_dds: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_bank_rates_dbt_dds"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'bank_rates_dbt_dds'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'bank_rates_dbt_dds'
  
[0m16:46:19.375479 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m16:46:19.376792 [debug] [ThreadPool]: On list_bank_rates_bank_rates_dbt_dds: ROLLBACK
[0m16:46:19.377246 [debug] [ThreadPool]: On list_bank_rates_bank_rates_dbt_dds: Close
[0m16:46:19.382524 [debug] [MainThread]: Using postgres connection "master"
[0m16:46:19.382857 [debug] [MainThread]: On master: BEGIN
[0m16:46:19.383160 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:46:19.391340 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m16:46:19.391762 [debug] [MainThread]: Using postgres connection "master"
[0m16:46:19.392233 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m16:46:19.398572 [debug] [MainThread]: SQL status: SELECT 3 in 0.0 seconds
[0m16:46:19.399889 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e2710f39-51d4-4232-a5a5-0d34b5f5073f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ff45ba3fd0>]}
[0m16:46:19.400413 [debug] [MainThread]: On master: ROLLBACK
[0m16:46:19.400840 [debug] [MainThread]: Using postgres connection "master"
[0m16:46:19.401160 [debug] [MainThread]: On master: BEGIN
[0m16:46:19.401666 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m16:46:19.401985 [debug] [MainThread]: On master: COMMIT
[0m16:46:19.402291 [debug] [MainThread]: Using postgres connection "master"
[0m16:46:19.402557 [debug] [MainThread]: On master: COMMIT
[0m16:46:19.402916 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m16:46:19.403234 [debug] [MainThread]: On master: Close
[0m16:46:19.403859 [info ] [MainThread]: Concurrency: 2 threads (target='dev')
[0m16:46:19.404293 [info ] [MainThread]: 
[0m16:46:19.408689 [debug] [Thread-1 (]: Began running node model.bank_rates.stg_cbr_precious_metals
[0m16:46:19.409251 [info ] [Thread-1 (]: 1 of 4 START sql view model bank_rates_dbt_staging.stg_cbr_precious_metals ..... [RUN]
[0m16:46:19.410012 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_bank_rates_bank_rates_dbt_dds, now model.bank_rates.stg_cbr_precious_metals)
[0m16:46:19.410504 [debug] [Thread-1 (]: Began compiling node model.bank_rates.stg_cbr_precious_metals
[0m16:46:19.413743 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_rates.stg_cbr_precious_metals"
[0m16:46:19.414601 [debug] [Thread-1 (]: Timing info for model.bank_rates.stg_cbr_precious_metals (compile): 16:46:19.410735 => 16:46:19.414350
[0m16:46:19.415007 [debug] [Thread-1 (]: Began executing node model.bank_rates.stg_cbr_precious_metals
[0m16:46:19.453066 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_rates.stg_cbr_precious_metals"
[0m16:46:19.454074 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m16:46:19.454539 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: BEGIN
[0m16:46:19.454927 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:46:19.463717 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m16:46:19.464204 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m16:46:19.464619 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */

  create view "bank_rates"."bank_rates_dbt_staging"."stg_cbr_precious_metals__dbt_tmp"
    
    
  as (
    

SELECT 
    record_date::DATE as trade_date,
    metal_code::INTEGER as metal_code,
    CASE 
        WHEN metal_code = 1 THEN 'Ð—Ð¾Ð»Ð¾Ñ‚Ð¾'
        WHEN metal_code = 2 THEN 'Ð¡ÐµÑ€ÐµÐ±Ñ€Ð¾'
        WHEN metal_code = 3 THEN 'ÐŸÐ»Ð°Ñ‚Ð¸Ð½Ð°'
        WHEN metal_code = 4 THEN 'ÐŸÐ°Ð»Ð»Ð°Ð´Ð¸Ð¹'
        ELSE 'ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ð¹ Ð¼ÐµÑ‚Ð°Ð»Ð»'
    END as metal_name,
    buy_price::DECIMAL(10,2) as buy_price_rub,
    sell_price::DECIMAL(10,2) as sell_price_rub,
    load_timestamp::TIMESTAMP as loaded_at
FROM raw.cbr_precious_metals
  );
[0m16:46:19.466658 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.0 seconds
[0m16:46:19.473987 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m16:46:19.474494 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
alter table "bank_rates"."bank_rates_dbt_staging"."stg_cbr_precious_metals" rename to "stg_cbr_precious_metals__dbt_backup"
[0m16:46:19.475314 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m16:46:19.478731 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m16:46:19.479211 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
alter table "bank_rates"."bank_rates_dbt_staging"."stg_cbr_precious_metals__dbt_tmp" rename to "stg_cbr_precious_metals"
[0m16:46:19.479963 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m16:46:19.498262 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: COMMIT
[0m16:46:19.498820 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m16:46:19.499231 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: COMMIT
[0m16:46:19.531000 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m16:46:19.537391 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m16:46:19.537910 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
drop view if exists "bank_rates"."bank_rates_dbt_staging"."stg_cbr_precious_metals__dbt_backup" cascade
[0m16:46:19.582160 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.0 seconds
[0m16:46:19.584468 [debug] [Thread-1 (]: Timing info for model.bank_rates.stg_cbr_precious_metals (execute): 16:46:19.415278 => 16:46:19.584238
[0m16:46:19.584964 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: Close
[0m16:46:19.585938 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e2710f39-51d4-4232-a5a5-0d34b5f5073f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ff45ba33a0>]}
[0m16:46:19.586743 [info ] [Thread-1 (]: 1 of 4 OK created sql view model bank_rates_dbt_staging.stg_cbr_precious_metals  [[32mCREATE VIEW[0m in 0.18s]
[0m16:46:19.587818 [debug] [Thread-1 (]: Finished running node model.bank_rates.stg_cbr_precious_metals
[0m16:46:19.589173 [debug] [Thread-2 (]: Began running node model.bank_rates.dim_metals
[0m16:46:19.589671 [debug] [Thread-1 (]: Began running node model.bank_rates.fact_metal_prices
[0m16:46:19.590267 [info ] [Thread-2 (]: 2 of 4 START sql table model bank_rates_dbt_dds.dim_metals ..................... [RUN]
[0m16:46:19.591004 [info ] [Thread-1 (]: 3 of 4 START sql table model bank_rates_dbt_dds.fact_metal_prices .............. [RUN]
[0m16:46:19.592087 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_bank_rates_bank_rates_dbt_mart, now model.bank_rates.dim_metals)
[0m16:46:19.592827 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.bank_rates.stg_cbr_precious_metals, now model.bank_rates.fact_metal_prices)
[0m16:46:19.593300 [debug] [Thread-2 (]: Began compiling node model.bank_rates.dim_metals
[0m16:46:19.593704 [debug] [Thread-1 (]: Began compiling node model.bank_rates.fact_metal_prices
[0m16:46:19.598454 [debug] [Thread-2 (]: Writing injected SQL for node "model.bank_rates.dim_metals"
[0m16:46:19.603546 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_rates.fact_metal_prices"
[0m16:46:19.604489 [debug] [Thread-1 (]: Timing info for model.bank_rates.fact_metal_prices (compile): 16:46:19.598845 => 16:46:19.604238
[0m16:46:19.604954 [debug] [Thread-2 (]: Timing info for model.bank_rates.dim_metals (compile): 16:46:19.594040 => 16:46:19.604731
[0m16:46:19.605329 [debug] [Thread-1 (]: Began executing node model.bank_rates.fact_metal_prices
[0m16:46:19.605722 [debug] [Thread-2 (]: Began executing node model.bank_rates.dim_metals
[0m16:46:19.649830 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_rates.fact_metal_prices"
[0m16:46:19.653769 [debug] [Thread-2 (]: Writing runtime sql for node "model.bank_rates.dim_metals"
[0m16:46:19.654802 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m16:46:19.655834 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: BEGIN
[0m16:46:19.655342 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m16:46:19.656383 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m16:46:19.656972 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: BEGIN
[0m16:46:19.658224 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:46:19.669578 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m16:46:19.670153 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m16:46:19.670582 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m16:46:19.671018 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */

  
    

  create  table "bank_rates"."bank_rates_dbt_dds"."dim_metals__dbt_tmp"
  
  
    as
  
  (
    

SELECT DISTINCT
    metal_code,
    metal_name
FROM "bank_rates"."bank_rates_dbt_staging"."stg_cbr_precious_metals"
WHERE metal_code IS NOT NULL
  );
  
[0m16:46:19.671503 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m16:46:19.672095 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */

  
    

  create  table "bank_rates"."bank_rates_dbt_dds"."fact_metal_prices__dbt_tmp"
  
  
    as
  
  (
    

SELECT 
    ROW_NUMBER() OVER (ORDER BY trade_date, metal_code) as price_id,
    trade_date,
    metal_code,
    metal_name,
    buy_price_rub,
    sell_price_rub,
    loaded_at,
    CURRENT_TIMESTAMP as dwh_loaded_at
FROM "bank_rates"."bank_rates_dbt_staging"."stg_cbr_precious_metals"
WHERE trade_date IS NOT NULL
  AND metal_code IS NOT NULL
  );
  
[0m16:46:19.685468 [debug] [Thread-2 (]: SQL status: SELECT 4 in 0.0 seconds
[0m16:46:19.691326 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m16:46:19.691977 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
alter table "bank_rates"."bank_rates_dbt_dds"."dim_metals" rename to "dim_metals__dbt_backup"
[0m16:46:19.692953 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m16:46:19.698047 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m16:46:19.698631 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
alter table "bank_rates"."bank_rates_dbt_dds"."dim_metals__dbt_tmp" rename to "dim_metals"
[0m16:46:19.699480 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m16:46:19.709283 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: COMMIT
[0m16:46:19.709839 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m16:46:19.710336 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: COMMIT
[0m16:46:19.718002 [debug] [Thread-1 (]: SQL status: SELECT 16796 in 0.0 seconds
[0m16:46:19.721648 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m16:46:19.722115 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m16:46:19.722629 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
alter table "bank_rates"."bank_rates_dbt_dds"."fact_metal_prices" rename to "fact_metal_prices__dbt_backup"
[0m16:46:19.725472 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m16:46:19.726040 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
drop table if exists "bank_rates"."bank_rates_dbt_dds"."dim_metals__dbt_backup" cascade
[0m16:46:19.726463 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m16:46:19.730534 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m16:46:19.730942 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
alter table "bank_rates"."bank_rates_dbt_dds"."fact_metal_prices__dbt_tmp" rename to "fact_metal_prices"
[0m16:46:19.731671 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m16:46:19.734164 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: COMMIT
[0m16:46:19.734550 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m16:46:19.734953 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m16:46:19.736593 [debug] [Thread-2 (]: Timing info for model.bank_rates.dim_metals (execute): 16:46:19.618816 => 16:46:19.736386
[0m16:46:19.736985 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: COMMIT
[0m16:46:19.737473 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: Close
[0m16:46:19.738449 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e2710f39-51d4-4232-a5a5-0d34b5f5073f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ff45ba34c0>]}
[0m16:46:19.739197 [info ] [Thread-2 (]: 2 of 4 OK created sql table model bank_rates_dbt_dds.dim_metals ................ [[32mSELECT 4[0m in 0.15s]
[0m16:46:19.740034 [debug] [Thread-2 (]: Finished running node model.bank_rates.dim_metals
[0m16:46:19.740484 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m16:46:19.744570 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m16:46:19.744963 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
drop table if exists "bank_rates"."bank_rates_dbt_dds"."fact_metal_prices__dbt_backup" cascade
[0m16:46:19.747973 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m16:46:19.749595 [debug] [Thread-1 (]: Timing info for model.bank_rates.fact_metal_prices (execute): 16:46:19.605972 => 16:46:19.749391
[0m16:46:19.749998 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: Close
[0m16:46:19.750842 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e2710f39-51d4-4232-a5a5-0d34b5f5073f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ff457c4340>]}
[0m16:46:19.751532 [info ] [Thread-1 (]: 3 of 4 OK created sql table model bank_rates_dbt_dds.fact_metal_prices ......... [[32mSELECT 16796[0m in 0.16s]
[0m16:46:19.752357 [debug] [Thread-1 (]: Finished running node model.bank_rates.fact_metal_prices
[0m16:46:19.753338 [debug] [Thread-2 (]: Began running node model.bank_rates.metal_prices_analytics
[0m16:46:19.753870 [info ] [Thread-2 (]: 4 of 4 START sql table model bank_rates_dbt_mart.metal_prices_analytics ........ [RUN]
[0m16:46:19.754666 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bank_rates.dim_metals, now model.bank_rates.metal_prices_analytics)
[0m16:46:19.755066 [debug] [Thread-2 (]: Began compiling node model.bank_rates.metal_prices_analytics
[0m16:46:19.758674 [debug] [Thread-2 (]: Writing injected SQL for node "model.bank_rates.metal_prices_analytics"
[0m16:46:19.759523 [debug] [Thread-2 (]: Timing info for model.bank_rates.metal_prices_analytics (compile): 16:46:19.755285 => 16:46:19.759262
[0m16:46:19.759898 [debug] [Thread-2 (]: Began executing node model.bank_rates.metal_prices_analytics
[0m16:46:19.764050 [debug] [Thread-2 (]: Writing runtime sql for node "model.bank_rates.metal_prices_analytics"
[0m16:46:19.764693 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m16:46:19.765064 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: BEGIN
[0m16:46:19.765394 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m16:46:19.774618 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m16:46:19.775035 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m16:46:19.775491 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */

  
    

  create  table "bank_rates"."bank_rates_dbt_mart"."metal_prices_analytics__dbt_tmp"
  
  
    as
  
  (
    

SELECT 
    f.trade_date,
    f.metal_name,
    f.buy_price_rub,
    f.sell_price_rub,
    ROUND((f.buy_price_rub + f.sell_price_rub) / 2, 2) as avg_price_rub,
    LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) as prev_buy_price,
    LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) as prev_sell_price,
    CASE 
        WHEN LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) IS NOT NULL 
        THEN ROUND((f.buy_price_rub - LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date)) / 
                   LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) * 100, 2)
        ELSE NULL 
    END as buy_price_change_percent,
    CASE 
        WHEN LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) IS NOT NULL 
        THEN ROUND((f.sell_price_rub - LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date)) / 
                   LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) * 100, 2)
        ELSE NULL 
    END as sell_price_change_percent
FROM "bank_rates"."bank_rates_dbt_dds"."fact_metal_prices" f
ORDER BY f.trade_date DESC, f.metal_name
  );
  
[0m16:46:19.840212 [debug] [Thread-2 (]: SQL status: SELECT 16796 in 0.0 seconds
[0m16:46:19.843898 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m16:46:19.844358 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
alter table "bank_rates"."bank_rates_dbt_mart"."metal_prices_analytics" rename to "metal_prices_analytics__dbt_backup"
[0m16:46:19.845163 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m16:46:19.848144 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m16:46:19.848520 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
alter table "bank_rates"."bank_rates_dbt_mart"."metal_prices_analytics__dbt_tmp" rename to "metal_prices_analytics"
[0m16:46:19.849229 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m16:46:19.851246 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: COMMIT
[0m16:46:19.851650 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m16:46:19.851959 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: COMMIT
[0m16:46:19.860643 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m16:46:19.863363 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m16:46:19.863784 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
drop table if exists "bank_rates"."bank_rates_dbt_mart"."metal_prices_analytics__dbt_backup" cascade
[0m16:46:19.866641 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m16:46:19.868260 [debug] [Thread-2 (]: Timing info for model.bank_rates.metal_prices_analytics (execute): 16:46:19.760165 => 16:46:19.868018
[0m16:46:19.868629 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: Close
[0m16:46:19.869625 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e2710f39-51d4-4232-a5a5-0d34b5f5073f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ff4530f820>]}
[0m16:46:19.870525 [info ] [Thread-2 (]: 4 of 4 OK created sql table model bank_rates_dbt_mart.metal_prices_analytics ... [[32mSELECT 16796[0m in 0.12s]
[0m16:46:19.871398 [debug] [Thread-2 (]: Finished running node model.bank_rates.metal_prices_analytics
[0m16:46:19.873031 [debug] [MainThread]: Using postgres connection "master"
[0m16:46:19.873396 [debug] [MainThread]: On master: BEGIN
[0m16:46:19.873693 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:46:19.882810 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m16:46:19.883290 [debug] [MainThread]: On master: COMMIT
[0m16:46:19.883627 [debug] [MainThread]: Using postgres connection "master"
[0m16:46:19.883961 [debug] [MainThread]: On master: COMMIT
[0m16:46:19.884497 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m16:46:19.884822 [debug] [MainThread]: On master: Close
[0m16:46:19.885506 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:46:19.885812 [debug] [MainThread]: Connection 'model.bank_rates.metal_prices_analytics' was properly closed.
[0m16:46:19.886109 [debug] [MainThread]: Connection 'model.bank_rates.fact_metal_prices' was properly closed.
[0m16:46:19.886571 [info ] [MainThread]: 
[0m16:46:19.887071 [info ] [MainThread]: Finished running 1 view model, 3 table models in 0 hours 0 minutes and 0.61 seconds (0.61s).
[0m16:46:19.888403 [debug] [MainThread]: Command end result
[0m16:46:19.894473 [info ] [MainThread]: 
[0m16:46:19.894975 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:46:19.895437 [info ] [MainThread]: 
[0m16:46:19.895897 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m16:46:19.896524 [debug] [MainThread]: Command `dbt run` succeeded at 16:46:19.896381 after 1.46 seconds
[0m16:46:19.896870 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ff481590c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ff45bbcb80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73ff487238b0>]}
[0m16:46:19.897227 [debug] [MainThread]: Flushing usage events
[0m16:48:49.380870 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x769fd2d29960>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x769fd17afa60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x769fd17aca60>]}


============================== 16:48:49.384187 | a8128a94-936f-4776-bb36-a55314661f4f ==============================
[0m16:48:49.384187 [info ] [MainThread]: Running with dbt=1.5.0
[0m16:48:49.384859 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'debug': 'False', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'quiet': 'False', 'log_cache_events': 'False', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'log_format': 'default', 'use_experimental_parser': 'False', 'introspect': 'True', 'write_json': 'True', 'no_print': 'None', 'partial_parse': 'True', 'printer_width': '80', 'log_path': '/usr/app/logs', 'target_path': 'None', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'static_parser': 'True', 'profiles_dir': '.'}
[0m16:48:49.423863 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a8128a94-936f-4776-bb36-a55314661f4f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x769fd17aca60>]}
[0m16:48:49.428104 [debug] [MainThread]: Command `dbt clean` succeeded at 16:48:49.427913 after 0.06 seconds
[0m16:48:49.428516 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x769fd2d29960>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x769fd17aca60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x769fd17afa30>]}
[0m16:48:49.428887 [debug] [MainThread]: Flushing usage events
[0m16:48:51.998375 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a8b96e59c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a8b81dfa60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a8b81dfaf0>]}


============================== 16:48:52.001580 | eaf888ef-8c85-4b82-a836-2c2579330810 ==============================
[0m16:48:52.001580 [info ] [MainThread]: Running with dbt=1.5.0
[0m16:48:52.002232 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'quiet': 'False', 'fail_fast': 'False', 'target_path': 'None', 'printer_width': '80', 'debug': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'partial_parse': 'True', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'warn_error': 'None', 'use_experimental_parser': 'False', 'introspect': 'True', 'log_cache_events': 'False', 'use_colors': 'True', 'cache_selected_only': 'False', 'write_json': 'True', 'log_path': '/usr/app/logs', 'version_check': 'True', 'no_print': 'None', 'profiles_dir': '.'}
[0m16:48:52.112507 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'eaf888ef-8c85-4b82-a836-2c2579330810', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a8b81dfc40>]}
[0m16:48:52.133901 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'eaf888ef-8c85-4b82-a836-2c2579330810', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a8b80fa320>]}
[0m16:48:52.145989 [debug] [MainThread]: checksum: 4568eb639a77b8fcb3a1f4a07856f42b1ff63f1376652889143968e1dbdafbda, vars: {}, profile: , target: , version: 1.5.0
[0m16:48:52.146601 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m16:48:52.147074 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'eaf888ef-8c85-4b82-a836-2c2579330810', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a8b80f9f60>]}
[0m16:48:52.741986 [debug] [MainThread]: 1699: static parser successfully parsed mart/metal_prices_analytics.sql
[0m16:48:52.755342 [debug] [MainThread]: 1699: static parser successfully parsed dds/dim_metals.sql
[0m16:48:52.759488 [debug] [MainThread]: 1699: static parser successfully parsed dds/fact_metal_prices.sql
[0m16:48:52.763002 [debug] [MainThread]: 1699: static parser successfully parsed staging/stg_cbr_precious_metals.sql
[0m16:48:52.799356 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'eaf888ef-8c85-4b82-a836-2c2579330810', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a8b76c8b20>]}
[0m16:48:52.805019 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'eaf888ef-8c85-4b82-a836-2c2579330810', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a8b9cbf850>]}
[0m16:48:52.805524 [info ] [MainThread]: Found 4 models, 0 tests, 0 snapshots, 0 analyses, 308 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m16:48:52.805927 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'eaf888ef-8c85-4b82-a836-2c2579330810', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a8b7676620>]}
[0m16:48:52.807443 [info ] [MainThread]: 
[0m16:48:52.808313 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m16:48:52.809712 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m16:48:52.810591 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m16:48:52.822807 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m16:48:52.824926 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m16:48:52.825457 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m16:48:52.825887 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m16:48:52.826300 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:48:52.826725 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:48:52.839953 [debug] [ThreadPool]: SQL status: SELECT 13 in 0.0 seconds
[0m16:48:52.841644 [debug] [ThreadPool]: On list_bank_rates: Close
[0m16:48:52.842011 [debug] [ThreadPool]: SQL status: SELECT 13 in 0.0 seconds
[0m16:48:52.843504 [debug] [ThreadPool]: On list_bank_rates: Close
[0m16:48:52.846507 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m16:48:52.847575 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m16:48:52.847958 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:48:52.856556 [debug] [ThreadPool]: SQL status: SELECT 13 in 0.0 seconds
[0m16:48:52.857750 [debug] [ThreadPool]: On list_bank_rates: Close
[0m16:48:52.859258 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates, now create_bank_rates_mart)
[0m16:48:52.859966 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates, now create_bank_rates_dds)
[0m16:48:52.860760 [debug] [ThreadPool]: Creating schema "database: "bank_rates"
schema: "mart"
"
[0m16:48:52.861539 [debug] [ThreadPool]: Creating schema "database: "bank_rates"
schema: "dds"
"
[0m16:48:52.867615 [debug] [ThreadPool]: Using postgres connection "create_bank_rates_mart"
[0m16:48:52.870120 [debug] [ThreadPool]: Using postgres connection "create_bank_rates_dds"
[0m16:48:52.870530 [debug] [ThreadPool]: On create_bank_rates_mart: BEGIN
[0m16:48:52.870910 [debug] [ThreadPool]: On create_bank_rates_dds: BEGIN
[0m16:48:52.871262 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:48:52.871643 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:48:52.883738 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m16:48:52.884149 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m16:48:52.884561 [debug] [ThreadPool]: Using postgres connection "create_bank_rates_mart"
[0m16:48:52.884957 [debug] [ThreadPool]: Using postgres connection "create_bank_rates_dds"
[0m16:48:52.885346 [debug] [ThreadPool]: On create_bank_rates_mart: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "create_bank_rates_mart"} */
create schema if not exists "mart"
[0m16:48:52.885715 [debug] [ThreadPool]: On create_bank_rates_dds: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "create_bank_rates_dds"} */
create schema if not exists "dds"
[0m16:48:52.886576 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.0 seconds
[0m16:48:52.886899 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.0 seconds
[0m16:48:52.887909 [debug] [ThreadPool]: On create_bank_rates_dds: COMMIT
[0m16:48:52.888946 [debug] [ThreadPool]: On create_bank_rates_mart: COMMIT
[0m16:48:52.889358 [debug] [ThreadPool]: Using postgres connection "create_bank_rates_dds"
[0m16:48:52.889708 [debug] [ThreadPool]: Using postgres connection "create_bank_rates_mart"
[0m16:48:52.890043 [debug] [ThreadPool]: On create_bank_rates_dds: COMMIT
[0m16:48:52.890417 [debug] [ThreadPool]: On create_bank_rates_mart: COMMIT
[0m16:48:52.893103 [debug] [ThreadPool]: SQL status: COMMIT in 0.0 seconds
[0m16:48:52.893439 [debug] [ThreadPool]: On create_bank_rates_dds: Close
[0m16:48:52.894559 [debug] [ThreadPool]: SQL status: COMMIT in 0.0 seconds
[0m16:48:52.894966 [debug] [ThreadPool]: On create_bank_rates_mart: Close
[0m16:48:52.897399 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_bank_rates_mart, now list_bank_rates_mart)
[0m16:48:52.903512 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_bank_rates_dds, now list_bank_rates_dds)
[0m16:48:52.904763 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m16:48:52.908239 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m16:48:52.908647 [debug] [ThreadPool]: On list_bank_rates_mart: BEGIN
[0m16:48:52.909038 [debug] [ThreadPool]: On list_bank_rates_dds: BEGIN
[0m16:48:52.909423 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:48:52.909773 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:48:52.919641 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m16:48:52.920083 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m16:48:52.920495 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m16:48:52.920860 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m16:48:52.921247 [debug] [ThreadPool]: On list_bank_rates_dds: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_dds"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dds'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dds'
  
[0m16:48:52.921619 [debug] [ThreadPool]: On list_bank_rates_mart: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_mart"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'mart'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'mart'
  
[0m16:48:52.924635 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.0 seconds
[0m16:48:52.924989 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.0 seconds
[0m16:48:52.926417 [debug] [ThreadPool]: On list_bank_rates_dds: ROLLBACK
[0m16:48:52.927729 [debug] [ThreadPool]: On list_bank_rates_mart: ROLLBACK
[0m16:48:52.928275 [debug] [ThreadPool]: On list_bank_rates_dds: Close
[0m16:48:52.928563 [debug] [ThreadPool]: On list_bank_rates_mart: Close
[0m16:48:52.929925 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates_dds, now list_bank_rates_staging)
[0m16:48:52.932794 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m16:48:52.933159 [debug] [ThreadPool]: On list_bank_rates_staging: BEGIN
[0m16:48:52.933515 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:48:52.940883 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m16:48:52.941273 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m16:48:52.941671 [debug] [ThreadPool]: On list_bank_rates_staging: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_staging"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging'
  
[0m16:48:52.944420 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m16:48:52.945848 [debug] [ThreadPool]: On list_bank_rates_staging: ROLLBACK
[0m16:48:52.946323 [debug] [ThreadPool]: On list_bank_rates_staging: Close
[0m16:48:52.952086 [debug] [MainThread]: Using postgres connection "master"
[0m16:48:52.952480 [debug] [MainThread]: On master: BEGIN
[0m16:48:52.952793 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:48:52.960632 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m16:48:52.960986 [debug] [MainThread]: Using postgres connection "master"
[0m16:48:52.961429 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m16:48:52.967129 [debug] [MainThread]: SQL status: SELECT 2 in 0.0 seconds
[0m16:48:52.968416 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'eaf888ef-8c85-4b82-a836-2c2579330810', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a8b80fb7c0>]}
[0m16:48:52.968880 [debug] [MainThread]: On master: ROLLBACK
[0m16:48:52.969338 [debug] [MainThread]: Using postgres connection "master"
[0m16:48:52.969613 [debug] [MainThread]: On master: BEGIN
[0m16:48:52.970104 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m16:48:52.970381 [debug] [MainThread]: On master: COMMIT
[0m16:48:52.970599 [debug] [MainThread]: Using postgres connection "master"
[0m16:48:52.970803 [debug] [MainThread]: On master: COMMIT
[0m16:48:52.971157 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m16:48:52.971446 [debug] [MainThread]: On master: Close
[0m16:48:52.972199 [info ] [MainThread]: Concurrency: 2 threads (target='dev')
[0m16:48:52.972632 [info ] [MainThread]: 
[0m16:48:52.976118 [debug] [Thread-1 (]: Began running node model.bank_rates.stg_cbr_precious_metals
[0m16:48:52.976721 [info ] [Thread-1 (]: 1 of 4 START sql view model staging.stg_cbr_precious_metals .................... [RUN]
[0m16:48:52.977692 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_bank_rates_staging, now model.bank_rates.stg_cbr_precious_metals)
[0m16:48:52.978142 [debug] [Thread-1 (]: Began compiling node model.bank_rates.stg_cbr_precious_metals
[0m16:48:52.981223 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_rates.stg_cbr_precious_metals"
[0m16:48:52.981980 [debug] [Thread-1 (]: Timing info for model.bank_rates.stg_cbr_precious_metals (compile): 16:48:52.978380 => 16:48:52.981743
[0m16:48:52.982372 [debug] [Thread-1 (]: Began executing node model.bank_rates.stg_cbr_precious_metals
[0m16:48:53.021986 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_rates.stg_cbr_precious_metals"
[0m16:48:53.022877 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m16:48:53.023299 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: BEGIN
[0m16:48:53.023647 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:48:53.032528 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m16:48:53.033010 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m16:48:53.033479 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */

  create view "bank_rates"."staging"."stg_cbr_precious_metals__dbt_tmp"
    
    
  as (
    

SELECT 
    record_date::DATE as trade_date,
    metal_code::INTEGER as metal_code,
    CASE 
        WHEN metal_code = 1 THEN 'Ð—Ð¾Ð»Ð¾Ñ‚Ð¾'
        WHEN metal_code = 2 THEN 'Ð¡ÐµÑ€ÐµÐ±Ñ€Ð¾'
        WHEN metal_code = 3 THEN 'ÐŸÐ»Ð°Ñ‚Ð¸Ð½Ð°'
        WHEN metal_code = 4 THEN 'ÐŸÐ°Ð»Ð»Ð°Ð´Ð¸Ð¹'
        ELSE 'ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ð¹ Ð¼ÐµÑ‚Ð°Ð»Ð»'
    END as metal_name,
    buy_price::DECIMAL(10,2) as buy_price_rub,
    sell_price::DECIMAL(10,2) as sell_price_rub,
    load_timestamp::TIMESTAMP as loaded_at
FROM raw.cbr_precious_metals
  );
[0m16:48:53.035525 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.0 seconds
[0m16:48:53.042592 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m16:48:53.043009 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
alter table "bank_rates"."staging"."stg_cbr_precious_metals__dbt_tmp" rename to "stg_cbr_precious_metals"
[0m16:48:53.043910 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m16:48:53.059953 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: COMMIT
[0m16:48:53.060373 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m16:48:53.060685 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: COMMIT
[0m16:48:53.062806 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m16:48:53.069531 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m16:48:53.069948 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
drop view if exists "bank_rates"."staging"."stg_cbr_precious_metals__dbt_backup" cascade
[0m16:48:53.070584 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.0 seconds
[0m16:48:53.072248 [debug] [Thread-1 (]: Timing info for model.bank_rates.stg_cbr_precious_metals (execute): 16:48:52.982584 => 16:48:53.071994
[0m16:48:53.072613 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: Close
[0m16:48:53.073565 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eaf888ef-8c85-4b82-a836-2c2579330810', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a8b73ec550>]}
[0m16:48:53.074450 [info ] [Thread-1 (]: 1 of 4 OK created sql view model staging.stg_cbr_precious_metals ............... [[32mCREATE VIEW[0m in 0.10s]
[0m16:48:53.075335 [debug] [Thread-1 (]: Finished running node model.bank_rates.stg_cbr_precious_metals
[0m16:48:53.076313 [debug] [Thread-2 (]: Began running node model.bank_rates.dim_metals
[0m16:48:53.076896 [debug] [Thread-1 (]: Began running node model.bank_rates.fact_metal_prices
[0m16:48:53.077416 [info ] [Thread-2 (]: 2 of 4 START sql table model dds.dim_metals .................................... [RUN]
[0m16:48:53.078126 [info ] [Thread-1 (]: 3 of 4 START sql table model dds.fact_metal_prices ............................. [RUN]
[0m16:48:53.078962 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_bank_rates_mart, now model.bank_rates.dim_metals)
[0m16:48:53.079678 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.bank_rates.stg_cbr_precious_metals, now model.bank_rates.fact_metal_prices)
[0m16:48:53.080145 [debug] [Thread-2 (]: Began compiling node model.bank_rates.dim_metals
[0m16:48:53.080569 [debug] [Thread-1 (]: Began compiling node model.bank_rates.fact_metal_prices
[0m16:48:53.084347 [debug] [Thread-2 (]: Writing injected SQL for node "model.bank_rates.dim_metals"
[0m16:48:53.087494 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_rates.fact_metal_prices"
[0m16:48:53.088429 [debug] [Thread-1 (]: Timing info for model.bank_rates.fact_metal_prices (compile): 16:48:53.084678 => 16:48:53.088169
[0m16:48:53.088863 [debug] [Thread-1 (]: Began executing node model.bank_rates.fact_metal_prices
[0m16:48:53.089425 [debug] [Thread-2 (]: Timing info for model.bank_rates.dim_metals (compile): 16:48:53.080857 => 16:48:53.089151
[0m16:48:53.110406 [debug] [Thread-2 (]: Began executing node model.bank_rates.dim_metals
[0m16:48:53.116598 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_rates.fact_metal_prices"
[0m16:48:53.120791 [debug] [Thread-2 (]: Writing runtime sql for node "model.bank_rates.dim_metals"
[0m16:48:53.121809 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m16:48:53.122388 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m16:48:53.122775 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: BEGIN
[0m16:48:53.123217 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: BEGIN
[0m16:48:53.123652 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:48:53.124083 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m16:48:53.134362 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m16:48:53.134861 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m16:48:53.135376 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m16:48:53.135850 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m16:48:53.136332 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */

  
    

  create  table "bank_rates"."dds"."fact_metal_prices__dbt_tmp"
  
  
    as
  
  (
    

SELECT 
    ROW_NUMBER() OVER (ORDER BY trade_date, metal_code) as price_id,
    trade_date,
    metal_code,
    metal_name,
    buy_price_rub,
    sell_price_rub,
    loaded_at,
    CURRENT_TIMESTAMP as dwh_loaded_at
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
WHERE trade_date IS NOT NULL
  AND metal_code IS NOT NULL
  );
  
[0m16:48:53.136790 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */

  
    

  create  table "bank_rates"."dds"."dim_metals__dbt_tmp"
  
  
    as
  
  (
    

SELECT DISTINCT
    metal_code,
    metal_name
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
WHERE metal_code IS NOT NULL
  );
  
[0m16:48:53.213467 [debug] [Thread-2 (]: SQL status: SELECT 4 in 0.0 seconds
[0m16:48:53.219473 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m16:48:53.220144 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
alter table "bank_rates"."dds"."dim_metals__dbt_tmp" rename to "dim_metals"
[0m16:48:53.221126 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m16:48:53.230813 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: COMMIT
[0m16:48:53.231314 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m16:48:53.231724 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: COMMIT
[0m16:48:53.236730 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m16:48:53.239397 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m16:48:53.239855 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
drop table if exists "bank_rates"."dds"."dim_metals__dbt_backup" cascade
[0m16:48:53.240528 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m16:48:53.242118 [debug] [Thread-2 (]: Timing info for model.bank_rates.dim_metals (execute): 16:48:53.116931 => 16:48:53.241895
[0m16:48:53.242529 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: Close
[0m16:48:53.242957 [debug] [Thread-1 (]: SQL status: SELECT 16796 in 0.0 seconds
[0m16:48:53.244015 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eaf888ef-8c85-4b82-a836-2c2579330810', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a8b7322ce0>]}
[0m16:48:53.247344 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m16:48:53.248095 [info ] [Thread-2 (]: 2 of 4 OK created sql table model dds.dim_metals ............................... [[32mSELECT 4[0m in 0.17s]
[0m16:48:53.248736 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
alter table "bank_rates"."dds"."fact_metal_prices__dbt_tmp" rename to "fact_metal_prices"
[0m16:48:53.249391 [debug] [Thread-2 (]: Finished running node model.bank_rates.dim_metals
[0m16:48:53.250171 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m16:48:53.251923 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: COMMIT
[0m16:48:53.252339 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m16:48:53.252738 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: COMMIT
[0m16:48:53.263679 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m16:48:53.266559 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m16:48:53.267014 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
drop table if exists "bank_rates"."dds"."fact_metal_prices__dbt_backup" cascade
[0m16:48:53.267697 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m16:48:53.269334 [debug] [Thread-1 (]: Timing info for model.bank_rates.fact_metal_prices (execute): 16:48:53.089637 => 16:48:53.269130
[0m16:48:53.269721 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: Close
[0m16:48:53.270503 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eaf888ef-8c85-4b82-a836-2c2579330810', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a8b7321030>]}
[0m16:48:53.271204 [info ] [Thread-1 (]: 3 of 4 OK created sql table model dds.fact_metal_prices ........................ [[32mSELECT 16796[0m in 0.19s]
[0m16:48:53.272008 [debug] [Thread-1 (]: Finished running node model.bank_rates.fact_metal_prices
[0m16:48:53.273283 [debug] [Thread-2 (]: Began running node model.bank_rates.metal_prices_analytics
[0m16:48:53.273807 [info ] [Thread-2 (]: 4 of 4 START sql table model mart.metal_prices_analytics ....................... [RUN]
[0m16:48:53.274631 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bank_rates.dim_metals, now model.bank_rates.metal_prices_analytics)
[0m16:48:53.275038 [debug] [Thread-2 (]: Began compiling node model.bank_rates.metal_prices_analytics
[0m16:48:53.279916 [debug] [Thread-2 (]: Writing injected SQL for node "model.bank_rates.metal_prices_analytics"
[0m16:48:53.280698 [debug] [Thread-2 (]: Timing info for model.bank_rates.metal_prices_analytics (compile): 16:48:53.275294 => 16:48:53.280445
[0m16:48:53.281125 [debug] [Thread-2 (]: Began executing node model.bank_rates.metal_prices_analytics
[0m16:48:53.285082 [debug] [Thread-2 (]: Writing runtime sql for node "model.bank_rates.metal_prices_analytics"
[0m16:48:53.285724 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m16:48:53.286141 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: BEGIN
[0m16:48:53.286513 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m16:48:53.294992 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m16:48:53.295440 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m16:48:53.295874 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */

  
    

  create  table "bank_rates"."mart"."metal_prices_analytics__dbt_tmp"
  
  
    as
  
  (
    

SELECT 
    f.trade_date,
    f.metal_name,
    f.buy_price_rub,
    f.sell_price_rub,
    ROUND((f.buy_price_rub + f.sell_price_rub) / 2, 2) as avg_price_rub,
    LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) as prev_buy_price,
    LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) as prev_sell_price,
    CASE 
        WHEN LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) IS NOT NULL 
        THEN ROUND((f.buy_price_rub - LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date)) / 
                   LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) * 100, 2)
        ELSE NULL 
    END as buy_price_change_percent,
    CASE 
        WHEN LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) IS NOT NULL 
        THEN ROUND((f.sell_price_rub - LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date)) / 
                   LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) * 100, 2)
        ELSE NULL 
    END as sell_price_change_percent
FROM "bank_rates"."dds"."fact_metal_prices" f
ORDER BY f.trade_date DESC, f.metal_name
  );
  
[0m16:48:53.367073 [debug] [Thread-2 (]: SQL status: SELECT 16796 in 0.0 seconds
[0m16:48:53.371249 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m16:48:53.371710 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
alter table "bank_rates"."mart"."metal_prices_analytics__dbt_tmp" rename to "metal_prices_analytics"
[0m16:48:53.372554 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m16:48:53.374542 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: COMMIT
[0m16:48:53.374972 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m16:48:53.375384 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: COMMIT
[0m16:48:53.412639 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m16:48:53.415873 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m16:48:53.416295 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
drop table if exists "bank_rates"."mart"."metal_prices_analytics__dbt_backup" cascade
[0m16:48:53.416881 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m16:48:53.418509 [debug] [Thread-2 (]: Timing info for model.bank_rates.metal_prices_analytics (execute): 16:48:53.281371 => 16:48:53.418302
[0m16:48:53.418869 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: Close
[0m16:48:53.419668 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eaf888ef-8c85-4b82-a836-2c2579330810', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a8b731f190>]}
[0m16:48:53.420364 [info ] [Thread-2 (]: 4 of 4 OK created sql table model mart.metal_prices_analytics .................. [[32mSELECT 16796[0m in 0.15s]
[0m16:48:53.421225 [debug] [Thread-2 (]: Finished running node model.bank_rates.metal_prices_analytics
[0m16:48:53.423004 [debug] [MainThread]: Using postgres connection "master"
[0m16:48:53.423390 [debug] [MainThread]: On master: BEGIN
[0m16:48:53.423674 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:48:53.432181 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m16:48:53.432615 [debug] [MainThread]: On master: COMMIT
[0m16:48:53.432954 [debug] [MainThread]: Using postgres connection "master"
[0m16:48:53.433306 [debug] [MainThread]: On master: COMMIT
[0m16:48:53.433751 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m16:48:53.434096 [debug] [MainThread]: On master: Close
[0m16:48:53.434766 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:48:53.435080 [debug] [MainThread]: Connection 'model.bank_rates.fact_metal_prices' was properly closed.
[0m16:48:53.435417 [debug] [MainThread]: Connection 'model.bank_rates.metal_prices_analytics' was properly closed.
[0m16:48:53.435793 [info ] [MainThread]: 
[0m16:48:53.436283 [info ] [MainThread]: Finished running 1 view model, 3 table models in 0 hours 0 minutes and 0.63 seconds (0.63s).
[0m16:48:53.437604 [debug] [MainThread]: Command end result
[0m16:48:53.443446 [info ] [MainThread]: 
[0m16:48:53.443983 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:48:53.444467 [info ] [MainThread]: 
[0m16:48:53.444951 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m16:48:53.445606 [debug] [MainThread]: Command `dbt run` succeeded at 16:48:53.445477 after 1.46 seconds
[0m16:48:53.445971 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a8b96e59c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a8b7701690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a8b9cbd5a0>]}
[0m16:48:53.446343 [debug] [MainThread]: Flushing usage events
[0m16:53:26.843736 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x781b36da1960>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x781b357cfa00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x781b357cfa90>]}


============================== 16:53:26.847161 | 0841005e-219a-4496-b702-f73e43a9d1a9 ==============================
[0m16:53:26.847161 [info ] [MainThread]: Running with dbt=1.5.0
[0m16:53:26.847811 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'partial_parse': 'True', 'introspect': 'True', 'use_colors': 'True', 'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'log_path': '/usr/app/logs', 'target_path': 'None', 'printer_width': '80', 'log_format': 'default', 'profiles_dir': '.', 'write_json': 'True', 'warn_error': 'None', 'use_experimental_parser': 'False', 'version_check': 'True', 'static_parser': 'True', 'debug': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'no_print': 'None', 'fail_fast': 'False', 'quiet': 'False'}
[0m16:53:26.961684 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0841005e-219a-4496-b702-f73e43a9d1a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x781b357cfbe0>]}
[0m16:53:26.982844 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0841005e-219a-4496-b702-f73e43a9d1a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x781b356f6f50>]}
[0m16:53:26.994132 [debug] [MainThread]: checksum: 4568eb639a77b8fcb3a1f4a07856f42b1ff63f1376652889143968e1dbdafbda, vars: {}, profile: , target: , version: 1.5.0
[0m16:53:27.014880 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 3 files added, 0 files changed.
[0m16:53:27.015538 [debug] [MainThread]: Partial parsing: added file: bank_rates://tests/not_null_key_columns.sql
[0m16:53:27.015939 [debug] [MainThread]: Partial parsing: added file: bank_rates://tests/positive_prices.sql
[0m16:53:27.016329 [debug] [MainThread]: Partial parsing: added file: bank_rates://tests/unique_trade_date_metal_code.sql
[0m16:53:27.072669 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0841005e-219a-4496-b702-f73e43a9d1a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x781b3476a230>]}
[0m16:53:27.079393 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0841005e-219a-4496-b702-f73e43a9d1a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x781b3472fee0>]}
[0m16:53:27.080025 [info ] [MainThread]: Found 4 models, 3 tests, 0 snapshots, 0 analyses, 308 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m16:53:27.080498 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0841005e-219a-4496-b702-f73e43a9d1a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x781b3472feb0>]}
[0m16:53:27.082313 [info ] [MainThread]: 
[0m16:53:27.083202 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m16:53:27.084668 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates_dds'
[0m16:53:27.085660 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates_staging'
[0m16:53:27.098210 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m16:53:27.100672 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m16:53:27.101205 [debug] [ThreadPool]: On list_bank_rates_dds: BEGIN
[0m16:53:27.101774 [debug] [ThreadPool]: On list_bank_rates_staging: BEGIN
[0m16:53:27.102197 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:53:27.102699 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:53:27.118010 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m16:53:27.118510 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m16:53:27.118992 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m16:53:27.119391 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m16:53:27.119796 [debug] [ThreadPool]: On list_bank_rates_staging: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_staging"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging'
  
[0m16:53:27.120200 [debug] [ThreadPool]: On list_bank_rates_dds: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_dds"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dds'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dds'
  
[0m16:53:27.123156 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m16:53:27.123530 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m16:53:27.125159 [debug] [ThreadPool]: On list_bank_rates_dds: ROLLBACK
[0m16:53:27.126632 [debug] [ThreadPool]: On list_bank_rates_staging: ROLLBACK
[0m16:53:27.127205 [debug] [ThreadPool]: On list_bank_rates_dds: Close
[0m16:53:27.127503 [debug] [ThreadPool]: On list_bank_rates_staging: Close
[0m16:53:27.129023 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates_dds, now list_bank_rates_mart)
[0m16:53:27.133953 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m16:53:27.134344 [debug] [ThreadPool]: On list_bank_rates_mart: BEGIN
[0m16:53:27.134602 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:53:27.143214 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m16:53:27.143597 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m16:53:27.144036 [debug] [ThreadPool]: On list_bank_rates_mart: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_mart"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'mart'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'mart'
  
[0m16:53:27.146830 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m16:53:27.148415 [debug] [ThreadPool]: On list_bank_rates_mart: ROLLBACK
[0m16:53:27.148934 [debug] [ThreadPool]: On list_bank_rates_mart: Close
[0m16:53:27.155148 [debug] [MainThread]: Using postgres connection "master"
[0m16:53:27.155531 [debug] [MainThread]: On master: BEGIN
[0m16:53:27.155853 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:53:27.164388 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m16:53:27.164751 [debug] [MainThread]: Using postgres connection "master"
[0m16:53:27.165155 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m16:53:27.171407 [debug] [MainThread]: SQL status: SELECT 3 in 0.0 seconds
[0m16:53:27.172837 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0841005e-219a-4496-b702-f73e43a9d1a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x781b3472e590>]}
[0m16:53:27.173375 [debug] [MainThread]: On master: ROLLBACK
[0m16:53:27.173821 [debug] [MainThread]: Using postgres connection "master"
[0m16:53:27.174157 [debug] [MainThread]: On master: BEGIN
[0m16:53:27.174648 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m16:53:27.174966 [debug] [MainThread]: On master: COMMIT
[0m16:53:27.175280 [debug] [MainThread]: Using postgres connection "master"
[0m16:53:27.175554 [debug] [MainThread]: On master: COMMIT
[0m16:53:27.175935 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m16:53:27.176253 [debug] [MainThread]: On master: Close
[0m16:53:27.176950 [info ] [MainThread]: Concurrency: 2 threads (target='dev')
[0m16:53:27.177408 [info ] [MainThread]: 
[0m16:53:27.181820 [debug] [Thread-1 (]: Began running node test.bank_rates.not_null_key_columns
[0m16:53:27.182303 [debug] [Thread-2 (]: Began running node test.bank_rates.positive_prices
[0m16:53:27.182827 [info ] [Thread-1 (]: 1 of 3 START test not_null_key_columns ......................................... [RUN]
[0m16:53:27.183519 [info ] [Thread-2 (]: 2 of 3 START test positive_prices .............................................. [RUN]
[0m16:53:27.184478 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_bank_rates_mart, now test.bank_rates.not_null_key_columns)
[0m16:53:27.185233 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_bank_rates_staging, now test.bank_rates.positive_prices)
[0m16:53:27.185657 [debug] [Thread-1 (]: Began compiling node test.bank_rates.not_null_key_columns
[0m16:53:27.186030 [debug] [Thread-2 (]: Began compiling node test.bank_rates.positive_prices
[0m16:53:27.189304 [debug] [Thread-1 (]: Writing injected SQL for node "test.bank_rates.not_null_key_columns"
[0m16:53:27.192330 [debug] [Thread-2 (]: Writing injected SQL for node "test.bank_rates.positive_prices"
[0m16:53:27.193318 [debug] [Thread-2 (]: Timing info for test.bank_rates.positive_prices (compile): 16:53:27.189683 => 16:53:27.192985
[0m16:53:27.193768 [debug] [Thread-1 (]: Timing info for test.bank_rates.not_null_key_columns (compile): 16:53:27.186317 => 16:53:27.193556
[0m16:53:27.194216 [debug] [Thread-2 (]: Began executing node test.bank_rates.positive_prices
[0m16:53:27.194722 [debug] [Thread-1 (]: Began executing node test.bank_rates.not_null_key_columns
[0m16:53:27.212791 [debug] [Thread-2 (]: Writing runtime sql for node "test.bank_rates.positive_prices"
[0m16:53:27.215215 [debug] [Thread-1 (]: Writing runtime sql for node "test.bank_rates.not_null_key_columns"
[0m16:53:27.216131 [debug] [Thread-1 (]: Using postgres connection "test.bank_rates.not_null_key_columns"
[0m16:53:27.216607 [debug] [Thread-2 (]: Using postgres connection "test.bank_rates.positive_prices"
[0m16:53:27.216967 [debug] [Thread-1 (]: On test.bank_rates.not_null_key_columns: BEGIN
[0m16:53:27.217378 [debug] [Thread-2 (]: On test.bank_rates.positive_prices: BEGIN
[0m16:53:27.217752 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:53:27.218139 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m16:53:27.228099 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m16:53:27.228569 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m16:53:27.228913 [debug] [Thread-2 (]: Using postgres connection "test.bank_rates.positive_prices"
[0m16:53:27.229341 [debug] [Thread-1 (]: Using postgres connection "test.bank_rates.not_null_key_columns"
[0m16:53:27.229770 [debug] [Thread-2 (]: On test.bank_rates.positive_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "test.bank_rates.positive_prices"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      SELECT 
    trade_date,
    metal_code,
    buy_price_rub,
    sell_price_rub
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
WHERE buy_price_rub <= 0 OR sell_price_rub <= 0
      
    ) dbt_internal_test
[0m16:53:27.230231 [debug] [Thread-1 (]: On test.bank_rates.not_null_key_columns: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "test.bank_rates.not_null_key_columns"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      SELECT 
    trade_date,
    metal_code
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
WHERE trade_date IS NULL 
   OR metal_code IS NULL 
   OR buy_price_rub IS NULL 
   OR sell_price_rub IS NULL
      
    ) dbt_internal_test
[0m16:53:27.233267 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m16:53:27.236142 [debug] [Thread-1 (]: Timing info for test.bank_rates.not_null_key_columns (execute): 16:53:27.213102 => 16:53:27.235844
[0m16:53:27.236512 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m16:53:27.236944 [debug] [Thread-1 (]: On test.bank_rates.not_null_key_columns: ROLLBACK
[0m16:53:27.238585 [debug] [Thread-2 (]: Timing info for test.bank_rates.positive_prices (execute): 16:53:27.195112 => 16:53:27.238344
[0m16:53:27.239105 [debug] [Thread-2 (]: On test.bank_rates.positive_prices: ROLLBACK
[0m16:53:27.239475 [debug] [Thread-1 (]: On test.bank_rates.not_null_key_columns: Close
[0m16:53:27.241240 [debug] [Thread-2 (]: On test.bank_rates.positive_prices: Close
[0m16:53:27.240743 [info ] [Thread-1 (]: 1 of 3 PASS not_null_key_columns ............................................... [[32mPASS[0m in 0.06s]
[0m16:53:27.243382 [debug] [Thread-1 (]: Finished running node test.bank_rates.not_null_key_columns
[0m16:53:27.242614 [info ] [Thread-2 (]: 2 of 3 PASS positive_prices .................................................... [[32mPASS[0m in 0.06s]
[0m16:53:27.244042 [debug] [Thread-1 (]: Began running node test.bank_rates.unique_trade_date_metal_code
[0m16:53:27.244810 [debug] [Thread-2 (]: Finished running node test.bank_rates.positive_prices
[0m16:53:27.245257 [info ] [Thread-1 (]: 3 of 3 START test unique_trade_date_metal_code ................................. [RUN]
[0m16:53:27.246270 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.bank_rates.not_null_key_columns, now test.bank_rates.unique_trade_date_metal_code)
[0m16:53:27.246636 [debug] [Thread-1 (]: Began compiling node test.bank_rates.unique_trade_date_metal_code
[0m16:53:27.249648 [debug] [Thread-1 (]: Writing injected SQL for node "test.bank_rates.unique_trade_date_metal_code"
[0m16:53:27.250325 [debug] [Thread-1 (]: Timing info for test.bank_rates.unique_trade_date_metal_code (compile): 16:53:27.246837 => 16:53:27.250089
[0m16:53:27.250684 [debug] [Thread-1 (]: Began executing node test.bank_rates.unique_trade_date_metal_code
[0m16:53:27.252929 [debug] [Thread-1 (]: Writing runtime sql for node "test.bank_rates.unique_trade_date_metal_code"
[0m16:53:27.253468 [debug] [Thread-1 (]: Using postgres connection "test.bank_rates.unique_trade_date_metal_code"
[0m16:53:27.253829 [debug] [Thread-1 (]: On test.bank_rates.unique_trade_date_metal_code: BEGIN
[0m16:53:27.254148 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:53:27.262346 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m16:53:27.262713 [debug] [Thread-1 (]: Using postgres connection "test.bank_rates.unique_trade_date_metal_code"
[0m16:53:27.263021 [debug] [Thread-1 (]: On test.bank_rates.unique_trade_date_metal_code: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "test.bank_rates.unique_trade_date_metal_code"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      SELECT 
    trade_date,
    metal_code,
    COUNT(*) as count
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
GROUP BY trade_date, metal_code
HAVING COUNT(*) > 1
      
    ) dbt_internal_test
[0m16:53:27.272667 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m16:53:27.274559 [debug] [Thread-1 (]: Timing info for test.bank_rates.unique_trade_date_metal_code (execute): 16:53:27.250883 => 16:53:27.274287
[0m16:53:27.274957 [debug] [Thread-1 (]: On test.bank_rates.unique_trade_date_metal_code: ROLLBACK
[0m16:53:27.275504 [debug] [Thread-1 (]: On test.bank_rates.unique_trade_date_metal_code: Close
[0m16:53:27.276701 [error] [Thread-1 (]: 3 of 3 FAIL 4 unique_trade_date_metal_code ..................................... [[31mFAIL 4[0m in 0.03s]
[0m16:53:27.277680 [debug] [Thread-1 (]: Finished running node test.bank_rates.unique_trade_date_metal_code
[0m16:53:27.279406 [debug] [MainThread]: Using postgres connection "master"
[0m16:53:27.279786 [debug] [MainThread]: On master: BEGIN
[0m16:53:27.280128 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:53:27.288692 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m16:53:27.289075 [debug] [MainThread]: On master: COMMIT
[0m16:53:27.289399 [debug] [MainThread]: Using postgres connection "master"
[0m16:53:27.289681 [debug] [MainThread]: On master: COMMIT
[0m16:53:27.290107 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m16:53:27.290421 [debug] [MainThread]: On master: Close
[0m16:53:27.291042 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:53:27.291360 [debug] [MainThread]: Connection 'test.bank_rates.unique_trade_date_metal_code' was properly closed.
[0m16:53:27.291612 [debug] [MainThread]: Connection 'test.bank_rates.positive_prices' was properly closed.
[0m16:53:27.291936 [info ] [MainThread]: 
[0m16:53:27.292367 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 0.21 seconds (0.21s).
[0m16:53:27.293520 [debug] [MainThread]: Command end result
[0m16:53:27.299245 [info ] [MainThread]: 
[0m16:53:27.299818 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:53:27.300247 [info ] [MainThread]: 
[0m16:53:27.300654 [error] [MainThread]: [31mFailure in test unique_trade_date_metal_code (tests/unique_trade_date_metal_code.sql)[0m
[0m16:53:27.301021 [error] [MainThread]:   Got 4 results, configured to fail if != 0
[0m16:53:27.301428 [info ] [MainThread]: 
[0m16:53:27.301813 [info ] [MainThread]:   compiled Code at target/compiled/bank_rates/tests/unique_trade_date_metal_code.sql
[0m16:53:27.302244 [info ] [MainThread]: 
[0m16:53:27.302692 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m16:53:27.303339 [debug] [MainThread]: Command `dbt test` failed at 16:53:27.303211 after 0.47 seconds
[0m16:53:27.303751 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x781b36da1960>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x781b3475cfd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x781b34738670>]}
[0m16:53:27.304186 [debug] [MainThread]: Flushing usage events
[0m16:56:25.185326 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x700c581699c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x700c56bcfa60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x700c56bcfaf0>]}


============================== 16:56:25.188821 | bf341033-d499-45b9-8d70-f7f9cdceee7e ==============================
[0m16:56:25.188821 [info ] [MainThread]: Running with dbt=1.5.0
[0m16:56:25.189600 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'printer_width': '80', 'log_path': '/usr/app/logs', 'introspect': 'True', 'indirect_selection': 'eager', 'static_parser': 'True', 'profiles_dir': '.', 'debug': 'False', 'partial_parse': 'True', 'quiet': 'False', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'use_experimental_parser': 'False', 'use_colors': 'True', 'warn_error': 'None', 'write_json': 'True', 'log_cache_events': 'False', 'version_check': 'True', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'fail_fast': 'False'}
[0m16:56:25.304686 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bf341033-d499-45b9-8d70-f7f9cdceee7e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x700c56bcfc40>]}
[0m16:56:25.326027 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bf341033-d499-45b9-8d70-f7f9cdceee7e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x700c56afa320>]}
[0m16:56:25.337859 [debug] [MainThread]: checksum: 4568eb639a77b8fcb3a1f4a07856f42b1ff63f1376652889143968e1dbdafbda, vars: {}, profile: , target: , version: 1.5.0
[0m16:56:25.358831 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:56:25.359550 [debug] [MainThread]: Partial parsing: updated file: bank_rates://models/staging/stg_cbr_precious_metals.sql
[0m16:56:25.389035 [debug] [MainThread]: 1699: static parser successfully parsed staging/stg_cbr_precious_metals.sql
[0m16:56:25.410951 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bf341033-d499-45b9-8d70-f7f9cdceee7e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x700c55bdfeb0>]}
[0m16:56:25.417879 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bf341033-d499-45b9-8d70-f7f9cdceee7e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x700c55b33ee0>]}
[0m16:56:25.418507 [info ] [MainThread]: Found 4 models, 3 tests, 0 snapshots, 0 analyses, 308 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m16:56:25.418932 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bf341033-d499-45b9-8d70-f7f9cdceee7e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x700c55b33eb0>]}
[0m16:56:25.420664 [info ] [MainThread]: 
[0m16:56:25.421564 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m16:56:25.423090 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m16:56:25.423945 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m16:56:25.436532 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m16:56:25.438972 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m16:56:25.439525 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m16:56:25.439996 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m16:56:25.440423 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:56:25.440802 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:56:25.453575 [debug] [ThreadPool]: SQL status: SELECT 15 in 0.0 seconds
[0m16:56:25.455735 [debug] [ThreadPool]: On list_bank_rates: Close
[0m16:56:25.459804 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m16:56:25.460344 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m16:56:25.460797 [debug] [ThreadPool]: SQL status: SELECT 15 in 0.0 seconds
[0m16:56:25.461268 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:56:25.462813 [debug] [ThreadPool]: On list_bank_rates: Close
[0m16:56:25.472556 [debug] [ThreadPool]: SQL status: SELECT 15 in 0.0 seconds
[0m16:56:25.474024 [debug] [ThreadPool]: On list_bank_rates: Close
[0m16:56:25.476205 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates, now list_bank_rates_mart)
[0m16:56:25.477081 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates, now list_bank_rates_dds)
[0m16:56:25.483556 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m16:56:25.485814 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m16:56:25.486266 [debug] [ThreadPool]: On list_bank_rates_mart: BEGIN
[0m16:56:25.486759 [debug] [ThreadPool]: On list_bank_rates_dds: BEGIN
[0m16:56:25.487117 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:56:25.487478 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:56:25.497306 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m16:56:25.497822 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m16:56:25.498194 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m16:56:25.498578 [debug] [ThreadPool]: On list_bank_rates_mart: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_mart"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'mart'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'mart'
  
[0m16:56:25.498914 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m16:56:25.499337 [debug] [ThreadPool]: On list_bank_rates_dds: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_dds"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dds'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dds'
  
[0m16:56:25.501689 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m16:56:25.502039 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m16:56:25.503557 [debug] [ThreadPool]: On list_bank_rates_mart: ROLLBACK
[0m16:56:25.505020 [debug] [ThreadPool]: On list_bank_rates_dds: ROLLBACK
[0m16:56:25.505595 [debug] [ThreadPool]: On list_bank_rates_mart: Close
[0m16:56:25.505923 [debug] [ThreadPool]: On list_bank_rates_dds: Close
[0m16:56:25.506989 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates_mart, now list_bank_rates_staging)
[0m16:56:25.509900 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m16:56:25.510991 [debug] [ThreadPool]: On list_bank_rates_staging: BEGIN
[0m16:56:25.511282 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:56:25.519786 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m16:56:25.520309 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m16:56:25.520766 [debug] [ThreadPool]: On list_bank_rates_staging: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_staging"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging'
  
[0m16:56:25.523677 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m16:56:25.525213 [debug] [ThreadPool]: On list_bank_rates_staging: ROLLBACK
[0m16:56:25.525729 [debug] [ThreadPool]: On list_bank_rates_staging: Close
[0m16:56:25.532851 [debug] [MainThread]: Using postgres connection "master"
[0m16:56:25.533282 [debug] [MainThread]: On master: BEGIN
[0m16:56:25.533616 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:56:25.542240 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m16:56:25.542682 [debug] [MainThread]: Using postgres connection "master"
[0m16:56:25.543185 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m16:56:25.549958 [debug] [MainThread]: SQL status: SELECT 3 in 0.0 seconds
[0m16:56:25.551464 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bf341033-d499-45b9-8d70-f7f9cdceee7e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x700c55712290>]}
[0m16:56:25.551989 [debug] [MainThread]: On master: ROLLBACK
[0m16:56:25.552482 [debug] [MainThread]: Using postgres connection "master"
[0m16:56:25.552802 [debug] [MainThread]: On master: BEGIN
[0m16:56:25.553442 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m16:56:25.553818 [debug] [MainThread]: On master: COMMIT
[0m16:56:25.554126 [debug] [MainThread]: Using postgres connection "master"
[0m16:56:25.554396 [debug] [MainThread]: On master: COMMIT
[0m16:56:25.554786 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m16:56:25.555135 [debug] [MainThread]: On master: Close
[0m16:56:25.556044 [info ] [MainThread]: Concurrency: 2 threads (target='dev')
[0m16:56:25.556594 [info ] [MainThread]: 
[0m16:56:25.560553 [debug] [Thread-1 (]: Began running node model.bank_rates.stg_cbr_precious_metals
[0m16:56:25.561165 [info ] [Thread-1 (]: 1 of 4 START sql view model staging.stg_cbr_precious_metals .................... [RUN]
[0m16:56:25.561946 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_bank_rates_staging, now model.bank_rates.stg_cbr_precious_metals)
[0m16:56:25.562359 [debug] [Thread-1 (]: Began compiling node model.bank_rates.stg_cbr_precious_metals
[0m16:56:25.565734 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_rates.stg_cbr_precious_metals"
[0m16:56:25.566468 [debug] [Thread-1 (]: Timing info for model.bank_rates.stg_cbr_precious_metals (compile): 16:56:25.562576 => 16:56:25.566215
[0m16:56:25.566846 [debug] [Thread-1 (]: Began executing node model.bank_rates.stg_cbr_precious_metals
[0m16:56:25.606771 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_rates.stg_cbr_precious_metals"
[0m16:56:25.607677 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m16:56:25.608157 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: BEGIN
[0m16:56:25.608530 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:56:25.617510 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m16:56:25.617971 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m16:56:25.618412 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */

  create view "bank_rates"."staging"."stg_cbr_precious_metals__dbt_tmp"
    
    
  as (
    

WITH ranked_data AS (
    SELECT 
        id,
        record_date::DATE as trade_date,
        metal_code::INTEGER as metal_code,
        buy_price::DECIMAL(10,2) as buy_price_rub,
        sell_price::DECIMAL(10,2) as sell_price_rub,
        from_date::DATE as valid_from,
        to_date::DATE as valid_to,
        load_timestamp::TIMESTAMP as loaded_at,
        -- Ð’Ñ‹Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÑŽÑŽ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÑƒ Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð´Ð½Ñ Ð¸ Ð¼ÐµÑ‚Ð°Ð»Ð»Ð°
        ROW_NUMBER() OVER (
            PARTITION BY record_date, metal_code 
            ORDER BY load_timestamp DESC
        ) as rn
    FROM raw.cbr_precious_metals
    WHERE record_date IS NOT NULL
      AND metal_code IS NOT NULL
      AND buy_price IS NOT NULL
)
SELECT 
    trade_date,
    metal_code,
    CASE 
        WHEN metal_code = 1 THEN 'Ð—Ð¾Ð»Ð¾Ñ‚Ð¾'
        WHEN metal_code = 2 THEN 'Ð¡ÐµÑ€ÐµÐ±Ñ€Ð¾'
        WHEN metal_code = 3 THEN 'ÐŸÐ»Ð°Ñ‚Ð¸Ð½Ð°'
        WHEN metal_code = 4 THEN 'ÐŸÐ°Ð»Ð»Ð°Ð´Ð¸Ð¹'
        ELSE 'ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ð¹ Ð¼ÐµÑ‚Ð°Ð»Ð»'
    END as metal_name,
    buy_price_rub,
    sell_price_rub,
    valid_from,
    valid_to,
    loaded_at
FROM ranked_data
WHERE rn = 1
  );
[0m16:56:25.628707 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.0 seconds
[0m16:56:25.636227 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m16:56:25.636658 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
alter table "bank_rates"."staging"."stg_cbr_precious_metals" rename to "stg_cbr_precious_metals__dbt_backup"
[0m16:56:25.637485 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m16:56:25.640672 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m16:56:25.641077 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
alter table "bank_rates"."staging"."stg_cbr_precious_metals__dbt_tmp" rename to "stg_cbr_precious_metals"
[0m16:56:25.641875 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m16:56:25.661481 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: COMMIT
[0m16:56:25.662010 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m16:56:25.662364 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: COMMIT
[0m16:56:25.665256 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m16:56:25.670886 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m16:56:25.671316 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
drop view if exists "bank_rates"."staging"."stg_cbr_precious_metals__dbt_backup" cascade
[0m16:56:25.676049 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.0 seconds
[0m16:56:25.677791 [debug] [Thread-1 (]: Timing info for model.bank_rates.stg_cbr_precious_metals (execute): 16:56:25.567083 => 16:56:25.677574
[0m16:56:25.678202 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: Close
[0m16:56:25.679220 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bf341033-d499-45b9-8d70-f7f9cdceee7e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x700c55733eb0>]}
[0m16:56:25.680144 [info ] [Thread-1 (]: 1 of 4 OK created sql view model staging.stg_cbr_precious_metals ............... [[32mCREATE VIEW[0m in 0.12s]
[0m16:56:25.681008 [debug] [Thread-1 (]: Finished running node model.bank_rates.stg_cbr_precious_metals
[0m16:56:25.682018 [debug] [Thread-2 (]: Began running node model.bank_rates.dim_metals
[0m16:56:25.682542 [debug] [Thread-1 (]: Began running node model.bank_rates.fact_metal_prices
[0m16:56:25.683173 [info ] [Thread-2 (]: 2 of 4 START sql table model dds.dim_metals .................................... [RUN]
[0m16:56:25.683874 [info ] [Thread-1 (]: 3 of 4 START sql table model dds.fact_metal_prices ............................. [RUN]
[0m16:56:25.684763 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_bank_rates_dds, now model.bank_rates.dim_metals)
[0m16:56:25.685482 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.bank_rates.stg_cbr_precious_metals, now model.bank_rates.fact_metal_prices)
[0m16:56:25.685971 [debug] [Thread-2 (]: Began compiling node model.bank_rates.dim_metals
[0m16:56:25.686444 [debug] [Thread-1 (]: Began compiling node model.bank_rates.fact_metal_prices
[0m16:56:25.690192 [debug] [Thread-2 (]: Writing injected SQL for node "model.bank_rates.dim_metals"
[0m16:56:25.695190 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_rates.fact_metal_prices"
[0m16:56:25.696124 [debug] [Thread-2 (]: Timing info for model.bank_rates.dim_metals (compile): 16:56:25.686734 => 16:56:25.695827
[0m16:56:25.696562 [debug] [Thread-2 (]: Began executing node model.bank_rates.dim_metals
[0m16:56:25.697097 [debug] [Thread-1 (]: Timing info for model.bank_rates.fact_metal_prices (compile): 16:56:25.690554 => 16:56:25.696795
[0m16:56:25.719028 [debug] [Thread-1 (]: Began executing node model.bank_rates.fact_metal_prices
[0m16:56:25.721564 [debug] [Thread-2 (]: Writing runtime sql for node "model.bank_rates.dim_metals"
[0m16:56:25.725897 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_rates.fact_metal_prices"
[0m16:56:25.726807 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m16:56:25.727312 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m16:56:25.727710 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: BEGIN
[0m16:56:25.728165 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: BEGIN
[0m16:56:25.728560 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m16:56:25.728952 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:56:25.738985 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m16:56:25.739460 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m16:56:25.739917 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m16:56:25.740375 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m16:56:25.740815 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */

  
    

  create  table "bank_rates"."dds"."fact_metal_prices__dbt_tmp"
  
  
    as
  
  (
    

SELECT 
    ROW_NUMBER() OVER (ORDER BY trade_date, metal_code) as price_id,
    trade_date,
    metal_code,
    metal_name,
    buy_price_rub,
    sell_price_rub,
    loaded_at,
    CURRENT_TIMESTAMP as dwh_loaded_at
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
WHERE trade_date IS NOT NULL
  AND metal_code IS NOT NULL
  );
  
[0m16:56:25.741280 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */

  
    

  create  table "bank_rates"."dds"."dim_metals__dbt_tmp"
  
  
    as
  
  (
    

SELECT DISTINCT
    metal_code,
    metal_name
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
WHERE metal_code IS NOT NULL
  );
  
[0m16:56:25.773355 [debug] [Thread-2 (]: SQL status: SELECT 4 in 0.0 seconds
[0m16:56:25.779279 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m16:56:25.780014 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
alter table "bank_rates"."dds"."dim_metals" rename to "dim_metals__dbt_backup"
[0m16:56:25.781195 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m16:56:25.786530 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m16:56:25.787143 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
alter table "bank_rates"."dds"."dim_metals__dbt_tmp" rename to "dim_metals"
[0m16:56:25.788101 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m16:56:25.797713 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: COMMIT
[0m16:56:25.798207 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m16:56:25.798614 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: COMMIT
[0m16:56:25.802381 [debug] [Thread-1 (]: SQL status: SELECT 16792 in 0.0 seconds
[0m16:56:25.805889 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m16:56:25.806323 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
alter table "bank_rates"."dds"."fact_metal_prices" rename to "fact_metal_prices__dbt_backup"
[0m16:56:25.807116 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m16:56:25.810695 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m16:56:25.811220 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m16:56:25.811698 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
alter table "bank_rates"."dds"."fact_metal_prices__dbt_tmp" rename to "fact_metal_prices"
[0m16:56:25.814351 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m16:56:25.814942 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
drop table if exists "bank_rates"."dds"."dim_metals__dbt_backup" cascade
[0m16:56:25.815352 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m16:56:25.817728 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: COMMIT
[0m16:56:25.818197 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m16:56:25.818601 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: COMMIT
[0m16:56:25.820427 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m16:56:25.822012 [debug] [Thread-2 (]: Timing info for model.bank_rates.dim_metals (execute): 16:56:25.697305 => 16:56:25.821803
[0m16:56:25.822465 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: Close
[0m16:56:25.822852 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m16:56:25.823711 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bf341033-d499-45b9-8d70-f7f9cdceee7e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x700c557787f0>]}
[0m16:56:25.827734 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m16:56:25.828527 [info ] [Thread-2 (]: 2 of 4 OK created sql table model dds.dim_metals ............................... [[32mSELECT 4[0m in 0.14s]
[0m16:56:25.829140 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
drop table if exists "bank_rates"."dds"."fact_metal_prices__dbt_backup" cascade
[0m16:56:25.829821 [debug] [Thread-2 (]: Finished running node model.bank_rates.dim_metals
[0m16:56:25.833649 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m16:56:25.835356 [debug] [Thread-1 (]: Timing info for model.bank_rates.fact_metal_prices (execute): 16:56:25.721919 => 16:56:25.835139
[0m16:56:25.835827 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: Close
[0m16:56:25.836610 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bf341033-d499-45b9-8d70-f7f9cdceee7e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x700c557ef220>]}
[0m16:56:25.837258 [info ] [Thread-1 (]: 3 of 4 OK created sql table model dds.fact_metal_prices ........................ [[32mSELECT 16792[0m in 0.15s]
[0m16:56:25.838009 [debug] [Thread-1 (]: Finished running node model.bank_rates.fact_metal_prices
[0m16:56:25.838929 [debug] [Thread-2 (]: Began running node model.bank_rates.metal_prices_analytics
[0m16:56:25.839455 [info ] [Thread-2 (]: 4 of 4 START sql table model mart.metal_prices_analytics ....................... [RUN]
[0m16:56:25.840260 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bank_rates.dim_metals, now model.bank_rates.metal_prices_analytics)
[0m16:56:25.840676 [debug] [Thread-2 (]: Began compiling node model.bank_rates.metal_prices_analytics
[0m16:56:25.844240 [debug] [Thread-2 (]: Writing injected SQL for node "model.bank_rates.metal_prices_analytics"
[0m16:56:25.844968 [debug] [Thread-2 (]: Timing info for model.bank_rates.metal_prices_analytics (compile): 16:56:25.840901 => 16:56:25.844719
[0m16:56:25.845362 [debug] [Thread-2 (]: Began executing node model.bank_rates.metal_prices_analytics
[0m16:56:25.849490 [debug] [Thread-2 (]: Writing runtime sql for node "model.bank_rates.metal_prices_analytics"
[0m16:56:25.850141 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m16:56:25.850535 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: BEGIN
[0m16:56:25.850900 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m16:56:25.859603 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m16:56:25.860042 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m16:56:25.860470 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */

  
    

  create  table "bank_rates"."mart"."metal_prices_analytics__dbt_tmp"
  
  
    as
  
  (
    

SELECT 
    f.trade_date,
    f.metal_name,
    f.buy_price_rub,
    f.sell_price_rub,
    ROUND((f.buy_price_rub + f.sell_price_rub) / 2, 2) as avg_price_rub,
    LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) as prev_buy_price,
    LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) as prev_sell_price,
    CASE 
        WHEN LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) IS NOT NULL 
        THEN ROUND((f.buy_price_rub - LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date)) / 
                   LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) * 100, 2)
        ELSE NULL 
    END as buy_price_change_percent,
    CASE 
        WHEN LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) IS NOT NULL 
        THEN ROUND((f.sell_price_rub - LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date)) / 
                   LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) * 100, 2)
        ELSE NULL 
    END as sell_price_change_percent
FROM "bank_rates"."dds"."fact_metal_prices" f
ORDER BY f.trade_date DESC, f.metal_name
  );
  
[0m16:56:25.948199 [debug] [Thread-2 (]: SQL status: SELECT 16792 in 0.0 seconds
[0m16:56:25.951814 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m16:56:25.952259 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
alter table "bank_rates"."mart"."metal_prices_analytics" rename to "metal_prices_analytics__dbt_backup"
[0m16:56:25.952985 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m16:56:25.955860 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m16:56:25.956255 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
alter table "bank_rates"."mart"."metal_prices_analytics__dbt_tmp" rename to "metal_prices_analytics"
[0m16:56:25.956966 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m16:56:25.958851 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: COMMIT
[0m16:56:25.959228 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m16:56:25.959523 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: COMMIT
[0m16:56:25.965928 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m16:56:25.968660 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m16:56:25.969038 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
drop table if exists "bank_rates"."mart"."metal_prices_analytics__dbt_backup" cascade
[0m16:56:25.981072 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m16:56:25.982693 [debug] [Thread-2 (]: Timing info for model.bank_rates.metal_prices_analytics (execute): 16:56:25.845585 => 16:56:25.982494
[0m16:56:25.983065 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: Close
[0m16:56:25.984016 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bf341033-d499-45b9-8d70-f7f9cdceee7e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x700c557ec9d0>]}
[0m16:56:25.984833 [info ] [Thread-2 (]: 4 of 4 OK created sql table model mart.metal_prices_analytics .................. [[32mSELECT 16792[0m in 0.14s]
[0m16:56:25.985642 [debug] [Thread-2 (]: Finished running node model.bank_rates.metal_prices_analytics
[0m16:56:25.987408 [debug] [MainThread]: Using postgres connection "master"
[0m16:56:25.987743 [debug] [MainThread]: On master: BEGIN
[0m16:56:25.988010 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:56:25.996503 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m16:56:25.996908 [debug] [MainThread]: On master: COMMIT
[0m16:56:25.997239 [debug] [MainThread]: Using postgres connection "master"
[0m16:56:25.997493 [debug] [MainThread]: On master: COMMIT
[0m16:56:25.997975 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m16:56:25.998409 [debug] [MainThread]: On master: Close
[0m16:56:25.999123 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:56:25.999461 [debug] [MainThread]: Connection 'model.bank_rates.fact_metal_prices' was properly closed.
[0m16:56:25.999757 [debug] [MainThread]: Connection 'model.bank_rates.metal_prices_analytics' was properly closed.
[0m16:56:26.000160 [info ] [MainThread]: 
[0m16:56:26.000607 [info ] [MainThread]: Finished running 1 view model, 3 table models in 0 hours 0 minutes and 0.58 seconds (0.58s).
[0m16:56:26.001922 [debug] [MainThread]: Command end result
[0m16:56:26.008274 [info ] [MainThread]: 
[0m16:56:26.008767 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:56:26.009198 [info ] [MainThread]: 
[0m16:56:26.009649 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m16:56:26.010269 [debug] [MainThread]: Command `dbt run` succeeded at 16:56:26.010141 after 0.83 seconds
[0m16:56:26.010627 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x700c581699c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x700c56afa320>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x700c55b33f10>]}
[0m16:56:26.010976 [debug] [MainThread]: Flushing usage events
[0m16:56:44.710393 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78dc8a4ad960>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78dc88ecba00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78dc88ecba90>]}


============================== 16:56:44.713386 | 24703279-d770-462a-9d08-7ab3f5d29ee4 ==============================
[0m16:56:44.713386 [info ] [MainThread]: Running with dbt=1.5.0
[0m16:56:44.713988 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'use_experimental_parser': 'False', 'log_path': '/usr/app/logs', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'log_format': 'default', 'fail_fast': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'static_parser': 'True', 'partial_parse': 'True', 'printer_width': '80', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '.', 'cache_selected_only': 'False', 'write_json': 'True', 'use_colors': 'True', 'version_check': 'True'}
[0m16:56:44.819288 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '24703279-d770-462a-9d08-7ab3f5d29ee4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78dc88ecbbe0>]}
[0m16:56:44.840257 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '24703279-d770-462a-9d08-7ab3f5d29ee4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78dc88deef50>]}
[0m16:56:44.853993 [debug] [MainThread]: checksum: 4568eb639a77b8fcb3a1f4a07856f42b1ff63f1376652889143968e1dbdafbda, vars: {}, profile: , target: , version: 1.5.0
[0m16:56:44.874726 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:56:44.875123 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:56:44.881125 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '24703279-d770-462a-9d08-7ab3f5d29ee4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78dc8816e680>]}
[0m16:56:44.886992 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '24703279-d770-462a-9d08-7ab3f5d29ee4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78dc8813f820>]}
[0m16:56:44.887457 [info ] [MainThread]: Found 4 models, 3 tests, 0 snapshots, 0 analyses, 308 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m16:56:44.887887 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '24703279-d770-462a-9d08-7ab3f5d29ee4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78dc8813f8b0>]}
[0m16:56:44.889461 [info ] [MainThread]: 
[0m16:56:44.890240 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m16:56:44.891616 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates_staging'
[0m16:56:44.892527 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates_dds'
[0m16:56:44.903861 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m16:56:44.905836 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m16:56:44.906285 [debug] [ThreadPool]: On list_bank_rates_staging: BEGIN
[0m16:56:44.906631 [debug] [ThreadPool]: On list_bank_rates_dds: BEGIN
[0m16:56:44.906981 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:56:44.907321 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:56:44.925227 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m16:56:44.925650 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m16:56:44.926078 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m16:56:44.926485 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m16:56:44.926921 [debug] [ThreadPool]: On list_bank_rates_staging: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_staging"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging'
  
[0m16:56:44.927320 [debug] [ThreadPool]: On list_bank_rates_dds: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_dds"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dds'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dds'
  
[0m16:56:44.930149 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m16:56:44.930565 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m16:56:44.931995 [debug] [ThreadPool]: On list_bank_rates_dds: ROLLBACK
[0m16:56:44.933432 [debug] [ThreadPool]: On list_bank_rates_staging: ROLLBACK
[0m16:56:44.933932 [debug] [ThreadPool]: On list_bank_rates_dds: Close
[0m16:56:44.934238 [debug] [ThreadPool]: On list_bank_rates_staging: Close
[0m16:56:44.935645 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates_dds, now list_bank_rates_mart)
[0m16:56:44.938795 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m16:56:44.939714 [debug] [ThreadPool]: On list_bank_rates_mart: BEGIN
[0m16:56:44.939987 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:56:44.948715 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m16:56:44.949108 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m16:56:44.949443 [debug] [ThreadPool]: On list_bank_rates_mart: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_mart"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'mart'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'mart'
  
[0m16:56:44.952141 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m16:56:44.953498 [debug] [ThreadPool]: On list_bank_rates_mart: ROLLBACK
[0m16:56:44.953949 [debug] [ThreadPool]: On list_bank_rates_mart: Close
[0m16:56:44.959247 [debug] [MainThread]: Using postgres connection "master"
[0m16:56:44.959584 [debug] [MainThread]: On master: BEGIN
[0m16:56:44.959848 [debug] [MainThread]: Opening a new connection, currently in state init
[0m16:56:44.967105 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m16:56:44.967448 [debug] [MainThread]: Using postgres connection "master"
[0m16:56:44.967846 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m16:56:44.974105 [debug] [MainThread]: SQL status: SELECT 3 in 0.0 seconds
[0m16:56:44.975479 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '24703279-d770-462a-9d08-7ab3f5d29ee4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78dc8813c640>]}
[0m16:56:44.976007 [debug] [MainThread]: On master: ROLLBACK
[0m16:56:44.976469 [debug] [MainThread]: Using postgres connection "master"
[0m16:56:44.976786 [debug] [MainThread]: On master: BEGIN
[0m16:56:44.977292 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m16:56:44.977638 [debug] [MainThread]: On master: COMMIT
[0m16:56:44.977939 [debug] [MainThread]: Using postgres connection "master"
[0m16:56:44.978256 [debug] [MainThread]: On master: COMMIT
[0m16:56:44.978638 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m16:56:44.978943 [debug] [MainThread]: On master: Close
[0m16:56:44.979661 [info ] [MainThread]: Concurrency: 2 threads (target='dev')
[0m16:56:44.980074 [info ] [MainThread]: 
[0m16:56:44.984332 [debug] [Thread-1 (]: Began running node test.bank_rates.not_null_key_columns
[0m16:56:44.984739 [debug] [Thread-2 (]: Began running node test.bank_rates.positive_prices
[0m16:56:44.985227 [info ] [Thread-1 (]: 1 of 3 START test not_null_key_columns ......................................... [RUN]
[0m16:56:44.985811 [info ] [Thread-2 (]: 2 of 3 START test positive_prices .............................................. [RUN]
[0m16:56:44.986617 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_bank_rates_mart, now test.bank_rates.not_null_key_columns)
[0m16:56:44.987274 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_bank_rates_staging, now test.bank_rates.positive_prices)
[0m16:56:44.987702 [debug] [Thread-1 (]: Began compiling node test.bank_rates.not_null_key_columns
[0m16:56:44.988111 [debug] [Thread-2 (]: Began compiling node test.bank_rates.positive_prices
[0m16:56:44.991334 [debug] [Thread-1 (]: Writing injected SQL for node "test.bank_rates.not_null_key_columns"
[0m16:56:44.994297 [debug] [Thread-2 (]: Writing injected SQL for node "test.bank_rates.positive_prices"
[0m16:56:44.995194 [debug] [Thread-2 (]: Timing info for test.bank_rates.positive_prices (compile): 16:56:44.991707 => 16:56:44.994920
[0m16:56:44.995729 [debug] [Thread-1 (]: Timing info for test.bank_rates.not_null_key_columns (compile): 16:56:44.988372 => 16:56:44.995426
[0m16:56:44.996106 [debug] [Thread-2 (]: Began executing node test.bank_rates.positive_prices
[0m16:56:44.996539 [debug] [Thread-1 (]: Began executing node test.bank_rates.not_null_key_columns
[0m16:56:45.016754 [debug] [Thread-1 (]: Writing runtime sql for node "test.bank_rates.not_null_key_columns"
[0m16:56:45.017918 [debug] [Thread-2 (]: Writing runtime sql for node "test.bank_rates.positive_prices"
[0m16:56:45.018857 [debug] [Thread-1 (]: Using postgres connection "test.bank_rates.not_null_key_columns"
[0m16:56:45.019362 [debug] [Thread-2 (]: Using postgres connection "test.bank_rates.positive_prices"
[0m16:56:45.019742 [debug] [Thread-1 (]: On test.bank_rates.not_null_key_columns: BEGIN
[0m16:56:45.020194 [debug] [Thread-2 (]: On test.bank_rates.positive_prices: BEGIN
[0m16:56:45.020630 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:56:45.021032 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m16:56:45.033640 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m16:56:45.034121 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m16:56:45.034569 [debug] [Thread-1 (]: Using postgres connection "test.bank_rates.not_null_key_columns"
[0m16:56:45.034962 [debug] [Thread-2 (]: Using postgres connection "test.bank_rates.positive_prices"
[0m16:56:45.035378 [debug] [Thread-1 (]: On test.bank_rates.not_null_key_columns: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "test.bank_rates.not_null_key_columns"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      SELECT 
    trade_date,
    metal_code
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
WHERE trade_date IS NULL 
   OR metal_code IS NULL 
   OR buy_price_rub IS NULL 
   OR sell_price_rub IS NULL
      
    ) dbt_internal_test
[0m16:56:45.035802 [debug] [Thread-2 (]: On test.bank_rates.positive_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "test.bank_rates.positive_prices"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      SELECT 
    trade_date,
    metal_code,
    buy_price_rub,
    sell_price_rub
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
WHERE buy_price_rub <= 0 OR sell_price_rub <= 0
      
    ) dbt_internal_test
[0m16:56:45.051938 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m16:56:45.054667 [debug] [Thread-1 (]: Timing info for test.bank_rates.not_null_key_columns (execute): 16:56:45.012215 => 16:56:45.054404
[0m16:56:45.055075 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m16:56:45.055583 [debug] [Thread-1 (]: On test.bank_rates.not_null_key_columns: ROLLBACK
[0m16:56:45.057243 [debug] [Thread-2 (]: Timing info for test.bank_rates.positive_prices (execute): 16:56:44.996799 => 16:56:45.056975
[0m16:56:45.057777 [debug] [Thread-2 (]: On test.bank_rates.positive_prices: ROLLBACK
[0m16:56:45.058162 [debug] [Thread-1 (]: On test.bank_rates.not_null_key_columns: Close
[0m16:56:45.059137 [info ] [Thread-1 (]: 1 of 3 PASS not_null_key_columns ............................................... [[32mPASS[0m in 0.07s]
[0m16:56:45.059674 [debug] [Thread-2 (]: On test.bank_rates.positive_prices: Close
[0m16:56:45.060425 [debug] [Thread-1 (]: Finished running node test.bank_rates.not_null_key_columns
[0m16:56:45.061036 [debug] [Thread-1 (]: Began running node test.bank_rates.unique_trade_date_metal_code
[0m16:56:45.061852 [info ] [Thread-2 (]: 2 of 3 PASS positive_prices .................................................... [[32mPASS[0m in 0.07s]
[0m16:56:45.062620 [info ] [Thread-1 (]: 3 of 3 START test unique_trade_date_metal_code ................................. [RUN]
[0m16:56:45.063495 [debug] [Thread-2 (]: Finished running node test.bank_rates.positive_prices
[0m16:56:45.064222 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.bank_rates.not_null_key_columns, now test.bank_rates.unique_trade_date_metal_code)
[0m16:56:45.064911 [debug] [Thread-1 (]: Began compiling node test.bank_rates.unique_trade_date_metal_code
[0m16:56:45.068203 [debug] [Thread-1 (]: Writing injected SQL for node "test.bank_rates.unique_trade_date_metal_code"
[0m16:56:45.068860 [debug] [Thread-1 (]: Timing info for test.bank_rates.unique_trade_date_metal_code (compile): 16:56:45.065188 => 16:56:45.068640
[0m16:56:45.069220 [debug] [Thread-1 (]: Began executing node test.bank_rates.unique_trade_date_metal_code
[0m16:56:45.071577 [debug] [Thread-1 (]: Writing runtime sql for node "test.bank_rates.unique_trade_date_metal_code"
[0m16:56:45.072264 [debug] [Thread-1 (]: Using postgres connection "test.bank_rates.unique_trade_date_metal_code"
[0m16:56:45.072638 [debug] [Thread-1 (]: On test.bank_rates.unique_trade_date_metal_code: BEGIN
[0m16:56:45.073019 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:56:45.081904 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m16:56:45.082394 [debug] [Thread-1 (]: Using postgres connection "test.bank_rates.unique_trade_date_metal_code"
[0m16:56:45.082818 [debug] [Thread-1 (]: On test.bank_rates.unique_trade_date_metal_code: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "test.bank_rates.unique_trade_date_metal_code"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      SELECT 
    trade_date,
    metal_code,
    COUNT(*) as count
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
GROUP BY trade_date, metal_code
HAVING COUNT(*) > 1
      
    ) dbt_internal_test
[0m16:56:45.106284 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m16:56:45.109352 [debug] [Thread-1 (]: Timing info for test.bank_rates.unique_trade_date_metal_code (execute): 16:56:45.069444 => 16:56:45.108901
[0m16:56:45.109983 [debug] [Thread-1 (]: On test.bank_rates.unique_trade_date_metal_code: ROLLBACK
[0m16:56:45.110772 [debug] [Thread-1 (]: On test.bank_rates.unique_trade_date_metal_code: Close
[0m16:56:45.112157 [info ] [Thread-1 (]: 3 of 3 PASS unique_trade_date_metal_code ....................................... [[32mPASS[0m in 0.05s]
[0m16:56:45.113436 [debug] [Thread-1 (]: Finished running node test.bank_rates.unique_trade_date_metal_code
[0m16:56:45.115329 [debug] [MainThread]: Using postgres connection "master"
[0m16:56:45.115677 [debug] [MainThread]: On master: BEGIN
[0m16:56:45.115935 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m16:56:45.124809 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m16:56:45.125251 [debug] [MainThread]: On master: COMMIT
[0m16:56:45.125593 [debug] [MainThread]: Using postgres connection "master"
[0m16:56:45.125910 [debug] [MainThread]: On master: COMMIT
[0m16:56:45.126363 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m16:56:45.126701 [debug] [MainThread]: On master: Close
[0m16:56:45.127397 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:56:45.127714 [debug] [MainThread]: Connection 'test.bank_rates.positive_prices' was properly closed.
[0m16:56:45.127992 [debug] [MainThread]: Connection 'test.bank_rates.unique_trade_date_metal_code' was properly closed.
[0m16:56:45.128442 [info ] [MainThread]: 
[0m16:56:45.128894 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 0.24 seconds (0.24s).
[0m16:56:45.130202 [debug] [MainThread]: Command end result
[0m16:56:45.136405 [info ] [MainThread]: 
[0m16:56:45.136908 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:56:45.137415 [info ] [MainThread]: 
[0m16:56:45.137891 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m16:56:45.138527 [debug] [MainThread]: Command `dbt test` succeeded at 16:56:45.138399 after 0.44 seconds
[0m16:56:45.138876 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78dc8a4ad960>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78dc88deef50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78dc8813f910>]}
[0m16:56:45.139265 [debug] [MainThread]: Flushing usage events
[0m08:02:56.657232 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ab05265000>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ab03cac940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ab03cae860>]}


============================== 08:02:56.663178 | 3bf997ee-d7c9-4566-868f-0e0a30248b47 ==============================
[0m08:02:56.663178 [info ] [MainThread]: Running with dbt=1.5.0
[0m08:02:56.663799 [debug] [MainThread]: running dbt with arguments {'send_anonymous_usage_stats': 'True', 'version_check': 'True', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'partial_parse': 'True', 'cache_selected_only': 'False', 'quiet': 'False', 'log_cache_events': 'False', 'log_path': '/usr/app/logs', 'profiles_dir': '/usr/app', 'use_colors': 'True', 'fail_fast': 'False', 'log_format': 'default', 'warn_error': 'None', 'use_experimental_parser': 'False', 'no_print': 'None', 'debug': 'False', 'introspect': 'True', 'indirect_selection': 'eager', 'target_path': 'None', 'printer_width': '80', 'static_parser': 'True'}
[0m08:02:56.664224 [info ] [MainThread]: dbt version: 1.5.0
[0m08:02:56.664557 [info ] [MainThread]: python version: 3.10.19
[0m08:02:56.664911 [info ] [MainThread]: python path: /usr/local/bin/python3.10
[0m08:02:56.665293 [info ] [MainThread]: os info: Linux-6.8.0-90-generic-x86_64-with-glibc2.41
[0m08:02:56.665682 [info ] [MainThread]: Using profiles.yml file at /usr/app/profiles.yml
[0m08:02:56.666117 [info ] [MainThread]: Using dbt_project.yml file at /usr/app/dbt_project.yml
[0m08:02:56.666525 [info ] [MainThread]: Configuration:
[0m08:02:56.718746 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m08:02:56.787421 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m08:02:56.788035 [info ] [MainThread]: Required dependencies:
[0m08:02:56.788565 [debug] [MainThread]: Executing "git --help"
[0m08:02:56.790681 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--no-lazy-fetch]\n           [--no-optional-locks] [--no-advice] [--bare] [--git-dir=<path>]\n           [--work-tree=<path>] [--namespace=<name>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m08:02:56.791145 [debug] [MainThread]: STDERR: "b''"
[0m08:02:56.791417 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m08:02:56.791731 [info ] [MainThread]: Connection:
[0m08:02:56.792190 [info ] [MainThread]:   host: postgres
[0m08:02:56.792559 [info ] [MainThread]:   port: 5432
[0m08:02:56.792980 [info ] [MainThread]:   user: admin
[0m08:02:56.793383 [info ] [MainThread]:   database: bank_rates
[0m08:02:56.793749 [info ] [MainThread]:   schema: public
[0m08:02:56.794188 [info ] [MainThread]:   search_path: None
[0m08:02:56.794568 [info ] [MainThread]:   keepalives_idle: 0
[0m08:02:56.794931 [info ] [MainThread]:   sslmode: None
[0m08:02:56.795693 [debug] [MainThread]: Acquiring new postgres connection 'debug'
[0m08:02:56.796039 [debug] [MainThread]: Using postgres connection "debug"
[0m08:02:56.796377 [debug] [MainThread]: On debug: select 1 as id
[0m08:02:56.796739 [debug] [MainThread]: Opening a new connection, currently in state init
[0m08:02:56.807835 [debug] [MainThread]: SQL status: SELECT 1 in 0.0 seconds
[0m08:02:56.808994 [debug] [MainThread]: On debug: Close
[0m08:02:56.809428 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m08:02:56.809807 [info ] [MainThread]: [32mAll checks passed![0m
[0m08:02:56.810480 [debug] [MainThread]: Command `dbt debug` succeeded at 08:02:56.810339 after 0.16 seconds
[0m08:02:56.810806 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m08:02:56.811178 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ab05265000>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ab03b93940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78ab03bcff40>]}
[0m08:02:56.811603 [debug] [MainThread]: Flushing usage events
[0m08:07:19.439572 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71bdea8d1090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71bde92cbb80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71bde92cb9d0>]}


============================== 08:07:19.442481 | 8effa343-3d89-4249-be54-66304df6cce6 ==============================
[0m08:07:19.442481 [info ] [MainThread]: Running with dbt=1.5.0
[0m08:07:19.443011 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'version_check': 'True', 'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'profiles_dir': '/usr/app', 'target_path': 'None', 'partial_parse': 'True', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'no_print': 'None', 'write_json': 'True', 'introspect': 'True', 'debug': 'False', 'indirect_selection': 'eager', 'warn_error': 'None', 'static_parser': 'True', 'use_colors': 'True', 'log_cache_events': 'False', 'quiet': 'False', 'printer_width': '80', 'log_path': '/usr/app/logs'}
[0m08:07:19.548742 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8effa343-3d89-4249-be54-66304df6cce6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71bde92cbb50>]}
[0m08:07:19.568420 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8effa343-3d89-4249-be54-66304df6cce6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71bde91f7490>]}
[0m08:07:19.579868 [debug] [MainThread]: checksum: 4568eb639a77b8fcb3a1f4a07856f42b1ff63f1376652889143968e1dbdafbda, vars: {}, profile: , target: , version: 1.5.0
[0m08:07:19.588277 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m08:07:19.588806 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '8effa343-3d89-4249-be54-66304df6cce6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71bde91f7a60>]}
[0m08:07:20.192046 [debug] [MainThread]: 1699: static parser successfully parsed mart/metal_prices_analytics.sql
[0m08:07:20.205468 [debug] [MainThread]: 1699: static parser successfully parsed dds/dim_metals.sql
[0m08:07:20.209543 [debug] [MainThread]: 1699: static parser successfully parsed dds/fact_metal_prices.sql
[0m08:07:20.213048 [debug] [MainThread]: 1699: static parser successfully parsed staging/stg_cbr_precious_metals.sql
[0m08:07:20.294297 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8effa343-3d89-4249-be54-66304df6cce6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71bde85bf190>]}
[0m08:07:20.301229 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8effa343-3d89-4249-be54-66304df6cce6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71bde8518f70>]}
[0m08:07:20.302002 [info ] [MainThread]: Found 4 models, 3 tests, 0 snapshots, 0 analyses, 308 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m08:07:20.302674 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8effa343-3d89-4249-be54-66304df6cce6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71bde91ed300>]}
[0m08:07:20.303381 [warn ] [MainThread]: The selection criterion 'staging_cbr_metals' does not match any nodes
[0m08:07:20.304355 [info ] [MainThread]: 
[0m08:07:20.304736 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m08:07:20.305295 [debug] [MainThread]: Command end result
[0m08:07:20.310448 [debug] [MainThread]: Command `dbt run` succeeded at 08:07:20.310286 after 0.88 seconds
[0m08:07:20.310830 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71bdea8d1090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71bdeaefe9b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71bde8101d50>]}
[0m08:07:20.311226 [debug] [MainThread]: Flushing usage events
[0m08:09:37.709597 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b2c34b56d70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b2c335cfaf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b2c335cf2e0>]}


============================== 08:09:37.712852 | 1e2f4fd5-1c20-4fbf-b019-744287294109 ==============================
[0m08:09:37.712852 [info ] [MainThread]: Running with dbt=1.5.0
[0m08:09:37.713514 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'static_parser': 'True', 'target_path': 'None', 'version_check': 'True', 'fail_fast': 'False', 'profiles_dir': '/usr/app', 'log_format': 'default', 'no_print': 'None', 'log_cache_events': 'False', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'log_path': '/usr/app/logs', 'introspect': 'True', 'debug': 'False', 'cache_selected_only': 'False', 'quiet': 'False', 'partial_parse': 'True', 'printer_width': '80', 'indirect_selection': 'eager', 'use_experimental_parser': 'False'}
[0m08:09:37.827153 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1e2f4fd5-1c20-4fbf-b019-744287294109', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b2c335cfbe0>]}
[0m08:09:37.847583 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1e2f4fd5-1c20-4fbf-b019-744287294109', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b2c334f53c0>]}
[0m08:09:37.859434 [debug] [MainThread]: checksum: 4568eb639a77b8fcb3a1f4a07856f42b1ff63f1376652889143968e1dbdafbda, vars: {}, profile: , target: , version: 1.5.0
[0m08:09:37.880684 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:09:37.881079 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:09:37.887224 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1e2f4fd5-1c20-4fbf-b019-744287294109', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b2c32572710>]}
[0m08:09:37.893666 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1e2f4fd5-1c20-4fbf-b019-744287294109', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b2c351cb8b0>]}
[0m08:09:37.894133 [info ] [MainThread]: Found 4 models, 3 tests, 0 snapshots, 0 analyses, 308 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m08:09:37.894559 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1e2f4fd5-1c20-4fbf-b019-744287294109', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b2c351cb940>]}
[0m08:09:37.895775 [debug] [MainThread]: Command `dbt ls` succeeded at 08:09:37.895639 after 0.20 seconds
[0m08:09:37.896198 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b2c34b56d70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b2c351cb8b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b2c351cb790>]}
[0m08:09:37.896581 [debug] [MainThread]: Flushing usage events
[0m10:03:32.287667 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71bef28c90c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71bef12cbbb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71bef12cba00>]}


============================== 10:03:32.290949 | a140abc6-d135-404c-ac02-8a2238e78124 ==============================
[0m10:03:32.290949 [info ] [MainThread]: Running with dbt=1.5.0
[0m10:03:32.291585 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'indirect_selection': 'eager', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'target_path': 'None', 'cache_selected_only': 'False', 'profiles_dir': '/usr/app', 'log_format': 'default', 'warn_error': 'None', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'printer_width': '80', 'log_path': '/usr/app/logs', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'version_check': 'True', 'introspect': 'True', 'static_parser': 'True', 'quiet': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'write_json': 'True'}
[0m10:03:32.401902 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a140abc6-d135-404c-ac02-8a2238e78124', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71bef12cbb80>]}
[0m10:03:32.423066 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a140abc6-d135-404c-ac02-8a2238e78124', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71bef11f26e0>]}
[0m10:03:32.434851 [debug] [MainThread]: checksum: 4568eb639a77b8fcb3a1f4a07856f42b1ff63f1376652889143968e1dbdafbda, vars: {}, profile: , target: , version: 1.5.0
[0m10:03:32.456975 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:03:32.457434 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:03:32.463591 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a140abc6-d135-404c-ac02-8a2238e78124', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71bef056e680>]}
[0m10:03:32.470175 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a140abc6-d135-404c-ac02-8a2238e78124', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71bef0543820>]}
[0m10:03:32.470677 [info ] [MainThread]: Found 4 models, 3 tests, 0 snapshots, 0 analyses, 308 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m10:03:32.471098 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a140abc6-d135-404c-ac02-8a2238e78124', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71bef05438b0>]}
[0m10:03:32.472413 [info ] [MainThread]: 
[0m10:03:32.473262 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m10:03:32.474506 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m10:03:32.486592 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m10:03:32.487069 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m10:03:32.487456 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:03:32.498700 [debug] [ThreadPool]: SQL status: SELECT 15 in 0.0 seconds
[0m10:03:32.500242 [debug] [ThreadPool]: On list_bank_rates: Close
[0m10:03:32.502017 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates, now list_bank_rates_mart)
[0m10:03:32.508191 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates_dds'
[0m10:03:32.512912 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m10:03:32.514151 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m10:03:32.514673 [debug] [ThreadPool]: On list_bank_rates_dds: BEGIN
[0m10:03:32.515036 [debug] [ThreadPool]: On list_bank_rates_mart: BEGIN
[0m10:03:32.515434 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:03:32.515767 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:03:32.525499 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m10:03:32.525847 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m10:03:32.526209 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m10:03:32.526555 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m10:03:32.526926 [debug] [ThreadPool]: On list_bank_rates_dds: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_dds"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dds'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dds'
  
[0m10:03:32.527339 [debug] [ThreadPool]: On list_bank_rates_mart: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_mart"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'mart'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'mart'
  
[0m10:03:32.531249 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m10:03:32.531619 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m10:03:32.532994 [debug] [ThreadPool]: On list_bank_rates_dds: ROLLBACK
[0m10:03:32.534355 [debug] [ThreadPool]: On list_bank_rates_mart: ROLLBACK
[0m10:03:32.534895 [debug] [ThreadPool]: On list_bank_rates_dds: Close
[0m10:03:32.535195 [debug] [ThreadPool]: On list_bank_rates_mart: Close
[0m10:03:32.536337 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates_dds, now list_bank_rates_staging)
[0m10:03:32.539676 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m10:03:32.540027 [debug] [ThreadPool]: On list_bank_rates_staging: BEGIN
[0m10:03:32.540345 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:03:32.548195 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m10:03:32.548535 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m10:03:32.548808 [debug] [ThreadPool]: On list_bank_rates_staging: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_staging"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging'
  
[0m10:03:32.551432 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m10:03:32.552744 [debug] [ThreadPool]: On list_bank_rates_staging: ROLLBACK
[0m10:03:32.553204 [debug] [ThreadPool]: On list_bank_rates_staging: Close
[0m10:03:32.559391 [debug] [MainThread]: Using postgres connection "master"
[0m10:03:32.559766 [debug] [MainThread]: On master: BEGIN
[0m10:03:32.560062 [debug] [MainThread]: Opening a new connection, currently in state init
[0m10:03:32.567988 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m10:03:32.568389 [debug] [MainThread]: Using postgres connection "master"
[0m10:03:32.568817 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m10:03:32.588504 [debug] [MainThread]: SQL status: SELECT 3 in 0.0 seconds
[0m10:03:32.590272 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a140abc6-d135-404c-ac02-8a2238e78124', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71bef0562560>]}
[0m10:03:32.590831 [debug] [MainThread]: On master: ROLLBACK
[0m10:03:32.591325 [debug] [MainThread]: Using postgres connection "master"
[0m10:03:32.591650 [debug] [MainThread]: On master: BEGIN
[0m10:03:32.592191 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m10:03:32.592531 [debug] [MainThread]: On master: COMMIT
[0m10:03:32.592827 [debug] [MainThread]: Using postgres connection "master"
[0m10:03:32.593128 [debug] [MainThread]: On master: COMMIT
[0m10:03:32.593544 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m10:03:32.593857 [debug] [MainThread]: On master: Close
[0m10:03:32.594575 [info ] [MainThread]: Concurrency: 2 threads (target='dev')
[0m10:03:32.594984 [info ] [MainThread]: 
[0m10:03:32.598503 [debug] [Thread-1 (]: Began running node model.bank_rates.stg_cbr_precious_metals
[0m10:03:32.599090 [info ] [Thread-1 (]: 1 of 1 START sql view model staging.stg_cbr_precious_metals .................... [RUN]
[0m10:03:32.599890 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_bank_rates_staging, now model.bank_rates.stg_cbr_precious_metals)
[0m10:03:32.600308 [debug] [Thread-1 (]: Began compiling node model.bank_rates.stg_cbr_precious_metals
[0m10:03:32.603663 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_rates.stg_cbr_precious_metals"
[0m10:03:32.604400 [debug] [Thread-1 (]: Timing info for model.bank_rates.stg_cbr_precious_metals (compile): 10:03:32.600523 => 10:03:32.604149
[0m10:03:32.604769 [debug] [Thread-1 (]: Began executing node model.bank_rates.stg_cbr_precious_metals
[0m10:03:32.644397 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_rates.stg_cbr_precious_metals"
[0m10:03:32.645274 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m10:03:32.645735 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: BEGIN
[0m10:03:32.646133 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:03:32.655161 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m10:03:32.655600 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m10:03:32.656040 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */

  create view "bank_rates"."staging"."stg_cbr_precious_metals__dbt_tmp"
    
    
  as (
    

WITH ranked_data AS (
    SELECT 
        id,
        record_date::DATE as trade_date,
        metal_code::INTEGER as metal_code,
        buy_price::DECIMAL(10,2) as buy_price_rub,
        sell_price::DECIMAL(10,2) as sell_price_rub,
        from_date::DATE as valid_from,
        to_date::DATE as valid_to,
        load_timestamp::TIMESTAMP as loaded_at,
        -- Ð’Ñ‹Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÑŽÑŽ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÑƒ Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð´Ð½Ñ Ð¸ Ð¼ÐµÑ‚Ð°Ð»Ð»Ð°
        ROW_NUMBER() OVER (
            PARTITION BY record_date, metal_code 
            ORDER BY load_timestamp DESC
        ) as rn
    FROM raw.cbr_precious_metals
    WHERE record_date IS NOT NULL
      AND metal_code IS NOT NULL
      AND buy_price IS NOT NULL
)
SELECT 
    trade_date,
    metal_code,
    CASE 
        WHEN metal_code = 1 THEN 'Ð—Ð¾Ð»Ð¾Ñ‚Ð¾'
        WHEN metal_code = 2 THEN 'Ð¡ÐµÑ€ÐµÐ±Ñ€Ð¾'
        WHEN metal_code = 3 THEN 'ÐŸÐ»Ð°Ñ‚Ð¸Ð½Ð°'
        WHEN metal_code = 4 THEN 'ÐŸÐ°Ð»Ð»Ð°Ð´Ð¸Ð¹'
        ELSE 'ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ð¹ Ð¼ÐµÑ‚Ð°Ð»Ð»'
    END as metal_name,
    buy_price_rub,
    sell_price_rub,
    valid_from,
    valid_to,
    loaded_at
FROM ranked_data
WHERE rn = 1
  );
[0m10:03:32.687345 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.0 seconds
[0m10:03:32.695148 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m10:03:32.695732 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
alter table "bank_rates"."staging"."stg_cbr_precious_metals" rename to "stg_cbr_precious_metals__dbt_backup"
[0m10:03:32.700704 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m10:03:32.704067 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m10:03:32.704556 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
alter table "bank_rates"."staging"."stg_cbr_precious_metals__dbt_tmp" rename to "stg_cbr_precious_metals"
[0m10:03:32.705577 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m10:03:32.727203 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: COMMIT
[0m10:03:32.727712 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m10:03:32.728145 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: COMMIT
[0m10:03:32.732856 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m10:03:32.738472 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m10:03:32.738956 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
drop view if exists "bank_rates"."staging"."stg_cbr_precious_metals__dbt_backup" cascade
[0m10:03:32.749011 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.0 seconds
[0m10:03:32.750831 [debug] [Thread-1 (]: Timing info for model.bank_rates.stg_cbr_precious_metals (execute): 10:03:32.604979 => 10:03:32.750604
[0m10:03:32.751361 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: Close
[0m10:03:32.752241 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a140abc6-d135-404c-ac02-8a2238e78124', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71bef01179d0>]}
[0m10:03:32.752963 [info ] [Thread-1 (]: 1 of 1 OK created sql view model staging.stg_cbr_precious_metals ............... [[32mCREATE VIEW[0m in 0.15s]
[0m10:03:32.753797 [debug] [Thread-1 (]: Finished running node model.bank_rates.stg_cbr_precious_metals
[0m10:03:32.755419 [debug] [MainThread]: Using postgres connection "master"
[0m10:03:32.755791 [debug] [MainThread]: On master: BEGIN
[0m10:03:32.756127 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m10:03:32.764828 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m10:03:32.765204 [debug] [MainThread]: On master: COMMIT
[0m10:03:32.765510 [debug] [MainThread]: Using postgres connection "master"
[0m10:03:32.765795 [debug] [MainThread]: On master: COMMIT
[0m10:03:32.766235 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m10:03:32.766540 [debug] [MainThread]: On master: Close
[0m10:03:32.767327 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:03:32.767749 [debug] [MainThread]: Connection 'list_bank_rates_mart' was properly closed.
[0m10:03:32.768110 [debug] [MainThread]: Connection 'model.bank_rates.stg_cbr_precious_metals' was properly closed.
[0m10:03:32.768529 [info ] [MainThread]: 
[0m10:03:32.769010 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.30 seconds (0.30s).
[0m10:03:32.769891 [debug] [MainThread]: Command end result
[0m10:03:32.777191 [info ] [MainThread]: 
[0m10:03:32.777685 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:03:32.778107 [info ] [MainThread]: 
[0m10:03:32.778512 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m10:03:32.779105 [debug] [MainThread]: Command `dbt run` succeeded at 10:03:32.778949 after 0.50 seconds
[0m10:03:32.779482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71bef28c90c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71bef0132560>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71bef0132170>]}
[0m10:03:32.779879 [debug] [MainThread]: Flushing usage events
[0m10:05:01.053726 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ce6c481090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ce6aecb970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ce6aecba00>]}


============================== 10:05:01.057020 | a66e5de7-7e17-4c8b-9990-2b705ddc5005 ==============================
[0m10:05:01.057020 [info ] [MainThread]: Running with dbt=1.5.0
[0m10:05:01.057673 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'log_cache_events': 'False', 'partial_parse': 'True', 'indirect_selection': 'eager', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'profiles_dir': '/usr/app', 'log_path': '/usr/app/logs', 'introspect': 'True', 'cache_selected_only': 'False', 'debug': 'False', 'no_print': 'None', 'fail_fast': 'False', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'write_json': 'True', 'quiet': 'False'}
[0m10:05:01.174248 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a66e5de7-7e17-4c8b-9990-2b705ddc5005', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ce6aecbb50>]}
[0m10:05:01.196472 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a66e5de7-7e17-4c8b-9990-2b705ddc5005', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ce6adf3430>]}
[0m10:05:01.208943 [debug] [MainThread]: checksum: 4568eb639a77b8fcb3a1f4a07856f42b1ff63f1376652889143968e1dbdafbda, vars: {}, profile: , target: , version: 1.5.0
[0m10:05:01.233968 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:05:01.234649 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:05:01.245334 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a66e5de7-7e17-4c8b-9990-2b705ddc5005', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ce6a16e5f0>]}
[0m10:05:01.254218 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a66e5de7-7e17-4c8b-9990-2b705ddc5005', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ce6a13f790>]}
[0m10:05:01.254770 [info ] [MainThread]: Found 4 models, 3 tests, 0 snapshots, 0 analyses, 308 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m10:05:01.255215 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a66e5de7-7e17-4c8b-9990-2b705ddc5005', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ce6a13f820>]}
[0m10:05:01.256825 [info ] [MainThread]: 
[0m10:05:01.257710 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m10:05:01.259336 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m10:05:01.260238 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m10:05:01.273644 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m10:05:01.275950 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m10:05:01.276441 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m10:05:01.276811 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m10:05:01.277157 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:05:01.277472 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:05:01.294478 [debug] [ThreadPool]: SQL status: SELECT 15 in 0.0 seconds
[0m10:05:01.295035 [debug] [ThreadPool]: SQL status: SELECT 15 in 0.0 seconds
[0m10:05:01.296613 [debug] [ThreadPool]: On list_bank_rates: Close
[0m10:05:01.298047 [debug] [ThreadPool]: On list_bank_rates: Close
[0m10:05:01.302051 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m10:05:01.302558 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m10:05:01.303372 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:05:01.312737 [debug] [ThreadPool]: SQL status: SELECT 15 in 0.0 seconds
[0m10:05:01.314457 [debug] [ThreadPool]: On list_bank_rates: Close
[0m10:05:01.316552 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates, now list_bank_rates_dds)
[0m10:05:01.322797 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates, now list_bank_rates_staging)
[0m10:05:01.324294 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m10:05:01.327725 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m10:05:01.328293 [debug] [ThreadPool]: On list_bank_rates_dds: BEGIN
[0m10:05:01.328655 [debug] [ThreadPool]: On list_bank_rates_staging: BEGIN
[0m10:05:01.328973 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:05:01.329362 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:05:01.340010 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m10:05:01.340576 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m10:05:01.341046 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m10:05:01.341580 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m10:05:01.342133 [debug] [ThreadPool]: On list_bank_rates_staging: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_staging"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging'
  
[0m10:05:01.342627 [debug] [ThreadPool]: On list_bank_rates_dds: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_dds"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dds'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dds'
  
[0m10:05:01.345937 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m10:05:01.346397 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.0 seconds
[0m10:05:01.347876 [debug] [ThreadPool]: On list_bank_rates_dds: ROLLBACK
[0m10:05:01.349311 [debug] [ThreadPool]: On list_bank_rates_staging: ROLLBACK
[0m10:05:01.349850 [debug] [ThreadPool]: On list_bank_rates_dds: Close
[0m10:05:01.350155 [debug] [ThreadPool]: On list_bank_rates_staging: Close
[0m10:05:01.351576 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates_dds, now list_bank_rates_mart)
[0m10:05:01.355486 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m10:05:01.355860 [debug] [ThreadPool]: On list_bank_rates_mart: BEGIN
[0m10:05:01.356121 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:05:01.364099 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m10:05:01.364457 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m10:05:01.364706 [debug] [ThreadPool]: On list_bank_rates_mart: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_mart"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'mart'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'mart'
  
[0m10:05:01.367413 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m10:05:01.368785 [debug] [ThreadPool]: On list_bank_rates_mart: ROLLBACK
[0m10:05:01.369273 [debug] [ThreadPool]: On list_bank_rates_mart: Close
[0m10:05:01.375045 [debug] [MainThread]: Using postgres connection "master"
[0m10:05:01.375481 [debug] [MainThread]: On master: BEGIN
[0m10:05:01.375807 [debug] [MainThread]: Opening a new connection, currently in state init
[0m10:05:01.384853 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m10:05:01.385309 [debug] [MainThread]: Using postgres connection "master"
[0m10:05:01.385773 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m10:05:01.392783 [debug] [MainThread]: SQL status: SELECT 3 in 0.0 seconds
[0m10:05:01.394476 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a66e5de7-7e17-4c8b-9990-2b705ddc5005', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ce6a161660>]}
[0m10:05:01.395045 [debug] [MainThread]: On master: ROLLBACK
[0m10:05:01.395608 [debug] [MainThread]: Using postgres connection "master"
[0m10:05:01.396023 [debug] [MainThread]: On master: BEGIN
[0m10:05:01.396669 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m10:05:01.396982 [debug] [MainThread]: On master: COMMIT
[0m10:05:01.397296 [debug] [MainThread]: Using postgres connection "master"
[0m10:05:01.397535 [debug] [MainThread]: On master: COMMIT
[0m10:05:01.397941 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m10:05:01.398277 [debug] [MainThread]: On master: Close
[0m10:05:01.399188 [info ] [MainThread]: Concurrency: 2 threads (target='dev')
[0m10:05:01.399705 [info ] [MainThread]: 
[0m10:05:01.403671 [debug] [Thread-1 (]: Began running node model.bank_rates.stg_cbr_precious_metals
[0m10:05:01.404244 [info ] [Thread-1 (]: 1 of 4 START sql view model staging.stg_cbr_precious_metals .................... [RUN]
[0m10:05:01.405079 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_bank_rates_mart, now model.bank_rates.stg_cbr_precious_metals)
[0m10:05:01.405477 [debug] [Thread-1 (]: Began compiling node model.bank_rates.stg_cbr_precious_metals
[0m10:05:01.409031 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_rates.stg_cbr_precious_metals"
[0m10:05:01.409799 [debug] [Thread-1 (]: Timing info for model.bank_rates.stg_cbr_precious_metals (compile): 10:05:01.405685 => 10:05:01.409533
[0m10:05:01.410264 [debug] [Thread-1 (]: Began executing node model.bank_rates.stg_cbr_precious_metals
[0m10:05:01.451373 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_rates.stg_cbr_precious_metals"
[0m10:05:01.452231 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m10:05:01.452630 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: BEGIN
[0m10:05:01.452926 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:05:01.461841 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m10:05:01.462362 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m10:05:01.462756 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */

  create view "bank_rates"."staging"."stg_cbr_precious_metals__dbt_tmp"
    
    
  as (
    

WITH ranked_data AS (
    SELECT 
        id,
        record_date::DATE as trade_date,
        metal_code::INTEGER as metal_code,
        buy_price::DECIMAL(10,2) as buy_price_rub,
        sell_price::DECIMAL(10,2) as sell_price_rub,
        from_date::DATE as valid_from,
        to_date::DATE as valid_to,
        load_timestamp::TIMESTAMP as loaded_at,
        -- Ð’Ñ‹Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÑŽÑŽ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÑƒ Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð´Ð½Ñ Ð¸ Ð¼ÐµÑ‚Ð°Ð»Ð»Ð°
        ROW_NUMBER() OVER (
            PARTITION BY record_date, metal_code 
            ORDER BY load_timestamp DESC
        ) as rn
    FROM raw.cbr_precious_metals
    WHERE record_date IS NOT NULL
      AND metal_code IS NOT NULL
      AND buy_price IS NOT NULL
)
SELECT 
    trade_date,
    metal_code,
    CASE 
        WHEN metal_code = 1 THEN 'Ð—Ð¾Ð»Ð¾Ñ‚Ð¾'
        WHEN metal_code = 2 THEN 'Ð¡ÐµÑ€ÐµÐ±Ñ€Ð¾'
        WHEN metal_code = 3 THEN 'ÐŸÐ»Ð°Ñ‚Ð¸Ð½Ð°'
        WHEN metal_code = 4 THEN 'ÐŸÐ°Ð»Ð»Ð°Ð´Ð¸Ð¹'
        ELSE 'ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ð¹ Ð¼ÐµÑ‚Ð°Ð»Ð»'
    END as metal_name,
    buy_price_rub,
    sell_price_rub,
    valid_from,
    valid_to,
    loaded_at
FROM ranked_data
WHERE rn = 1
  );
[0m10:05:01.468898 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.0 seconds
[0m10:05:01.477157 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m10:05:01.477589 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
alter table "bank_rates"."staging"."stg_cbr_precious_metals" rename to "stg_cbr_precious_metals__dbt_backup"
[0m10:05:01.478490 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m10:05:01.481686 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m10:05:01.482115 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
alter table "bank_rates"."staging"."stg_cbr_precious_metals__dbt_tmp" rename to "stg_cbr_precious_metals"
[0m10:05:01.482920 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m10:05:01.503333 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: COMMIT
[0m10:05:01.503898 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m10:05:01.504266 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: COMMIT
[0m10:05:01.508767 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m10:05:01.514463 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m10:05:01.514888 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
drop view if exists "bank_rates"."staging"."stg_cbr_precious_metals__dbt_backup" cascade
[0m10:05:01.516842 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.0 seconds
[0m10:05:01.518430 [debug] [Thread-1 (]: Timing info for model.bank_rates.stg_cbr_precious_metals (execute): 10:05:01.410500 => 10:05:01.518235
[0m10:05:01.518768 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: Close
[0m10:05:01.519666 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a66e5de7-7e17-4c8b-9990-2b705ddc5005', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ce69d66d40>]}
[0m10:05:01.520518 [info ] [Thread-1 (]: 1 of 4 OK created sql view model staging.stg_cbr_precious_metals ............... [[32mCREATE VIEW[0m in 0.11s]
[0m10:05:01.521331 [debug] [Thread-1 (]: Finished running node model.bank_rates.stg_cbr_precious_metals
[0m10:05:01.522922 [debug] [Thread-2 (]: Began running node model.bank_rates.dim_metals
[0m10:05:01.523379 [debug] [Thread-1 (]: Began running node model.bank_rates.fact_metal_prices
[0m10:05:01.523936 [info ] [Thread-2 (]: 2 of 4 START sql table model dds.dim_metals .................................... [RUN]
[0m10:05:01.524622 [info ] [Thread-1 (]: 3 of 4 START sql table model dds.fact_metal_prices ............................. [RUN]
[0m10:05:01.525516 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_bank_rates_staging, now model.bank_rates.dim_metals)
[0m10:05:01.526284 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.bank_rates.stg_cbr_precious_metals, now model.bank_rates.fact_metal_prices)
[0m10:05:01.526744 [debug] [Thread-2 (]: Began compiling node model.bank_rates.dim_metals
[0m10:05:01.527200 [debug] [Thread-1 (]: Began compiling node model.bank_rates.fact_metal_prices
[0m10:05:01.531343 [debug] [Thread-2 (]: Writing injected SQL for node "model.bank_rates.dim_metals"
[0m10:05:01.535000 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_rates.fact_metal_prices"
[0m10:05:01.536092 [debug] [Thread-2 (]: Timing info for model.bank_rates.dim_metals (compile): 10:05:01.527503 => 10:05:01.535762
[0m10:05:01.536664 [debug] [Thread-1 (]: Timing info for model.bank_rates.fact_metal_prices (compile): 10:05:01.531760 => 10:05:01.536373
[0m10:05:01.537026 [debug] [Thread-2 (]: Began executing node model.bank_rates.dim_metals
[0m10:05:01.537530 [debug] [Thread-1 (]: Began executing node model.bank_rates.fact_metal_prices
[0m10:05:01.567234 [debug] [Thread-2 (]: Writing runtime sql for node "model.bank_rates.dim_metals"
[0m10:05:01.571318 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_rates.fact_metal_prices"
[0m10:05:01.572391 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m10:05:01.572787 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: BEGIN
[0m10:05:01.573210 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m10:05:01.573628 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:05:01.574115 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: BEGIN
[0m10:05:01.574762 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:05:01.585363 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m10:05:01.585949 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m10:05:01.586517 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m10:05:01.587004 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m10:05:01.587515 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */

  
    

  create  table "bank_rates"."dds"."fact_metal_prices__dbt_tmp"
  
  
    as
  
  (
    

SELECT 
    ROW_NUMBER() OVER (ORDER BY trade_date, metal_code) as price_id,
    trade_date,
    metal_code,
    metal_name,
    buy_price_rub,
    sell_price_rub,
    loaded_at,
    CURRENT_TIMESTAMP as dwh_loaded_at
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
WHERE trade_date IS NOT NULL
  AND metal_code IS NOT NULL
  );
  
[0m10:05:01.588023 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */

  
    

  create  table "bank_rates"."dds"."dim_metals__dbt_tmp"
  
  
    as
  
  (
    

SELECT DISTINCT
    metal_code,
    metal_name
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
WHERE metal_code IS NOT NULL
  );
  
[0m10:05:01.656211 [debug] [Thread-2 (]: SQL status: SELECT 4 in 0.0 seconds
[0m10:05:01.660105 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m10:05:01.660579 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
alter table "bank_rates"."dds"."dim_metals" rename to "dim_metals__dbt_backup"
[0m10:05:01.662920 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m10:05:01.666306 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m10:05:01.666707 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
alter table "bank_rates"."dds"."dim_metals__dbt_tmp" rename to "dim_metals"
[0m10:05:01.667442 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m10:05:01.673746 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: COMMIT
[0m10:05:01.674256 [debug] [Thread-1 (]: SQL status: SELECT 16796 in 0.0 seconds
[0m10:05:01.674676 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m10:05:01.679348 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m10:05:01.679892 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: COMMIT
[0m10:05:01.680381 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
alter table "bank_rates"."dds"."fact_metal_prices" rename to "fact_metal_prices__dbt_backup"
[0m10:05:01.681288 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m10:05:01.684436 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m10:05:01.684864 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
alter table "bank_rates"."dds"."fact_metal_prices__dbt_tmp" rename to "fact_metal_prices"
[0m10:05:01.685637 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m10:05:01.687698 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: COMMIT
[0m10:05:01.688141 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m10:05:01.688566 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: COMMIT
[0m10:05:01.715546 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m10:05:01.718884 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m10:05:01.719357 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
drop table if exists "bank_rates"."dds"."dim_metals__dbt_backup" cascade
[0m10:05:01.730142 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m10:05:01.733033 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m10:05:01.733643 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m10:05:01.734130 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
drop table if exists "bank_rates"."dds"."fact_metal_prices__dbt_backup" cascade
[0m10:05:01.735983 [debug] [Thread-2 (]: Timing info for model.bank_rates.dim_metals (execute): 10:05:01.537821 => 10:05:01.735760
[0m10:05:01.736620 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: Close
[0m10:05:01.737505 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a66e5de7-7e17-4c8b-9990-2b705ddc5005', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ce6a1b9000>]}
[0m10:05:01.738230 [info ] [Thread-2 (]: 2 of 4 OK created sql table model dds.dim_metals ............................... [[32mSELECT 4[0m in 0.21s]
[0m10:05:01.739043 [debug] [Thread-2 (]: Finished running node model.bank_rates.dim_metals
[0m10:05:01.744887 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m10:05:01.746662 [debug] [Thread-1 (]: Timing info for model.bank_rates.fact_metal_prices (execute): 10:05:01.559769 => 10:05:01.746459
[0m10:05:01.747073 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: Close
[0m10:05:01.747861 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a66e5de7-7e17-4c8b-9990-2b705ddc5005', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ce69d72530>]}
[0m10:05:01.748587 [info ] [Thread-1 (]: 3 of 4 OK created sql table model dds.fact_metal_prices ........................ [[32mSELECT 16796[0m in 0.22s]
[0m10:05:01.749405 [debug] [Thread-1 (]: Finished running node model.bank_rates.fact_metal_prices
[0m10:05:01.750430 [debug] [Thread-2 (]: Began running node model.bank_rates.metal_prices_analytics
[0m10:05:01.750946 [info ] [Thread-2 (]: 4 of 4 START sql table model mart.metal_prices_analytics ....................... [RUN]
[0m10:05:01.751741 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bank_rates.dim_metals, now model.bank_rates.metal_prices_analytics)
[0m10:05:01.752140 [debug] [Thread-2 (]: Began compiling node model.bank_rates.metal_prices_analytics
[0m10:05:01.756132 [debug] [Thread-2 (]: Writing injected SQL for node "model.bank_rates.metal_prices_analytics"
[0m10:05:01.756841 [debug] [Thread-2 (]: Timing info for model.bank_rates.metal_prices_analytics (compile): 10:05:01.752363 => 10:05:01.756598
[0m10:05:01.757213 [debug] [Thread-2 (]: Began executing node model.bank_rates.metal_prices_analytics
[0m10:05:01.761303 [debug] [Thread-2 (]: Writing runtime sql for node "model.bank_rates.metal_prices_analytics"
[0m10:05:01.761908 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m10:05:01.762308 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: BEGIN
[0m10:05:01.762605 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:05:01.771644 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m10:05:01.772174 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m10:05:01.772652 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */

  
    

  create  table "bank_rates"."mart"."metal_prices_analytics__dbt_tmp"
  
  
    as
  
  (
    

SELECT 
    f.trade_date,
    f.metal_name,
    f.buy_price_rub,
    f.sell_price_rub,
    ROUND((f.buy_price_rub + f.sell_price_rub) / 2, 2) as avg_price_rub,
    LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) as prev_buy_price,
    LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) as prev_sell_price,
    CASE 
        WHEN LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) IS NOT NULL 
        THEN ROUND((f.buy_price_rub - LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date)) / 
                   LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) * 100, 2)
        ELSE NULL 
    END as buy_price_change_percent,
    CASE 
        WHEN LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) IS NOT NULL 
        THEN ROUND((f.sell_price_rub - LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date)) / 
                   LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) * 100, 2)
        ELSE NULL 
    END as sell_price_change_percent
FROM "bank_rates"."dds"."fact_metal_prices" f
ORDER BY f.trade_date DESC, f.metal_name
  );
  
[0m10:05:01.896705 [debug] [Thread-2 (]: SQL status: SELECT 16796 in 0.0 seconds
[0m10:05:01.900472 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m10:05:01.900942 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
alter table "bank_rates"."mart"."metal_prices_analytics" rename to "metal_prices_analytics__dbt_backup"
[0m10:05:01.901800 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m10:05:01.904872 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m10:05:01.905382 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
alter table "bank_rates"."mart"."metal_prices_analytics__dbt_tmp" rename to "metal_prices_analytics"
[0m10:05:01.906024 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m10:05:01.908025 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: COMMIT
[0m10:05:01.908445 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m10:05:01.908795 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: COMMIT
[0m10:05:01.928704 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m10:05:01.931945 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m10:05:01.932407 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
drop table if exists "bank_rates"."mart"."metal_prices_analytics__dbt_backup" cascade
[0m10:05:01.936275 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m10:05:01.938095 [debug] [Thread-2 (]: Timing info for model.bank_rates.metal_prices_analytics (execute): 10:05:01.757429 => 10:05:01.937844
[0m10:05:01.938510 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: Close
[0m10:05:01.939330 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a66e5de7-7e17-4c8b-9990-2b705ddc5005', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ce69d2e560>]}
[0m10:05:01.939987 [info ] [Thread-2 (]: 4 of 4 OK created sql table model mart.metal_prices_analytics .................. [[32mSELECT 16796[0m in 0.19s]
[0m10:05:01.940748 [debug] [Thread-2 (]: Finished running node model.bank_rates.metal_prices_analytics
[0m10:05:01.942444 [debug] [MainThread]: Using postgres connection "master"
[0m10:05:01.942814 [debug] [MainThread]: On master: BEGIN
[0m10:05:01.943141 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m10:05:01.951360 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m10:05:01.951734 [debug] [MainThread]: On master: COMMIT
[0m10:05:01.952001 [debug] [MainThread]: Using postgres connection "master"
[0m10:05:01.952297 [debug] [MainThread]: On master: COMMIT
[0m10:05:01.952698 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m10:05:01.952998 [debug] [MainThread]: On master: Close
[0m10:05:01.953801 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:05:01.954218 [debug] [MainThread]: Connection 'model.bank_rates.metal_prices_analytics' was properly closed.
[0m10:05:01.954543 [debug] [MainThread]: Connection 'model.bank_rates.fact_metal_prices' was properly closed.
[0m10:05:01.954964 [info ] [MainThread]: 
[0m10:05:01.955455 [info ] [MainThread]: Finished running 1 view model, 3 table models in 0 hours 0 minutes and 0.70 seconds (0.70s).
[0m10:05:01.956716 [debug] [MainThread]: Command end result
[0m10:05:01.964146 [info ] [MainThread]: 
[0m10:05:01.964639 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:05:01.965088 [info ] [MainThread]: 
[0m10:05:01.965527 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m10:05:01.966221 [debug] [MainThread]: Command `dbt run` succeeded at 10:05:01.966068 after 0.92 seconds
[0m10:05:01.966591 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ce6c481090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ce6adf3430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77ce6a1c02b0>]}
[0m10:05:01.966936 [debug] [MainThread]: Flushing usage events
[0m10:13:52.480891 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75d9f7169090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75d9f5bdf970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75d9f5bdfa00>]}


============================== 10:13:52.484189 | 9683587f-8a41-4c07-a3ca-871e330c1961 ==============================
[0m10:13:52.484189 [info ] [MainThread]: Running with dbt=1.5.0
[0m10:13:52.484829 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'log_path': '/usr/app/logs', 'fail_fast': 'False', 'profiles_dir': '/usr/app', 'no_print': 'None', 'log_cache_events': 'False', 'warn_error': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'log_format': 'default', 'introspect': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'printer_width': '80', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'quiet': 'False', 'version_check': 'True', 'debug': 'False', 'target_path': 'None', 'partial_parse': 'True', 'use_colors': 'True'}
[0m10:13:52.594896 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9683587f-8a41-4c07-a3ca-871e330c1961', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75d9f5bdfb50>]}
[0m10:13:52.616117 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9683587f-8a41-4c07-a3ca-871e330c1961', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75d9f5aeafe0>]}
[0m10:13:52.628179 [debug] [MainThread]: checksum: 4568eb639a77b8fcb3a1f4a07856f42b1ff63f1376652889143968e1dbdafbda, vars: {}, profile: , target: , version: 1.5.0
[0m10:13:52.649327 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:13:52.649673 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:13:52.655598 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9683587f-8a41-4c07-a3ca-871e330c1961', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75d9f4b7e5f0>]}
[0m10:13:52.662262 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9683587f-8a41-4c07-a3ca-871e330c1961', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75d9f4b4f790>]}
[0m10:13:52.662701 [info ] [MainThread]: Found 4 models, 3 tests, 0 snapshots, 0 analyses, 308 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m10:13:52.663148 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9683587f-8a41-4c07-a3ca-871e330c1961', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75d9f4b4f820>]}
[0m10:13:52.664683 [info ] [MainThread]: 
[0m10:13:52.665545 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m10:13:52.666964 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates_staging'
[0m10:13:52.667940 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates_mart'
[0m10:13:52.680366 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m10:13:52.682604 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m10:13:52.683028 [debug] [ThreadPool]: On list_bank_rates_staging: BEGIN
[0m10:13:52.683477 [debug] [ThreadPool]: On list_bank_rates_mart: BEGIN
[0m10:13:52.683815 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:13:52.684191 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:13:52.697478 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m10:13:52.697854 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m10:13:52.698217 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m10:13:52.698553 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m10:13:52.698909 [debug] [ThreadPool]: On list_bank_rates_mart: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_mart"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'mart'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'mart'
  
[0m10:13:52.699267 [debug] [ThreadPool]: On list_bank_rates_staging: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_staging"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging'
  
[0m10:13:52.702121 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m10:13:52.702440 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m10:13:52.703916 [debug] [ThreadPool]: On list_bank_rates_mart: ROLLBACK
[0m10:13:52.705222 [debug] [ThreadPool]: On list_bank_rates_staging: ROLLBACK
[0m10:13:52.705709 [debug] [ThreadPool]: On list_bank_rates_mart: Close
[0m10:13:52.705986 [debug] [ThreadPool]: On list_bank_rates_staging: Close
[0m10:13:52.707077 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates_mart, now list_bank_rates_dds)
[0m10:13:52.710439 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m10:13:52.710740 [debug] [ThreadPool]: On list_bank_rates_dds: BEGIN
[0m10:13:52.710996 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:13:52.719094 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m10:13:52.719450 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m10:13:52.719799 [debug] [ThreadPool]: On list_bank_rates_dds: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_dds"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dds'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dds'
  
[0m10:13:52.722373 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m10:13:52.723647 [debug] [ThreadPool]: On list_bank_rates_dds: ROLLBACK
[0m10:13:52.724098 [debug] [ThreadPool]: On list_bank_rates_dds: Close
[0m10:13:52.729338 [debug] [MainThread]: Using postgres connection "master"
[0m10:13:52.729726 [debug] [MainThread]: On master: BEGIN
[0m10:13:52.730048 [debug] [MainThread]: Opening a new connection, currently in state init
[0m10:13:52.738256 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m10:13:52.738596 [debug] [MainThread]: Using postgres connection "master"
[0m10:13:52.738988 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m10:13:52.745141 [debug] [MainThread]: SQL status: SELECT 3 in 0.0 seconds
[0m10:13:52.746535 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9683587f-8a41-4c07-a3ca-871e330c1961', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75d9f4b4c790>]}
[0m10:13:52.746997 [debug] [MainThread]: On master: ROLLBACK
[0m10:13:52.747474 [debug] [MainThread]: Using postgres connection "master"
[0m10:13:52.747751 [debug] [MainThread]: On master: BEGIN
[0m10:13:52.748252 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m10:13:52.748548 [debug] [MainThread]: On master: COMMIT
[0m10:13:52.748811 [debug] [MainThread]: Using postgres connection "master"
[0m10:13:52.749084 [debug] [MainThread]: On master: COMMIT
[0m10:13:52.749451 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m10:13:52.749753 [debug] [MainThread]: On master: Close
[0m10:13:52.750441 [info ] [MainThread]: Concurrency: 2 threads (target='dev')
[0m10:13:52.750865 [info ] [MainThread]: 
[0m10:13:52.755237 [debug] [Thread-1 (]: Began running node test.bank_rates.not_null_key_columns
[0m10:13:52.755665 [debug] [Thread-2 (]: Began running node test.bank_rates.positive_prices
[0m10:13:52.756203 [info ] [Thread-1 (]: 1 of 3 START test not_null_key_columns ......................................... [RUN]
[0m10:13:52.756816 [info ] [Thread-2 (]: 2 of 3 START test positive_prices .............................................. [RUN]
[0m10:13:52.757699 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_bank_rates_staging, now test.bank_rates.not_null_key_columns)
[0m10:13:52.758396 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_bank_rates_dds, now test.bank_rates.positive_prices)
[0m10:13:52.758840 [debug] [Thread-1 (]: Began compiling node test.bank_rates.not_null_key_columns
[0m10:13:52.759271 [debug] [Thread-2 (]: Began compiling node test.bank_rates.positive_prices
[0m10:13:52.762603 [debug] [Thread-1 (]: Writing injected SQL for node "test.bank_rates.not_null_key_columns"
[0m10:13:52.765425 [debug] [Thread-2 (]: Writing injected SQL for node "test.bank_rates.positive_prices"
[0m10:13:52.766306 [debug] [Thread-1 (]: Timing info for test.bank_rates.not_null_key_columns (compile): 10:13:52.759525 => 10:13:52.766019
[0m10:13:52.766770 [debug] [Thread-1 (]: Began executing node test.bank_rates.not_null_key_columns
[0m10:13:52.767250 [debug] [Thread-2 (]: Timing info for test.bank_rates.positive_prices (compile): 10:13:52.762895 => 10:13:52.766993
[0m10:13:52.784028 [debug] [Thread-1 (]: Writing runtime sql for node "test.bank_rates.not_null_key_columns"
[0m10:13:52.784452 [debug] [Thread-2 (]: Began executing node test.bank_rates.positive_prices
[0m10:13:52.787025 [debug] [Thread-2 (]: Writing runtime sql for node "test.bank_rates.positive_prices"
[0m10:13:52.787557 [debug] [Thread-1 (]: Using postgres connection "test.bank_rates.not_null_key_columns"
[0m10:13:52.788136 [debug] [Thread-1 (]: On test.bank_rates.not_null_key_columns: BEGIN
[0m10:13:52.788543 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:13:52.788948 [debug] [Thread-2 (]: Using postgres connection "test.bank_rates.positive_prices"
[0m10:13:52.789503 [debug] [Thread-2 (]: On test.bank_rates.positive_prices: BEGIN
[0m10:13:52.789922 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:13:52.799778 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m10:13:52.800340 [debug] [Thread-1 (]: Using postgres connection "test.bank_rates.not_null_key_columns"
[0m10:13:52.800793 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m10:13:52.801186 [debug] [Thread-1 (]: On test.bank_rates.not_null_key_columns: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "test.bank_rates.not_null_key_columns"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      SELECT 
    trade_date,
    metal_code
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
WHERE trade_date IS NULL 
   OR metal_code IS NULL 
   OR buy_price_rub IS NULL 
   OR sell_price_rub IS NULL
      
    ) dbt_internal_test
[0m10:13:52.801637 [debug] [Thread-2 (]: Using postgres connection "test.bank_rates.positive_prices"
[0m10:13:52.802218 [debug] [Thread-2 (]: On test.bank_rates.positive_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "test.bank_rates.positive_prices"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      SELECT 
    trade_date,
    metal_code,
    buy_price_rub,
    sell_price_rub
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
WHERE buy_price_rub <= 0 OR sell_price_rub <= 0
      
    ) dbt_internal_test
[0m10:13:52.830763 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m10:13:52.834295 [debug] [Thread-1 (]: Timing info for test.bank_rates.not_null_key_columns (execute): 10:13:52.767470 => 10:13:52.833978
[0m10:13:52.834693 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m10:13:52.835175 [debug] [Thread-1 (]: On test.bank_rates.not_null_key_columns: ROLLBACK
[0m10:13:52.836736 [debug] [Thread-2 (]: Timing info for test.bank_rates.positive_prices (execute): 10:13:52.784915 => 10:13:52.836502
[0m10:13:52.837299 [debug] [Thread-2 (]: On test.bank_rates.positive_prices: ROLLBACK
[0m10:13:52.837695 [debug] [Thread-1 (]: On test.bank_rates.not_null_key_columns: Close
[0m10:13:52.838256 [debug] [Thread-2 (]: On test.bank_rates.positive_prices: Close
[0m10:13:52.839134 [info ] [Thread-1 (]: 1 of 3 PASS not_null_key_columns ............................................... [[32mPASS[0m in 0.08s]
[0m10:13:52.840206 [debug] [Thread-1 (]: Finished running node test.bank_rates.not_null_key_columns
[0m10:13:52.840969 [info ] [Thread-2 (]: 2 of 3 PASS positive_prices .................................................... [[32mPASS[0m in 0.08s]
[0m10:13:52.841640 [debug] [Thread-1 (]: Began running node test.bank_rates.unique_trade_date_metal_code
[0m10:13:52.842486 [debug] [Thread-2 (]: Finished running node test.bank_rates.positive_prices
[0m10:13:52.842954 [info ] [Thread-1 (]: 3 of 3 START test unique_trade_date_metal_code ................................. [RUN]
[0m10:13:52.844003 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.bank_rates.not_null_key_columns, now test.bank_rates.unique_trade_date_metal_code)
[0m10:13:52.844431 [debug] [Thread-1 (]: Began compiling node test.bank_rates.unique_trade_date_metal_code
[0m10:13:52.847703 [debug] [Thread-1 (]: Writing injected SQL for node "test.bank_rates.unique_trade_date_metal_code"
[0m10:13:52.848437 [debug] [Thread-1 (]: Timing info for test.bank_rates.unique_trade_date_metal_code (compile): 10:13:52.844645 => 10:13:52.848188
[0m10:13:52.848800 [debug] [Thread-1 (]: Began executing node test.bank_rates.unique_trade_date_metal_code
[0m10:13:52.851390 [debug] [Thread-1 (]: Writing runtime sql for node "test.bank_rates.unique_trade_date_metal_code"
[0m10:13:52.851967 [debug] [Thread-1 (]: Using postgres connection "test.bank_rates.unique_trade_date_metal_code"
[0m10:13:52.852361 [debug] [Thread-1 (]: On test.bank_rates.unique_trade_date_metal_code: BEGIN
[0m10:13:52.852732 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:13:52.861126 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m10:13:52.861497 [debug] [Thread-1 (]: Using postgres connection "test.bank_rates.unique_trade_date_metal_code"
[0m10:13:52.861824 [debug] [Thread-1 (]: On test.bank_rates.unique_trade_date_metal_code: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "test.bank_rates.unique_trade_date_metal_code"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      SELECT 
    trade_date,
    metal_code,
    COUNT(*) as count
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
GROUP BY trade_date, metal_code
HAVING COUNT(*) > 1
      
    ) dbt_internal_test
[0m10:13:52.885649 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m10:13:52.887507 [debug] [Thread-1 (]: Timing info for test.bank_rates.unique_trade_date_metal_code (execute): 10:13:52.849006 => 10:13:52.887246
[0m10:13:52.887888 [debug] [Thread-1 (]: On test.bank_rates.unique_trade_date_metal_code: ROLLBACK
[0m10:13:52.888405 [debug] [Thread-1 (]: On test.bank_rates.unique_trade_date_metal_code: Close
[0m10:13:52.889518 [info ] [Thread-1 (]: 3 of 3 PASS unique_trade_date_metal_code ....................................... [[32mPASS[0m in 0.05s]
[0m10:13:52.890419 [debug] [Thread-1 (]: Finished running node test.bank_rates.unique_trade_date_metal_code
[0m10:13:52.892181 [debug] [MainThread]: Using postgres connection "master"
[0m10:13:52.892514 [debug] [MainThread]: On master: BEGIN
[0m10:13:52.892824 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m10:13:52.901744 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m10:13:52.902110 [debug] [MainThread]: On master: COMMIT
[0m10:13:52.902417 [debug] [MainThread]: Using postgres connection "master"
[0m10:13:52.902681 [debug] [MainThread]: On master: COMMIT
[0m10:13:52.903157 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m10:13:52.903467 [debug] [MainThread]: On master: Close
[0m10:13:52.904111 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:13:52.904396 [debug] [MainThread]: Connection 'test.bank_rates.unique_trade_date_metal_code' was properly closed.
[0m10:13:52.904641 [debug] [MainThread]: Connection 'test.bank_rates.positive_prices' was properly closed.
[0m10:13:52.904938 [info ] [MainThread]: 
[0m10:13:52.905397 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 0.24 seconds (0.24s).
[0m10:13:52.906518 [debug] [MainThread]: Command end result
[0m10:13:52.912194 [info ] [MainThread]: 
[0m10:13:52.912664 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:13:52.913080 [info ] [MainThread]: 
[0m10:13:52.913562 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m10:13:52.914190 [debug] [MainThread]: Command `dbt test` succeeded at 10:13:52.914012 after 0.44 seconds
[0m10:13:52.914543 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75d9f7169090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75d9f5aeafe0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75d9f4b4f880>]}
[0m10:13:52.914905 [debug] [MainThread]: Flushing usage events
[0m11:38:59.377647 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf63777cf40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf6361af820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf6361af8b0>]}


============================== 11:38:59.380792 | 9e552a53-ba7d-4428-acc4-61c7c4743682 ==============================
[0m11:38:59.380792 [info ] [MainThread]: Running with dbt=1.5.0
[0m11:38:59.381479 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'use_colors': 'True', 'fail_fast': 'False', 'printer_width': '80', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'introspect': 'True', 'quiet': 'False', 'version_check': 'True', 'use_experimental_parser': 'False', 'static_parser': 'True', 'indirect_selection': 'eager', 'write_json': 'True', 'debug': 'False', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'target_path': 'None', 'log_format': 'default', 'profiles_dir': '/usr/app', 'log_path': '/usr/app/logs', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])'}
[0m11:38:59.492268 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9e552a53-ba7d-4428-acc4-61c7c4743682', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf63608bfa0>]}
[0m11:38:59.512857 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9e552a53-ba7d-4428-acc4-61c7c4743682', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf6360d2d10>]}
[0m11:38:59.524175 [debug] [MainThread]: checksum: 4568eb639a77b8fcb3a1f4a07856f42b1ff63f1376652889143968e1dbdafbda, vars: {}, profile: , target: , version: 1.5.0
[0m11:38:59.544976 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:38:59.545344 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:38:59.550933 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9e552a53-ba7d-4428-acc4-61c7c4743682', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf6351524a0>]}
[0m11:38:59.557365 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9e552a53-ba7d-4428-acc4-61c7c4743682', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf635123640>]}
[0m11:38:59.557832 [info ] [MainThread]: Found 4 models, 3 tests, 0 snapshots, 0 analyses, 308 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m11:38:59.558232 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9e552a53-ba7d-4428-acc4-61c7c4743682', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf6351236d0>]}
[0m11:38:59.559812 [info ] [MainThread]: 
[0m11:38:59.560621 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m11:38:59.562085 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m11:38:59.573305 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m11:38:59.575307 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m11:38:59.577586 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m11:38:59.577996 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m11:38:59.578425 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m11:38:59.578761 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:38:59.579107 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:38:59.592538 [debug] [ThreadPool]: SQL status: SELECT 11 in 0.0 seconds
[0m11:38:59.593029 [debug] [ThreadPool]: SQL status: SELECT 11 in 0.0 seconds
[0m11:38:59.594471 [debug] [ThreadPool]: On list_bank_rates: Close
[0m11:38:59.595842 [debug] [ThreadPool]: On list_bank_rates: Close
[0m11:38:59.598627 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m11:38:59.599655 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m11:38:59.599938 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:38:59.608524 [debug] [ThreadPool]: SQL status: SELECT 11 in 0.0 seconds
[0m11:38:59.609840 [debug] [ThreadPool]: On list_bank_rates: Close
[0m11:38:59.611796 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates, now list_bank_rates_mart)
[0m11:38:59.617999 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates, now list_bank_rates_dds)
[0m11:38:59.619425 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m11:38:59.621525 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m11:38:59.621902 [debug] [ThreadPool]: On list_bank_rates_mart: BEGIN
[0m11:38:59.622312 [debug] [ThreadPool]: On list_bank_rates_dds: BEGIN
[0m11:38:59.622634 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:38:59.622973 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:38:59.634615 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m11:38:59.635006 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m11:38:59.635401 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m11:38:59.635811 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m11:38:59.636201 [debug] [ThreadPool]: On list_bank_rates_mart: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_mart"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'mart'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'mart'
  
[0m11:38:59.636588 [debug] [ThreadPool]: On list_bank_rates_dds: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_dds"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dds'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dds'
  
[0m11:38:59.640237 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m11:38:59.640577 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m11:38:59.641919 [debug] [ThreadPool]: On list_bank_rates_dds: ROLLBACK
[0m11:38:59.643262 [debug] [ThreadPool]: On list_bank_rates_mart: ROLLBACK
[0m11:38:59.643860 [debug] [ThreadPool]: On list_bank_rates_dds: Close
[0m11:38:59.644178 [debug] [ThreadPool]: On list_bank_rates_mart: Close
[0m11:38:59.645618 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates_dds, now list_bank_rates_staging)
[0m11:38:59.648964 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m11:38:59.649350 [debug] [ThreadPool]: On list_bank_rates_staging: BEGIN
[0m11:38:59.649648 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:38:59.658009 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m11:38:59.658429 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m11:38:59.658794 [debug] [ThreadPool]: On list_bank_rates_staging: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_staging"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging'
  
[0m11:38:59.661566 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m11:38:59.662925 [debug] [ThreadPool]: On list_bank_rates_staging: ROLLBACK
[0m11:38:59.663402 [debug] [ThreadPool]: On list_bank_rates_staging: Close
[0m11:38:59.668858 [debug] [MainThread]: Using postgres connection "master"
[0m11:38:59.669340 [debug] [MainThread]: On master: BEGIN
[0m11:38:59.669616 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:38:59.678296 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m11:38:59.678702 [debug] [MainThread]: Using postgres connection "master"
[0m11:38:59.679167 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m11:38:59.684286 [debug] [MainThread]: SQL status: SELECT 3 in 0.0 seconds
[0m11:38:59.685768 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9e552a53-ba7d-4428-acc4-61c7c4743682', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf635147940>]}
[0m11:38:59.686369 [debug] [MainThread]: On master: ROLLBACK
[0m11:38:59.686840 [debug] [MainThread]: Using postgres connection "master"
[0m11:38:59.687195 [debug] [MainThread]: On master: BEGIN
[0m11:38:59.687737 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m11:38:59.688116 [debug] [MainThread]: On master: COMMIT
[0m11:38:59.688447 [debug] [MainThread]: Using postgres connection "master"
[0m11:38:59.688759 [debug] [MainThread]: On master: COMMIT
[0m11:38:59.689187 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m11:38:59.689520 [debug] [MainThread]: On master: Close
[0m11:38:59.690277 [info ] [MainThread]: Concurrency: 2 threads (target='dev')
[0m11:38:59.690672 [info ] [MainThread]: 
[0m11:38:59.694505 [debug] [Thread-1 (]: Began running node model.bank_rates.stg_cbr_precious_metals
[0m11:38:59.695198 [info ] [Thread-1 (]: 1 of 4 START sql view model staging.stg_cbr_precious_metals .................... [RUN]
[0m11:38:59.696007 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_bank_rates_staging, now model.bank_rates.stg_cbr_precious_metals)
[0m11:38:59.696469 [debug] [Thread-1 (]: Began compiling node model.bank_rates.stg_cbr_precious_metals
[0m11:38:59.699862 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_rates.stg_cbr_precious_metals"
[0m11:38:59.700622 [debug] [Thread-1 (]: Timing info for model.bank_rates.stg_cbr_precious_metals (compile): 11:38:59.696692 => 11:38:59.700367
[0m11:38:59.701075 [debug] [Thread-1 (]: Began executing node model.bank_rates.stg_cbr_precious_metals
[0m11:38:59.741157 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_rates.stg_cbr_precious_metals"
[0m11:38:59.742030 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m11:38:59.742538 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: BEGIN
[0m11:38:59.742936 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:38:59.752174 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m11:38:59.752652 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m11:38:59.753048 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */

  create view "bank_rates"."staging"."stg_cbr_precious_metals__dbt_tmp"
    
    
  as (
    

WITH ranked_data AS (
    SELECT 
        id,
        record_date::DATE as trade_date,
        metal_code::INTEGER as metal_code,
        buy_price::DECIMAL(10,2) as buy_price_rub,
        sell_price::DECIMAL(10,2) as sell_price_rub,
        from_date::DATE as valid_from,
        to_date::DATE as valid_to,
        load_timestamp::TIMESTAMP as loaded_at,
        -- Ð’Ñ‹Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÑŽÑŽ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÑƒ Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð´Ð½Ñ Ð¸ Ð¼ÐµÑ‚Ð°Ð»Ð»Ð°
        ROW_NUMBER() OVER (
            PARTITION BY record_date, metal_code 
            ORDER BY load_timestamp DESC
        ) as rn
    FROM raw.cbr_precious_metals
    WHERE record_date IS NOT NULL
      AND metal_code IS NOT NULL
      AND buy_price IS NOT NULL
)
SELECT 
    trade_date,
    metal_code,
    CASE 
        WHEN metal_code = 1 THEN 'Ð—Ð¾Ð»Ð¾Ñ‚Ð¾'
        WHEN metal_code = 2 THEN 'Ð¡ÐµÑ€ÐµÐ±Ñ€Ð¾'
        WHEN metal_code = 3 THEN 'ÐŸÐ»Ð°Ñ‚Ð¸Ð½Ð°'
        WHEN metal_code = 4 THEN 'ÐŸÐ°Ð»Ð»Ð°Ð´Ð¸Ð¹'
        ELSE 'ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ð¹ Ð¼ÐµÑ‚Ð°Ð»Ð»'
    END as metal_name,
    buy_price_rub,
    sell_price_rub,
    valid_from,
    valid_to,
    loaded_at
FROM ranked_data
WHERE rn = 1
  );
[0m11:38:59.756319 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.0 seconds
[0m11:38:59.763565 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m11:38:59.763995 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
alter table "bank_rates"."staging"."stg_cbr_precious_metals" rename to "stg_cbr_precious_metals__dbt_backup"
[0m11:38:59.765016 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m11:38:59.768233 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m11:38:59.768614 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
alter table "bank_rates"."staging"."stg_cbr_precious_metals__dbt_tmp" rename to "stg_cbr_precious_metals"
[0m11:38:59.769448 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m11:38:59.797535 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: COMMIT
[0m11:38:59.798128 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m11:38:59.798556 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: COMMIT
[0m11:38:59.800258 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m11:38:59.805704 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m11:38:59.806177 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
drop view if exists "bank_rates"."staging"."stg_cbr_precious_metals__dbt_backup" cascade
[0m11:38:59.808016 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.0 seconds
[0m11:38:59.809610 [debug] [Thread-1 (]: Timing info for model.bank_rates.stg_cbr_precious_metals (execute): 11:38:59.701326 => 11:38:59.809413
[0m11:38:59.809993 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: Close
[0m11:38:59.810797 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9e552a53-ba7d-4428-acc4-61c7c4743682', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf634d4f190>]}
[0m11:38:59.811473 [info ] [Thread-1 (]: 1 of 4 OK created sql view model staging.stg_cbr_precious_metals ............... [[32mCREATE VIEW[0m in 0.12s]
[0m11:38:59.812255 [debug] [Thread-1 (]: Finished running node model.bank_rates.stg_cbr_precious_metals
[0m11:38:59.813267 [debug] [Thread-2 (]: Began running node model.bank_rates.dim_metals
[0m11:38:59.813735 [debug] [Thread-1 (]: Began running node model.bank_rates.fact_metal_prices
[0m11:38:59.814251 [info ] [Thread-2 (]: 2 of 4 START sql table model dds.dim_metals .................................... [RUN]
[0m11:38:59.814874 [info ] [Thread-1 (]: 3 of 4 START sql table model dds.fact_metal_prices ............................. [RUN]
[0m11:38:59.815723 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_bank_rates_mart, now model.bank_rates.dim_metals)
[0m11:38:59.816375 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.bank_rates.stg_cbr_precious_metals, now model.bank_rates.fact_metal_prices)
[0m11:38:59.816784 [debug] [Thread-2 (]: Began compiling node model.bank_rates.dim_metals
[0m11:38:59.817201 [debug] [Thread-1 (]: Began compiling node model.bank_rates.fact_metal_prices
[0m11:38:59.820550 [debug] [Thread-2 (]: Writing injected SQL for node "model.bank_rates.dim_metals"
[0m11:38:59.823694 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_rates.fact_metal_prices"
[0m11:38:59.824545 [debug] [Thread-2 (]: Timing info for model.bank_rates.dim_metals (compile): 11:38:59.817445 => 11:38:59.824301
[0m11:38:59.824953 [debug] [Thread-2 (]: Began executing node model.bank_rates.dim_metals
[0m11:38:59.825570 [debug] [Thread-1 (]: Timing info for model.bank_rates.fact_metal_prices (compile): 11:38:59.820854 => 11:38:59.825268
[0m11:38:59.846983 [debug] [Thread-1 (]: Began executing node model.bank_rates.fact_metal_prices
[0m11:38:59.849246 [debug] [Thread-2 (]: Writing runtime sql for node "model.bank_rates.dim_metals"
[0m11:38:59.853258 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_rates.fact_metal_prices"
[0m11:38:59.854114 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m11:38:59.854547 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: BEGIN
[0m11:38:59.854968 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m11:38:59.855373 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m11:38:59.855823 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: BEGIN
[0m11:38:59.856436 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:38:59.867678 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m11:38:59.868189 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m11:38:59.868613 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m11:38:59.869002 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m11:38:59.869400 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */

  
    

  create  table "bank_rates"."dds"."dim_metals__dbt_tmp"
  
  
    as
  
  (
    

SELECT DISTINCT
    metal_code,
    metal_name
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
WHERE metal_code IS NOT NULL
  );
  
[0m11:38:59.869779 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */

  
    

  create  table "bank_rates"."dds"."fact_metal_prices__dbt_tmp"
  
  
    as
  
  (
    

SELECT 
    ROW_NUMBER() OVER (ORDER BY trade_date, metal_code) as price_id,
    trade_date,
    metal_code,
    metal_name,
    buy_price_rub,
    sell_price_rub,
    loaded_at,
    CURRENT_TIMESTAMP as dwh_loaded_at
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
WHERE trade_date IS NOT NULL
  AND metal_code IS NOT NULL
  );
  
[0m11:38:59.915506 [debug] [Thread-2 (]: SQL status: SELECT 4 in 0.0 seconds
[0m11:38:59.921284 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m11:38:59.921948 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
alter table "bank_rates"."dds"."dim_metals" rename to "dim_metals__dbt_backup"
[0m11:38:59.922976 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m11:38:59.928317 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m11:38:59.928903 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
alter table "bank_rates"."dds"."dim_metals__dbt_tmp" rename to "dim_metals"
[0m11:38:59.929779 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m11:38:59.939158 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: COMMIT
[0m11:38:59.939735 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m11:38:59.940245 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: COMMIT
[0m11:38:59.944969 [debug] [Thread-1 (]: SQL status: SELECT 16796 in 0.0 seconds
[0m11:38:59.949670 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m11:38:59.950141 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
alter table "bank_rates"."dds"."fact_metal_prices" rename to "fact_metal_prices__dbt_backup"
[0m11:38:59.950533 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m11:38:59.953010 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m11:38:59.953465 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m11:38:59.953797 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
drop table if exists "bank_rates"."dds"."dim_metals__dbt_backup" cascade
[0m11:38:59.956960 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m11:38:59.957525 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
alter table "bank_rates"."dds"."fact_metal_prices__dbt_tmp" rename to "fact_metal_prices"
[0m11:38:59.958241 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m11:38:59.960131 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: COMMIT
[0m11:38:59.960514 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m11:38:59.960849 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: COMMIT
[0m11:38:59.969383 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m11:38:59.971319 [debug] [Thread-2 (]: Timing info for model.bank_rates.dim_metals (execute): 11:38:59.825774 => 11:38:59.971105
[0m11:38:59.971726 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m11:38:59.972247 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: Close
[0m11:38:59.974863 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m11:38:59.975961 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9e552a53-ba7d-4428-acc4-61c7c4743682', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf6351999f0>]}
[0m11:38:59.976466 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
drop table if exists "bank_rates"."dds"."fact_metal_prices__dbt_backup" cascade
[0m11:38:59.977325 [info ] [Thread-2 (]: 2 of 4 OK created sql table model dds.dim_metals ............................... [[32mSELECT 4[0m in 0.16s]
[0m11:38:59.978428 [debug] [Thread-2 (]: Finished running node model.bank_rates.dim_metals
[0m11:38:59.980498 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m11:38:59.982178 [debug] [Thread-1 (]: Timing info for model.bank_rates.fact_metal_prices (execute): 11:38:59.849551 => 11:38:59.981943
[0m11:38:59.982580 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: Close
[0m11:38:59.983365 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9e552a53-ba7d-4428-acc4-61c7c4743682', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf6351a3e80>]}
[0m11:38:59.984042 [info ] [Thread-1 (]: 3 of 4 OK created sql table model dds.fact_metal_prices ........................ [[32mSELECT 16796[0m in 0.17s]
[0m11:38:59.984754 [debug] [Thread-1 (]: Finished running node model.bank_rates.fact_metal_prices
[0m11:38:59.985519 [debug] [Thread-2 (]: Began running node model.bank_rates.metal_prices_analytics
[0m11:38:59.986218 [info ] [Thread-2 (]: 4 of 4 START sql table model mart.metal_prices_analytics ....................... [RUN]
[0m11:38:59.986953 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bank_rates.dim_metals, now model.bank_rates.metal_prices_analytics)
[0m11:38:59.987361 [debug] [Thread-2 (]: Began compiling node model.bank_rates.metal_prices_analytics
[0m11:38:59.991011 [debug] [Thread-2 (]: Writing injected SQL for node "model.bank_rates.metal_prices_analytics"
[0m11:38:59.991749 [debug] [Thread-2 (]: Timing info for model.bank_rates.metal_prices_analytics (compile): 11:38:59.987578 => 11:38:59.991513
[0m11:38:59.992120 [debug] [Thread-2 (]: Began executing node model.bank_rates.metal_prices_analytics
[0m11:38:59.996210 [debug] [Thread-2 (]: Writing runtime sql for node "model.bank_rates.metal_prices_analytics"
[0m11:38:59.996867 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m11:38:59.997322 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: BEGIN
[0m11:38:59.997678 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m11:39:00.006284 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m11:39:00.006798 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m11:39:00.007284 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */

  
    

  create  table "bank_rates"."mart"."metal_prices_analytics__dbt_tmp"
  
  
    as
  
  (
    

SELECT 
    f.trade_date,
    f.metal_name,
    f.buy_price_rub,
    f.sell_price_rub,
    ROUND((f.buy_price_rub + f.sell_price_rub) / 2, 2) as avg_price_rub,
    LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) as prev_buy_price,
    LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) as prev_sell_price,
    CASE 
        WHEN LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) IS NOT NULL 
        THEN ROUND((f.buy_price_rub - LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date)) / 
                   LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) * 100, 2)
        ELSE NULL 
    END as buy_price_change_percent,
    CASE 
        WHEN LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) IS NOT NULL 
        THEN ROUND((f.sell_price_rub - LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date)) / 
                   LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) * 100, 2)
        ELSE NULL 
    END as sell_price_change_percent
FROM "bank_rates"."dds"."fact_metal_prices" f
ORDER BY f.trade_date DESC, f.metal_name
  );
  
[0m11:39:00.119825 [debug] [Thread-2 (]: SQL status: SELECT 16796 in 0.0 seconds
[0m11:39:00.123610 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m11:39:00.124128 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
alter table "bank_rates"."mart"."metal_prices_analytics" rename to "metal_prices_analytics__dbt_backup"
[0m11:39:00.124933 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m11:39:00.128026 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m11:39:00.128489 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
alter table "bank_rates"."mart"."metal_prices_analytics__dbt_tmp" rename to "metal_prices_analytics"
[0m11:39:00.129160 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m11:39:00.131111 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: COMMIT
[0m11:39:00.131549 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m11:39:00.131927 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: COMMIT
[0m11:39:00.140440 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m11:39:00.143306 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m11:39:00.143777 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
drop table if exists "bank_rates"."mart"."metal_prices_analytics__dbt_backup" cascade
[0m11:39:00.147177 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m11:39:00.148892 [debug] [Thread-2 (]: Timing info for model.bank_rates.metal_prices_analytics (execute): 11:38:59.992340 => 11:39:00.148680
[0m11:39:00.149335 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: Close
[0m11:39:00.150162 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9e552a53-ba7d-4428-acc4-61c7c4743682', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf634d22e00>]}
[0m11:39:00.150832 [info ] [Thread-2 (]: 4 of 4 OK created sql table model mart.metal_prices_analytics .................. [[32mSELECT 16796[0m in 0.16s]
[0m11:39:00.151616 [debug] [Thread-2 (]: Finished running node model.bank_rates.metal_prices_analytics
[0m11:39:00.153221 [debug] [MainThread]: Using postgres connection "master"
[0m11:39:00.153563 [debug] [MainThread]: On master: BEGIN
[0m11:39:00.153816 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:39:00.162300 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m11:39:00.162693 [debug] [MainThread]: On master: COMMIT
[0m11:39:00.163006 [debug] [MainThread]: Using postgres connection "master"
[0m11:39:00.163319 [debug] [MainThread]: On master: COMMIT
[0m11:39:00.163731 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m11:39:00.164028 [debug] [MainThread]: On master: Close
[0m11:39:00.164844 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:39:00.165267 [debug] [MainThread]: Connection 'model.bank_rates.metal_prices_analytics' was properly closed.
[0m11:39:00.165588 [debug] [MainThread]: Connection 'model.bank_rates.fact_metal_prices' was properly closed.
[0m11:39:00.166008 [info ] [MainThread]: 
[0m11:39:00.166534 [info ] [MainThread]: Finished running 1 view model, 3 table models in 0 hours 0 minutes and 0.61 seconds (0.61s).
[0m11:39:00.167803 [debug] [MainThread]: Command end result
[0m11:39:00.174986 [info ] [MainThread]: 
[0m11:39:00.175466 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:39:00.175848 [info ] [MainThread]: 
[0m11:39:00.176267 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m11:39:00.176818 [debug] [MainThread]: Command `dbt run` succeeded at 11:39:00.176700 after 0.81 seconds
[0m11:39:00.177157 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf63777cf40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf635197c70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf634da7a30>]}
[0m11:39:00.177496 [debug] [MainThread]: Flushing usage events
[0m11:39:02.776009 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7697590f5000>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x769757baf8e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x769757baf970>]}


============================== 11:39:02.779405 | b9713eb2-3d94-4567-9555-4b8642657fe8 ==============================
[0m11:39:02.779405 [info ] [MainThread]: Running with dbt=1.5.0
[0m11:39:02.780170 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'fail_fast': 'False', 'static_parser': 'True', 'log_path': '/usr/app/logs', 'use_experimental_parser': 'False', 'quiet': 'False', 'use_colors': 'True', 'log_cache_events': 'False', 'debug': 'False', 'no_print': 'None', 'partial_parse': 'True', 'version_check': 'True', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'log_format': 'default', 'warn_error': 'None', 'profiles_dir': '/usr/app', 'target_path': 'None'}
[0m11:39:02.897666 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b9713eb2-3d94-4567-9555-4b8642657fe8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x769757a8be80>]}
[0m11:39:02.919178 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b9713eb2-3d94-4567-9555-4b8642657fe8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x769757ad65c0>]}
[0m11:39:02.930661 [debug] [MainThread]: checksum: 4568eb639a77b8fcb3a1f4a07856f42b1ff63f1376652889143968e1dbdafbda, vars: {}, profile: , target: , version: 1.5.0
[0m11:39:02.951668 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:39:02.952077 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:39:02.958218 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b9713eb2-3d94-4567-9555-4b8642657fe8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7697570b6560>]}
[0m11:39:02.964932 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b9713eb2-3d94-4567-9555-4b8642657fe8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x769757087700>]}
[0m11:39:02.965436 [info ] [MainThread]: Found 4 models, 3 tests, 0 snapshots, 0 analyses, 308 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m11:39:02.965805 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b9713eb2-3d94-4567-9555-4b8642657fe8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x769757087790>]}
[0m11:39:02.967548 [info ] [MainThread]: 
[0m11:39:02.968397 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m11:39:02.969820 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates_staging'
[0m11:39:02.970862 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates_dds'
[0m11:39:02.983776 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m11:39:02.986076 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m11:39:02.986511 [debug] [ThreadPool]: On list_bank_rates_staging: BEGIN
[0m11:39:02.986870 [debug] [ThreadPool]: On list_bank_rates_dds: BEGIN
[0m11:39:02.987219 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:39:02.987547 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:39:03.000760 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m11:39:03.001141 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m11:39:03.001563 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m11:39:03.001908 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m11:39:03.002266 [debug] [ThreadPool]: On list_bank_rates_staging: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_staging"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging'
  
[0m11:39:03.002604 [debug] [ThreadPool]: On list_bank_rates_dds: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_dds"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dds'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dds'
  
[0m11:39:03.006412 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m11:39:03.006721 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m11:39:03.008321 [debug] [ThreadPool]: On list_bank_rates_dds: ROLLBACK
[0m11:39:03.009760 [debug] [ThreadPool]: On list_bank_rates_staging: ROLLBACK
[0m11:39:03.010339 [debug] [ThreadPool]: On list_bank_rates_dds: Close
[0m11:39:03.010645 [debug] [ThreadPool]: On list_bank_rates_staging: Close
[0m11:39:03.011923 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates_dds, now list_bank_rates_mart)
[0m11:39:03.014879 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m11:39:03.015261 [debug] [ThreadPool]: On list_bank_rates_mart: BEGIN
[0m11:39:03.015873 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:39:03.024847 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m11:39:03.025293 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m11:39:03.025648 [debug] [ThreadPool]: On list_bank_rates_mart: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_mart"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'mart'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'mart'
  
[0m11:39:03.028414 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m11:39:03.029866 [debug] [ThreadPool]: On list_bank_rates_mart: ROLLBACK
[0m11:39:03.030313 [debug] [ThreadPool]: On list_bank_rates_mart: Close
[0m11:39:03.036388 [debug] [MainThread]: Using postgres connection "master"
[0m11:39:03.036740 [debug] [MainThread]: On master: BEGIN
[0m11:39:03.036993 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:39:03.045553 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m11:39:03.045973 [debug] [MainThread]: Using postgres connection "master"
[0m11:39:03.046371 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m11:39:03.051594 [debug] [MainThread]: SQL status: SELECT 3 in 0.0 seconds
[0m11:39:03.053195 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b9713eb2-3d94-4567-9555-4b8642657fe8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x769757084520>]}
[0m11:39:03.053706 [debug] [MainThread]: On master: ROLLBACK
[0m11:39:03.054236 [debug] [MainThread]: Using postgres connection "master"
[0m11:39:03.054552 [debug] [MainThread]: On master: BEGIN
[0m11:39:03.055198 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m11:39:03.055586 [debug] [MainThread]: On master: COMMIT
[0m11:39:03.055894 [debug] [MainThread]: Using postgres connection "master"
[0m11:39:03.056194 [debug] [MainThread]: On master: COMMIT
[0m11:39:03.056589 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m11:39:03.056888 [debug] [MainThread]: On master: Close
[0m11:39:03.057629 [info ] [MainThread]: Concurrency: 2 threads (target='dev')
[0m11:39:03.058085 [info ] [MainThread]: 
[0m11:39:03.062696 [debug] [Thread-1 (]: Began running node test.bank_rates.not_null_key_columns
[0m11:39:03.063157 [debug] [Thread-2 (]: Began running node test.bank_rates.positive_prices
[0m11:39:03.063651 [info ] [Thread-1 (]: 1 of 3 START test not_null_key_columns ......................................... [RUN]
[0m11:39:03.064239 [info ] [Thread-2 (]: 2 of 3 START test positive_prices .............................................. [RUN]
[0m11:39:03.065099 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_bank_rates_mart, now test.bank_rates.not_null_key_columns)
[0m11:39:03.065773 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_bank_rates_staging, now test.bank_rates.positive_prices)
[0m11:39:03.066209 [debug] [Thread-1 (]: Began compiling node test.bank_rates.not_null_key_columns
[0m11:39:03.066597 [debug] [Thread-2 (]: Began compiling node test.bank_rates.positive_prices
[0m11:39:03.069919 [debug] [Thread-1 (]: Writing injected SQL for node "test.bank_rates.not_null_key_columns"
[0m11:39:03.072783 [debug] [Thread-2 (]: Writing injected SQL for node "test.bank_rates.positive_prices"
[0m11:39:03.073669 [debug] [Thread-2 (]: Timing info for test.bank_rates.positive_prices (compile): 11:39:03.070251 => 11:39:03.073416
[0m11:39:03.074157 [debug] [Thread-1 (]: Timing info for test.bank_rates.not_null_key_columns (compile): 11:39:03.066853 => 11:39:03.073889
[0m11:39:03.074536 [debug] [Thread-2 (]: Began executing node test.bank_rates.positive_prices
[0m11:39:03.074929 [debug] [Thread-1 (]: Began executing node test.bank_rates.not_null_key_columns
[0m11:39:03.092754 [debug] [Thread-2 (]: Writing runtime sql for node "test.bank_rates.positive_prices"
[0m11:39:03.095394 [debug] [Thread-1 (]: Writing runtime sql for node "test.bank_rates.not_null_key_columns"
[0m11:39:03.096373 [debug] [Thread-1 (]: Using postgres connection "test.bank_rates.not_null_key_columns"
[0m11:39:03.096864 [debug] [Thread-2 (]: Using postgres connection "test.bank_rates.positive_prices"
[0m11:39:03.097253 [debug] [Thread-1 (]: On test.bank_rates.not_null_key_columns: BEGIN
[0m11:39:03.097654 [debug] [Thread-2 (]: On test.bank_rates.positive_prices: BEGIN
[0m11:39:03.098023 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:39:03.098422 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m11:39:03.111705 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m11:39:03.112233 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m11:39:03.112827 [debug] [Thread-2 (]: Using postgres connection "test.bank_rates.positive_prices"
[0m11:39:03.113475 [debug] [Thread-1 (]: Using postgres connection "test.bank_rates.not_null_key_columns"
[0m11:39:03.113974 [debug] [Thread-2 (]: On test.bank_rates.positive_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "test.bank_rates.positive_prices"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      SELECT 
    trade_date,
    metal_code,
    buy_price_rub,
    sell_price_rub
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
WHERE buy_price_rub <= 0 OR sell_price_rub <= 0
      
    ) dbt_internal_test
[0m11:39:03.114483 [debug] [Thread-1 (]: On test.bank_rates.not_null_key_columns: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "test.bank_rates.not_null_key_columns"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      SELECT 
    trade_date,
    metal_code
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
WHERE trade_date IS NULL 
   OR metal_code IS NULL 
   OR buy_price_rub IS NULL 
   OR sell_price_rub IS NULL
      
    ) dbt_internal_test
[0m11:39:03.137943 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m11:39:03.141493 [debug] [Thread-1 (]: Timing info for test.bank_rates.not_null_key_columns (execute): 11:39:03.093104 => 11:39:03.141190
[0m11:39:03.141974 [debug] [Thread-1 (]: On test.bank_rates.not_null_key_columns: ROLLBACK
[0m11:39:03.142402 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m11:39:03.144399 [debug] [Thread-2 (]: Timing info for test.bank_rates.positive_prices (execute): 11:39:03.075268 => 11:39:03.144157
[0m11:39:03.144821 [debug] [Thread-1 (]: On test.bank_rates.not_null_key_columns: Close
[0m11:39:03.145261 [debug] [Thread-2 (]: On test.bank_rates.positive_prices: ROLLBACK
[0m11:39:03.146708 [debug] [Thread-2 (]: On test.bank_rates.positive_prices: Close
[0m11:39:03.146299 [info ] [Thread-1 (]: 1 of 3 PASS not_null_key_columns ............................................... [[32mPASS[0m in 0.08s]
[0m11:39:03.147945 [info ] [Thread-2 (]: 2 of 3 PASS positive_prices .................................................... [[32mPASS[0m in 0.08s]
[0m11:39:03.148732 [debug] [Thread-1 (]: Finished running node test.bank_rates.not_null_key_columns
[0m11:39:03.149436 [debug] [Thread-2 (]: Finished running node test.bank_rates.positive_prices
[0m11:39:03.149990 [debug] [Thread-1 (]: Began running node test.bank_rates.unique_trade_date_metal_code
[0m11:39:03.150676 [info ] [Thread-1 (]: 3 of 3 START test unique_trade_date_metal_code ................................. [RUN]
[0m11:39:03.151422 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.bank_rates.not_null_key_columns, now test.bank_rates.unique_trade_date_metal_code)
[0m11:39:03.151815 [debug] [Thread-1 (]: Began compiling node test.bank_rates.unique_trade_date_metal_code
[0m11:39:03.155042 [debug] [Thread-1 (]: Writing injected SQL for node "test.bank_rates.unique_trade_date_metal_code"
[0m11:39:03.155754 [debug] [Thread-1 (]: Timing info for test.bank_rates.unique_trade_date_metal_code (compile): 11:39:03.152025 => 11:39:03.155526
[0m11:39:03.156119 [debug] [Thread-1 (]: Began executing node test.bank_rates.unique_trade_date_metal_code
[0m11:39:03.158638 [debug] [Thread-1 (]: Writing runtime sql for node "test.bank_rates.unique_trade_date_metal_code"
[0m11:39:03.159238 [debug] [Thread-1 (]: Using postgres connection "test.bank_rates.unique_trade_date_metal_code"
[0m11:39:03.159605 [debug] [Thread-1 (]: On test.bank_rates.unique_trade_date_metal_code: BEGIN
[0m11:39:03.159951 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:39:03.168455 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m11:39:03.168841 [debug] [Thread-1 (]: Using postgres connection "test.bank_rates.unique_trade_date_metal_code"
[0m11:39:03.169197 [debug] [Thread-1 (]: On test.bank_rates.unique_trade_date_metal_code: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "test.bank_rates.unique_trade_date_metal_code"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      SELECT 
    trade_date,
    metal_code,
    COUNT(*) as count
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
GROUP BY trade_date, metal_code
HAVING COUNT(*) > 1
      
    ) dbt_internal_test
[0m11:39:03.193408 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m11:39:03.195439 [debug] [Thread-1 (]: Timing info for test.bank_rates.unique_trade_date_metal_code (execute): 11:39:03.156364 => 11:39:03.195147
[0m11:39:03.195869 [debug] [Thread-1 (]: On test.bank_rates.unique_trade_date_metal_code: ROLLBACK
[0m11:39:03.196422 [debug] [Thread-1 (]: On test.bank_rates.unique_trade_date_metal_code: Close
[0m11:39:03.197617 [info ] [Thread-1 (]: 3 of 3 PASS unique_trade_date_metal_code ....................................... [[32mPASS[0m in 0.05s]
[0m11:39:03.198490 [debug] [Thread-1 (]: Finished running node test.bank_rates.unique_trade_date_metal_code
[0m11:39:03.200536 [debug] [MainThread]: Using postgres connection "master"
[0m11:39:03.200914 [debug] [MainThread]: On master: BEGIN
[0m11:39:03.201288 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:39:03.209781 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m11:39:03.210295 [debug] [MainThread]: On master: COMMIT
[0m11:39:03.210725 [debug] [MainThread]: Using postgres connection "master"
[0m11:39:03.211148 [debug] [MainThread]: On master: COMMIT
[0m11:39:03.211731 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m11:39:03.212184 [debug] [MainThread]: On master: Close
[0m11:39:03.213136 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:39:03.213554 [debug] [MainThread]: Connection 'test.bank_rates.positive_prices' was properly closed.
[0m11:39:03.213916 [debug] [MainThread]: Connection 'test.bank_rates.unique_trade_date_metal_code' was properly closed.
[0m11:39:03.214387 [info ] [MainThread]: 
[0m11:39:03.214897 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 0.25 seconds (0.25s).
[0m11:39:03.216156 [debug] [MainThread]: Command end result
[0m11:39:03.221994 [info ] [MainThread]: 
[0m11:39:03.222563 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:39:03.223064 [info ] [MainThread]: 
[0m11:39:03.223519 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m11:39:03.224246 [debug] [MainThread]: Command `dbt test` succeeded at 11:39:03.224114 after 0.46 seconds
[0m11:39:03.224636 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7697590f5000>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x769757ad65c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7697570877f0>]}
[0m11:39:03.225045 [debug] [MainThread]: Flushing usage events
[0m12:20:22.882423 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ec7ee3a10c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ec7ecddf9a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ec7ecddfa30>]}


============================== 12:20:22.885869 | a3632d2a-19ba-4bc7-8b80-ef1a92f8f97d ==============================
[0m12:20:22.885869 [info ] [MainThread]: Running with dbt=1.5.0
[0m12:20:22.886510 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'profiles_dir': '.', 'log_cache_events': 'False', 'static_parser': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'version_check': 'True', 'printer_width': '80', 'quiet': 'False', 'log_path': '/usr/app/logs', 'no_print': 'None', 'indirect_selection': 'eager', 'debug': 'False', 'introspect': 'True', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'write_json': 'True', 'partial_parse': 'True', 'warn_error': 'None', 'fail_fast': 'False', 'log_format': 'default'}
[0m12:20:23.000189 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a3632d2a-19ba-4bc7-8b80-ef1a92f8f97d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ec7ecddfb80>]}
[0m12:20:23.022273 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a3632d2a-19ba-4bc7-8b80-ef1a92f8f97d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ec7eccfdd20>]}
[0m12:20:23.034874 [debug] [MainThread]: checksum: 4568eb639a77b8fcb3a1f4a07856f42b1ff63f1376652889143968e1dbdafbda, vars: {}, profile: , target: , version: 1.5.0
[0m12:20:23.058708 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:20:23.059208 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:20:23.066075 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a3632d2a-19ba-4bc7-8b80-ef1a92f8f97d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ec7ebd82620>]}
[0m12:20:23.073418 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a3632d2a-19ba-4bc7-8b80-ef1a92f8f97d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ec7ebd537c0>]}
[0m12:20:23.073966 [info ] [MainThread]: Found 4 models, 3 tests, 0 snapshots, 0 analyses, 308 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m12:20:23.074426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a3632d2a-19ba-4bc7-8b80-ef1a92f8f97d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ec7ebd53850>]}
[0m12:20:23.076079 [info ] [MainThread]: 
[0m12:20:23.076918 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:20:23.078515 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m12:20:23.089905 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m12:20:23.091992 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m12:20:23.094126 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m12:20:23.094570 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m12:20:23.094951 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m12:20:23.095327 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:20:23.095663 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:20:23.110737 [debug] [ThreadPool]: SQL status: SELECT 11 in 0.0 seconds
[0m12:20:23.111231 [debug] [ThreadPool]: SQL status: SELECT 11 in 0.0 seconds
[0m12:20:23.112938 [debug] [ThreadPool]: On list_bank_rates: Close
[0m12:20:23.114375 [debug] [ThreadPool]: On list_bank_rates: Close
[0m12:20:23.118454 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m12:20:23.119333 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m12:20:23.119674 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:20:23.129040 [debug] [ThreadPool]: SQL status: SELECT 11 in 0.0 seconds
[0m12:20:23.130601 [debug] [ThreadPool]: On list_bank_rates: Close
[0m12:20:23.132592 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates, now list_bank_rates_staging)
[0m12:20:23.139435 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m12:20:23.140149 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates, now list_bank_rates_dds)
[0m12:20:23.141484 [debug] [ThreadPool]: On list_bank_rates_staging: BEGIN
[0m12:20:23.143469 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m12:20:23.143861 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:20:23.144239 [debug] [ThreadPool]: On list_bank_rates_dds: BEGIN
[0m12:20:23.144760 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:20:23.154559 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m12:20:23.155065 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m12:20:23.155457 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m12:20:23.155831 [debug] [ThreadPool]: On list_bank_rates_staging: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_staging"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging'
  
[0m12:20:23.156226 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m12:20:23.156707 [debug] [ThreadPool]: On list_bank_rates_dds: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_dds"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dds'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dds'
  
[0m12:20:23.160003 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m12:20:23.160378 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m12:20:23.161842 [debug] [ThreadPool]: On list_bank_rates_dds: ROLLBACK
[0m12:20:23.163273 [debug] [ThreadPool]: On list_bank_rates_staging: ROLLBACK
[0m12:20:23.163832 [debug] [ThreadPool]: On list_bank_rates_dds: Close
[0m12:20:23.164149 [debug] [ThreadPool]: On list_bank_rates_staging: Close
[0m12:20:23.165286 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates_dds, now list_bank_rates_mart)
[0m12:20:23.168084 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m12:20:23.169153 [debug] [ThreadPool]: On list_bank_rates_mart: BEGIN
[0m12:20:23.169478 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:20:23.177820 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m12:20:23.178281 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m12:20:23.178630 [debug] [ThreadPool]: On list_bank_rates_mart: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_mart"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'mart'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'mart'
  
[0m12:20:23.181251 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m12:20:23.182656 [debug] [ThreadPool]: On list_bank_rates_mart: ROLLBACK
[0m12:20:23.183150 [debug] [ThreadPool]: On list_bank_rates_mart: Close
[0m12:20:23.188672 [debug] [MainThread]: Using postgres connection "master"
[0m12:20:23.189041 [debug] [MainThread]: On master: BEGIN
[0m12:20:23.189382 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:20:23.197708 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:20:23.198112 [debug] [MainThread]: Using postgres connection "master"
[0m12:20:23.198621 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:20:23.203706 [debug] [MainThread]: SQL status: SELECT 3 in 0.0 seconds
[0m12:20:23.205223 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a3632d2a-19ba-4bc7-8b80-ef1a92f8f97d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ec7ebd77a00>]}
[0m12:20:23.205726 [debug] [MainThread]: On master: ROLLBACK
[0m12:20:23.206260 [debug] [MainThread]: Using postgres connection "master"
[0m12:20:23.206581 [debug] [MainThread]: On master: BEGIN
[0m12:20:23.207160 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:20:23.207506 [debug] [MainThread]: On master: COMMIT
[0m12:20:23.207773 [debug] [MainThread]: Using postgres connection "master"
[0m12:20:23.208014 [debug] [MainThread]: On master: COMMIT
[0m12:20:23.208516 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m12:20:23.208822 [debug] [MainThread]: On master: Close
[0m12:20:23.209685 [info ] [MainThread]: Concurrency: 2 threads (target='dev')
[0m12:20:23.210250 [info ] [MainThread]: 
[0m12:20:23.214200 [debug] [Thread-1 (]: Began running node model.bank_rates.stg_cbr_precious_metals
[0m12:20:23.214768 [info ] [Thread-1 (]: 1 of 4 START sql view model staging.stg_cbr_precious_metals .................... [RUN]
[0m12:20:23.215494 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_bank_rates_mart, now model.bank_rates.stg_cbr_precious_metals)
[0m12:20:23.215866 [debug] [Thread-1 (]: Began compiling node model.bank_rates.stg_cbr_precious_metals
[0m12:20:23.219313 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_rates.stg_cbr_precious_metals"
[0m12:20:23.220027 [debug] [Thread-1 (]: Timing info for model.bank_rates.stg_cbr_precious_metals (compile): 12:20:23.216094 => 12:20:23.219779
[0m12:20:23.220450 [debug] [Thread-1 (]: Began executing node model.bank_rates.stg_cbr_precious_metals
[0m12:20:23.268168 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_rates.stg_cbr_precious_metals"
[0m12:20:23.269154 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m12:20:23.269666 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: BEGIN
[0m12:20:23.270090 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:20:23.282373 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m12:20:23.283013 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m12:20:23.283516 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */

  create view "bank_rates"."staging"."stg_cbr_precious_metals__dbt_tmp"
    
    
  as (
    

WITH ranked_data AS (
    SELECT 
        id,
        record_date::DATE as trade_date,
        metal_code::INTEGER as metal_code,
        buy_price::DECIMAL(10,2) as buy_price_rub,
        sell_price::DECIMAL(10,2) as sell_price_rub,
        from_date::DATE as valid_from,
        to_date::DATE as valid_to,
        load_timestamp::TIMESTAMP as loaded_at,
        -- Ð’Ñ‹Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÑŽÑŽ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÑƒ Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð´Ð½Ñ Ð¸ Ð¼ÐµÑ‚Ð°Ð»Ð»Ð°
        ROW_NUMBER() OVER (
            PARTITION BY record_date, metal_code 
            ORDER BY load_timestamp DESC
        ) as rn
    FROM raw.cbr_precious_metals
    WHERE record_date IS NOT NULL
      AND metal_code IS NOT NULL
      AND buy_price IS NOT NULL
)
SELECT 
    trade_date,
    metal_code,
    CASE 
        WHEN metal_code = 1 THEN 'Ð—Ð¾Ð»Ð¾Ñ‚Ð¾'
        WHEN metal_code = 2 THEN 'Ð¡ÐµÑ€ÐµÐ±Ñ€Ð¾'
        WHEN metal_code = 3 THEN 'ÐŸÐ»Ð°Ñ‚Ð¸Ð½Ð°'
        WHEN metal_code = 4 THEN 'ÐŸÐ°Ð»Ð»Ð°Ð´Ð¸Ð¹'
        ELSE 'ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ð¹ Ð¼ÐµÑ‚Ð°Ð»Ð»'
    END as metal_name,
    buy_price_rub,
    sell_price_rub,
    valid_from,
    valid_to,
    loaded_at
FROM ranked_data
WHERE rn = 1
  );
[0m12:20:23.286681 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.0 seconds
[0m12:20:23.294289 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m12:20:23.294780 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
alter table "bank_rates"."staging"."stg_cbr_precious_metals" rename to "stg_cbr_precious_metals__dbt_backup"
[0m12:20:23.295729 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:20:23.299152 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m12:20:23.299663 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
alter table "bank_rates"."staging"."stg_cbr_precious_metals__dbt_tmp" rename to "stg_cbr_precious_metals"
[0m12:20:23.300481 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:20:23.323594 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: COMMIT
[0m12:20:23.324238 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m12:20:23.324667 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: COMMIT
[0m12:20:23.327433 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m12:20:23.333482 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m12:20:23.333964 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
drop view if exists "bank_rates"."staging"."stg_cbr_precious_metals__dbt_backup" cascade
[0m12:20:23.336494 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.0 seconds
[0m12:20:23.338428 [debug] [Thread-1 (]: Timing info for model.bank_rates.stg_cbr_precious_metals (execute): 12:20:23.220654 => 12:20:23.338190
[0m12:20:23.338878 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: Close
[0m12:20:23.340078 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a3632d2a-19ba-4bc7-8b80-ef1a92f8f97d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ec7eb9583a0>]}
[0m12:20:23.340828 [info ] [Thread-1 (]: 1 of 4 OK created sql view model staging.stg_cbr_precious_metals ............... [[32mCREATE VIEW[0m in 0.12s]
[0m12:20:23.341623 [debug] [Thread-1 (]: Finished running node model.bank_rates.stg_cbr_precious_metals
[0m12:20:23.342861 [debug] [Thread-2 (]: Began running node model.bank_rates.dim_metals
[0m12:20:23.343292 [debug] [Thread-1 (]: Began running node model.bank_rates.fact_metal_prices
[0m12:20:23.343806 [info ] [Thread-2 (]: 2 of 4 START sql table model dds.dim_metals .................................... [RUN]
[0m12:20:23.344428 [info ] [Thread-1 (]: 3 of 4 START sql table model dds.fact_metal_prices ............................. [RUN]
[0m12:20:23.345225 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_bank_rates_staging, now model.bank_rates.dim_metals)
[0m12:20:23.345925 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.bank_rates.stg_cbr_precious_metals, now model.bank_rates.fact_metal_prices)
[0m12:20:23.346412 [debug] [Thread-2 (]: Began compiling node model.bank_rates.dim_metals
[0m12:20:23.346813 [debug] [Thread-1 (]: Began compiling node model.bank_rates.fact_metal_prices
[0m12:20:23.350675 [debug] [Thread-2 (]: Writing injected SQL for node "model.bank_rates.dim_metals"
[0m12:20:23.354038 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_rates.fact_metal_prices"
[0m12:20:23.354994 [debug] [Thread-1 (]: Timing info for model.bank_rates.fact_metal_prices (compile): 12:20:23.351024 => 12:20:23.354714
[0m12:20:23.355542 [debug] [Thread-2 (]: Timing info for model.bank_rates.dim_metals (compile): 12:20:23.347093 => 12:20:23.355289
[0m12:20:23.355949 [debug] [Thread-1 (]: Began executing node model.bank_rates.fact_metal_prices
[0m12:20:23.356401 [debug] [Thread-2 (]: Began executing node model.bank_rates.dim_metals
[0m12:20:23.387162 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_rates.fact_metal_prices"
[0m12:20:23.391320 [debug] [Thread-2 (]: Writing runtime sql for node "model.bank_rates.dim_metals"
[0m12:20:23.392294 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m12:20:23.392746 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m12:20:23.393176 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: BEGIN
[0m12:20:23.393623 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: BEGIN
[0m12:20:23.394047 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:20:23.394484 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m12:20:23.405194 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m12:20:23.405699 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m12:20:23.406229 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m12:20:23.406690 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m12:20:23.407144 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */

  
    

  create  table "bank_rates"."dds"."dim_metals__dbt_tmp"
  
  
    as
  
  (
    

SELECT DISTINCT
    metal_code,
    metal_name
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
WHERE metal_code IS NOT NULL
  );
  
[0m12:20:23.407598 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */

  
    

  create  table "bank_rates"."dds"."fact_metal_prices__dbt_tmp"
  
  
    as
  
  (
    

SELECT 
    ROW_NUMBER() OVER (ORDER BY trade_date, metal_code) as price_id,
    trade_date,
    metal_code,
    metal_name,
    buy_price_rub,
    sell_price_rub,
    loaded_at,
    CURRENT_TIMESTAMP as dwh_loaded_at
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
WHERE trade_date IS NOT NULL
  AND metal_code IS NOT NULL
  );
  
[0m12:20:23.435219 [debug] [Thread-2 (]: SQL status: SELECT 4 in 0.0 seconds
[0m12:20:23.440917 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m12:20:23.441424 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
alter table "bank_rates"."dds"."dim_metals" rename to "dim_metals__dbt_backup"
[0m12:20:23.442251 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:20:23.445425 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m12:20:23.445839 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
alter table "bank_rates"."dds"."dim_metals__dbt_tmp" rename to "dim_metals"
[0m12:20:23.446639 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:20:23.453178 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: COMMIT
[0m12:20:23.453608 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m12:20:23.454016 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: COMMIT
[0m12:20:23.456725 [debug] [Thread-1 (]: SQL status: SELECT 16796 in 0.0 seconds
[0m12:20:23.461533 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m12:20:23.462338 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
alter table "bank_rates"."dds"."fact_metal_prices" rename to "fact_metal_prices__dbt_backup"
[0m12:20:23.462762 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m12:20:23.465718 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m12:20:23.466276 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:20:23.466873 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
drop table if exists "bank_rates"."dds"."dim_metals__dbt_backup" cascade
[0m12:20:23.470277 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m12:20:23.470866 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
alter table "bank_rates"."dds"."fact_metal_prices__dbt_tmp" rename to "fact_metal_prices"
[0m12:20:23.471722 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:20:23.473682 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: COMMIT
[0m12:20:23.474153 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m12:20:23.474552 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: COMMIT
[0m12:20:23.477917 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m12:20:23.479661 [debug] [Thread-2 (]: Timing info for model.bank_rates.dim_metals (execute): 12:20:23.377573 => 12:20:23.479444
[0m12:20:23.480081 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m12:20:23.480466 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: Close
[0m12:20:23.483179 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m12:20:23.483718 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
drop table if exists "bank_rates"."dds"."fact_metal_prices__dbt_backup" cascade
[0m12:20:23.484558 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a3632d2a-19ba-4bc7-8b80-ef1a92f8f97d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ec7eb98f640>]}
[0m12:20:23.485352 [info ] [Thread-2 (]: 2 of 4 OK created sql table model dds.dim_metals ............................... [[32mSELECT 4[0m in 0.14s]
[0m12:20:23.486177 [debug] [Thread-2 (]: Finished running node model.bank_rates.dim_metals
[0m12:20:23.493780 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m12:20:23.495565 [debug] [Thread-1 (]: Timing info for model.bank_rates.fact_metal_prices (execute): 12:20:23.356673 => 12:20:23.495324
[0m12:20:23.495986 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: Close
[0m12:20:23.496989 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a3632d2a-19ba-4bc7-8b80-ef1a92f8f97d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ec7eb9a8ee0>]}
[0m12:20:23.497866 [info ] [Thread-1 (]: 3 of 4 OK created sql table model dds.fact_metal_prices ........................ [[32mSELECT 16796[0m in 0.15s]
[0m12:20:23.498775 [debug] [Thread-1 (]: Finished running node model.bank_rates.fact_metal_prices
[0m12:20:23.499911 [debug] [Thread-2 (]: Began running node model.bank_rates.metal_prices_analytics
[0m12:20:23.500519 [info ] [Thread-2 (]: 4 of 4 START sql table model mart.metal_prices_analytics ....................... [RUN]
[0m12:20:23.501242 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bank_rates.dim_metals, now model.bank_rates.metal_prices_analytics)
[0m12:20:23.501708 [debug] [Thread-2 (]: Began compiling node model.bank_rates.metal_prices_analytics
[0m12:20:23.505367 [debug] [Thread-2 (]: Writing injected SQL for node "model.bank_rates.metal_prices_analytics"
[0m12:20:23.506156 [debug] [Thread-2 (]: Timing info for model.bank_rates.metal_prices_analytics (compile): 12:20:23.501932 => 12:20:23.505870
[0m12:20:23.506560 [debug] [Thread-2 (]: Began executing node model.bank_rates.metal_prices_analytics
[0m12:20:23.510751 [debug] [Thread-2 (]: Writing runtime sql for node "model.bank_rates.metal_prices_analytics"
[0m12:20:23.511487 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m12:20:23.511938 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: BEGIN
[0m12:20:23.512332 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m12:20:23.520729 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m12:20:23.521170 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m12:20:23.521659 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */

  
    

  create  table "bank_rates"."mart"."metal_prices_analytics__dbt_tmp"
  
  
    as
  
  (
    

SELECT 
    f.trade_date,
    f.metal_name,
    f.buy_price_rub,
    f.sell_price_rub,
    ROUND((f.buy_price_rub + f.sell_price_rub) / 2, 2) as avg_price_rub,
    LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) as prev_buy_price,
    LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) as prev_sell_price,
    CASE 
        WHEN LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) IS NOT NULL 
        THEN ROUND((f.buy_price_rub - LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date)) / 
                   LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) * 100, 2)
        ELSE NULL 
    END as buy_price_change_percent,
    CASE 
        WHEN LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) IS NOT NULL 
        THEN ROUND((f.sell_price_rub - LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date)) / 
                   LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) * 100, 2)
        ELSE NULL 
    END as sell_price_change_percent
FROM "bank_rates"."dds"."fact_metal_prices" f
ORDER BY f.trade_date DESC, f.metal_name
  );
  
[0m12:20:23.594257 [debug] [Thread-2 (]: SQL status: SELECT 16796 in 0.0 seconds
[0m12:20:23.598097 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m12:20:23.598607 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
alter table "bank_rates"."mart"."metal_prices_analytics" rename to "metal_prices_analytics__dbt_backup"
[0m12:20:23.599438 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:20:23.602990 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m12:20:23.603461 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
alter table "bank_rates"."mart"."metal_prices_analytics__dbt_tmp" rename to "metal_prices_analytics"
[0m12:20:23.604197 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:20:23.606250 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: COMMIT
[0m12:20:23.606690 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m12:20:23.607030 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: COMMIT
[0m12:20:23.617245 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m12:20:23.620233 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m12:20:23.620695 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
drop table if exists "bank_rates"."mart"."metal_prices_analytics__dbt_backup" cascade
[0m12:20:23.629492 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m12:20:23.631286 [debug] [Thread-2 (]: Timing info for model.bank_rates.metal_prices_analytics (execute): 12:20:23.506790 => 12:20:23.631023
[0m12:20:23.631677 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: Close
[0m12:20:23.632655 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a3632d2a-19ba-4bc7-8b80-ef1a92f8f97d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ec7eb91b9d0>]}
[0m12:20:23.633542 [info ] [Thread-2 (]: 4 of 4 OK created sql table model mart.metal_prices_analytics .................. [[32mSELECT 16796[0m in 0.13s]
[0m12:20:23.634437 [debug] [Thread-2 (]: Finished running node model.bank_rates.metal_prices_analytics
[0m12:20:23.636221 [debug] [MainThread]: Using postgres connection "master"
[0m12:20:23.636572 [debug] [MainThread]: On master: BEGIN
[0m12:20:23.636841 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:20:23.645434 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:20:23.645837 [debug] [MainThread]: On master: COMMIT
[0m12:20:23.646224 [debug] [MainThread]: Using postgres connection "master"
[0m12:20:23.646622 [debug] [MainThread]: On master: COMMIT
[0m12:20:23.647144 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m12:20:23.647470 [debug] [MainThread]: On master: Close
[0m12:20:23.648232 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:20:23.648524 [debug] [MainThread]: Connection 'model.bank_rates.fact_metal_prices' was properly closed.
[0m12:20:23.648784 [debug] [MainThread]: Connection 'model.bank_rates.metal_prices_analytics' was properly closed.
[0m12:20:23.649252 [info ] [MainThread]: 
[0m12:20:23.649673 [info ] [MainThread]: Finished running 1 view model, 3 table models in 0 hours 0 minutes and 0.57 seconds (0.57s).
[0m12:20:23.650873 [debug] [MainThread]: Command end result
[0m12:20:23.658544 [info ] [MainThread]: 
[0m12:20:23.659106 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:20:23.659492 [info ] [MainThread]: 
[0m12:20:23.659895 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m12:20:23.660465 [debug] [MainThread]: Command `dbt run` succeeded at 12:20:23.660341 after 0.79 seconds
[0m12:20:23.660832 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ec7ee3a10c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ec7eccfdd20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ec7eb9e6230>]}
[0m12:20:23.661245 [debug] [MainThread]: Flushing usage events
[0m12:20:26.216510 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d2a6a5519f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d2a68fafa90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d2a68fafb20>]}


============================== 12:20:26.219885 | caa3eeda-4974-499a-b606-fc834b877eae ==============================
[0m12:20:26.219885 [info ] [MainThread]: Running with dbt=1.5.0
[0m12:20:26.220459 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'write_json': 'True', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'version_check': 'True', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'profiles_dir': '.', 'printer_width': '80', 'log_path': '/usr/app/logs', 'no_print': 'None', 'log_format': 'default', 'fail_fast': 'False', 'introspect': 'True', 'use_colors': 'True', 'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'quiet': 'False', 'target_path': 'None', 'static_parser': 'True'}
[0m12:20:26.333152 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'caa3eeda-4974-499a-b606-fc834b877eae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d2a68fafc70>]}
[0m12:20:26.355102 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'caa3eeda-4974-499a-b606-fc834b877eae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d2a68ed6f50>]}
[0m12:20:26.366907 [debug] [MainThread]: checksum: 4568eb639a77b8fcb3a1f4a07856f42b1ff63f1376652889143968e1dbdafbda, vars: {}, profile: , target: , version: 1.5.0
[0m12:20:26.388810 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:20:26.389277 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:20:26.395689 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'caa3eeda-4974-499a-b606-fc834b877eae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d2a67f52710>]}
[0m12:20:26.402426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'caa3eeda-4974-499a-b606-fc834b877eae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d2a67f238b0>]}
[0m12:20:26.402951 [info ] [MainThread]: Found 4 models, 3 tests, 0 snapshots, 0 analyses, 308 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m12:20:26.403384 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'caa3eeda-4974-499a-b606-fc834b877eae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d2a67f23940>]}
[0m12:20:26.405035 [info ] [MainThread]: 
[0m12:20:26.405868 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:20:26.407430 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates_mart'
[0m12:20:26.418822 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates_staging'
[0m12:20:26.420864 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m12:20:26.423168 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m12:20:26.423598 [debug] [ThreadPool]: On list_bank_rates_mart: BEGIN
[0m12:20:26.424000 [debug] [ThreadPool]: On list_bank_rates_staging: BEGIN
[0m12:20:26.424440 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:20:26.424826 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:20:26.439152 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m12:20:26.439632 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m12:20:26.440126 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m12:20:26.440577 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m12:20:26.441089 [debug] [ThreadPool]: On list_bank_rates_staging: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_staging"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging'
  
[0m12:20:26.441505 [debug] [ThreadPool]: On list_bank_rates_mart: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_mart"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'mart'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'mart'
  
[0m12:20:26.445573 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m12:20:26.445965 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m12:20:26.447576 [debug] [ThreadPool]: On list_bank_rates_staging: ROLLBACK
[0m12:20:26.449127 [debug] [ThreadPool]: On list_bank_rates_mart: ROLLBACK
[0m12:20:26.449754 [debug] [ThreadPool]: On list_bank_rates_staging: Close
[0m12:20:26.450145 [debug] [ThreadPool]: On list_bank_rates_mart: Close
[0m12:20:26.451350 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates_staging, now list_bank_rates_dds)
[0m12:20:26.455307 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m12:20:26.455956 [debug] [ThreadPool]: On list_bank_rates_dds: BEGIN
[0m12:20:26.456306 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:20:26.464391 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m12:20:26.464834 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m12:20:26.465206 [debug] [ThreadPool]: On list_bank_rates_dds: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_dds"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dds'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dds'
  
[0m12:20:26.467773 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m12:20:26.469134 [debug] [ThreadPool]: On list_bank_rates_dds: ROLLBACK
[0m12:20:26.469593 [debug] [ThreadPool]: On list_bank_rates_dds: Close
[0m12:20:26.475486 [debug] [MainThread]: Using postgres connection "master"
[0m12:20:26.475872 [debug] [MainThread]: On master: BEGIN
[0m12:20:26.476239 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:20:26.485093 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:20:26.485479 [debug] [MainThread]: Using postgres connection "master"
[0m12:20:26.485926 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:20:26.490963 [debug] [MainThread]: SQL status: SELECT 3 in 0.0 seconds
[0m12:20:26.492857 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'caa3eeda-4974-499a-b606-fc834b877eae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d2a67f45600>]}
[0m12:20:26.493401 [debug] [MainThread]: On master: ROLLBACK
[0m12:20:26.493944 [debug] [MainThread]: Using postgres connection "master"
[0m12:20:26.494294 [debug] [MainThread]: On master: BEGIN
[0m12:20:26.494835 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:20:26.495276 [debug] [MainThread]: On master: COMMIT
[0m12:20:26.495665 [debug] [MainThread]: Using postgres connection "master"
[0m12:20:26.495985 [debug] [MainThread]: On master: COMMIT
[0m12:20:26.496542 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m12:20:26.497082 [debug] [MainThread]: On master: Close
[0m12:20:26.498403 [info ] [MainThread]: Concurrency: 2 threads (target='dev')
[0m12:20:26.499018 [info ] [MainThread]: 
[0m12:20:26.504781 [debug] [Thread-1 (]: Began running node test.bank_rates.not_null_key_columns
[0m12:20:26.505354 [debug] [Thread-2 (]: Began running node test.bank_rates.positive_prices
[0m12:20:26.505958 [info ] [Thread-1 (]: 1 of 3 START test not_null_key_columns ......................................... [RUN]
[0m12:20:26.506676 [info ] [Thread-2 (]: 2 of 3 START test positive_prices .............................................. [RUN]
[0m12:20:26.507650 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_bank_rates_dds, now test.bank_rates.not_null_key_columns)
[0m12:20:26.508442 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_bank_rates_mart, now test.bank_rates.positive_prices)
[0m12:20:26.508957 [debug] [Thread-1 (]: Began compiling node test.bank_rates.not_null_key_columns
[0m12:20:26.509495 [debug] [Thread-2 (]: Began compiling node test.bank_rates.positive_prices
[0m12:20:26.514471 [debug] [Thread-1 (]: Writing injected SQL for node "test.bank_rates.not_null_key_columns"
[0m12:20:26.517651 [debug] [Thread-2 (]: Writing injected SQL for node "test.bank_rates.positive_prices"
[0m12:20:26.518598 [debug] [Thread-2 (]: Timing info for test.bank_rates.positive_prices (compile): 12:20:26.514890 => 12:20:26.518325
[0m12:20:26.519200 [debug] [Thread-1 (]: Timing info for test.bank_rates.not_null_key_columns (compile): 12:20:26.509793 => 12:20:26.518859
[0m12:20:26.519575 [debug] [Thread-2 (]: Began executing node test.bank_rates.positive_prices
[0m12:20:26.520085 [debug] [Thread-1 (]: Began executing node test.bank_rates.not_null_key_columns
[0m12:20:26.538401 [debug] [Thread-2 (]: Writing runtime sql for node "test.bank_rates.positive_prices"
[0m12:20:26.540878 [debug] [Thread-1 (]: Writing runtime sql for node "test.bank_rates.not_null_key_columns"
[0m12:20:26.541788 [debug] [Thread-1 (]: Using postgres connection "test.bank_rates.not_null_key_columns"
[0m12:20:26.542274 [debug] [Thread-2 (]: Using postgres connection "test.bank_rates.positive_prices"
[0m12:20:26.542739 [debug] [Thread-1 (]: On test.bank_rates.not_null_key_columns: BEGIN
[0m12:20:26.543178 [debug] [Thread-2 (]: On test.bank_rates.positive_prices: BEGIN
[0m12:20:26.543592 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:20:26.543989 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m12:20:26.555158 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m12:20:26.555915 [debug] [Thread-1 (]: Using postgres connection "test.bank_rates.not_null_key_columns"
[0m12:20:26.556540 [debug] [Thread-1 (]: On test.bank_rates.not_null_key_columns: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "test.bank_rates.not_null_key_columns"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      SELECT 
    trade_date,
    metal_code
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
WHERE trade_date IS NULL 
   OR metal_code IS NULL 
   OR buy_price_rub IS NULL 
   OR sell_price_rub IS NULL
      
    ) dbt_internal_test
[0m12:20:26.557481 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m12:20:26.558047 [debug] [Thread-2 (]: Using postgres connection "test.bank_rates.positive_prices"
[0m12:20:26.558653 [debug] [Thread-2 (]: On test.bank_rates.positive_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "test.bank_rates.positive_prices"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      SELECT 
    trade_date,
    metal_code,
    buy_price_rub,
    sell_price_rub
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
WHERE buy_price_rub <= 0 OR sell_price_rub <= 0
      
    ) dbt_internal_test
[0m12:20:26.589450 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m12:20:26.592471 [debug] [Thread-1 (]: Timing info for test.bank_rates.not_null_key_columns (execute): 12:20:26.538718 => 12:20:26.592171
[0m12:20:26.592960 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m12:20:26.593424 [debug] [Thread-1 (]: On test.bank_rates.not_null_key_columns: ROLLBACK
[0m12:20:26.595087 [debug] [Thread-2 (]: Timing info for test.bank_rates.positive_prices (execute): 12:20:26.520380 => 12:20:26.594810
[0m12:20:26.595851 [debug] [Thread-2 (]: On test.bank_rates.positive_prices: ROLLBACK
[0m12:20:26.596268 [debug] [Thread-1 (]: On test.bank_rates.not_null_key_columns: Close
[0m12:20:26.596845 [debug] [Thread-2 (]: On test.bank_rates.positive_prices: Close
[0m12:20:26.597794 [info ] [Thread-1 (]: 1 of 3 PASS not_null_key_columns ............................................... [[32mPASS[0m in 0.09s]
[0m12:20:26.599024 [info ] [Thread-2 (]: 2 of 3 PASS positive_prices .................................................... [[32mPASS[0m in 0.09s]
[0m12:20:26.599984 [debug] [Thread-1 (]: Finished running node test.bank_rates.not_null_key_columns
[0m12:20:26.600727 [debug] [Thread-2 (]: Finished running node test.bank_rates.positive_prices
[0m12:20:26.601262 [debug] [Thread-1 (]: Began running node test.bank_rates.unique_trade_date_metal_code
[0m12:20:26.602016 [info ] [Thread-1 (]: 3 of 3 START test unique_trade_date_metal_code ................................. [RUN]
[0m12:20:26.602801 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.bank_rates.not_null_key_columns, now test.bank_rates.unique_trade_date_metal_code)
[0m12:20:26.603213 [debug] [Thread-1 (]: Began compiling node test.bank_rates.unique_trade_date_metal_code
[0m12:20:26.606507 [debug] [Thread-1 (]: Writing injected SQL for node "test.bank_rates.unique_trade_date_metal_code"
[0m12:20:26.607228 [debug] [Thread-1 (]: Timing info for test.bank_rates.unique_trade_date_metal_code (compile): 12:20:26.603454 => 12:20:26.606963
[0m12:20:26.607593 [debug] [Thread-1 (]: Began executing node test.bank_rates.unique_trade_date_metal_code
[0m12:20:26.610117 [debug] [Thread-1 (]: Writing runtime sql for node "test.bank_rates.unique_trade_date_metal_code"
[0m12:20:26.610741 [debug] [Thread-1 (]: Using postgres connection "test.bank_rates.unique_trade_date_metal_code"
[0m12:20:26.611163 [debug] [Thread-1 (]: On test.bank_rates.unique_trade_date_metal_code: BEGIN
[0m12:20:26.611526 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:20:26.620582 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m12:20:26.621070 [debug] [Thread-1 (]: Using postgres connection "test.bank_rates.unique_trade_date_metal_code"
[0m12:20:26.621476 [debug] [Thread-1 (]: On test.bank_rates.unique_trade_date_metal_code: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "test.bank_rates.unique_trade_date_metal_code"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      SELECT 
    trade_date,
    metal_code,
    COUNT(*) as count
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
GROUP BY trade_date, metal_code
HAVING COUNT(*) > 1
      
    ) dbt_internal_test
[0m12:20:26.645455 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m12:20:26.647648 [debug] [Thread-1 (]: Timing info for test.bank_rates.unique_trade_date_metal_code (execute): 12:20:26.607818 => 12:20:26.647351
[0m12:20:26.648158 [debug] [Thread-1 (]: On test.bank_rates.unique_trade_date_metal_code: ROLLBACK
[0m12:20:26.648720 [debug] [Thread-1 (]: On test.bank_rates.unique_trade_date_metal_code: Close
[0m12:20:26.649671 [info ] [Thread-1 (]: 3 of 3 PASS unique_trade_date_metal_code ....................................... [[32mPASS[0m in 0.05s]
[0m12:20:26.650401 [debug] [Thread-1 (]: Finished running node test.bank_rates.unique_trade_date_metal_code
[0m12:20:26.652264 [debug] [MainThread]: Using postgres connection "master"
[0m12:20:26.652615 [debug] [MainThread]: On master: BEGIN
[0m12:20:26.652878 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:20:26.661511 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:20:26.661879 [debug] [MainThread]: On master: COMMIT
[0m12:20:26.662213 [debug] [MainThread]: Using postgres connection "master"
[0m12:20:26.662469 [debug] [MainThread]: On master: COMMIT
[0m12:20:26.662891 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m12:20:26.663229 [debug] [MainThread]: On master: Close
[0m12:20:26.664025 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:20:26.664457 [debug] [MainThread]: Connection 'test.bank_rates.positive_prices' was properly closed.
[0m12:20:26.664783 [debug] [MainThread]: Connection 'test.bank_rates.unique_trade_date_metal_code' was properly closed.
[0m12:20:26.665214 [info ] [MainThread]: 
[0m12:20:26.665720 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 0.26 seconds (0.26s).
[0m12:20:26.666954 [debug] [MainThread]: Command end result
[0m12:20:26.673315 [info ] [MainThread]: 
[0m12:20:26.673789 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:20:26.674226 [info ] [MainThread]: 
[0m12:20:26.674751 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m12:20:26.675370 [debug] [MainThread]: Command `dbt test` succeeded at 12:20:26.675235 after 0.47 seconds
[0m12:20:26.675774 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d2a6a5519f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d2a68ed6f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d2a67f239a0>]}
[0m12:20:26.676213 [debug] [MainThread]: Flushing usage events
[0m12:20:29.253132 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7815a0b510c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78159f5df9a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78159f5dfa30>]}


============================== 12:20:29.256437 | 2fae5949-519c-4c46-8733-fd9b01e72121 ==============================
[0m12:20:29.256437 [info ] [MainThread]: Running with dbt=1.5.0
[0m12:20:29.256949 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'cache_selected_only': 'False', 'introspect': 'True', 'log_format': 'default', 'log_path': '/usr/app/logs', 'no_print': 'None', 'target_path': 'None', 'profiles_dir': '.', 'fail_fast': 'False', 'printer_width': '80', 'quiet': 'False', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'use_colors': 'True', 'static_parser': 'True', 'indirect_selection': 'eager', 'warn_error': 'None', 'partial_parse': 'True', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True', 'version_check': 'True'}
[0m12:20:29.366285 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2fae5949-519c-4c46-8733-fd9b01e72121', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78159f5dfb80>]}
[0m12:20:29.388269 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2fae5949-519c-4c46-8733-fd9b01e72121', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78159f4f9d20>]}
[0m12:20:29.399725 [debug] [MainThread]: checksum: 4568eb639a77b8fcb3a1f4a07856f42b1ff63f1376652889143968e1dbdafbda, vars: {}, profile: , target: , version: 1.5.0
[0m12:20:29.420901 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:20:29.421282 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:20:29.427263 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2fae5949-519c-4c46-8733-fd9b01e72121', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78159e582620>]}
[0m12:20:29.433647 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2fae5949-519c-4c46-8733-fd9b01e72121', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78159e5537c0>]}
[0m12:20:29.434121 [info ] [MainThread]: Found 4 models, 3 tests, 0 snapshots, 0 analyses, 308 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m12:20:29.434490 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2fae5949-519c-4c46-8733-fd9b01e72121', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78159e553850>]}
[0m12:20:29.435959 [info ] [MainThread]: 
[0m12:20:29.436685 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:20:29.438161 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m12:20:29.449369 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m12:20:29.451255 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m12:20:29.453409 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m12:20:29.453832 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m12:20:29.454300 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m12:20:29.454646 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:20:29.455003 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:20:29.468726 [debug] [ThreadPool]: SQL status: SELECT 11 in 0.0 seconds
[0m12:20:29.469114 [debug] [ThreadPool]: SQL status: SELECT 11 in 0.0 seconds
[0m12:20:29.470558 [debug] [ThreadPool]: On list_bank_rates: Close
[0m12:20:29.471894 [debug] [ThreadPool]: On list_bank_rates: Close
[0m12:20:29.475532 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m12:20:29.476701 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m12:20:29.477025 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:20:29.485959 [debug] [ThreadPool]: SQL status: SELECT 11 in 0.0 seconds
[0m12:20:29.487471 [debug] [ThreadPool]: On list_bank_rates: Close
[0m12:20:29.489723 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates, now list_bank_rates_staging)
[0m12:20:29.490628 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates, now list_bank_rates_mart)
[0m12:20:29.497990 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m12:20:29.500112 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m12:20:29.500550 [debug] [ThreadPool]: On list_bank_rates_staging: BEGIN
[0m12:20:29.500916 [debug] [ThreadPool]: On list_bank_rates_mart: BEGIN
[0m12:20:29.501321 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:20:29.501646 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:20:29.511521 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m12:20:29.512004 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m12:20:29.512438 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m12:20:29.512909 [debug] [ThreadPool]: On list_bank_rates_staging: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_staging"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging'
  
[0m12:20:29.513372 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m12:20:29.513951 [debug] [ThreadPool]: On list_bank_rates_mart: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_mart"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'mart'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'mart'
  
[0m12:20:29.516408 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m12:20:29.517909 [debug] [ThreadPool]: On list_bank_rates_staging: ROLLBACK
[0m12:20:29.518430 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m12:20:29.520629 [debug] [ThreadPool]: On list_bank_rates_mart: ROLLBACK
[0m12:20:29.521081 [debug] [ThreadPool]: On list_bank_rates_staging: Close
[0m12:20:29.521607 [debug] [ThreadPool]: On list_bank_rates_mart: Close
[0m12:20:29.522683 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates_staging, now list_bank_rates_dds)
[0m12:20:29.526038 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m12:20:29.526986 [debug] [ThreadPool]: On list_bank_rates_dds: BEGIN
[0m12:20:29.527644 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:20:29.536265 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m12:20:29.536661 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m12:20:29.537019 [debug] [ThreadPool]: On list_bank_rates_dds: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_dds"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dds'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dds'
  
[0m12:20:29.539664 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m12:20:29.541027 [debug] [ThreadPool]: On list_bank_rates_dds: ROLLBACK
[0m12:20:29.541505 [debug] [ThreadPool]: On list_bank_rates_dds: Close
[0m12:20:29.548101 [debug] [MainThread]: Using postgres connection "master"
[0m12:20:29.548588 [debug] [MainThread]: On master: BEGIN
[0m12:20:29.549046 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:20:29.558320 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:20:29.558760 [debug] [MainThread]: Using postgres connection "master"
[0m12:20:29.559153 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:20:29.564314 [debug] [MainThread]: SQL status: SELECT 3 in 0.0 seconds
[0m12:20:29.565801 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2fae5949-519c-4c46-8733-fd9b01e72121', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78159e56fd30>]}
[0m12:20:29.566341 [debug] [MainThread]: On master: ROLLBACK
[0m12:20:29.566815 [debug] [MainThread]: Using postgres connection "master"
[0m12:20:29.567148 [debug] [MainThread]: On master: BEGIN
[0m12:20:29.567746 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:20:29.568042 [debug] [MainThread]: On master: COMMIT
[0m12:20:29.568342 [debug] [MainThread]: Using postgres connection "master"
[0m12:20:29.568677 [debug] [MainThread]: On master: COMMIT
[0m12:20:29.569107 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m12:20:29.569409 [debug] [MainThread]: On master: Close
[0m12:20:29.570290 [info ] [MainThread]: Concurrency: 2 threads (target='dev')
[0m12:20:29.570839 [info ] [MainThread]: 
[0m12:20:29.574783 [debug] [Thread-1 (]: Began running node model.bank_rates.stg_cbr_precious_metals
[0m12:20:29.575385 [info ] [Thread-1 (]: 1 of 4 START sql view model staging.stg_cbr_precious_metals .................... [RUN]
[0m12:20:29.576139 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_bank_rates_dds, now model.bank_rates.stg_cbr_precious_metals)
[0m12:20:29.576522 [debug] [Thread-1 (]: Began compiling node model.bank_rates.stg_cbr_precious_metals
[0m12:20:29.580075 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_rates.stg_cbr_precious_metals"
[0m12:20:29.580785 [debug] [Thread-1 (]: Timing info for model.bank_rates.stg_cbr_precious_metals (compile): 12:20:29.576729 => 12:20:29.580534
[0m12:20:29.581203 [debug] [Thread-1 (]: Began executing node model.bank_rates.stg_cbr_precious_metals
[0m12:20:29.621765 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_rates.stg_cbr_precious_metals"
[0m12:20:29.622593 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m12:20:29.622978 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: BEGIN
[0m12:20:29.623310 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:20:29.632402 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m12:20:29.632890 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m12:20:29.633407 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */

  create view "bank_rates"."staging"."stg_cbr_precious_metals__dbt_tmp"
    
    
  as (
    

WITH ranked_data AS (
    SELECT 
        id,
        record_date::DATE as trade_date,
        metal_code::INTEGER as metal_code,
        buy_price::DECIMAL(10,2) as buy_price_rub,
        sell_price::DECIMAL(10,2) as sell_price_rub,
        from_date::DATE as valid_from,
        to_date::DATE as valid_to,
        load_timestamp::TIMESTAMP as loaded_at,
        -- Ð’Ñ‹Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÑŽÑŽ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÑƒ Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð´Ð½Ñ Ð¸ Ð¼ÐµÑ‚Ð°Ð»Ð»Ð°
        ROW_NUMBER() OVER (
            PARTITION BY record_date, metal_code 
            ORDER BY load_timestamp DESC
        ) as rn
    FROM raw.cbr_precious_metals
    WHERE record_date IS NOT NULL
      AND metal_code IS NOT NULL
      AND buy_price IS NOT NULL
)
SELECT 
    trade_date,
    metal_code,
    CASE 
        WHEN metal_code = 1 THEN 'Ð—Ð¾Ð»Ð¾Ñ‚Ð¾'
        WHEN metal_code = 2 THEN 'Ð¡ÐµÑ€ÐµÐ±Ñ€Ð¾'
        WHEN metal_code = 3 THEN 'ÐŸÐ»Ð°Ñ‚Ð¸Ð½Ð°'
        WHEN metal_code = 4 THEN 'ÐŸÐ°Ð»Ð»Ð°Ð´Ð¸Ð¹'
        ELSE 'ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ð¹ Ð¼ÐµÑ‚Ð°Ð»Ð»'
    END as metal_name,
    buy_price_rub,
    sell_price_rub,
    valid_from,
    valid_to,
    loaded_at
FROM ranked_data
WHERE rn = 1
  );
[0m12:20:29.636388 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.0 seconds
[0m12:20:29.643353 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m12:20:29.643849 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
alter table "bank_rates"."staging"."stg_cbr_precious_metals" rename to "stg_cbr_precious_metals__dbt_backup"
[0m12:20:29.644704 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:20:29.647953 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m12:20:29.648447 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
alter table "bank_rates"."staging"."stg_cbr_precious_metals__dbt_tmp" rename to "stg_cbr_precious_metals"
[0m12:20:29.649242 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:20:29.670201 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: COMMIT
[0m12:20:29.670792 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m12:20:29.671229 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: COMMIT
[0m12:20:29.702942 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m12:20:29.709267 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m12:20:29.709855 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
drop view if exists "bank_rates"."staging"."stg_cbr_precious_metals__dbt_backup" cascade
[0m12:20:29.720228 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.0 seconds
[0m12:20:29.722118 [debug] [Thread-1 (]: Timing info for model.bank_rates.stg_cbr_precious_metals (execute): 12:20:29.581451 => 12:20:29.721857
[0m12:20:29.722568 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: Close
[0m12:20:29.723453 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2fae5949-519c-4c46-8733-fd9b01e72121', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78159e1583a0>]}
[0m12:20:29.724179 [info ] [Thread-1 (]: 1 of 4 OK created sql view model staging.stg_cbr_precious_metals ............... [[32mCREATE VIEW[0m in 0.15s]
[0m12:20:29.724916 [debug] [Thread-1 (]: Finished running node model.bank_rates.stg_cbr_precious_metals
[0m12:20:29.726074 [debug] [Thread-2 (]: Began running node model.bank_rates.dim_metals
[0m12:20:29.726538 [debug] [Thread-1 (]: Began running node model.bank_rates.fact_metal_prices
[0m12:20:29.727174 [info ] [Thread-2 (]: 2 of 4 START sql table model dds.dim_metals .................................... [RUN]
[0m12:20:29.727857 [info ] [Thread-1 (]: 3 of 4 START sql table model dds.fact_metal_prices ............................. [RUN]
[0m12:20:29.728680 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_bank_rates_mart, now model.bank_rates.dim_metals)
[0m12:20:29.729414 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.bank_rates.stg_cbr_precious_metals, now model.bank_rates.fact_metal_prices)
[0m12:20:29.729903 [debug] [Thread-2 (]: Began compiling node model.bank_rates.dim_metals
[0m12:20:29.730421 [debug] [Thread-1 (]: Began compiling node model.bank_rates.fact_metal_prices
[0m12:20:29.734186 [debug] [Thread-2 (]: Writing injected SQL for node "model.bank_rates.dim_metals"
[0m12:20:29.737522 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_rates.fact_metal_prices"
[0m12:20:29.738439 [debug] [Thread-2 (]: Timing info for model.bank_rates.dim_metals (compile): 12:20:29.730701 => 12:20:29.738180
[0m12:20:29.738913 [debug] [Thread-1 (]: Timing info for model.bank_rates.fact_metal_prices (compile): 12:20:29.734516 => 12:20:29.738640
[0m12:20:29.739367 [debug] [Thread-2 (]: Began executing node model.bank_rates.dim_metals
[0m12:20:29.739822 [debug] [Thread-1 (]: Began executing node model.bank_rates.fact_metal_prices
[0m12:20:29.770840 [debug] [Thread-2 (]: Writing runtime sql for node "model.bank_rates.dim_metals"
[0m12:20:29.775173 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_rates.fact_metal_prices"
[0m12:20:29.776208 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m12:20:29.776677 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m12:20:29.777207 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: BEGIN
[0m12:20:29.777664 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: BEGIN
[0m12:20:29.778134 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m12:20:29.778571 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:20:29.789364 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m12:20:29.789837 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m12:20:29.790395 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m12:20:29.790873 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m12:20:29.791348 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */

  
    

  create  table "bank_rates"."dds"."dim_metals__dbt_tmp"
  
  
    as
  
  (
    

SELECT DISTINCT
    metal_code,
    metal_name
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
WHERE metal_code IS NOT NULL
  );
  
[0m12:20:29.791780 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */

  
    

  create  table "bank_rates"."dds"."fact_metal_prices__dbt_tmp"
  
  
    as
  
  (
    

SELECT 
    ROW_NUMBER() OVER (ORDER BY trade_date, metal_code) as price_id,
    trade_date,
    metal_code,
    metal_name,
    buy_price_rub,
    sell_price_rub,
    loaded_at,
    CURRENT_TIMESTAMP as dwh_loaded_at
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
WHERE trade_date IS NOT NULL
  AND metal_code IS NOT NULL
  );
  
[0m12:20:29.819393 [debug] [Thread-2 (]: SQL status: SELECT 4 in 0.0 seconds
[0m12:20:29.825119 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m12:20:29.825782 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
alter table "bank_rates"."dds"."dim_metals" rename to "dim_metals__dbt_backup"
[0m12:20:29.826849 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:20:29.832116 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m12:20:29.832742 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
alter table "bank_rates"."dds"."dim_metals__dbt_tmp" rename to "dim_metals"
[0m12:20:29.833685 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:20:29.842221 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: COMMIT
[0m12:20:29.842640 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m12:20:29.843035 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: COMMIT
[0m12:20:29.847817 [debug] [Thread-1 (]: SQL status: SELECT 16796 in 0.0 seconds
[0m12:20:29.852551 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m12:20:29.853012 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m12:20:29.853566 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
alter table "bank_rates"."dds"."fact_metal_prices" rename to "fact_metal_prices__dbt_backup"
[0m12:20:29.856423 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m12:20:29.857009 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
drop table if exists "bank_rates"."dds"."dim_metals__dbt_backup" cascade
[0m12:20:29.857435 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:20:29.861432 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m12:20:29.861845 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
alter table "bank_rates"."dds"."fact_metal_prices__dbt_tmp" rename to "fact_metal_prices"
[0m12:20:29.862588 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:20:29.864595 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: COMMIT
[0m12:20:29.865002 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m12:20:29.865361 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: COMMIT
[0m12:20:29.867936 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m12:20:29.869877 [debug] [Thread-2 (]: Timing info for model.bank_rates.dim_metals (execute): 12:20:29.740169 => 12:20:29.869598
[0m12:20:29.870340 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m12:20:29.870778 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: Close
[0m12:20:29.873805 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m12:20:29.875041 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2fae5949-519c-4c46-8733-fd9b01e72121', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78159e5d2020>]}
[0m12:20:29.875715 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
drop table if exists "bank_rates"."dds"."fact_metal_prices__dbt_backup" cascade
[0m12:20:29.876581 [info ] [Thread-2 (]: 2 of 4 OK created sql table model dds.dim_metals ............................... [[32mSELECT 4[0m in 0.15s]
[0m12:20:29.877625 [debug] [Thread-2 (]: Finished running node model.bank_rates.dim_metals
[0m12:20:29.879986 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m12:20:29.881735 [debug] [Thread-1 (]: Timing info for model.bank_rates.fact_metal_prices (execute): 12:20:29.762373 => 12:20:29.881527
[0m12:20:29.882180 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: Close
[0m12:20:29.882964 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2fae5949-519c-4c46-8733-fd9b01e72121', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78159e18ea10>]}
[0m12:20:29.883662 [info ] [Thread-1 (]: 3 of 4 OK created sql table model dds.fact_metal_prices ........................ [[32mSELECT 16796[0m in 0.15s]
[0m12:20:29.884348 [debug] [Thread-1 (]: Finished running node model.bank_rates.fact_metal_prices
[0m12:20:29.885324 [debug] [Thread-2 (]: Began running node model.bank_rates.metal_prices_analytics
[0m12:20:29.885896 [info ] [Thread-2 (]: 4 of 4 START sql table model mart.metal_prices_analytics ....................... [RUN]
[0m12:20:29.886645 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bank_rates.dim_metals, now model.bank_rates.metal_prices_analytics)
[0m12:20:29.887026 [debug] [Thread-2 (]: Began compiling node model.bank_rates.metal_prices_analytics
[0m12:20:29.890415 [debug] [Thread-2 (]: Writing injected SQL for node "model.bank_rates.metal_prices_analytics"
[0m12:20:29.891165 [debug] [Thread-2 (]: Timing info for model.bank_rates.metal_prices_analytics (compile): 12:20:29.887272 => 12:20:29.890877
[0m12:20:29.891676 [debug] [Thread-2 (]: Began executing node model.bank_rates.metal_prices_analytics
[0m12:20:29.895622 [debug] [Thread-2 (]: Writing runtime sql for node "model.bank_rates.metal_prices_analytics"
[0m12:20:29.896245 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m12:20:29.896656 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: BEGIN
[0m12:20:29.897022 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m12:20:29.905958 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m12:20:29.906571 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m12:20:29.907027 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */

  
    

  create  table "bank_rates"."mart"."metal_prices_analytics__dbt_tmp"
  
  
    as
  
  (
    

SELECT 
    f.trade_date,
    f.metal_name,
    f.buy_price_rub,
    f.sell_price_rub,
    ROUND((f.buy_price_rub + f.sell_price_rub) / 2, 2) as avg_price_rub,
    LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) as prev_buy_price,
    LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) as prev_sell_price,
    CASE 
        WHEN LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) IS NOT NULL 
        THEN ROUND((f.buy_price_rub - LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date)) / 
                   LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) * 100, 2)
        ELSE NULL 
    END as buy_price_change_percent,
    CASE 
        WHEN LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) IS NOT NULL 
        THEN ROUND((f.sell_price_rub - LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date)) / 
                   LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) * 100, 2)
        ELSE NULL 
    END as sell_price_change_percent
FROM "bank_rates"."dds"."fact_metal_prices" f
ORDER BY f.trade_date DESC, f.metal_name
  );
  
[0m12:20:29.969979 [debug] [Thread-2 (]: SQL status: SELECT 16796 in 0.0 seconds
[0m12:20:29.973879 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m12:20:29.974423 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
alter table "bank_rates"."mart"."metal_prices_analytics" rename to "metal_prices_analytics__dbt_backup"
[0m12:20:29.975265 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:20:29.978418 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m12:20:29.978870 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
alter table "bank_rates"."mart"."metal_prices_analytics__dbt_tmp" rename to "metal_prices_analytics"
[0m12:20:29.979515 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:20:29.981578 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: COMMIT
[0m12:20:29.982047 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m12:20:29.982568 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: COMMIT
[0m12:20:30.020134 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m12:20:30.023674 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m12:20:30.024190 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
drop table if exists "bank_rates"."mart"."metal_prices_analytics__dbt_backup" cascade
[0m12:20:30.038626 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m12:20:30.040493 [debug] [Thread-2 (]: Timing info for model.bank_rates.metal_prices_analytics (execute): 12:20:29.891901 => 12:20:30.040272
[0m12:20:30.040885 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: Close
[0m12:20:30.041671 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2fae5949-519c-4c46-8733-fd9b01e72121', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78159e18ea10>]}
[0m12:20:30.042421 [info ] [Thread-2 (]: 4 of 4 OK created sql table model mart.metal_prices_analytics .................. [[32mSELECT 16796[0m in 0.16s]
[0m12:20:30.043227 [debug] [Thread-2 (]: Finished running node model.bank_rates.metal_prices_analytics
[0m12:20:30.045047 [debug] [MainThread]: Using postgres connection "master"
[0m12:20:30.045423 [debug] [MainThread]: On master: BEGIN
[0m12:20:30.045717 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:20:30.054570 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:20:30.054950 [debug] [MainThread]: On master: COMMIT
[0m12:20:30.055261 [debug] [MainThread]: Using postgres connection "master"
[0m12:20:30.055507 [debug] [MainThread]: On master: COMMIT
[0m12:20:30.055865 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m12:20:30.056190 [debug] [MainThread]: On master: Close
[0m12:20:30.056814 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:20:30.057116 [debug] [MainThread]: Connection 'model.bank_rates.fact_metal_prices' was properly closed.
[0m12:20:30.057366 [debug] [MainThread]: Connection 'model.bank_rates.metal_prices_analytics' was properly closed.
[0m12:20:30.057701 [info ] [MainThread]: 
[0m12:20:30.058043 [info ] [MainThread]: Finished running 1 view model, 3 table models in 0 hours 0 minutes and 0.62 seconds (0.62s).
[0m12:20:30.059163 [debug] [MainThread]: Command end result
[0m12:20:30.066625 [info ] [MainThread]: 
[0m12:20:30.067108 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:20:30.067446 [info ] [MainThread]: 
[0m12:20:30.067800 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m12:20:30.068330 [debug] [MainThread]: Command `dbt run` succeeded at 12:20:30.068206 after 0.82 seconds
[0m12:20:30.068689 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7815a0b510c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78159e1eb5b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78159e1ebd90>]}
[0m12:20:30.069091 [debug] [MainThread]: Flushing usage events
[0m12:20:32.667443 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7926e7cad960>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7926e66cba00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7926e66cba90>]}


============================== 12:20:32.670914 | 07a119f2-5945-465b-a19b-5ffad53f324e ==============================
[0m12:20:32.670914 [info ] [MainThread]: Running with dbt=1.5.0
[0m12:20:32.671557 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'target_path': 'None', 'quiet': 'False', 'profiles_dir': '.', 'log_format': 'default', 'no_print': 'None', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'log_path': '/usr/app/logs', 'indirect_selection': 'eager', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'fail_fast': 'False', 'write_json': 'True', 'use_experimental_parser': 'False', 'static_parser': 'True', 'use_colors': 'True', 'introspect': 'True'}
[0m12:20:32.785634 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '07a119f2-5945-465b-a19b-5ffad53f324e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7926e66cbbe0>]}
[0m12:20:32.807801 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '07a119f2-5945-465b-a19b-5ffad53f324e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7926e65f2f50>]}
[0m12:20:32.819432 [debug] [MainThread]: checksum: 4568eb639a77b8fcb3a1f4a07856f42b1ff63f1376652889143968e1dbdafbda, vars: {}, profile: , target: , version: 1.5.0
[0m12:20:32.841008 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:20:32.841463 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:20:32.847653 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '07a119f2-5945-465b-a19b-5ffad53f324e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7926e596e680>]}
[0m12:20:32.854295 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '07a119f2-5945-465b-a19b-5ffad53f324e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7926e593f820>]}
[0m12:20:32.854827 [info ] [MainThread]: Found 4 models, 3 tests, 0 snapshots, 0 analyses, 308 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m12:20:32.855293 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '07a119f2-5945-465b-a19b-5ffad53f324e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7926e593f8b0>]}
[0m12:20:32.856829 [info ] [MainThread]: 
[0m12:20:32.857580 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:20:32.858983 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates_dds'
[0m12:20:32.870416 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates_mart'
[0m12:20:32.872458 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m12:20:32.874741 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m12:20:32.875311 [debug] [ThreadPool]: On list_bank_rates_dds: BEGIN
[0m12:20:32.875746 [debug] [ThreadPool]: On list_bank_rates_mart: BEGIN
[0m12:20:32.876161 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:20:32.876522 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:20:32.890249 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m12:20:32.890684 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m12:20:32.891160 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m12:20:32.891579 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m12:20:32.891970 [debug] [ThreadPool]: On list_bank_rates_dds: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_dds"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dds'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dds'
  
[0m12:20:32.892416 [debug] [ThreadPool]: On list_bank_rates_mart: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_mart"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'mart'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'mart'
  
[0m12:20:32.896323 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m12:20:32.896709 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m12:20:32.898229 [debug] [ThreadPool]: On list_bank_rates_mart: ROLLBACK
[0m12:20:32.899763 [debug] [ThreadPool]: On list_bank_rates_dds: ROLLBACK
[0m12:20:32.900338 [debug] [ThreadPool]: On list_bank_rates_mart: Close
[0m12:20:32.900698 [debug] [ThreadPool]: On list_bank_rates_dds: Close
[0m12:20:32.902248 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates_mart, now list_bank_rates_staging)
[0m12:20:32.906022 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m12:20:32.906379 [debug] [ThreadPool]: On list_bank_rates_staging: BEGIN
[0m12:20:32.906655 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:20:32.914961 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m12:20:32.915422 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m12:20:32.915789 [debug] [ThreadPool]: On list_bank_rates_staging: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_staging"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging'
  
[0m12:20:32.918596 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m12:20:32.919935 [debug] [ThreadPool]: On list_bank_rates_staging: ROLLBACK
[0m12:20:32.920415 [debug] [ThreadPool]: On list_bank_rates_staging: Close
[0m12:20:32.925832 [debug] [MainThread]: Using postgres connection "master"
[0m12:20:32.926250 [debug] [MainThread]: On master: BEGIN
[0m12:20:32.926565 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:20:32.934844 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:20:32.935255 [debug] [MainThread]: Using postgres connection "master"
[0m12:20:32.935698 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:20:32.940836 [debug] [MainThread]: SQL status: SELECT 3 in 0.0 seconds
[0m12:20:32.942277 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '07a119f2-5945-465b-a19b-5ffad53f324e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7926e5961810>]}
[0m12:20:32.942753 [debug] [MainThread]: On master: ROLLBACK
[0m12:20:32.943231 [debug] [MainThread]: Using postgres connection "master"
[0m12:20:32.943535 [debug] [MainThread]: On master: BEGIN
[0m12:20:32.944100 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:20:32.944444 [debug] [MainThread]: On master: COMMIT
[0m12:20:32.944694 [debug] [MainThread]: Using postgres connection "master"
[0m12:20:32.944919 [debug] [MainThread]: On master: COMMIT
[0m12:20:32.945329 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m12:20:32.945681 [debug] [MainThread]: On master: Close
[0m12:20:32.946555 [info ] [MainThread]: Concurrency: 2 threads (target='dev')
[0m12:20:32.947090 [info ] [MainThread]: 
[0m12:20:32.951655 [debug] [Thread-1 (]: Began running node test.bank_rates.not_null_key_columns
[0m12:20:32.952121 [debug] [Thread-2 (]: Began running node test.bank_rates.positive_prices
[0m12:20:32.952594 [info ] [Thread-1 (]: 1 of 3 START test not_null_key_columns ......................................... [RUN]
[0m12:20:32.953174 [info ] [Thread-2 (]: 2 of 3 START test positive_prices .............................................. [RUN]
[0m12:20:32.953967 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_bank_rates_staging, now test.bank_rates.not_null_key_columns)
[0m12:20:32.954721 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_bank_rates_dds, now test.bank_rates.positive_prices)
[0m12:20:32.955158 [debug] [Thread-1 (]: Began compiling node test.bank_rates.not_null_key_columns
[0m12:20:32.955601 [debug] [Thread-2 (]: Began compiling node test.bank_rates.positive_prices
[0m12:20:32.958949 [debug] [Thread-1 (]: Writing injected SQL for node "test.bank_rates.not_null_key_columns"
[0m12:20:32.961889 [debug] [Thread-2 (]: Writing injected SQL for node "test.bank_rates.positive_prices"
[0m12:20:32.962818 [debug] [Thread-1 (]: Timing info for test.bank_rates.not_null_key_columns (compile): 12:20:32.955907 => 12:20:32.962563
[0m12:20:32.963371 [debug] [Thread-2 (]: Timing info for test.bank_rates.positive_prices (compile): 12:20:32.959301 => 12:20:32.963079
[0m12:20:32.963728 [debug] [Thread-1 (]: Began executing node test.bank_rates.not_null_key_columns
[0m12:20:32.964200 [debug] [Thread-2 (]: Began executing node test.bank_rates.positive_prices
[0m12:20:32.981956 [debug] [Thread-1 (]: Writing runtime sql for node "test.bank_rates.not_null_key_columns"
[0m12:20:32.984474 [debug] [Thread-2 (]: Writing runtime sql for node "test.bank_rates.positive_prices"
[0m12:20:32.985430 [debug] [Thread-1 (]: Using postgres connection "test.bank_rates.not_null_key_columns"
[0m12:20:32.985964 [debug] [Thread-2 (]: Using postgres connection "test.bank_rates.positive_prices"
[0m12:20:32.986416 [debug] [Thread-1 (]: On test.bank_rates.not_null_key_columns: BEGIN
[0m12:20:32.986867 [debug] [Thread-2 (]: On test.bank_rates.positive_prices: BEGIN
[0m12:20:32.987375 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:20:32.987824 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m12:20:32.998278 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m12:20:32.998745 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m12:20:32.999210 [debug] [Thread-1 (]: Using postgres connection "test.bank_rates.not_null_key_columns"
[0m12:20:32.999660 [debug] [Thread-2 (]: Using postgres connection "test.bank_rates.positive_prices"
[0m12:20:33.000104 [debug] [Thread-1 (]: On test.bank_rates.not_null_key_columns: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "test.bank_rates.not_null_key_columns"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      SELECT 
    trade_date,
    metal_code
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
WHERE trade_date IS NULL 
   OR metal_code IS NULL 
   OR buy_price_rub IS NULL 
   OR sell_price_rub IS NULL
      
    ) dbt_internal_test
[0m12:20:33.000566 [debug] [Thread-2 (]: On test.bank_rates.positive_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "test.bank_rates.positive_prices"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      SELECT 
    trade_date,
    metal_code,
    buy_price_rub,
    sell_price_rub
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
WHERE buy_price_rub <= 0 OR sell_price_rub <= 0
      
    ) dbt_internal_test
[0m12:20:33.026178 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m12:20:33.029218 [debug] [Thread-1 (]: Timing info for test.bank_rates.not_null_key_columns (execute): 12:20:32.964464 => 12:20:33.028879
[0m12:20:33.029677 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m12:20:33.030120 [debug] [Thread-1 (]: On test.bank_rates.not_null_key_columns: ROLLBACK
[0m12:20:33.031715 [debug] [Thread-2 (]: Timing info for test.bank_rates.positive_prices (execute): 12:20:32.982293 => 12:20:33.031471
[0m12:20:33.032275 [debug] [Thread-2 (]: On test.bank_rates.positive_prices: ROLLBACK
[0m12:20:33.032710 [debug] [Thread-1 (]: On test.bank_rates.not_null_key_columns: Close
[0m12:20:33.033272 [debug] [Thread-2 (]: On test.bank_rates.positive_prices: Close
[0m12:20:33.034376 [info ] [Thread-1 (]: 1 of 3 PASS not_null_key_columns ............................................... [[32mPASS[0m in 0.08s]
[0m12:20:33.035551 [info ] [Thread-2 (]: 2 of 3 PASS positive_prices .................................................... [[32mPASS[0m in 0.08s]
[0m12:20:33.036256 [debug] [Thread-1 (]: Finished running node test.bank_rates.not_null_key_columns
[0m12:20:33.036881 [debug] [Thread-2 (]: Finished running node test.bank_rates.positive_prices
[0m12:20:33.037377 [debug] [Thread-1 (]: Began running node test.bank_rates.unique_trade_date_metal_code
[0m12:20:33.038104 [info ] [Thread-1 (]: 3 of 3 START test unique_trade_date_metal_code ................................. [RUN]
[0m12:20:33.038781 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.bank_rates.not_null_key_columns, now test.bank_rates.unique_trade_date_metal_code)
[0m12:20:33.039163 [debug] [Thread-1 (]: Began compiling node test.bank_rates.unique_trade_date_metal_code
[0m12:20:33.042257 [debug] [Thread-1 (]: Writing injected SQL for node "test.bank_rates.unique_trade_date_metal_code"
[0m12:20:33.042937 [debug] [Thread-1 (]: Timing info for test.bank_rates.unique_trade_date_metal_code (compile): 12:20:33.039375 => 12:20:33.042708
[0m12:20:33.043325 [debug] [Thread-1 (]: Began executing node test.bank_rates.unique_trade_date_metal_code
[0m12:20:33.045784 [debug] [Thread-1 (]: Writing runtime sql for node "test.bank_rates.unique_trade_date_metal_code"
[0m12:20:33.046395 [debug] [Thread-1 (]: Using postgres connection "test.bank_rates.unique_trade_date_metal_code"
[0m12:20:33.046799 [debug] [Thread-1 (]: On test.bank_rates.unique_trade_date_metal_code: BEGIN
[0m12:20:33.047168 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:20:33.055739 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m12:20:33.056184 [debug] [Thread-1 (]: Using postgres connection "test.bank_rates.unique_trade_date_metal_code"
[0m12:20:33.056560 [debug] [Thread-1 (]: On test.bank_rates.unique_trade_date_metal_code: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "test.bank_rates.unique_trade_date_metal_code"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      SELECT 
    trade_date,
    metal_code,
    COUNT(*) as count
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
GROUP BY trade_date, metal_code
HAVING COUNT(*) > 1
      
    ) dbt_internal_test
[0m12:20:33.080794 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m12:20:33.082688 [debug] [Thread-1 (]: Timing info for test.bank_rates.unique_trade_date_metal_code (execute): 12:20:33.043579 => 12:20:33.082420
[0m12:20:33.083107 [debug] [Thread-1 (]: On test.bank_rates.unique_trade_date_metal_code: ROLLBACK
[0m12:20:33.083646 [debug] [Thread-1 (]: On test.bank_rates.unique_trade_date_metal_code: Close
[0m12:20:33.084633 [info ] [Thread-1 (]: 3 of 3 PASS unique_trade_date_metal_code ....................................... [[32mPASS[0m in 0.05s]
[0m12:20:33.085332 [debug] [Thread-1 (]: Finished running node test.bank_rates.unique_trade_date_metal_code
[0m12:20:33.087087 [debug] [MainThread]: Using postgres connection "master"
[0m12:20:33.087465 [debug] [MainThread]: On master: BEGIN
[0m12:20:33.087753 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:20:33.096326 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:20:33.096752 [debug] [MainThread]: On master: COMMIT
[0m12:20:33.097112 [debug] [MainThread]: Using postgres connection "master"
[0m12:20:33.097481 [debug] [MainThread]: On master: COMMIT
[0m12:20:33.097916 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m12:20:33.098333 [debug] [MainThread]: On master: Close
[0m12:20:33.099045 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:20:33.099410 [debug] [MainThread]: Connection 'test.bank_rates.positive_prices' was properly closed.
[0m12:20:33.099709 [debug] [MainThread]: Connection 'test.bank_rates.unique_trade_date_metal_code' was properly closed.
[0m12:20:33.100108 [info ] [MainThread]: 
[0m12:20:33.100529 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 0.24 seconds (0.24s).
[0m12:20:33.101692 [debug] [MainThread]: Command end result
[0m12:20:33.108095 [info ] [MainThread]: 
[0m12:20:33.108611 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:20:33.109024 [info ] [MainThread]: 
[0m12:20:33.109501 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m12:20:33.110177 [debug] [MainThread]: Command `dbt test` succeeded at 12:20:33.109957 after 0.45 seconds
[0m12:20:33.110581 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7926e7cad960>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7926e65f2f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7926e593f910>]}
[0m12:20:33.111008 [debug] [MainThread]: Flushing usage events
[0m13:53:02.886991 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x721b521b9960>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x721b50bcfc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x721b50bcfac0>]}


============================== 13:53:02.891726 | 0ab9296f-c596-411b-b089-95bbe9f68fc5 ==============================
[0m13:53:02.891726 [info ] [MainThread]: Running with dbt=1.5.0
[0m13:53:02.892543 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'target_path': 'None', 'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'quiet': 'False', 'indirect_selection': 'eager', 'log_format': 'default', 'version_check': 'True', 'printer_width': '80', 'partial_parse': 'True', 'no_print': 'None', 'log_cache_events': 'False', 'debug': 'False', 'log_path': '/usr/app/logs', 'profiles_dir': '.', 'use_colors': 'True', 'warn_error': 'None', 'write_json': 'True', 'use_experimental_parser': 'False', 'fail_fast': 'False'}
[0m13:53:03.008724 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0ab9296f-c596-411b-b089-95bbe9f68fc5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x721b50bcfbe0>]}
[0m13:53:03.030860 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0ab9296f-c596-411b-b089-95bbe9f68fc5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x721b50afa320>]}
[0m13:53:03.042682 [debug] [MainThread]: checksum: 4568eb639a77b8fcb3a1f4a07856f42b1ff63f1376652889143968e1dbdafbda, vars: {}, profile: , target: , version: 1.5.0
[0m13:53:03.064250 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:53:03.064671 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:53:03.071197 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0ab9296f-c596-411b-b089-95bbe9f68fc5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x721b4fb726e0>]}
[0m13:53:03.078003 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0ab9296f-c596-411b-b089-95bbe9f68fc5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x721b4fb47880>]}
[0m13:53:03.078553 [info ] [MainThread]: Found 4 models, 3 tests, 0 snapshots, 0 analyses, 308 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m13:53:03.079012 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0ab9296f-c596-411b-b089-95bbe9f68fc5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x721b4fb47910>]}
[0m13:53:03.080429 [info ] [MainThread]: 
[0m13:53:03.081342 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m13:53:03.082658 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m13:53:03.095527 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m13:53:03.096031 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m13:53:03.096412 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:53:03.108121 [debug] [ThreadPool]: SQL status: SELECT 11 in 0.0 seconds
[0m13:53:03.109803 [debug] [ThreadPool]: On list_bank_rates: Close
[0m13:53:03.111863 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates, now list_bank_rates_mart)
[0m13:53:03.118021 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates_dds'
[0m13:53:03.119813 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m13:53:03.122295 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m13:53:03.122777 [debug] [ThreadPool]: On list_bank_rates_mart: BEGIN
[0m13:53:03.123189 [debug] [ThreadPool]: On list_bank_rates_dds: BEGIN
[0m13:53:03.123558 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:53:03.123895 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:53:03.136938 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m13:53:03.137415 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m13:53:03.137835 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m13:53:03.138275 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m13:53:03.138691 [debug] [ThreadPool]: On list_bank_rates_mart: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_mart"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'mart'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'mart'
  
[0m13:53:03.139124 [debug] [ThreadPool]: On list_bank_rates_dds: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_dds"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dds'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dds'
  
[0m13:53:03.143290 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m13:53:03.144784 [debug] [ThreadPool]: On list_bank_rates_dds: ROLLBACK
[0m13:53:03.145188 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m13:53:03.146544 [debug] [ThreadPool]: On list_bank_rates_mart: ROLLBACK
[0m13:53:03.146908 [debug] [ThreadPool]: On list_bank_rates_dds: Close
[0m13:53:03.147465 [debug] [ThreadPool]: On list_bank_rates_mart: Close
[0m13:53:03.148637 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates_dds, now list_bank_rates_staging)
[0m13:53:03.152126 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m13:53:03.152774 [debug] [ThreadPool]: On list_bank_rates_staging: BEGIN
[0m13:53:03.153076 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:53:03.161223 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m13:53:03.161598 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m13:53:03.161868 [debug] [ThreadPool]: On list_bank_rates_staging: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_staging"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging'
  
[0m13:53:03.164489 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m13:53:03.165824 [debug] [ThreadPool]: On list_bank_rates_staging: ROLLBACK
[0m13:53:03.166306 [debug] [ThreadPool]: On list_bank_rates_staging: Close
[0m13:53:03.172580 [debug] [MainThread]: Using postgres connection "master"
[0m13:53:03.172922 [debug] [MainThread]: On master: BEGIN
[0m13:53:03.173243 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:53:03.181604 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m13:53:03.181984 [debug] [MainThread]: Using postgres connection "master"
[0m13:53:03.182412 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m13:53:03.187406 [debug] [MainThread]: SQL status: SELECT 3 in 0.0 seconds
[0m13:53:03.188816 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0ab9296f-c596-411b-b089-95bbe9f68fc5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x721b4fbc7d30>]}
[0m13:53:03.189322 [debug] [MainThread]: On master: ROLLBACK
[0m13:53:03.189800 [debug] [MainThread]: Using postgres connection "master"
[0m13:53:03.190141 [debug] [MainThread]: On master: BEGIN
[0m13:53:03.190767 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m13:53:03.191125 [debug] [MainThread]: On master: COMMIT
[0m13:53:03.191506 [debug] [MainThread]: Using postgres connection "master"
[0m13:53:03.191762 [debug] [MainThread]: On master: COMMIT
[0m13:53:03.192146 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m13:53:03.192447 [debug] [MainThread]: On master: Close
[0m13:53:03.193128 [info ] [MainThread]: Concurrency: 2 threads (target='dev')
[0m13:53:03.193525 [info ] [MainThread]: 
[0m13:53:03.197009 [debug] [Thread-1 (]: Began running node model.bank_rates.stg_cbr_precious_metals
[0m13:53:03.197597 [info ] [Thread-1 (]: 1 of 1 START sql view model staging.stg_cbr_precious_metals .................... [RUN]
[0m13:53:03.198517 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_bank_rates_staging, now model.bank_rates.stg_cbr_precious_metals)
[0m13:53:03.198933 [debug] [Thread-1 (]: Began compiling node model.bank_rates.stg_cbr_precious_metals
[0m13:53:03.202686 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_rates.stg_cbr_precious_metals"
[0m13:53:03.203431 [debug] [Thread-1 (]: Timing info for model.bank_rates.stg_cbr_precious_metals (compile): 13:53:03.199194 => 13:53:03.203177
[0m13:53:03.203812 [debug] [Thread-1 (]: Began executing node model.bank_rates.stg_cbr_precious_metals
[0m13:53:03.245502 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_rates.stg_cbr_precious_metals"
[0m13:53:03.246401 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m13:53:03.246848 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: BEGIN
[0m13:53:03.247277 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:53:03.256461 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m13:53:03.256969 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m13:53:03.257456 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */

  create view "bank_rates"."staging"."stg_cbr_precious_metals__dbt_tmp"
    
    
  as (
    

WITH ranked_data AS (
    SELECT 
        id,
        record_date::DATE as trade_date,
        metal_code::INTEGER as metal_code,
        buy_price::DECIMAL(10,2) as buy_price_rub,
        sell_price::DECIMAL(10,2) as sell_price_rub,
        from_date::DATE as valid_from,
        to_date::DATE as valid_to,
        load_timestamp::TIMESTAMP as loaded_at,
        -- Ð’Ñ‹Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÑŽÑŽ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÑƒ Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð´Ð½Ñ Ð¸ Ð¼ÐµÑ‚Ð°Ð»Ð»Ð°
        ROW_NUMBER() OVER (
            PARTITION BY record_date, metal_code 
            ORDER BY load_timestamp DESC
        ) as rn
    FROM raw.cbr_precious_metals
    WHERE record_date IS NOT NULL
      AND metal_code IS NOT NULL
      AND buy_price IS NOT NULL
)
SELECT 
    trade_date,
    metal_code,
    CASE 
        WHEN metal_code = 1 THEN 'Ð—Ð¾Ð»Ð¾Ñ‚Ð¾'
        WHEN metal_code = 2 THEN 'Ð¡ÐµÑ€ÐµÐ±Ñ€Ð¾'
        WHEN metal_code = 3 THEN 'ÐŸÐ»Ð°Ñ‚Ð¸Ð½Ð°'
        WHEN metal_code = 4 THEN 'ÐŸÐ°Ð»Ð»Ð°Ð´Ð¸Ð¹'
        ELSE 'ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ð¹ Ð¼ÐµÑ‚Ð°Ð»Ð»'
    END as metal_name,
    buy_price_rub,
    sell_price_rub,
    valid_from,
    valid_to,
    loaded_at
FROM ranked_data
WHERE rn = 1
  );
[0m13:53:03.261087 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.0 seconds
[0m13:53:03.268650 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m13:53:03.269151 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
alter table "bank_rates"."staging"."stg_cbr_precious_metals" rename to "stg_cbr_precious_metals__dbt_backup"
[0m13:53:03.269980 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m13:53:03.273155 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m13:53:03.273555 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
alter table "bank_rates"."staging"."stg_cbr_precious_metals__dbt_tmp" rename to "stg_cbr_precious_metals"
[0m13:53:03.274351 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m13:53:03.294394 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: COMMIT
[0m13:53:03.294893 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m13:53:03.295304 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: COMMIT
[0m13:53:03.297245 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m13:53:03.303017 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m13:53:03.303456 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
drop view if exists "bank_rates"."staging"."stg_cbr_precious_metals__dbt_backup" cascade
[0m13:53:03.305736 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.0 seconds
[0m13:53:03.307493 [debug] [Thread-1 (]: Timing info for model.bank_rates.stg_cbr_precious_metals (execute): 13:53:03.204093 => 13:53:03.307261
[0m13:53:03.307880 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: Close
[0m13:53:03.308885 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0ab9296f-c596-411b-b089-95bbe9f68fc5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x721b4fbbd330>]}
[0m13:53:03.309801 [info ] [Thread-1 (]: 1 of 1 OK created sql view model staging.stg_cbr_precious_metals ............... [[32mCREATE VIEW[0m in 0.11s]
[0m13:53:03.310762 [debug] [Thread-1 (]: Finished running node model.bank_rates.stg_cbr_precious_metals
[0m13:53:03.312589 [debug] [MainThread]: Using postgres connection "master"
[0m13:53:03.312929 [debug] [MainThread]: On master: BEGIN
[0m13:53:03.313230 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:53:03.322034 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m13:53:03.322561 [debug] [MainThread]: On master: COMMIT
[0m13:53:03.322861 [debug] [MainThread]: Using postgres connection "master"
[0m13:53:03.323142 [debug] [MainThread]: On master: COMMIT
[0m13:53:03.323573 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m13:53:03.323874 [debug] [MainThread]: On master: Close
[0m13:53:03.324692 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:53:03.325106 [debug] [MainThread]: Connection 'list_bank_rates_mart' was properly closed.
[0m13:53:03.325461 [debug] [MainThread]: Connection 'model.bank_rates.stg_cbr_precious_metals' was properly closed.
[0m13:53:03.325880 [info ] [MainThread]: 
[0m13:53:03.326402 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.24 seconds (0.24s).
[0m13:53:03.327369 [debug] [MainThread]: Command end result
[0m13:53:03.335036 [info ] [MainThread]: 
[0m13:53:03.335560 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:53:03.336081 [info ] [MainThread]: 
[0m13:53:03.336529 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m13:53:03.337130 [debug] [MainThread]: Command `dbt run` succeeded at 13:53:03.336972 after 0.46 seconds
[0m13:53:03.337468 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x721b521b9960>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x721b4f73e680>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x721b4f73ff40>]}
[0m13:53:03.337794 [debug] [MainThread]: Flushing usage events
[0m18:24:23.960148 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7030169ad450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703015225090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703015225000>]}


============================== 18:24:23.972124 | b808be34-2177-4ec4-b10a-5544a0a93959 ==============================
[0m18:24:23.972124 [info ] [MainThread]: Running with dbt=1.5.0
[0m18:24:23.972784 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'quiet': 'False', 'fail_fast': 'False', 'indirect_selection': 'eager', 'profiles_dir': '.', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'target_path': 'None', 'log_path': '/usr/app/logs', 'log_format': 'default', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'partial_parse': 'True', 'introspect': 'True', 'write_json': 'True', 'warn_error': 'None', 'use_experimental_parser': 'False', 'debug': 'False', 'printer_width': '80', 'version_check': 'True', 'use_colors': 'True', 'static_parser': 'True', 'cache_selected_only': 'False'}
[0m18:24:24.155573 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b808be34-2177-4ec4-b10a-5544a0a93959', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70301911f610>]}
[0m18:24:24.178761 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b808be34-2177-4ec4-b10a-5544a0a93959', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7030155821d0>]}
[0m18:24:24.191906 [debug] [MainThread]: checksum: 4568eb639a77b8fcb3a1f4a07856f42b1ff63f1376652889143968e1dbdafbda, vars: {}, profile: , target: , version: 1.5.0
[0m18:24:24.292131 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:24:24.292630 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:24:24.299532 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b808be34-2177-4ec4-b10a-5544a0a93959', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70301438c0d0>]}
[0m18:24:24.306565 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b808be34-2177-4ec4-b10a-5544a0a93959', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70301540c6a0>]}
[0m18:24:24.307199 [info ] [MainThread]: Found 4 models, 3 tests, 0 snapshots, 0 analyses, 308 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m18:24:24.307651 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b808be34-2177-4ec4-b10a-5544a0a93959', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70301540d900>]}
[0m18:24:24.309355 [info ] [MainThread]: 
[0m18:24:24.310414 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m18:24:24.311997 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m18:24:24.312887 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m18:24:24.326035 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m18:24:24.328623 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m18:24:24.329187 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m18:24:24.329640 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m18:24:24.330146 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:24:24.330525 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:24:24.346938 [debug] [ThreadPool]: SQL status: SELECT 11 in 0.0 seconds
[0m18:24:24.347454 [debug] [ThreadPool]: SQL status: SELECT 11 in 0.0 seconds
[0m18:24:24.349160 [debug] [ThreadPool]: On list_bank_rates: Close
[0m18:24:24.350684 [debug] [ThreadPool]: On list_bank_rates: Close
[0m18:24:24.354705 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m18:24:24.355183 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m18:24:24.356039 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:24:24.365353 [debug] [ThreadPool]: SQL status: SELECT 11 in 0.0 seconds
[0m18:24:24.366874 [debug] [ThreadPool]: On list_bank_rates: Close
[0m18:24:24.368891 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates, now list_bank_rates_staging)
[0m18:24:24.369916 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates, now list_bank_rates_mart)
[0m18:24:24.377655 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m18:24:24.380046 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m18:24:24.380511 [debug] [ThreadPool]: On list_bank_rates_staging: BEGIN
[0m18:24:24.380929 [debug] [ThreadPool]: On list_bank_rates_mart: BEGIN
[0m18:24:24.381324 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:24:24.381686 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:24:24.392403 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m18:24:24.392841 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m18:24:24.393309 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m18:24:24.393728 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m18:24:24.394197 [debug] [ThreadPool]: On list_bank_rates_staging: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_staging"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging'
  
[0m18:24:24.394603 [debug] [ThreadPool]: On list_bank_rates_mart: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_mart"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'mart'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'mart'
  
[0m18:24:24.535834 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m18:24:24.536410 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m18:24:24.538028 [debug] [ThreadPool]: On list_bank_rates_mart: ROLLBACK
[0m18:24:24.539561 [debug] [ThreadPool]: On list_bank_rates_staging: ROLLBACK
[0m18:24:24.540190 [debug] [ThreadPool]: On list_bank_rates_mart: Close
[0m18:24:24.540502 [debug] [ThreadPool]: On list_bank_rates_staging: Close
[0m18:24:24.541976 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates_mart, now list_bank_rates_dds)
[0m18:24:24.545321 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m18:24:24.546045 [debug] [ThreadPool]: On list_bank_rates_dds: BEGIN
[0m18:24:24.546364 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:24:24.554897 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m18:24:24.555369 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m18:24:24.555771 [debug] [ThreadPool]: On list_bank_rates_dds: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_dds"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dds'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dds'
  
[0m18:24:24.558536 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m18:24:24.559992 [debug] [ThreadPool]: On list_bank_rates_dds: ROLLBACK
[0m18:24:24.560509 [debug] [ThreadPool]: On list_bank_rates_dds: Close
[0m18:24:24.566682 [debug] [MainThread]: Using postgres connection "master"
[0m18:24:24.567108 [debug] [MainThread]: On master: BEGIN
[0m18:24:24.567449 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:24:24.576607 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m18:24:24.577049 [debug] [MainThread]: Using postgres connection "master"
[0m18:24:24.577531 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m18:24:24.609590 [debug] [MainThread]: SQL status: SELECT 3 in 0.0 seconds
[0m18:24:24.611403 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b808be34-2177-4ec4-b10a-5544a0a93959', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70301540d8a0>]}
[0m18:24:24.612025 [debug] [MainThread]: On master: ROLLBACK
[0m18:24:24.612581 [debug] [MainThread]: Using postgres connection "master"
[0m18:24:24.612919 [debug] [MainThread]: On master: BEGIN
[0m18:24:24.613534 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m18:24:24.613975 [debug] [MainThread]: On master: COMMIT
[0m18:24:24.614310 [debug] [MainThread]: Using postgres connection "master"
[0m18:24:24.614603 [debug] [MainThread]: On master: COMMIT
[0m18:24:24.615010 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m18:24:24.615358 [debug] [MainThread]: On master: Close
[0m18:24:24.616106 [info ] [MainThread]: Concurrency: 2 threads (target='dev')
[0m18:24:24.616529 [info ] [MainThread]: 
[0m18:24:24.641328 [debug] [Thread-1 (]: Began running node model.bank_rates.stg_cbr_precious_metals
[0m18:24:24.642008 [info ] [Thread-1 (]: 1 of 4 START sql view model staging.stg_cbr_precious_metals .................... [RUN]
[0m18:24:24.643033 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_bank_rates_dds, now model.bank_rates.stg_cbr_precious_metals)
[0m18:24:24.643521 [debug] [Thread-1 (]: Began compiling node model.bank_rates.stg_cbr_precious_metals
[0m18:24:24.647159 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_rates.stg_cbr_precious_metals"
[0m18:24:24.647895 [debug] [Thread-1 (]: Timing info for model.bank_rates.stg_cbr_precious_metals (compile): 18:24:24.643760 => 18:24:24.647630
[0m18:24:24.648295 [debug] [Thread-1 (]: Began executing node model.bank_rates.stg_cbr_precious_metals
[0m18:24:24.690775 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_rates.stg_cbr_precious_metals"
[0m18:24:24.691680 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m18:24:24.692108 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: BEGIN
[0m18:24:24.692442 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:24:24.701770 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m18:24:24.702298 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m18:24:24.702718 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */

  create view "bank_rates"."staging"."stg_cbr_precious_metals__dbt_tmp"
    
    
  as (
    

WITH ranked_data AS (
    SELECT 
        id,
        record_date::DATE as trade_date,
        metal_code::INTEGER as metal_code,
        buy_price::DECIMAL(10,2) as buy_price_rub,
        sell_price::DECIMAL(10,2) as sell_price_rub,
        from_date::DATE as valid_from,
        to_date::DATE as valid_to,
        load_timestamp::TIMESTAMP as loaded_at,
        -- Ð’Ñ‹Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÑŽÑŽ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÑƒ Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð´Ð½Ñ Ð¸ Ð¼ÐµÑ‚Ð°Ð»Ð»Ð°
        ROW_NUMBER() OVER (
            PARTITION BY record_date, metal_code 
            ORDER BY load_timestamp DESC
        ) as rn
    FROM raw.cbr_precious_metals
    WHERE record_date IS NOT NULL
      AND metal_code IS NOT NULL
      AND buy_price IS NOT NULL
)
SELECT 
    trade_date,
    metal_code,
    CASE 
        WHEN metal_code = 1 THEN 'Ð—Ð¾Ð»Ð¾Ñ‚Ð¾'
        WHEN metal_code = 2 THEN 'Ð¡ÐµÑ€ÐµÐ±Ñ€Ð¾'
        WHEN metal_code = 3 THEN 'ÐŸÐ»Ð°Ñ‚Ð¸Ð½Ð°'
        WHEN metal_code = 4 THEN 'ÐŸÐ°Ð»Ð»Ð°Ð´Ð¸Ð¹'
        ELSE 'ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ð¹ Ð¼ÐµÑ‚Ð°Ð»Ð»'
    END as metal_name,
    buy_price_rub,
    sell_price_rub,
    valid_from,
    valid_to,
    loaded_at
FROM ranked_data
WHERE rn = 1
  );
[0m18:24:24.749414 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.0 seconds
[0m18:24:24.757397 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m18:24:24.757909 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
alter table "bank_rates"."staging"."stg_cbr_precious_metals" rename to "stg_cbr_precious_metals__dbt_backup"
[0m18:24:24.758950 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m18:24:24.763657 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m18:24:24.764122 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
alter table "bank_rates"."staging"."stg_cbr_precious_metals__dbt_tmp" rename to "stg_cbr_precious_metals"
[0m18:24:24.765163 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m18:24:24.785599 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: COMMIT
[0m18:24:24.786172 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m18:24:24.786524 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: COMMIT
[0m18:24:24.788363 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m18:24:24.794192 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m18:24:24.794622 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
drop view if exists "bank_rates"."staging"."stg_cbr_precious_metals__dbt_backup" cascade
[0m18:24:24.804688 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.0 seconds
[0m18:24:24.806712 [debug] [Thread-1 (]: Timing info for model.bank_rates.stg_cbr_precious_metals (execute): 18:24:24.648510 => 18:24:24.806481
[0m18:24:24.807133 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: Close
[0m18:24:24.808196 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b808be34-2177-4ec4-b10a-5544a0a93959', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703013f180d0>]}
[0m18:24:24.809160 [info ] [Thread-1 (]: 1 of 4 OK created sql view model staging.stg_cbr_precious_metals ............... [[32mCREATE VIEW[0m in 0.17s]
[0m18:24:24.810119 [debug] [Thread-1 (]: Finished running node model.bank_rates.stg_cbr_precious_metals
[0m18:24:24.811379 [debug] [Thread-2 (]: Began running node model.bank_rates.dim_metals
[0m18:24:24.811831 [debug] [Thread-1 (]: Began running node model.bank_rates.fact_metal_prices
[0m18:24:24.812475 [info ] [Thread-2 (]: 2 of 4 START sql table model dds.dim_metals .................................... [RUN]
[0m18:24:24.813257 [info ] [Thread-1 (]: 3 of 4 START sql table model dds.fact_metal_prices ............................. [RUN]
[0m18:24:24.814286 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_bank_rates_staging, now model.bank_rates.dim_metals)
[0m18:24:24.815030 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.bank_rates.stg_cbr_precious_metals, now model.bank_rates.fact_metal_prices)
[0m18:24:24.815614 [debug] [Thread-2 (]: Began compiling node model.bank_rates.dim_metals
[0m18:24:24.816089 [debug] [Thread-1 (]: Began compiling node model.bank_rates.fact_metal_prices
[0m18:24:24.819968 [debug] [Thread-2 (]: Writing injected SQL for node "model.bank_rates.dim_metals"
[0m18:24:24.823629 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_rates.fact_metal_prices"
[0m18:24:24.824619 [debug] [Thread-2 (]: Timing info for model.bank_rates.dim_metals (compile): 18:24:24.816383 => 18:24:24.824346
[0m18:24:24.825211 [debug] [Thread-1 (]: Timing info for model.bank_rates.fact_metal_prices (compile): 18:24:24.820359 => 18:24:24.824874
[0m18:24:24.825678 [debug] [Thread-2 (]: Began executing node model.bank_rates.dim_metals
[0m18:24:24.826178 [debug] [Thread-1 (]: Began executing node model.bank_rates.fact_metal_prices
[0m18:24:24.861170 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_rates.fact_metal_prices"
[0m18:24:24.861668 [debug] [Thread-2 (]: Writing runtime sql for node "model.bank_rates.dim_metals"
[0m18:24:24.862663 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m18:24:24.863139 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: BEGIN
[0m18:24:24.863586 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m18:24:24.863950 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:24:24.864390 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: BEGIN
[0m18:24:24.865008 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m18:24:24.875306 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m18:24:24.875809 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m18:24:24.876375 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m18:24:24.876818 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m18:24:24.877302 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */

  
    

  create  table "bank_rates"."dds"."fact_metal_prices__dbt_tmp"
  
  
    as
  
  (
    

SELECT 
    ROW_NUMBER() OVER (ORDER BY trade_date, metal_code) as price_id,
    trade_date,
    metal_code,
    metal_name,
    buy_price_rub,
    sell_price_rub,
    loaded_at,
    CURRENT_TIMESTAMP as dwh_loaded_at
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
WHERE trade_date IS NOT NULL
  AND metal_code IS NOT NULL
  );
  
[0m18:24:24.877739 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */

  
    

  create  table "bank_rates"."dds"."dim_metals__dbt_tmp"
  
  
    as
  
  (
    

SELECT DISTINCT
    metal_code,
    metal_name
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
WHERE metal_code IS NOT NULL
  );
  
[0m18:24:24.911036 [debug] [Thread-2 (]: SQL status: SELECT 4 in 0.0 seconds
[0m18:24:24.917158 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m18:24:24.917859 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
alter table "bank_rates"."dds"."dim_metals" rename to "dim_metals__dbt_backup"
[0m18:24:24.918963 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m18:24:24.924380 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m18:24:24.924993 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
alter table "bank_rates"."dds"."dim_metals__dbt_tmp" rename to "dim_metals"
[0m18:24:24.926122 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m18:24:24.936886 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: COMMIT
[0m18:24:24.937445 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m18:24:24.937904 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: COMMIT
[0m18:24:24.940439 [debug] [Thread-1 (]: SQL status: SELECT 16796 in 0.0 seconds
[0m18:24:24.945337 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m18:24:24.945865 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m18:24:24.946485 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
alter table "bank_rates"."dds"."fact_metal_prices" rename to "fact_metal_prices__dbt_backup"
[0m18:24:24.950420 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m18:24:24.951110 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
drop table if exists "bank_rates"."dds"."dim_metals__dbt_backup" cascade
[0m18:24:24.951618 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m18:24:24.955388 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m18:24:24.955923 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
alter table "bank_rates"."dds"."fact_metal_prices__dbt_tmp" rename to "fact_metal_prices"
[0m18:24:24.956849 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m18:24:24.958952 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: COMMIT
[0m18:24:24.959416 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m18:24:24.960007 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: COMMIT
[0m18:24:24.960779 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m18:24:24.962814 [debug] [Thread-2 (]: Timing info for model.bank_rates.dim_metals (execute): 18:24:24.826461 => 18:24:24.962587
[0m18:24:24.963223 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m18:24:24.963718 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: Close
[0m18:24:24.966596 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m18:24:24.967723 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b808be34-2177-4ec4-b10a-5544a0a93959', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7030154bf0a0>]}
[0m18:24:24.968200 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
drop table if exists "bank_rates"."dds"."fact_metal_prices__dbt_backup" cascade
[0m18:24:24.968911 [info ] [Thread-2 (]: 2 of 4 OK created sql table model dds.dim_metals ............................... [[32mSELECT 4[0m in 0.15s]
[0m18:24:24.969883 [debug] [Thread-2 (]: Finished running node model.bank_rates.dim_metals
[0m18:24:24.972413 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m18:24:24.974103 [debug] [Thread-1 (]: Timing info for model.bank_rates.fact_metal_prices (execute): 18:24:24.846921 => 18:24:24.973858
[0m18:24:24.974482 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: Close
[0m18:24:24.975256 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b808be34-2177-4ec4-b10a-5544a0a93959', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703013faa410>]}
[0m18:24:24.975960 [info ] [Thread-1 (]: 3 of 4 OK created sql table model dds.fact_metal_prices ........................ [[32mSELECT 16796[0m in 0.16s]
[0m18:24:24.976886 [debug] [Thread-1 (]: Finished running node model.bank_rates.fact_metal_prices
[0m18:24:24.977820 [debug] [Thread-2 (]: Began running node model.bank_rates.metal_prices_analytics
[0m18:24:24.978591 [info ] [Thread-2 (]: 4 of 4 START sql table model mart.metal_prices_analytics ....................... [RUN]
[0m18:24:24.979440 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bank_rates.dim_metals, now model.bank_rates.metal_prices_analytics)
[0m18:24:24.979872 [debug] [Thread-2 (]: Began compiling node model.bank_rates.metal_prices_analytics
[0m18:24:24.983717 [debug] [Thread-2 (]: Writing injected SQL for node "model.bank_rates.metal_prices_analytics"
[0m18:24:24.984508 [debug] [Thread-2 (]: Timing info for model.bank_rates.metal_prices_analytics (compile): 18:24:24.980129 => 18:24:24.984236
[0m18:24:24.984928 [debug] [Thread-2 (]: Began executing node model.bank_rates.metal_prices_analytics
[0m18:24:24.989557 [debug] [Thread-2 (]: Writing runtime sql for node "model.bank_rates.metal_prices_analytics"
[0m18:24:24.990262 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m18:24:24.990676 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: BEGIN
[0m18:24:24.991038 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m18:24:25.000410 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m18:24:25.000902 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m18:24:25.001426 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */

  
    

  create  table "bank_rates"."mart"."metal_prices_analytics__dbt_tmp"
  
  
    as
  
  (
    

SELECT 
    f.trade_date,
    f.metal_name,
    f.buy_price_rub,
    f.sell_price_rub,
    ROUND((f.buy_price_rub + f.sell_price_rub) / 2, 2) as avg_price_rub,
    LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) as prev_buy_price,
    LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) as prev_sell_price,
    CASE 
        WHEN LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) IS NOT NULL 
        THEN ROUND((f.buy_price_rub - LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date)) / 
                   LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) * 100, 2)
        ELSE NULL 
    END as buy_price_change_percent,
    CASE 
        WHEN LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) IS NOT NULL 
        THEN ROUND((f.sell_price_rub - LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date)) / 
                   LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) * 100, 2)
        ELSE NULL 
    END as sell_price_change_percent
FROM "bank_rates"."dds"."fact_metal_prices" f
ORDER BY f.trade_date DESC, f.metal_name
  );
  
[0m18:24:25.132189 [debug] [Thread-2 (]: SQL status: SELECT 16796 in 0.0 seconds
[0m18:24:25.136181 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m18:24:25.136697 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
alter table "bank_rates"."mart"."metal_prices_analytics" rename to "metal_prices_analytics__dbt_backup"
[0m18:24:25.137593 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m18:24:25.140891 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m18:24:25.141339 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
alter table "bank_rates"."mart"."metal_prices_analytics__dbt_tmp" rename to "metal_prices_analytics"
[0m18:24:25.141978 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m18:24:25.143998 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: COMMIT
[0m18:24:25.144476 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m18:24:25.144876 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: COMMIT
[0m18:24:25.151539 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m18:24:25.154576 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m18:24:25.155075 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
drop table if exists "bank_rates"."mart"."metal_prices_analytics__dbt_backup" cascade
[0m18:24:25.164527 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m18:24:25.166393 [debug] [Thread-2 (]: Timing info for model.bank_rates.metal_prices_analytics (execute): 18:24:24.985220 => 18:24:25.166170
[0m18:24:25.166824 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: Close
[0m18:24:25.167689 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b808be34-2177-4ec4-b10a-5544a0a93959', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703015ae9e70>]}
[0m18:24:25.168405 [info ] [Thread-2 (]: 4 of 4 OK created sql table model mart.metal_prices_analytics .................. [[32mSELECT 16796[0m in 0.19s]
[0m18:24:25.169309 [debug] [Thread-2 (]: Finished running node model.bank_rates.metal_prices_analytics
[0m18:24:25.171020 [debug] [MainThread]: Using postgres connection "master"
[0m18:24:25.171414 [debug] [MainThread]: On master: BEGIN
[0m18:24:25.171688 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:24:25.180885 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m18:24:25.181376 [debug] [MainThread]: On master: COMMIT
[0m18:24:25.181738 [debug] [MainThread]: Using postgres connection "master"
[0m18:24:25.182091 [debug] [MainThread]: On master: COMMIT
[0m18:24:25.182520 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m18:24:25.182858 [debug] [MainThread]: On master: Close
[0m18:24:25.183624 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:24:25.183953 [debug] [MainThread]: Connection 'model.bank_rates.fact_metal_prices' was properly closed.
[0m18:24:25.184283 [debug] [MainThread]: Connection 'model.bank_rates.metal_prices_analytics' was properly closed.
[0m18:24:25.184690 [info ] [MainThread]: 
[0m18:24:25.185157 [info ] [MainThread]: Finished running 1 view model, 3 table models in 0 hours 0 minutes and 0.87 seconds (0.87s).
[0m18:24:25.186683 [debug] [MainThread]: Command end result
[0m18:24:25.194431 [info ] [MainThread]: 
[0m18:24:25.194991 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:24:25.195589 [info ] [MainThread]: 
[0m18:24:25.196195 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m18:24:25.197071 [debug] [MainThread]: Command `dbt run` succeeded at 18:24:25.196869 after 1.25 seconds
[0m18:24:25.197454 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7030169ad450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7030143d2f20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x703013fc4940>]}
[0m18:24:25.197819 [debug] [MainThread]: Flushing usage events
[0m18:24:27.873277 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa04a11d9f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa048bdfa90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa048bdfb20>]}


============================== 18:24:27.876760 | 66c1e278-c7d5-49d2-9f1b-81acabbe6016 ==============================
[0m18:24:27.876760 [info ] [MainThread]: Running with dbt=1.5.0
[0m18:24:27.877470 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '.', 'fail_fast': 'False', 'debug': 'False', 'send_anonymous_usage_stats': 'True', 'log_format': 'default', 'printer_width': '80', 'static_parser': 'True', 'use_experimental_parser': 'False', 'warn_error': 'None', 'quiet': 'False', 'target_path': 'None', 'partial_parse': 'True', 'write_json': 'True', 'introspect': 'True', 'log_path': '/usr/app/logs', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'no_print': 'None', 'use_colors': 'True', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'version_check': 'True'}
[0m18:24:27.991930 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '66c1e278-c7d5-49d2-9f1b-81acabbe6016', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa048bdfc70>]}
[0m18:24:28.013125 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '66c1e278-c7d5-49d2-9f1b-81acabbe6016', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa048afaf50>]}
[0m18:24:28.025142 [debug] [MainThread]: checksum: 4568eb639a77b8fcb3a1f4a07856f42b1ff63f1376652889143968e1dbdafbda, vars: {}, profile: , target: , version: 1.5.0
[0m18:24:28.047574 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:24:28.048007 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:24:28.054709 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '66c1e278-c7d5-49d2-9f1b-81acabbe6016', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa048112710>]}
[0m18:24:28.062346 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '66c1e278-c7d5-49d2-9f1b-81acabbe6016', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0480e38b0>]}
[0m18:24:28.062944 [info ] [MainThread]: Found 4 models, 3 tests, 0 snapshots, 0 analyses, 308 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m18:24:28.063418 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '66c1e278-c7d5-49d2-9f1b-81acabbe6016', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0480e3940>]}
[0m18:24:28.065124 [info ] [MainThread]: 
[0m18:24:28.066070 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m18:24:28.067643 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates_dds'
[0m18:24:28.068730 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates_staging'
[0m18:24:28.081893 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m18:24:28.084289 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m18:24:28.084789 [debug] [ThreadPool]: On list_bank_rates_dds: BEGIN
[0m18:24:28.085203 [debug] [ThreadPool]: On list_bank_rates_staging: BEGIN
[0m18:24:28.085545 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:24:28.085864 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:24:28.101703 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m18:24:28.102315 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m18:24:28.102726 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m18:24:28.103128 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m18:24:28.103505 [debug] [ThreadPool]: On list_bank_rates_staging: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_staging"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging'
  
[0m18:24:28.103876 [debug] [ThreadPool]: On list_bank_rates_dds: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_dds"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dds'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dds'
  
[0m18:24:28.108015 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m18:24:28.108424 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m18:24:28.110029 [debug] [ThreadPool]: On list_bank_rates_staging: ROLLBACK
[0m18:24:28.111600 [debug] [ThreadPool]: On list_bank_rates_dds: ROLLBACK
[0m18:24:28.112208 [debug] [ThreadPool]: On list_bank_rates_staging: Close
[0m18:24:28.112504 [debug] [ThreadPool]: On list_bank_rates_dds: Close
[0m18:24:28.113726 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates_staging, now list_bank_rates_mart)
[0m18:24:28.116746 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m18:24:28.117596 [debug] [ThreadPool]: On list_bank_rates_mart: BEGIN
[0m18:24:28.117886 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:24:28.126734 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m18:24:28.127169 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m18:24:28.127487 [debug] [ThreadPool]: On list_bank_rates_mart: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_mart"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'mart'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'mart'
  
[0m18:24:28.130510 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m18:24:28.132015 [debug] [ThreadPool]: On list_bank_rates_mart: ROLLBACK
[0m18:24:28.132500 [debug] [ThreadPool]: On list_bank_rates_mart: Close
[0m18:24:28.138732 [debug] [MainThread]: Using postgres connection "master"
[0m18:24:28.139151 [debug] [MainThread]: On master: BEGIN
[0m18:24:28.139444 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:24:28.148190 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m18:24:28.148601 [debug] [MainThread]: Using postgres connection "master"
[0m18:24:28.149050 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m18:24:28.154077 [debug] [MainThread]: SQL status: SELECT 3 in 0.0 seconds
[0m18:24:28.155584 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '66c1e278-c7d5-49d2-9f1b-81acabbe6016', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0480e06d0>]}
[0m18:24:28.156163 [debug] [MainThread]: On master: ROLLBACK
[0m18:24:28.156645 [debug] [MainThread]: Using postgres connection "master"
[0m18:24:28.156949 [debug] [MainThread]: On master: BEGIN
[0m18:24:28.157581 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m18:24:28.157945 [debug] [MainThread]: On master: COMMIT
[0m18:24:28.158303 [debug] [MainThread]: Using postgres connection "master"
[0m18:24:28.158594 [debug] [MainThread]: On master: COMMIT
[0m18:24:28.158985 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m18:24:28.159313 [debug] [MainThread]: On master: Close
[0m18:24:28.160039 [info ] [MainThread]: Concurrency: 2 threads (target='dev')
[0m18:24:28.160490 [info ] [MainThread]: 
[0m18:24:28.165290 [debug] [Thread-1 (]: Began running node test.bank_rates.not_null_key_columns
[0m18:24:28.165788 [debug] [Thread-2 (]: Began running node test.bank_rates.positive_prices
[0m18:24:28.166368 [info ] [Thread-1 (]: 1 of 3 START test not_null_key_columns ......................................... [RUN]
[0m18:24:28.167021 [info ] [Thread-2 (]: 2 of 3 START test positive_prices .............................................. [RUN]
[0m18:24:28.168005 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_bank_rates_mart, now test.bank_rates.not_null_key_columns)
[0m18:24:28.168760 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_bank_rates_dds, now test.bank_rates.positive_prices)
[0m18:24:28.169245 [debug] [Thread-1 (]: Began compiling node test.bank_rates.not_null_key_columns
[0m18:24:28.169660 [debug] [Thread-2 (]: Began compiling node test.bank_rates.positive_prices
[0m18:24:28.173207 [debug] [Thread-1 (]: Writing injected SQL for node "test.bank_rates.not_null_key_columns"
[0m18:24:28.176385 [debug] [Thread-2 (]: Writing injected SQL for node "test.bank_rates.positive_prices"
[0m18:24:28.177304 [debug] [Thread-1 (]: Timing info for test.bank_rates.not_null_key_columns (compile): 18:24:28.169946 => 18:24:28.177021
[0m18:24:28.177822 [debug] [Thread-2 (]: Timing info for test.bank_rates.positive_prices (compile): 18:24:28.173541 => 18:24:28.177547
[0m18:24:28.178229 [debug] [Thread-1 (]: Began executing node test.bank_rates.not_null_key_columns
[0m18:24:28.178676 [debug] [Thread-2 (]: Began executing node test.bank_rates.positive_prices
[0m18:24:28.196606 [debug] [Thread-1 (]: Writing runtime sql for node "test.bank_rates.not_null_key_columns"
[0m18:24:28.199167 [debug] [Thread-2 (]: Writing runtime sql for node "test.bank_rates.positive_prices"
[0m18:24:28.200285 [debug] [Thread-1 (]: Using postgres connection "test.bank_rates.not_null_key_columns"
[0m18:24:28.200701 [debug] [Thread-1 (]: On test.bank_rates.not_null_key_columns: BEGIN
[0m18:24:28.201135 [debug] [Thread-2 (]: Using postgres connection "test.bank_rates.positive_prices"
[0m18:24:28.201568 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:24:28.202008 [debug] [Thread-2 (]: On test.bank_rates.positive_prices: BEGIN
[0m18:24:28.202784 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m18:24:28.212895 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m18:24:28.213526 [debug] [Thread-1 (]: Using postgres connection "test.bank_rates.not_null_key_columns"
[0m18:24:28.213998 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m18:24:28.214507 [debug] [Thread-1 (]: On test.bank_rates.not_null_key_columns: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "test.bank_rates.not_null_key_columns"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      SELECT 
    trade_date,
    metal_code
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
WHERE trade_date IS NULL 
   OR metal_code IS NULL 
   OR buy_price_rub IS NULL 
   OR sell_price_rub IS NULL
      
    ) dbt_internal_test
[0m18:24:28.214957 [debug] [Thread-2 (]: Using postgres connection "test.bank_rates.positive_prices"
[0m18:24:28.215547 [debug] [Thread-2 (]: On test.bank_rates.positive_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "test.bank_rates.positive_prices"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      SELECT 
    trade_date,
    metal_code,
    buy_price_rub,
    sell_price_rub
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
WHERE buy_price_rub <= 0 OR sell_price_rub <= 0
      
    ) dbt_internal_test
[0m18:24:28.248545 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m18:24:28.251580 [debug] [Thread-1 (]: Timing info for test.bank_rates.not_null_key_columns (execute): 18:24:28.178952 => 18:24:28.251253
[0m18:24:28.252084 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m18:24:28.252700 [debug] [Thread-1 (]: On test.bank_rates.not_null_key_columns: ROLLBACK
[0m18:24:28.254499 [debug] [Thread-2 (]: Timing info for test.bank_rates.positive_prices (execute): 18:24:28.196900 => 18:24:28.254236
[0m18:24:28.255125 [debug] [Thread-2 (]: On test.bank_rates.positive_prices: ROLLBACK
[0m18:24:28.255502 [debug] [Thread-1 (]: On test.bank_rates.not_null_key_columns: Close
[0m18:24:28.256150 [debug] [Thread-2 (]: On test.bank_rates.positive_prices: Close
[0m18:24:28.257106 [info ] [Thread-1 (]: 1 of 3 PASS not_null_key_columns ............................................... [[32mPASS[0m in 0.09s]
[0m18:24:28.258291 [debug] [Thread-1 (]: Finished running node test.bank_rates.not_null_key_columns
[0m18:24:28.259440 [info ] [Thread-2 (]: 2 of 3 PASS positive_prices .................................................... [[32mPASS[0m in 0.09s]
[0m18:24:28.260257 [debug] [Thread-1 (]: Began running node test.bank_rates.unique_trade_date_metal_code
[0m18:24:28.261051 [debug] [Thread-2 (]: Finished running node test.bank_rates.positive_prices
[0m18:24:28.261530 [info ] [Thread-1 (]: 3 of 3 START test unique_trade_date_metal_code ................................. [RUN]
[0m18:24:28.262571 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.bank_rates.not_null_key_columns, now test.bank_rates.unique_trade_date_metal_code)
[0m18:24:28.263011 [debug] [Thread-1 (]: Began compiling node test.bank_rates.unique_trade_date_metal_code
[0m18:24:28.266315 [debug] [Thread-1 (]: Writing injected SQL for node "test.bank_rates.unique_trade_date_metal_code"
[0m18:24:28.267046 [debug] [Thread-1 (]: Timing info for test.bank_rates.unique_trade_date_metal_code (compile): 18:24:28.263276 => 18:24:28.266772
[0m18:24:28.267487 [debug] [Thread-1 (]: Began executing node test.bank_rates.unique_trade_date_metal_code
[0m18:24:28.270222 [debug] [Thread-1 (]: Writing runtime sql for node "test.bank_rates.unique_trade_date_metal_code"
[0m18:24:28.270877 [debug] [Thread-1 (]: Using postgres connection "test.bank_rates.unique_trade_date_metal_code"
[0m18:24:28.271332 [debug] [Thread-1 (]: On test.bank_rates.unique_trade_date_metal_code: BEGIN
[0m18:24:28.271704 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:24:28.281224 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m18:24:28.281727 [debug] [Thread-1 (]: Using postgres connection "test.bank_rates.unique_trade_date_metal_code"
[0m18:24:28.282143 [debug] [Thread-1 (]: On test.bank_rates.unique_trade_date_metal_code: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "test.bank_rates.unique_trade_date_metal_code"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      SELECT 
    trade_date,
    metal_code,
    COUNT(*) as count
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
GROUP BY trade_date, metal_code
HAVING COUNT(*) > 1
      
    ) dbt_internal_test
[0m18:24:28.307543 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m18:24:28.309966 [debug] [Thread-1 (]: Timing info for test.bank_rates.unique_trade_date_metal_code (execute): 18:24:28.267752 => 18:24:28.309484
[0m18:24:28.310685 [debug] [Thread-1 (]: On test.bank_rates.unique_trade_date_metal_code: ROLLBACK
[0m18:24:28.311395 [debug] [Thread-1 (]: On test.bank_rates.unique_trade_date_metal_code: Close
[0m18:24:28.312611 [info ] [Thread-1 (]: 3 of 3 PASS unique_trade_date_metal_code ....................................... [[32mPASS[0m in 0.05s]
[0m18:24:28.313551 [debug] [Thread-1 (]: Finished running node test.bank_rates.unique_trade_date_metal_code
[0m18:24:28.315479 [debug] [MainThread]: Using postgres connection "master"
[0m18:24:28.315880 [debug] [MainThread]: On master: BEGIN
[0m18:24:28.316245 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:24:28.325538 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m18:24:28.325974 [debug] [MainThread]: On master: COMMIT
[0m18:24:28.326333 [debug] [MainThread]: Using postgres connection "master"
[0m18:24:28.326624 [debug] [MainThread]: On master: COMMIT
[0m18:24:28.327076 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m18:24:28.327450 [debug] [MainThread]: On master: Close
[0m18:24:28.328186 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:24:28.328483 [debug] [MainThread]: Connection 'test.bank_rates.positive_prices' was properly closed.
[0m18:24:28.328741 [debug] [MainThread]: Connection 'test.bank_rates.unique_trade_date_metal_code' was properly closed.
[0m18:24:28.329131 [info ] [MainThread]: 
[0m18:24:28.329597 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 0.26 seconds (0.26s).
[0m18:24:28.330981 [debug] [MainThread]: Command end result
[0m18:24:28.337298 [info ] [MainThread]: 
[0m18:24:28.337819 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:24:28.338328 [info ] [MainThread]: 
[0m18:24:28.338911 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m18:24:28.339621 [debug] [MainThread]: Command `dbt test` succeeded at 18:24:28.339466 after 0.48 seconds
[0m18:24:28.340016 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa04a11d9f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa048afaf50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa0480e39a0>]}
[0m18:24:28.340472 [debug] [MainThread]: Flushing usage events
[0m07:30:10.265240 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a11be825990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a11bd2dba30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a11bd2dbac0>]}


============================== 07:30:10.276273 | cd034ec1-5f43-4136-b031-e5ef56662dc3 ==============================
[0m07:30:10.276273 [info ] [MainThread]: Running with dbt=1.5.0
[0m07:30:10.277370 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'cache_selected_only': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'write_json': 'True', 'static_parser': 'True', 'version_check': 'True', 'use_experimental_parser': 'False', 'use_colors': 'True', 'indirect_selection': 'eager', 'printer_width': '80', 'log_format': 'default', 'log_path': '/usr/app/logs', 'profiles_dir': '.', 'introspect': 'True', 'quiet': 'False', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'log_cache_events': 'False', 'debug': 'False'}
[0m07:30:10.598836 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cd034ec1-5f43-4136-b031-e5ef56662dc3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a11bd2dbc10>]}
[0m07:30:10.645666 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cd034ec1-5f43-4136-b031-e5ef56662dc3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a11bd1e9360>]}
[0m07:30:10.669429 [debug] [MainThread]: checksum: 4568eb639a77b8fcb3a1f4a07856f42b1ff63f1376652889143968e1dbdafbda, vars: {}, profile: , target: , version: 1.5.0
[0m07:30:10.804453 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:30:10.806975 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:30:10.820604 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cd034ec1-5f43-4136-b031-e5ef56662dc3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a11bc57e6b0>]}
[0m07:30:10.834604 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cd034ec1-5f43-4136-b031-e5ef56662dc3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a11bc54f850>]}
[0m07:30:10.835584 [info ] [MainThread]: Found 4 models, 3 tests, 0 snapshots, 0 analyses, 308 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m07:30:10.836315 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cd034ec1-5f43-4136-b031-e5ef56662dc3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a11bc54f8e0>]}
[0m07:30:10.838722 [info ] [MainThread]: 
[0m07:30:10.840821 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m07:30:10.843087 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m07:30:10.857253 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m07:30:10.895396 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m07:30:10.896160 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m07:30:10.896599 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m07:30:10.897097 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:30:10.897584 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m07:30:10.900170 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:30:11.045539 [debug] [ThreadPool]: SQL status: SELECT 11 in 0.0 seconds
[0m07:30:11.046297 [debug] [ThreadPool]: SQL status: SELECT 11 in 0.0 seconds
[0m07:30:11.048641 [debug] [ThreadPool]: On list_bank_rates: Close
[0m07:30:11.050758 [debug] [ThreadPool]: On list_bank_rates: Close
[0m07:30:11.061491 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m07:30:11.062197 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m07:30:11.062694 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:30:11.081654 [debug] [ThreadPool]: SQL status: SELECT 11 in 0.0 seconds
[0m07:30:11.086856 [debug] [ThreadPool]: On list_bank_rates: Close
[0m07:30:11.090081 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates, now list_bank_rates_staging)
[0m07:30:11.091343 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates, now list_bank_rates_mart)
[0m07:30:11.106175 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m07:30:11.111103 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m07:30:11.111730 [debug] [ThreadPool]: On list_bank_rates_staging: BEGIN
[0m07:30:11.112348 [debug] [ThreadPool]: On list_bank_rates_mart: BEGIN
[0m07:30:11.112809 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:30:11.113355 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:30:11.134561 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m07:30:11.135501 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m07:30:11.136002 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m07:30:11.136688 [debug] [ThreadPool]: On list_bank_rates_mart: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_mart"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'mart'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'mart'
  
[0m07:30:11.137253 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m07:30:11.138005 [debug] [ThreadPool]: On list_bank_rates_staging: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_staging"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging'
  
[0m07:30:11.142640 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m07:30:11.144889 [debug] [ThreadPool]: On list_bank_rates_mart: ROLLBACK
[0m07:30:11.145419 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m07:30:11.147631 [debug] [ThreadPool]: On list_bank_rates_staging: ROLLBACK
[0m07:30:11.148765 [debug] [ThreadPool]: On list_bank_rates_staging: Close
[0m07:30:11.148070 [debug] [ThreadPool]: On list_bank_rates_mart: Close
[0m07:30:11.150585 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates_mart, now list_bank_rates_dds)
[0m07:30:11.157716 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m07:30:11.158336 [debug] [ThreadPool]: On list_bank_rates_dds: BEGIN
[0m07:30:11.159772 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:30:11.177939 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m07:30:11.178856 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m07:30:11.179562 [debug] [ThreadPool]: On list_bank_rates_dds: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_dds"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dds'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dds'
  
[0m07:30:11.184889 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m07:30:11.187392 [debug] [ThreadPool]: On list_bank_rates_dds: ROLLBACK
[0m07:30:11.188202 [debug] [ThreadPool]: On list_bank_rates_dds: Close
[0m07:30:11.199739 [debug] [MainThread]: Using postgres connection "master"
[0m07:30:11.200344 [debug] [MainThread]: On master: BEGIN
[0m07:30:11.200793 [debug] [MainThread]: Opening a new connection, currently in state init
[0m07:30:11.217840 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m07:30:11.218568 [debug] [MainThread]: Using postgres connection "master"
[0m07:30:11.219278 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m07:30:11.233359 [debug] [MainThread]: SQL status: SELECT 3 in 0.0 seconds
[0m07:30:11.235728 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cd034ec1-5f43-4136-b031-e5ef56662dc3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a11bc570280>]}
[0m07:30:11.236614 [debug] [MainThread]: On master: ROLLBACK
[0m07:30:11.237339 [debug] [MainThread]: Using postgres connection "master"
[0m07:30:11.237780 [debug] [MainThread]: On master: BEGIN
[0m07:30:11.238602 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m07:30:11.239038 [debug] [MainThread]: On master: COMMIT
[0m07:30:11.239506 [debug] [MainThread]: Using postgres connection "master"
[0m07:30:11.239897 [debug] [MainThread]: On master: COMMIT
[0m07:30:11.240498 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m07:30:11.240929 [debug] [MainThread]: On master: Close
[0m07:30:11.241954 [info ] [MainThread]: Concurrency: 2 threads (target='dev')
[0m07:30:11.242516 [info ] [MainThread]: 
[0m07:30:11.254925 [debug] [Thread-1 (]: Began running node model.bank_rates.stg_cbr_precious_metals
[0m07:30:11.255980 [info ] [Thread-1 (]: 1 of 4 START sql view model staging.stg_cbr_precious_metals .................... [RUN]
[0m07:30:11.260265 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_bank_rates_dds, now model.bank_rates.stg_cbr_precious_metals)
[0m07:30:11.260936 [debug] [Thread-1 (]: Began compiling node model.bank_rates.stg_cbr_precious_metals
[0m07:30:11.275360 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_rates.stg_cbr_precious_metals"
[0m07:30:11.277861 [debug] [Thread-1 (]: Timing info for model.bank_rates.stg_cbr_precious_metals (compile): 07:30:11.261337 => 07:30:11.276224
[0m07:30:11.280354 [debug] [Thread-1 (]: Began executing node model.bank_rates.stg_cbr_precious_metals
[0m07:30:11.414751 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_rates.stg_cbr_precious_metals"
[0m07:30:11.416073 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m07:30:11.416737 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: BEGIN
[0m07:30:11.417320 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:30:11.434868 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m07:30:11.435660 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m07:30:11.436358 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */

  create view "bank_rates"."staging"."stg_cbr_precious_metals__dbt_tmp"
    
    
  as (
    

WITH ranked_data AS (
    SELECT 
        id,
        record_date::DATE as trade_date,
        metal_code::INTEGER as metal_code,
        buy_price::DECIMAL(10,2) as buy_price_rub,
        sell_price::DECIMAL(10,2) as sell_price_rub,
        from_date::DATE as valid_from,
        to_date::DATE as valid_to,
        load_timestamp::TIMESTAMP as loaded_at,
        -- Ð’Ñ‹Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÑŽÑŽ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÑƒ Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð´Ð½Ñ Ð¸ Ð¼ÐµÑ‚Ð°Ð»Ð»Ð°
        ROW_NUMBER() OVER (
            PARTITION BY record_date, metal_code 
            ORDER BY load_timestamp DESC
        ) as rn
    FROM raw.cbr_precious_metals
    WHERE record_date IS NOT NULL
      AND metal_code IS NOT NULL
      AND buy_price IS NOT NULL
)
SELECT 
    trade_date,
    metal_code,
    CASE 
        WHEN metal_code = 1 THEN 'Ð—Ð¾Ð»Ð¾Ñ‚Ð¾'
        WHEN metal_code = 2 THEN 'Ð¡ÐµÑ€ÐµÐ±Ñ€Ð¾'
        WHEN metal_code = 3 THEN 'ÐŸÐ»Ð°Ñ‚Ð¸Ð½Ð°'
        WHEN metal_code = 4 THEN 'ÐŸÐ°Ð»Ð»Ð°Ð´Ð¸Ð¹'
        ELSE 'ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ð¹ Ð¼ÐµÑ‚Ð°Ð»Ð»'
    END as metal_name,
    buy_price_rub,
    sell_price_rub,
    valid_from,
    valid_to,
    loaded_at
FROM ranked_data
WHERE rn = 1
  );
[0m07:30:11.452467 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.0 seconds
[0m07:30:11.466874 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m07:30:11.467690 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
alter table "bank_rates"."staging"."stg_cbr_precious_metals" rename to "stg_cbr_precious_metals__dbt_backup"
[0m07:30:11.469097 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m07:30:11.476276 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m07:30:11.476907 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
alter table "bank_rates"."staging"."stg_cbr_precious_metals__dbt_tmp" rename to "stg_cbr_precious_metals"
[0m07:30:11.478108 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m07:30:11.518763 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: COMMIT
[0m07:30:11.519639 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m07:30:11.520268 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: COMMIT
[0m07:30:11.526069 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m07:30:11.536384 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m07:30:11.537196 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
drop view if exists "bank_rates"."staging"."stg_cbr_precious_metals__dbt_backup" cascade
[0m07:30:11.542441 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.0 seconds
[0m07:30:11.545080 [debug] [Thread-1 (]: Timing info for model.bank_rates.stg_cbr_precious_metals (execute): 07:30:11.282371 => 07:30:11.544684
[0m07:30:11.545702 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: Close
[0m07:30:11.546896 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd034ec1-5f43-4136-b031-e5ef56662dc3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a11bc15b1f0>]}
[0m07:30:11.547851 [info ] [Thread-1 (]: 1 of 4 OK created sql view model staging.stg_cbr_precious_metals ............... [[32mCREATE VIEW[0m in 0.29s]
[0m07:30:11.548832 [debug] [Thread-1 (]: Finished running node model.bank_rates.stg_cbr_precious_metals
[0m07:30:11.549990 [debug] [Thread-2 (]: Began running node model.bank_rates.dim_metals
[0m07:30:11.553104 [info ] [Thread-2 (]: 2 of 4 START sql table model dds.dim_metals .................................... [RUN]
[0m07:30:11.554212 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_bank_rates_staging, now model.bank_rates.dim_metals)
[0m07:30:11.554780 [debug] [Thread-2 (]: Began compiling node model.bank_rates.dim_metals
[0m07:30:11.555388 [debug] [Thread-1 (]: Began running node model.bank_rates.fact_metal_prices
[0m07:30:11.561593 [info ] [Thread-1 (]: 3 of 4 START sql table model dds.fact_metal_prices ............................. [RUN]
[0m07:30:11.562757 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.bank_rates.stg_cbr_precious_metals, now model.bank_rates.fact_metal_prices)
[0m07:30:11.567314 [debug] [Thread-2 (]: Writing injected SQL for node "model.bank_rates.dim_metals"
[0m07:30:11.569788 [debug] [Thread-2 (]: Timing info for model.bank_rates.dim_metals (compile): 07:30:11.555991 => 07:30:11.569426
[0m07:30:11.570350 [debug] [Thread-2 (]: Began executing node model.bank_rates.dim_metals
[0m07:30:11.568729 [debug] [Thread-1 (]: Began compiling node model.bank_rates.fact_metal_prices
[0m07:30:11.583626 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_rates.fact_metal_prices"
[0m07:30:11.597333 [debug] [Thread-1 (]: Timing info for model.bank_rates.fact_metal_prices (compile): 07:30:11.577998 => 07:30:11.593685
[0m07:30:11.605819 [debug] [Thread-1 (]: Began executing node model.bank_rates.fact_metal_prices
[0m07:30:11.683019 [debug] [Thread-2 (]: Writing runtime sql for node "model.bank_rates.dim_metals"
[0m07:30:11.694584 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_rates.fact_metal_prices"
[0m07:30:11.696101 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m07:30:11.696778 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: BEGIN
[0m07:30:11.697414 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:30:11.698803 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m07:30:11.702095 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: BEGIN
[0m07:30:11.702770 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:30:11.715497 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m07:30:11.716247 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m07:30:11.716845 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */

  
    

  create  table "bank_rates"."dds"."fact_metal_prices__dbt_tmp"
  
  
    as
  
  (
    

SELECT 
    ROW_NUMBER() OVER (ORDER BY trade_date, metal_code) as price_id,
    trade_date,
    metal_code,
    metal_name,
    buy_price_rub,
    sell_price_rub,
    loaded_at,
    CURRENT_TIMESTAMP as dwh_loaded_at
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
WHERE trade_date IS NOT NULL
  AND metal_code IS NOT NULL
  );
  
[0m07:30:11.720476 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m07:30:11.721188 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m07:30:11.722211 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */

  
    

  create  table "bank_rates"."dds"."dim_metals__dbt_tmp"
  
  
    as
  
  (
    

SELECT DISTINCT
    metal_code,
    metal_name
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
WHERE metal_code IS NOT NULL
  );
  
[0m07:30:11.787656 [debug] [Thread-2 (]: SQL status: SELECT 4 in 0.0 seconds
[0m07:30:11.795291 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m07:30:11.796072 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
alter table "bank_rates"."dds"."dim_metals" rename to "dim_metals__dbt_backup"
[0m07:30:11.797350 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m07:30:11.807935 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m07:30:11.808699 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
alter table "bank_rates"."dds"."dim_metals__dbt_tmp" rename to "dim_metals"
[0m07:30:11.809938 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m07:30:11.821577 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: COMMIT
[0m07:30:11.822360 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m07:30:11.822987 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: COMMIT
[0m07:30:11.834352 [debug] [Thread-1 (]: SQL status: SELECT 16800 in 0.0 seconds
[0m07:30:11.845974 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m07:30:11.846816 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
alter table "bank_rates"."dds"."fact_metal_prices" rename to "fact_metal_prices__dbt_backup"
[0m07:30:11.848007 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m07:30:11.854658 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m07:30:11.855237 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m07:30:11.856004 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
alter table "bank_rates"."dds"."fact_metal_prices__dbt_tmp" rename to "fact_metal_prices"
[0m07:30:11.863988 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m07:30:11.865090 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
drop table if exists "bank_rates"."dds"."dim_metals__dbt_backup" cascade
[0m07:30:11.865722 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m07:30:11.869221 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: COMMIT
[0m07:30:11.869824 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m07:30:11.870389 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: COMMIT
[0m07:30:11.901509 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m07:30:11.906687 [debug] [Thread-2 (]: Timing info for model.bank_rates.dim_metals (execute): 07:30:11.570714 => 07:30:11.906218
[0m07:30:11.907260 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m07:30:11.907928 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: Close
[0m07:30:11.915177 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd034ec1-5f43-4136-b031-e5ef56662dc3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a11bc5baf80>]}
[0m07:30:11.913858 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m07:30:11.917742 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
drop table if exists "bank_rates"."dds"."fact_metal_prices__dbt_backup" cascade
[0m07:30:11.917148 [info ] [Thread-2 (]: 2 of 4 OK created sql table model dds.dim_metals ............................... [[32mSELECT 4[0m in 0.36s]
[0m07:30:11.918855 [debug] [Thread-2 (]: Finished running node model.bank_rates.dim_metals
[0m07:30:11.945809 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m07:30:11.948911 [debug] [Thread-1 (]: Timing info for model.bank_rates.fact_metal_prices (execute): 07:30:11.606347 => 07:30:11.948538
[0m07:30:11.949582 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: Close
[0m07:30:11.950867 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd034ec1-5f43-4136-b031-e5ef56662dc3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a11bc17d5d0>]}
[0m07:30:11.951828 [info ] [Thread-1 (]: 3 of 4 OK created sql table model dds.fact_metal_prices ........................ [[32mSELECT 16800[0m in 0.39s]
[0m07:30:11.952795 [debug] [Thread-1 (]: Finished running node model.bank_rates.fact_metal_prices
[0m07:30:11.955925 [debug] [Thread-2 (]: Began running node model.bank_rates.metal_prices_analytics
[0m07:30:11.956712 [info ] [Thread-2 (]: 4 of 4 START sql table model mart.metal_prices_analytics ....................... [RUN]
[0m07:30:11.957786 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bank_rates.dim_metals, now model.bank_rates.metal_prices_analytics)
[0m07:30:11.958394 [debug] [Thread-2 (]: Began compiling node model.bank_rates.metal_prices_analytics
[0m07:30:11.965132 [debug] [Thread-2 (]: Writing injected SQL for node "model.bank_rates.metal_prices_analytics"
[0m07:30:11.966204 [debug] [Thread-2 (]: Timing info for model.bank_rates.metal_prices_analytics (compile): 07:30:11.958765 => 07:30:11.965823
[0m07:30:11.966777 [debug] [Thread-2 (]: Began executing node model.bank_rates.metal_prices_analytics
[0m07:30:11.975438 [debug] [Thread-2 (]: Writing runtime sql for node "model.bank_rates.metal_prices_analytics"
[0m07:30:11.976417 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m07:30:11.977009 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: BEGIN
[0m07:30:11.977550 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:30:11.994279 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m07:30:11.995092 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m07:30:11.995787 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */

  
    

  create  table "bank_rates"."mart"."metal_prices_analytics__dbt_tmp"
  
  
    as
  
  (
    

SELECT 
    f.trade_date,
    f.metal_name,
    f.buy_price_rub,
    f.sell_price_rub,
    ROUND((f.buy_price_rub + f.sell_price_rub) / 2, 2) as avg_price_rub,
    LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) as prev_buy_price,
    LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) as prev_sell_price,
    CASE 
        WHEN LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) IS NOT NULL 
        THEN ROUND((f.buy_price_rub - LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date)) / 
                   LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) * 100, 2)
        ELSE NULL 
    END as buy_price_change_percent,
    CASE 
        WHEN LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) IS NOT NULL 
        THEN ROUND((f.sell_price_rub - LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date)) / 
                   LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) * 100, 2)
        ELSE NULL 
    END as sell_price_change_percent
FROM "bank_rates"."dds"."fact_metal_prices" f
ORDER BY f.trade_date DESC, f.metal_name
  );
  
[0m07:30:12.145707 [debug] [Thread-2 (]: SQL status: SELECT 16800 in 0.0 seconds
[0m07:30:12.155578 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m07:30:12.156378 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
alter table "bank_rates"."mart"."metal_prices_analytics" rename to "metal_prices_analytics__dbt_backup"
[0m07:30:12.157640 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m07:30:12.163720 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m07:30:12.167422 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
alter table "bank_rates"."mart"."metal_prices_analytics__dbt_tmp" rename to "metal_prices_analytics"
[0m07:30:12.168544 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m07:30:12.171662 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: COMMIT
[0m07:30:12.172260 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m07:30:12.172812 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: COMMIT
[0m07:30:12.182932 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m07:30:12.187869 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m07:30:12.190654 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
drop table if exists "bank_rates"."mart"."metal_prices_analytics__dbt_backup" cascade
[0m07:30:12.194836 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m07:30:12.197595 [debug] [Thread-2 (]: Timing info for model.bank_rates.metal_prices_analytics (execute): 07:30:11.967150 => 07:30:12.197252
[0m07:30:12.198231 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: Close
[0m07:30:12.201934 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cd034ec1-5f43-4136-b031-e5ef56662dc3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a11bc12f460>]}
[0m07:30:12.202906 [info ] [Thread-2 (]: 4 of 4 OK created sql table model mart.metal_prices_analytics .................. [[32mSELECT 16800[0m in 0.24s]
[0m07:30:12.203836 [debug] [Thread-2 (]: Finished running node model.bank_rates.metal_prices_analytics
[0m07:30:12.207853 [debug] [MainThread]: Using postgres connection "master"
[0m07:30:12.208397 [debug] [MainThread]: On master: BEGIN
[0m07:30:12.208833 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m07:30:12.226681 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m07:30:12.227505 [debug] [MainThread]: On master: COMMIT
[0m07:30:12.228016 [debug] [MainThread]: Using postgres connection "master"
[0m07:30:12.228497 [debug] [MainThread]: On master: COMMIT
[0m07:30:12.229151 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m07:30:12.229641 [debug] [MainThread]: On master: Close
[0m07:30:12.233853 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:30:12.234538 [debug] [MainThread]: Connection 'model.bank_rates.fact_metal_prices' was properly closed.
[0m07:30:12.235003 [debug] [MainThread]: Connection 'model.bank_rates.metal_prices_analytics' was properly closed.
[0m07:30:12.238277 [info ] [MainThread]: 
[0m07:30:12.238915 [info ] [MainThread]: Finished running 1 view model, 3 table models in 0 hours 0 minutes and 1.40 seconds (1.40s).
[0m07:30:12.241466 [debug] [MainThread]: Command end result
[0m07:30:12.257905 [info ] [MainThread]: 
[0m07:30:12.258928 [info ] [MainThread]: [32mCompleted successfully[0m
[0m07:30:12.259580 [info ] [MainThread]: 
[0m07:30:12.260231 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m07:30:12.261299 [debug] [MainThread]: Command `dbt run` succeeded at 07:30:12.261002 after 2.02 seconds
[0m07:30:12.261879 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a11be825990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a11bc1f6260>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a11bc1f62c0>]}
[0m07:30:12.262470 [debug] [MainThread]: Flushing usage events
[0m07:30:17.113916 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b54716f9930>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b54701df9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b54701dfa60>]}


============================== 07:30:17.121409 | 1c048588-2b9f-43d9-803c-dcfbb25d26b6 ==============================
[0m07:30:17.121409 [info ] [MainThread]: Running with dbt=1.5.0
[0m07:30:17.123984 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'use_colors': 'True', 'profiles_dir': '.', 'target_path': 'None', 'version_check': 'True', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'partial_parse': 'True', 'debug': 'False', 'write_json': 'True', 'introspect': 'True', 'quiet': 'False', 'no_print': 'None', 'fail_fast': 'False', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'log_format': 'default', 'static_parser': 'True', 'log_path': '/usr/app/logs', 'cache_selected_only': 'False', 'log_cache_events': 'False'}
[0m07:30:17.358540 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1c048588-2b9f-43d9-803c-dcfbb25d26b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b54701dfbb0>]}
[0m07:30:17.398405 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1c048588-2b9f-43d9-803c-dcfbb25d26b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b54700ea8c0>]}
[0m07:30:17.420049 [debug] [MainThread]: checksum: 4568eb639a77b8fcb3a1f4a07856f42b1ff63f1376652889143968e1dbdafbda, vars: {}, profile: , target: , version: 1.5.0
[0m07:30:17.463347 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:30:17.463985 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:30:17.477679 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1c048588-2b9f-43d9-803c-dcfbb25d26b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b546f6f6650>]}
[0m07:30:17.492003 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1c048588-2b9f-43d9-803c-dcfbb25d26b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b546f6c77f0>]}
[0m07:30:17.492874 [info ] [MainThread]: Found 4 models, 3 tests, 0 snapshots, 0 analyses, 308 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m07:30:17.493646 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1c048588-2b9f-43d9-803c-dcfbb25d26b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b546f6c7880>]}
[0m07:30:17.496123 [info ] [MainThread]: 
[0m07:30:17.499183 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m07:30:17.501351 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates_dds'
[0m07:30:17.509571 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates_mart'
[0m07:30:17.547674 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m07:30:17.556371 [debug] [ThreadPool]: On list_bank_rates_dds: BEGIN
[0m07:30:17.555636 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m07:30:17.556866 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:30:17.557377 [debug] [ThreadPool]: On list_bank_rates_mart: BEGIN
[0m07:30:17.558213 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:30:17.581706 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m07:30:17.582826 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m07:30:17.583498 [debug] [ThreadPool]: On list_bank_rates_mart: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_mart"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'mart'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'mart'
  
[0m07:30:17.585744 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m07:30:17.586271 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m07:30:17.586768 [debug] [ThreadPool]: On list_bank_rates_dds: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_dds"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dds'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dds'
  
[0m07:30:17.587629 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m07:30:17.589712 [debug] [ThreadPool]: On list_bank_rates_mart: ROLLBACK
[0m07:30:17.592392 [debug] [ThreadPool]: On list_bank_rates_mart: Close
[0m07:30:17.593935 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates_mart, now list_bank_rates_staging)
[0m07:30:17.599169 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m07:30:17.599717 [debug] [ThreadPool]: On list_bank_rates_staging: BEGIN
[0m07:30:17.601201 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:30:17.618736 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m07:30:17.619746 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m07:30:17.620348 [debug] [ThreadPool]: On list_bank_rates_staging: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_staging"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging'
  
[0m07:30:17.621613 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m07:30:17.623998 [debug] [ThreadPool]: On list_bank_rates_dds: ROLLBACK
[0m07:30:17.625814 [debug] [ThreadPool]: On list_bank_rates_dds: Close
[0m07:30:17.629228 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m07:30:17.630992 [debug] [ThreadPool]: On list_bank_rates_staging: ROLLBACK
[0m07:30:17.632189 [debug] [ThreadPool]: On list_bank_rates_staging: Close
[0m07:30:17.644450 [debug] [MainThread]: Using postgres connection "master"
[0m07:30:17.645156 [debug] [MainThread]: On master: BEGIN
[0m07:30:17.645706 [debug] [MainThread]: Opening a new connection, currently in state init
[0m07:30:17.662714 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m07:30:17.663524 [debug] [MainThread]: Using postgres connection "master"
[0m07:30:17.664239 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m07:30:17.673875 [debug] [MainThread]: SQL status: SELECT 3 in 0.0 seconds
[0m07:30:17.676298 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1c048588-2b9f-43d9-803c-dcfbb25d26b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b546f6e3fa0>]}
[0m07:30:17.677190 [debug] [MainThread]: On master: ROLLBACK
[0m07:30:17.682440 [debug] [MainThread]: Using postgres connection "master"
[0m07:30:17.683091 [debug] [MainThread]: On master: BEGIN
[0m07:30:17.683931 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m07:30:17.684617 [debug] [MainThread]: On master: COMMIT
[0m07:30:17.685152 [debug] [MainThread]: Using postgres connection "master"
[0m07:30:17.685688 [debug] [MainThread]: On master: COMMIT
[0m07:30:17.686349 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m07:30:17.686941 [debug] [MainThread]: On master: Close
[0m07:30:17.688094 [info ] [MainThread]: Concurrency: 2 threads (target='dev')
[0m07:30:17.690157 [info ] [MainThread]: 
[0m07:30:17.701391 [debug] [Thread-1 (]: Began running node test.bank_rates.not_null_key_columns
[0m07:30:17.703798 [info ] [Thread-1 (]: 1 of 3 START test not_null_key_columns ......................................... [RUN]
[0m07:30:17.702049 [debug] [Thread-2 (]: Began running node test.bank_rates.positive_prices
[0m07:30:17.708517 [info ] [Thread-2 (]: 2 of 3 START test positive_prices .............................................. [RUN]
[0m07:30:17.705708 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_bank_rates_staging, now test.bank_rates.not_null_key_columns)
[0m07:30:17.709663 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_bank_rates_dds, now test.bank_rates.positive_prices)
[0m07:30:17.710358 [debug] [Thread-1 (]: Began compiling node test.bank_rates.not_null_key_columns
[0m07:30:17.713481 [debug] [Thread-2 (]: Began compiling node test.bank_rates.positive_prices
[0m07:30:17.721534 [debug] [Thread-1 (]: Writing injected SQL for node "test.bank_rates.not_null_key_columns"
[0m07:30:17.734497 [debug] [Thread-1 (]: Timing info for test.bank_rates.not_null_key_columns (compile): 07:30:17.713937 => 07:30:17.733992
[0m07:30:17.735253 [debug] [Thread-1 (]: Began executing node test.bank_rates.not_null_key_columns
[0m07:30:17.729615 [debug] [Thread-2 (]: Writing injected SQL for node "test.bank_rates.positive_prices"
[0m07:30:17.745819 [debug] [Thread-2 (]: Timing info for test.bank_rates.positive_prices (compile): 07:30:17.725126 => 07:30:17.745363
[0m07:30:17.754500 [debug] [Thread-2 (]: Began executing node test.bank_rates.positive_prices
[0m07:30:17.811245 [debug] [Thread-1 (]: Writing runtime sql for node "test.bank_rates.not_null_key_columns"
[0m07:30:17.816529 [debug] [Thread-1 (]: Using postgres connection "test.bank_rates.not_null_key_columns"
[0m07:30:17.819304 [debug] [Thread-1 (]: On test.bank_rates.not_null_key_columns: BEGIN
[0m07:30:17.819926 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:30:17.814988 [debug] [Thread-2 (]: Writing runtime sql for node "test.bank_rates.positive_prices"
[0m07:30:17.821624 [debug] [Thread-2 (]: Using postgres connection "test.bank_rates.positive_prices"
[0m07:30:17.822280 [debug] [Thread-2 (]: On test.bank_rates.positive_prices: BEGIN
[0m07:30:17.822946 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:30:17.872888 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m07:30:17.874510 [debug] [Thread-1 (]: Using postgres connection "test.bank_rates.not_null_key_columns"
[0m07:30:17.873914 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m07:30:17.875247 [debug] [Thread-1 (]: On test.bank_rates.not_null_key_columns: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "test.bank_rates.not_null_key_columns"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      SELECT 
    trade_date,
    metal_code
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
WHERE trade_date IS NULL 
   OR metal_code IS NULL 
   OR buy_price_rub IS NULL 
   OR sell_price_rub IS NULL
      
    ) dbt_internal_test
[0m07:30:17.877560 [debug] [Thread-2 (]: Using postgres connection "test.bank_rates.positive_prices"
[0m07:30:17.878450 [debug] [Thread-2 (]: On test.bank_rates.positive_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "test.bank_rates.positive_prices"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      SELECT 
    trade_date,
    metal_code,
    buy_price_rub,
    sell_price_rub
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
WHERE buy_price_rub <= 0 OR sell_price_rub <= 0
      
    ) dbt_internal_test
[0m07:30:17.918688 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m07:30:17.923355 [debug] [Thread-1 (]: Timing info for test.bank_rates.not_null_key_columns (execute): 07:30:17.737826 => 07:30:17.922903
[0m07:30:17.926379 [debug] [Thread-1 (]: On test.bank_rates.not_null_key_columns: ROLLBACK
[0m07:30:17.927370 [debug] [Thread-1 (]: On test.bank_rates.not_null_key_columns: Close
[0m07:30:17.929412 [info ] [Thread-1 (]: 1 of 3 PASS not_null_key_columns ............................................... [[32mPASS[0m in 0.22s]
[0m07:30:17.928033 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m07:30:17.930587 [debug] [Thread-1 (]: Finished running node test.bank_rates.not_null_key_columns
[0m07:30:17.935406 [debug] [Thread-1 (]: Began running node test.bank_rates.unique_trade_date_metal_code
[0m07:30:17.934566 [debug] [Thread-2 (]: Timing info for test.bank_rates.positive_prices (execute): 07:30:17.763714 => 07:30:17.932810
[0m07:30:17.937068 [debug] [Thread-2 (]: On test.bank_rates.positive_prices: ROLLBACK
[0m07:30:17.936131 [info ] [Thread-1 (]: 3 of 3 START test unique_trade_date_metal_code ................................. [RUN]
[0m07:30:17.938309 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.bank_rates.not_null_key_columns, now test.bank_rates.unique_trade_date_metal_code)
[0m07:30:17.939170 [debug] [Thread-1 (]: Began compiling node test.bank_rates.unique_trade_date_metal_code
[0m07:30:17.941285 [debug] [Thread-2 (]: On test.bank_rates.positive_prices: Close
[0m07:30:17.947854 [info ] [Thread-2 (]: 2 of 3 PASS positive_prices .................................................... [[32mPASS[0m in 0.24s]
[0m07:30:17.946435 [debug] [Thread-1 (]: Writing injected SQL for node "test.bank_rates.unique_trade_date_metal_code"
[0m07:30:17.951639 [debug] [Thread-2 (]: Finished running node test.bank_rates.positive_prices
[0m07:30:17.953389 [debug] [Thread-1 (]: Timing info for test.bank_rates.unique_trade_date_metal_code (compile): 07:30:17.941742 => 07:30:17.952969
[0m07:30:17.953995 [debug] [Thread-1 (]: Began executing node test.bank_rates.unique_trade_date_metal_code
[0m07:30:17.958157 [debug] [Thread-1 (]: Writing runtime sql for node "test.bank_rates.unique_trade_date_metal_code"
[0m07:30:17.959454 [debug] [Thread-1 (]: Using postgres connection "test.bank_rates.unique_trade_date_metal_code"
[0m07:30:17.960169 [debug] [Thread-1 (]: On test.bank_rates.unique_trade_date_metal_code: BEGIN
[0m07:30:17.960796 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:30:17.977554 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m07:30:17.978535 [debug] [Thread-1 (]: Using postgres connection "test.bank_rates.unique_trade_date_metal_code"
[0m07:30:17.979289 [debug] [Thread-1 (]: On test.bank_rates.unique_trade_date_metal_code: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "test.bank_rates.unique_trade_date_metal_code"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      SELECT 
    trade_date,
    metal_code,
    COUNT(*) as count
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
GROUP BY trade_date, metal_code
HAVING COUNT(*) > 1
      
    ) dbt_internal_test
[0m07:30:18.036579 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m07:30:18.039710 [debug] [Thread-1 (]: Timing info for test.bank_rates.unique_trade_date_metal_code (execute): 07:30:17.954359 => 07:30:18.039282
[0m07:30:18.040499 [debug] [Thread-1 (]: On test.bank_rates.unique_trade_date_metal_code: ROLLBACK
[0m07:30:18.041373 [debug] [Thread-1 (]: On test.bank_rates.unique_trade_date_metal_code: Close
[0m07:30:18.042805 [info ] [Thread-1 (]: 3 of 3 PASS unique_trade_date_metal_code ....................................... [[32mPASS[0m in 0.10s]
[0m07:30:18.043821 [debug] [Thread-1 (]: Finished running node test.bank_rates.unique_trade_date_metal_code
[0m07:30:18.046373 [debug] [MainThread]: Using postgres connection "master"
[0m07:30:18.049522 [debug] [MainThread]: On master: BEGIN
[0m07:30:18.050083 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m07:30:18.066948 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m07:30:18.067776 [debug] [MainThread]: On master: COMMIT
[0m07:30:18.068430 [debug] [MainThread]: Using postgres connection "master"
[0m07:30:18.068995 [debug] [MainThread]: On master: COMMIT
[0m07:30:18.069729 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m07:30:18.070289 [debug] [MainThread]: On master: Close
[0m07:30:18.073816 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:30:18.074389 [debug] [MainThread]: Connection 'test.bank_rates.positive_prices' was properly closed.
[0m07:30:18.077969 [debug] [MainThread]: Connection 'test.bank_rates.unique_trade_date_metal_code' was properly closed.
[0m07:30:18.078669 [info ] [MainThread]: 
[0m07:30:18.079382 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 0.58 seconds (0.58s).
[0m07:30:18.081107 [debug] [MainThread]: Command end result
[0m07:30:18.094963 [info ] [MainThread]: 
[0m07:30:18.095926 [info ] [MainThread]: [32mCompleted successfully[0m
[0m07:30:18.096668 [info ] [MainThread]: 
[0m07:30:18.097397 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m07:30:18.100778 [debug] [MainThread]: Command `dbt test` succeeded at 07:30:18.100576 after 1.00 seconds
[0m07:30:18.101476 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b54716f9930>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b54700ea8c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b546f6c78e0>]}
[0m07:30:18.102188 [debug] [MainThread]: Flushing usage events
[0m09:20:03.751552 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7788d23cd9c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7788d0ddfa60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7788d0ddfaf0>]}


============================== 09:20:03.758826 | 5981a676-df43-4e88-a449-d37b4aa5259f ==============================
[0m09:20:03.758826 [info ] [MainThread]: Running with dbt=1.5.0
[0m09:20:03.759364 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'log_format': 'default', 'version_check': 'True', 'debug': 'False', 'profiles_dir': '.', 'use_colors': 'True', 'introspect': 'True', 'cache_selected_only': 'False', 'log_path': '/usr/app/logs', 'partial_parse': 'True', 'printer_width': '80', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'warn_error': 'None', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'quiet': 'False', 'static_parser': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False'}
[0m09:20:03.966576 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5981a676-df43-4e88-a449-d37b4aa5259f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7788d0ddfc40>]}
[0m09:20:03.980664 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5981a676-df43-4e88-a449-d37b4aa5259f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7788d0cfe320>]}
[0m09:20:03.989864 [debug] [MainThread]: checksum: 4568eb639a77b8fcb3a1f4a07856f42b1ff63f1376652889143968e1dbdafbda, vars: {}, profile: , target: , version: 1.5.0
[0m09:20:04.109132 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:20:04.109474 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:20:04.114822 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5981a676-df43-4e88-a449-d37b4aa5259f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7788cfd7e6e0>]}
[0m09:20:04.122895 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5981a676-df43-4e88-a449-d37b4aa5259f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7788cfd4f880>]}
[0m09:20:04.123248 [info ] [MainThread]: Found 4 models, 3 tests, 0 snapshots, 0 analyses, 308 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m09:20:04.123561 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5981a676-df43-4e88-a449-d37b4aa5259f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7788cfd4f910>]}
[0m09:20:04.124884 [info ] [MainThread]: 
[0m09:20:04.125484 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m09:20:04.126538 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m09:20:04.127225 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m09:20:04.136050 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m09:20:04.137490 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m09:20:04.137769 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m09:20:04.138049 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m09:20:04.138294 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:20:04.138537 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:20:04.187813 [debug] [ThreadPool]: SQL status: SELECT 11 in 0.0 seconds
[0m09:20:04.189122 [debug] [ThreadPool]: On list_bank_rates: Close
[0m09:20:04.189378 [debug] [ThreadPool]: SQL status: SELECT 11 in 0.0 seconds
[0m09:20:04.191560 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m09:20:04.192546 [debug] [ThreadPool]: On list_bank_rates: Close
[0m09:20:04.192865 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m09:20:04.193566 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:20:04.202272 [debug] [ThreadPool]: SQL status: SELECT 11 in 0.0 seconds
[0m09:20:04.203155 [debug] [ThreadPool]: On list_bank_rates: Close
[0m09:20:04.204420 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates, now list_bank_rates_staging)
[0m09:20:04.204988 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates, now list_bank_rates_mart)
[0m09:20:04.209782 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m09:20:04.211237 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m09:20:04.211567 [debug] [ThreadPool]: On list_bank_rates_staging: BEGIN
[0m09:20:04.211820 [debug] [ThreadPool]: On list_bank_rates_mart: BEGIN
[0m09:20:04.212091 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:20:04.212333 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:20:04.219787 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m09:20:04.220111 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m09:20:04.220339 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m09:20:04.220585 [debug] [ThreadPool]: On list_bank_rates_mart: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_mart"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'mart'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'mart'
  
[0m09:20:04.220840 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m09:20:04.221181 [debug] [ThreadPool]: On list_bank_rates_staging: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_staging"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging'
  
[0m09:20:04.230839 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m09:20:04.231819 [debug] [ThreadPool]: On list_bank_rates_mart: ROLLBACK
[0m09:20:04.232081 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m09:20:04.232878 [debug] [ThreadPool]: On list_bank_rates_staging: ROLLBACK
[0m09:20:04.233130 [debug] [ThreadPool]: On list_bank_rates_mart: Close
[0m09:20:04.233940 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates_mart, now list_bank_rates_dds)
[0m09:20:04.234459 [debug] [ThreadPool]: On list_bank_rates_staging: Close
[0m09:20:04.235879 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m09:20:04.236644 [debug] [ThreadPool]: On list_bank_rates_dds: BEGIN
[0m09:20:04.236854 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:20:04.242817 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m09:20:04.243094 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m09:20:04.243315 [debug] [ThreadPool]: On list_bank_rates_dds: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_dds"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dds'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dds'
  
[0m09:20:04.245521 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m09:20:04.246363 [debug] [ThreadPool]: On list_bank_rates_dds: ROLLBACK
[0m09:20:04.246727 [debug] [ThreadPool]: On list_bank_rates_dds: Close
[0m09:20:04.250359 [debug] [MainThread]: Using postgres connection "master"
[0m09:20:04.250624 [debug] [MainThread]: On master: BEGIN
[0m09:20:04.250917 [debug] [MainThread]: Opening a new connection, currently in state init
[0m09:20:04.256973 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m09:20:04.257247 [debug] [MainThread]: Using postgres connection "master"
[0m09:20:04.257595 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m09:20:04.266092 [debug] [MainThread]: SQL status: SELECT 3 in 0.0 seconds
[0m09:20:04.267042 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5981a676-df43-4e88-a449-d37b4aa5259f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7788cfdc4310>]}
[0m09:20:04.267403 [debug] [MainThread]: On master: ROLLBACK
[0m09:20:04.267750 [debug] [MainThread]: Using postgres connection "master"
[0m09:20:04.268012 [debug] [MainThread]: On master: BEGIN
[0m09:20:04.268487 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m09:20:04.268736 [debug] [MainThread]: On master: COMMIT
[0m09:20:04.269019 [debug] [MainThread]: Using postgres connection "master"
[0m09:20:04.269264 [debug] [MainThread]: On master: COMMIT
[0m09:20:04.269604 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m09:20:04.269846 [debug] [MainThread]: On master: Close
[0m09:20:04.270418 [info ] [MainThread]: Concurrency: 2 threads (target='dev')
[0m09:20:04.270723 [info ] [MainThread]: 
[0m09:20:04.276084 [debug] [Thread-1 (]: Began running node model.bank_rates.stg_cbr_precious_metals
[0m09:20:04.276473 [info ] [Thread-1 (]: 1 of 4 START sql view model staging.stg_cbr_precious_metals .................... [RUN]
[0m09:20:04.277042 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_bank_rates_dds, now model.bank_rates.stg_cbr_precious_metals)
[0m09:20:04.277311 [debug] [Thread-1 (]: Began compiling node model.bank_rates.stg_cbr_precious_metals
[0m09:20:04.279516 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_rates.stg_cbr_precious_metals"
[0m09:20:04.280076 [debug] [Thread-1 (]: Timing info for model.bank_rates.stg_cbr_precious_metals (compile): 09:20:04.277483 => 09:20:04.279872
[0m09:20:04.280343 [debug] [Thread-1 (]: Began executing node model.bank_rates.stg_cbr_precious_metals
[0m09:20:04.307232 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_rates.stg_cbr_precious_metals"
[0m09:20:04.307770 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m09:20:04.308055 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: BEGIN
[0m09:20:04.308305 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:20:04.314627 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m09:20:04.314959 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m09:20:04.315254 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */

  create view "bank_rates"."staging"."stg_cbr_precious_metals__dbt_tmp"
    
    
  as (
    

WITH ranked_data AS (
    SELECT 
        id,
        record_date::DATE as trade_date,
        metal_code::INTEGER as metal_code,
        buy_price::DECIMAL(10,2) as buy_price_rub,
        sell_price::DECIMAL(10,2) as sell_price_rub,
        from_date::DATE as valid_from,
        to_date::DATE as valid_to,
        load_timestamp::TIMESTAMP as loaded_at,
        -- Ð’Ñ‹Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÑŽÑŽ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÑƒ Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð´Ð½Ñ Ð¸ Ð¼ÐµÑ‚Ð°Ð»Ð»Ð°
        ROW_NUMBER() OVER (
            PARTITION BY record_date, metal_code 
            ORDER BY load_timestamp DESC
        ) as rn
    FROM raw.cbr_precious_metals
    WHERE record_date IS NOT NULL
      AND metal_code IS NOT NULL
      AND buy_price IS NOT NULL
)
SELECT 
    trade_date,
    metal_code,
    CASE 
        WHEN metal_code = 1 THEN 'Ð—Ð¾Ð»Ð¾Ñ‚Ð¾'
        WHEN metal_code = 2 THEN 'Ð¡ÐµÑ€ÐµÐ±Ñ€Ð¾'
        WHEN metal_code = 3 THEN 'ÐŸÐ»Ð°Ñ‚Ð¸Ð½Ð°'
        WHEN metal_code = 4 THEN 'ÐŸÐ°Ð»Ð»Ð°Ð´Ð¸Ð¹'
        ELSE 'ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ð¹ Ð¼ÐµÑ‚Ð°Ð»Ð»'
    END as metal_name,
    buy_price_rub,
    sell_price_rub,
    valid_from,
    valid_to,
    loaded_at
FROM ranked_data
WHERE rn = 1
  );
[0m09:20:04.364269 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.0 seconds
[0m09:20:04.369139 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m09:20:04.369437 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
alter table "bank_rates"."staging"."stg_cbr_precious_metals" rename to "stg_cbr_precious_metals__dbt_backup"
[0m09:20:04.370019 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m09:20:04.371973 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m09:20:04.372273 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
alter table "bank_rates"."staging"."stg_cbr_precious_metals__dbt_tmp" rename to "stg_cbr_precious_metals"
[0m09:20:04.372759 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m09:20:04.386218 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: COMMIT
[0m09:20:04.386521 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m09:20:04.386807 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: COMMIT
[0m09:20:04.388776 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m09:20:04.392311 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m09:20:04.392601 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
drop view if exists "bank_rates"."staging"."stg_cbr_precious_metals__dbt_backup" cascade
[0m09:20:04.427701 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.0 seconds
[0m09:20:04.428984 [debug] [Thread-1 (]: Timing info for model.bank_rates.stg_cbr_precious_metals (execute): 09:20:04.280509 => 09:20:04.428801
[0m09:20:04.429269 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: Close
[0m09:20:04.429839 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5981a676-df43-4e88-a449-d37b4aa5259f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7788cf9443a0>]}
[0m09:20:04.430330 [info ] [Thread-1 (]: 1 of 4 OK created sql view model staging.stg_cbr_precious_metals ............... [[32mCREATE VIEW[0m in 0.15s]
[0m09:20:04.431056 [debug] [Thread-1 (]: Finished running node model.bank_rates.stg_cbr_precious_metals
[0m09:20:04.431914 [debug] [Thread-2 (]: Began running node model.bank_rates.dim_metals
[0m09:20:04.432246 [debug] [Thread-1 (]: Began running node model.bank_rates.fact_metal_prices
[0m09:20:04.432560 [info ] [Thread-2 (]: 2 of 4 START sql table model dds.dim_metals .................................... [RUN]
[0m09:20:04.433028 [info ] [Thread-1 (]: 3 of 4 START sql table model dds.fact_metal_prices ............................. [RUN]
[0m09:20:04.433578 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_bank_rates_staging, now model.bank_rates.dim_metals)
[0m09:20:04.434041 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.bank_rates.stg_cbr_precious_metals, now model.bank_rates.fact_metal_prices)
[0m09:20:04.434384 [debug] [Thread-2 (]: Began compiling node model.bank_rates.dim_metals
[0m09:20:04.434674 [debug] [Thread-1 (]: Began compiling node model.bank_rates.fact_metal_prices
[0m09:20:04.437079 [debug] [Thread-2 (]: Writing injected SQL for node "model.bank_rates.dim_metals"
[0m09:20:04.439069 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_rates.fact_metal_prices"
[0m09:20:04.439718 [debug] [Thread-2 (]: Timing info for model.bank_rates.dim_metals (compile): 09:20:04.434916 => 09:20:04.439504
[0m09:20:04.440065 [debug] [Thread-1 (]: Timing info for model.bank_rates.fact_metal_prices (compile): 09:20:04.437303 => 09:20:04.439886
[0m09:20:04.440311 [debug] [Thread-2 (]: Began executing node model.bank_rates.dim_metals
[0m09:20:04.440612 [debug] [Thread-1 (]: Began executing node model.bank_rates.fact_metal_prices
[0m09:20:04.462608 [debug] [Thread-2 (]: Writing runtime sql for node "model.bank_rates.dim_metals"
[0m09:20:04.463084 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_rates.fact_metal_prices"
[0m09:20:04.463687 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m09:20:04.464001 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m09:20:04.464256 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: BEGIN
[0m09:20:04.464550 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: BEGIN
[0m09:20:04.464871 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m09:20:04.465196 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:20:04.472581 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m09:20:04.472836 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m09:20:04.473183 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m09:20:04.473478 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m09:20:04.473814 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */

  
    

  create  table "bank_rates"."dds"."dim_metals__dbt_tmp"
  
  
    as
  
  (
    

SELECT DISTINCT
    metal_code,
    metal_name
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
WHERE metal_code IS NOT NULL
  );
  
[0m09:20:04.474181 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */

  
    

  create  table "bank_rates"."dds"."fact_metal_prices__dbt_tmp"
  
  
    as
  
  (
    

SELECT 
    ROW_NUMBER() OVER (ORDER BY trade_date, metal_code) as price_id,
    trade_date,
    metal_code,
    metal_name,
    buy_price_rub,
    sell_price_rub,
    loaded_at,
    CURRENT_TIMESTAMP as dwh_loaded_at
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
WHERE trade_date IS NOT NULL
  AND metal_code IS NOT NULL
  );
  
[0m09:20:04.502552 [debug] [Thread-2 (]: SQL status: SELECT 4 in 0.0 seconds
[0m09:20:04.505065 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m09:20:04.505387 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
alter table "bank_rates"."dds"."dim_metals" rename to "dim_metals__dbt_backup"
[0m09:20:04.505917 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m09:20:04.507920 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m09:20:04.508250 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
alter table "bank_rates"."dds"."dim_metals__dbt_tmp" rename to "dim_metals"
[0m09:20:04.508715 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m09:20:04.512702 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: COMMIT
[0m09:20:04.513034 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m09:20:04.513335 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: COMMIT
[0m09:20:04.517981 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m09:20:04.520543 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m09:20:04.520852 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
drop table if exists "bank_rates"."dds"."dim_metals__dbt_backup" cascade
[0m09:20:04.523924 [debug] [Thread-1 (]: SQL status: SELECT 16804 in 0.0 seconds
[0m09:20:04.525825 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m09:20:04.526124 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
alter table "bank_rates"."dds"."fact_metal_prices" rename to "fact_metal_prices__dbt_backup"
[0m09:20:04.526419 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m09:20:04.526659 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m09:20:04.527718 [debug] [Thread-2 (]: Timing info for model.bank_rates.dim_metals (execute): 09:20:04.440812 => 09:20:04.527574
[0m09:20:04.529594 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m09:20:04.529940 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: Close
[0m09:20:04.530252 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
alter table "bank_rates"."dds"."fact_metal_prices__dbt_tmp" rename to "fact_metal_prices"
[0m09:20:04.530924 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5981a676-df43-4e88-a449-d37b4aa5259f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7788cf9c75b0>]}
[0m09:20:04.531431 [info ] [Thread-2 (]: 2 of 4 OK created sql table model dds.dim_metals ............................... [[32mSELECT 4[0m in 0.10s]
[0m09:20:04.531802 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m09:20:04.532259 [debug] [Thread-2 (]: Finished running node model.bank_rates.dim_metals
[0m09:20:04.533569 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: COMMIT
[0m09:20:04.534052 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m09:20:04.534310 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: COMMIT
[0m09:20:04.538169 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m09:20:04.539861 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m09:20:04.540168 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
drop table if exists "bank_rates"."dds"."fact_metal_prices__dbt_backup" cascade
[0m09:20:04.584704 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m09:20:04.585978 [debug] [Thread-1 (]: Timing info for model.bank_rates.fact_metal_prices (execute): 09:20:04.456192 => 09:20:04.585803
[0m09:20:04.586260 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: Close
[0m09:20:04.586845 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5981a676-df43-4e88-a449-d37b4aa5259f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7788cf91b580>]}
[0m09:20:04.587311 [info ] [Thread-1 (]: 3 of 4 OK created sql table model dds.fact_metal_prices ........................ [[32mSELECT 16804[0m in 0.15s]
[0m09:20:04.587863 [debug] [Thread-1 (]: Finished running node model.bank_rates.fact_metal_prices
[0m09:20:04.588639 [debug] [Thread-2 (]: Began running node model.bank_rates.metal_prices_analytics
[0m09:20:04.589033 [info ] [Thread-2 (]: 4 of 4 START sql table model mart.metal_prices_analytics ....................... [RUN]
[0m09:20:04.589598 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bank_rates.dim_metals, now model.bank_rates.metal_prices_analytics)
[0m09:20:04.589864 [debug] [Thread-2 (]: Began compiling node model.bank_rates.metal_prices_analytics
[0m09:20:04.592288 [debug] [Thread-2 (]: Writing injected SQL for node "model.bank_rates.metal_prices_analytics"
[0m09:20:04.592813 [debug] [Thread-2 (]: Timing info for model.bank_rates.metal_prices_analytics (compile): 09:20:04.590075 => 09:20:04.592650
[0m09:20:04.593087 [debug] [Thread-2 (]: Began executing node model.bank_rates.metal_prices_analytics
[0m09:20:04.595759 [debug] [Thread-2 (]: Writing runtime sql for node "model.bank_rates.metal_prices_analytics"
[0m09:20:04.596236 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m09:20:04.596495 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: BEGIN
[0m09:20:04.596739 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m09:20:04.603416 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m09:20:04.603727 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m09:20:04.604036 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */

  
    

  create  table "bank_rates"."mart"."metal_prices_analytics__dbt_tmp"
  
  
    as
  
  (
    

SELECT 
    f.trade_date,
    f.metal_name,
    f.buy_price_rub,
    f.sell_price_rub,
    ROUND((f.buy_price_rub + f.sell_price_rub) / 2, 2) as avg_price_rub,
    LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) as prev_buy_price,
    LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) as prev_sell_price,
    CASE 
        WHEN LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) IS NOT NULL 
        THEN ROUND((f.buy_price_rub - LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date)) / 
                   LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) * 100, 2)
        ELSE NULL 
    END as buy_price_change_percent,
    CASE 
        WHEN LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) IS NOT NULL 
        THEN ROUND((f.sell_price_rub - LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date)) / 
                   LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) * 100, 2)
        ELSE NULL 
    END as sell_price_change_percent
FROM "bank_rates"."dds"."fact_metal_prices" f
ORDER BY f.trade_date DESC, f.metal_name
  );
  
[0m09:20:04.662507 [debug] [Thread-2 (]: SQL status: SELECT 16804 in 0.0 seconds
[0m09:20:04.665069 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m09:20:04.665361 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
alter table "bank_rates"."mart"."metal_prices_analytics" rename to "metal_prices_analytics__dbt_backup"
[0m09:20:04.665896 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m09:20:04.667975 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m09:20:04.668260 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
alter table "bank_rates"."mart"."metal_prices_analytics__dbt_tmp" rename to "metal_prices_analytics"
[0m09:20:04.668751 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m09:20:04.670083 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: COMMIT
[0m09:20:04.670349 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m09:20:04.670598 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: COMMIT
[0m09:20:04.677781 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m09:20:04.679607 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m09:20:04.679882 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
drop table if exists "bank_rates"."mart"."metal_prices_analytics__dbt_backup" cascade
[0m09:20:04.687165 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m09:20:04.688311 [debug] [Thread-2 (]: Timing info for model.bank_rates.metal_prices_analytics (execute): 09:20:04.593249 => 09:20:04.688166
[0m09:20:04.688573 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: Close
[0m09:20:04.689184 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5981a676-df43-4e88-a449-d37b4aa5259f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7788cf91b040>]}
[0m09:20:04.689634 [info ] [Thread-2 (]: 4 of 4 OK created sql table model mart.metal_prices_analytics .................. [[32mSELECT 16804[0m in 0.10s]
[0m09:20:04.690261 [debug] [Thread-2 (]: Finished running node model.bank_rates.metal_prices_analytics
[0m09:20:04.691410 [debug] [MainThread]: Using postgres connection "master"
[0m09:20:04.691656 [debug] [MainThread]: On master: BEGIN
[0m09:20:04.691866 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m09:20:04.700137 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m09:20:04.700385 [debug] [MainThread]: On master: COMMIT
[0m09:20:04.700596 [debug] [MainThread]: Using postgres connection "master"
[0m09:20:04.700800 [debug] [MainThread]: On master: COMMIT
[0m09:20:04.701146 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m09:20:04.701360 [debug] [MainThread]: On master: Close
[0m09:20:04.701806 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:20:04.702046 [debug] [MainThread]: Connection 'model.bank_rates.fact_metal_prices' was properly closed.
[0m09:20:04.702238 [debug] [MainThread]: Connection 'model.bank_rates.metal_prices_analytics' was properly closed.
[0m09:20:04.702491 [info ] [MainThread]: 
[0m09:20:04.702789 [info ] [MainThread]: Finished running 1 view model, 3 table models in 0 hours 0 minutes and 0.58 seconds (0.58s).
[0m09:20:04.703737 [debug] [MainThread]: Command end result
[0m09:20:04.709606 [info ] [MainThread]: 
[0m09:20:04.709969 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:20:04.710324 [info ] [MainThread]: 
[0m09:20:04.710720 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m09:20:04.711326 [debug] [MainThread]: Command `dbt run` succeeded at 09:20:04.711204 after 0.98 seconds
[0m09:20:04.711599 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7788d23cd9c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7788cfdd7ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7788cf9e2e30>]}
[0m09:20:04.711860 [debug] [MainThread]: Flushing usage events
[0m09:20:06.650811 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737a6532d9c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737a63dafa60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737a63dafaf0>]}


============================== 09:20:06.653136 | 605bc281-bebd-4ab6-bb17-77fba037259a ==============================
[0m09:20:06.653136 [info ] [MainThread]: Running with dbt=1.5.0
[0m09:20:06.653529 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'quiet': 'False', 'warn_error': 'None', 'printer_width': '80', 'partial_parse': 'True', 'target_path': 'None', 'cache_selected_only': 'False', 'version_check': 'True', 'log_path': '/usr/app/logs', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'debug': 'False', 'introspect': 'True', 'use_colors': 'True', 'write_json': 'True', 'profiles_dir': '.', 'no_print': 'None'}
[0m09:20:06.733303 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '605bc281-bebd-4ab6-bb17-77fba037259a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737a63dafc40>]}
[0m09:20:06.746610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '605bc281-bebd-4ab6-bb17-77fba037259a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737a63cd6830>]}
[0m09:20:06.754333 [debug] [MainThread]: checksum: 4568eb639a77b8fcb3a1f4a07856f42b1ff63f1376652889143968e1dbdafbda, vars: {}, profile: , target: , version: 1.5.0
[0m09:20:06.772352 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m09:20:06.772613 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m09:20:06.776881 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '605bc281-bebd-4ab6-bb17-77fba037259a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737a632e66e0>]}
[0m09:20:06.781751 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '605bc281-bebd-4ab6-bb17-77fba037259a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737a632b7880>]}
[0m09:20:06.782086 [info ] [MainThread]: Found 4 models, 3 tests, 0 snapshots, 0 analyses, 308 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m09:20:06.782370 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '605bc281-bebd-4ab6-bb17-77fba037259a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737a632b7910>]}
[0m09:20:06.783649 [info ] [MainThread]: 
[0m09:20:06.784219 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m09:20:06.785234 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates_dds'
[0m09:20:06.785951 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates_staging'
[0m09:20:06.794045 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m09:20:06.795540 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m09:20:06.795814 [debug] [ThreadPool]: On list_bank_rates_dds: BEGIN
[0m09:20:06.796087 [debug] [ThreadPool]: On list_bank_rates_staging: BEGIN
[0m09:20:06.796328 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:20:06.796566 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m09:20:06.806241 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m09:20:06.806516 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m09:20:06.806755 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m09:20:06.807022 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m09:20:06.807279 [debug] [ThreadPool]: On list_bank_rates_dds: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_dds"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dds'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dds'
  
[0m09:20:06.807536 [debug] [ThreadPool]: On list_bank_rates_staging: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_staging"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging'
  
[0m09:20:06.809743 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m09:20:06.809960 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m09:20:06.811024 [debug] [ThreadPool]: On list_bank_rates_staging: ROLLBACK
[0m09:20:06.811856 [debug] [ThreadPool]: On list_bank_rates_dds: ROLLBACK
[0m09:20:06.812253 [debug] [ThreadPool]: On list_bank_rates_staging: Close
[0m09:20:06.812475 [debug] [ThreadPool]: On list_bank_rates_dds: Close
[0m09:20:06.813225 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates_staging, now list_bank_rates_mart)
[0m09:20:06.815408 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m09:20:06.815640 [debug] [ThreadPool]: On list_bank_rates_mart: BEGIN
[0m09:20:06.815842 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m09:20:06.821675 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m09:20:06.821971 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m09:20:06.822194 [debug] [ThreadPool]: On list_bank_rates_mart: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_mart"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'mart'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'mart'
  
[0m09:20:06.824222 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m09:20:06.825027 [debug] [ThreadPool]: On list_bank_rates_mart: ROLLBACK
[0m09:20:06.825349 [debug] [ThreadPool]: On list_bank_rates_mart: Close
[0m09:20:06.828888 [debug] [MainThread]: Using postgres connection "master"
[0m09:20:06.829186 [debug] [MainThread]: On master: BEGIN
[0m09:20:06.829394 [debug] [MainThread]: Opening a new connection, currently in state init
[0m09:20:06.835228 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m09:20:06.835468 [debug] [MainThread]: Using postgres connection "master"
[0m09:20:06.835726 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m09:20:06.839416 [debug] [MainThread]: SQL status: SELECT 3 in 0.0 seconds
[0m09:20:06.840334 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '605bc281-bebd-4ab6-bb17-77fba037259a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737a6332fd60>]}
[0m09:20:06.840666 [debug] [MainThread]: On master: ROLLBACK
[0m09:20:06.841013 [debug] [MainThread]: Using postgres connection "master"
[0m09:20:06.841241 [debug] [MainThread]: On master: BEGIN
[0m09:20:06.841671 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m09:20:06.841883 [debug] [MainThread]: On master: COMMIT
[0m09:20:06.842131 [debug] [MainThread]: Using postgres connection "master"
[0m09:20:06.842317 [debug] [MainThread]: On master: COMMIT
[0m09:20:06.842586 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m09:20:06.842826 [debug] [MainThread]: On master: Close
[0m09:20:06.843323 [info ] [MainThread]: Concurrency: 2 threads (target='dev')
[0m09:20:06.843621 [info ] [MainThread]: 
[0m09:20:06.846954 [debug] [Thread-1 (]: Began running node test.bank_rates.not_null_key_columns
[0m09:20:06.847282 [debug] [Thread-2 (]: Began running node test.bank_rates.positive_prices
[0m09:20:06.847565 [info ] [Thread-1 (]: 1 of 3 START test not_null_key_columns ......................................... [RUN]
[0m09:20:06.847992 [info ] [Thread-2 (]: 2 of 3 START test positive_prices .............................................. [RUN]
[0m09:20:06.848512 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_bank_rates_mart, now test.bank_rates.not_null_key_columns)
[0m09:20:06.848979 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_bank_rates_dds, now test.bank_rates.positive_prices)
[0m09:20:06.849290 [debug] [Thread-1 (]: Began compiling node test.bank_rates.not_null_key_columns
[0m09:20:06.849574 [debug] [Thread-2 (]: Began compiling node test.bank_rates.positive_prices
[0m09:20:06.851730 [debug] [Thread-1 (]: Writing injected SQL for node "test.bank_rates.not_null_key_columns"
[0m09:20:06.853456 [debug] [Thread-2 (]: Writing injected SQL for node "test.bank_rates.positive_prices"
[0m09:20:06.854111 [debug] [Thread-2 (]: Timing info for test.bank_rates.positive_prices (compile): 09:20:06.851972 => 09:20:06.853935
[0m09:20:06.854436 [debug] [Thread-1 (]: Timing info for test.bank_rates.not_null_key_columns (compile): 09:20:06.849780 => 09:20:06.854268
[0m09:20:06.854675 [debug] [Thread-2 (]: Began executing node test.bank_rates.positive_prices
[0m09:20:06.855061 [debug] [Thread-1 (]: Began executing node test.bank_rates.not_null_key_columns
[0m09:20:06.868361 [debug] [Thread-1 (]: Writing runtime sql for node "test.bank_rates.not_null_key_columns"
[0m09:20:06.869363 [debug] [Thread-2 (]: Writing runtime sql for node "test.bank_rates.positive_prices"
[0m09:20:06.869873 [debug] [Thread-1 (]: Using postgres connection "test.bank_rates.not_null_key_columns"
[0m09:20:06.870199 [debug] [Thread-2 (]: Using postgres connection "test.bank_rates.positive_prices"
[0m09:20:06.870453 [debug] [Thread-1 (]: On test.bank_rates.not_null_key_columns: BEGIN
[0m09:20:06.870796 [debug] [Thread-2 (]: On test.bank_rates.positive_prices: BEGIN
[0m09:20:06.871107 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:20:06.871390 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m09:20:06.878318 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m09:20:06.878593 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m09:20:06.878940 [debug] [Thread-1 (]: Using postgres connection "test.bank_rates.not_null_key_columns"
[0m09:20:06.879245 [debug] [Thread-2 (]: Using postgres connection "test.bank_rates.positive_prices"
[0m09:20:06.879547 [debug] [Thread-1 (]: On test.bank_rates.not_null_key_columns: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "test.bank_rates.not_null_key_columns"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      SELECT 
    trade_date,
    metal_code
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
WHERE trade_date IS NULL 
   OR metal_code IS NULL 
   OR buy_price_rub IS NULL 
   OR sell_price_rub IS NULL
      
    ) dbt_internal_test
[0m09:20:06.879854 [debug] [Thread-2 (]: On test.bank_rates.positive_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "test.bank_rates.positive_prices"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      SELECT 
    trade_date,
    metal_code,
    buy_price_rub,
    sell_price_rub
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
WHERE buy_price_rub <= 0 OR sell_price_rub <= 0
      
    ) dbt_internal_test
[0m09:20:06.895423 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m09:20:06.897449 [debug] [Thread-1 (]: Timing info for test.bank_rates.not_null_key_columns (execute): 09:20:06.865561 => 09:20:06.897268
[0m09:20:06.897711 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m09:20:06.898000 [debug] [Thread-1 (]: On test.bank_rates.not_null_key_columns: ROLLBACK
[0m09:20:06.899050 [debug] [Thread-2 (]: Timing info for test.bank_rates.positive_prices (execute): 09:20:06.855265 => 09:20:06.898854
[0m09:20:06.899408 [debug] [Thread-2 (]: On test.bank_rates.positive_prices: ROLLBACK
[0m09:20:06.899663 [debug] [Thread-1 (]: On test.bank_rates.not_null_key_columns: Close
[0m09:20:06.900009 [debug] [Thread-2 (]: On test.bank_rates.positive_prices: Close
[0m09:20:06.900542 [info ] [Thread-1 (]: 1 of 3 PASS not_null_key_columns ............................................... [[32mPASS[0m in 0.05s]
[0m09:20:06.901226 [info ] [Thread-2 (]: 2 of 3 PASS positive_prices .................................................... [[32mPASS[0m in 0.05s]
[0m09:20:06.901726 [debug] [Thread-1 (]: Finished running node test.bank_rates.not_null_key_columns
[0m09:20:06.902155 [debug] [Thread-2 (]: Finished running node test.bank_rates.positive_prices
[0m09:20:06.902496 [debug] [Thread-1 (]: Began running node test.bank_rates.unique_trade_date_metal_code
[0m09:20:06.903016 [info ] [Thread-1 (]: 3 of 3 START test unique_trade_date_metal_code ................................. [RUN]
[0m09:20:06.903576 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.bank_rates.not_null_key_columns, now test.bank_rates.unique_trade_date_metal_code)
[0m09:20:06.903846 [debug] [Thread-1 (]: Began compiling node test.bank_rates.unique_trade_date_metal_code
[0m09:20:06.905956 [debug] [Thread-1 (]: Writing injected SQL for node "test.bank_rates.unique_trade_date_metal_code"
[0m09:20:06.906553 [debug] [Thread-1 (]: Timing info for test.bank_rates.unique_trade_date_metal_code (compile): 09:20:06.904055 => 09:20:06.906322
[0m09:20:06.906871 [debug] [Thread-1 (]: Began executing node test.bank_rates.unique_trade_date_metal_code
[0m09:20:06.908471 [debug] [Thread-1 (]: Writing runtime sql for node "test.bank_rates.unique_trade_date_metal_code"
[0m09:20:06.908930 [debug] [Thread-1 (]: Using postgres connection "test.bank_rates.unique_trade_date_metal_code"
[0m09:20:06.909211 [debug] [Thread-1 (]: On test.bank_rates.unique_trade_date_metal_code: BEGIN
[0m09:20:06.909453 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m09:20:06.915489 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m09:20:06.915776 [debug] [Thread-1 (]: Using postgres connection "test.bank_rates.unique_trade_date_metal_code"
[0m09:20:06.916063 [debug] [Thread-1 (]: On test.bank_rates.unique_trade_date_metal_code: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "test.bank_rates.unique_trade_date_metal_code"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      SELECT 
    trade_date,
    metal_code,
    COUNT(*) as count
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
GROUP BY trade_date, metal_code
HAVING COUNT(*) > 1
      
    ) dbt_internal_test
[0m09:20:06.932494 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m09:20:06.933665 [debug] [Thread-1 (]: Timing info for test.bank_rates.unique_trade_date_metal_code (execute): 09:20:06.907081 => 09:20:06.933499
[0m09:20:06.933957 [debug] [Thread-1 (]: On test.bank_rates.unique_trade_date_metal_code: ROLLBACK
[0m09:20:06.934349 [debug] [Thread-1 (]: On test.bank_rates.unique_trade_date_metal_code: Close
[0m09:20:06.935011 [info ] [Thread-1 (]: 3 of 3 PASS unique_trade_date_metal_code ....................................... [[32mPASS[0m in 0.03s]
[0m09:20:06.935570 [debug] [Thread-1 (]: Finished running node test.bank_rates.unique_trade_date_metal_code
[0m09:20:06.936652 [debug] [MainThread]: Using postgres connection "master"
[0m09:20:06.936890 [debug] [MainThread]: On master: BEGIN
[0m09:20:06.937135 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m09:20:06.943012 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m09:20:06.943305 [debug] [MainThread]: On master: COMMIT
[0m09:20:06.943522 [debug] [MainThread]: Using postgres connection "master"
[0m09:20:06.943730 [debug] [MainThread]: On master: COMMIT
[0m09:20:06.944048 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m09:20:06.944266 [debug] [MainThread]: On master: Close
[0m09:20:06.944698 [debug] [MainThread]: Connection 'master' was properly closed.
[0m09:20:06.944920 [debug] [MainThread]: Connection 'test.bank_rates.positive_prices' was properly closed.
[0m09:20:06.945128 [debug] [MainThread]: Connection 'test.bank_rates.unique_trade_date_metal_code' was properly closed.
[0m09:20:06.945362 [info ] [MainThread]: 
[0m09:20:06.945674 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 0.16 seconds (0.16s).
[0m09:20:06.946388 [debug] [MainThread]: Command end result
[0m09:20:06.950895 [info ] [MainThread]: 
[0m09:20:06.951290 [info ] [MainThread]: [32mCompleted successfully[0m
[0m09:20:06.951597 [info ] [MainThread]: 
[0m09:20:06.951914 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m09:20:06.952348 [debug] [MainThread]: Command `dbt test` succeeded at 09:20:06.952256 after 0.31 seconds
[0m09:20:06.952608 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737a6532d9c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737a63cd6830>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737a632b7970>]}
[0m09:20:06.952890 [debug] [MainThread]: Flushing usage events
[0m14:23:47.061225 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73d9aef313c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73d9ad826050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73d9ad825fc0>]}


============================== 14:23:47.069837 | 436bca20-0452-49c6-9b25-ae23d97f8dc0 ==============================
[0m14:23:47.069837 [info ] [MainThread]: Running with dbt=1.5.0
[0m14:23:47.070299 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'log_cache_events': 'False', 'quiet': 'False', 'no_print': 'None', 'fail_fast': 'False', 'printer_width': '80', 'target_path': 'None', 'use_experimental_parser': 'False', 'log_format': 'default', 'profiles_dir': '.', 'introspect': 'True', 'log_path': '/usr/app/logs', 'version_check': 'True', 'static_parser': 'True', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'debug': 'False', 'write_json': 'True'}
[0m14:23:47.316364 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '436bca20-0452-49c6-9b25-ae23d97f8dc0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73d9ad874850>]}
[0m14:23:47.330471 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '436bca20-0452-49c6-9b25-ae23d97f8dc0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73d9adb81030>]}
[0m14:23:47.339632 [debug] [MainThread]: checksum: 4568eb639a77b8fcb3a1f4a07856f42b1ff63f1376652889143968e1dbdafbda, vars: {}, profile: , target: , version: 1.5.0
[0m14:23:47.446472 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:23:47.446920 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:23:47.451848 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '436bca20-0452-49c6-9b25-ae23d97f8dc0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73d9ac98c0d0>]}
[0m14:23:47.456776 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '436bca20-0452-49c6-9b25-ae23d97f8dc0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73d9ada076a0>]}
[0m14:23:47.457106 [info ] [MainThread]: Found 4 models, 3 tests, 0 snapshots, 0 analyses, 308 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m14:23:47.457440 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '436bca20-0452-49c6-9b25-ae23d97f8dc0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73d9ada07a90>]}
[0m14:23:47.458624 [info ] [MainThread]: 
[0m14:23:47.459203 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:23:47.460279 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m14:23:47.460949 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m14:23:47.469673 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m14:23:47.471187 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m14:23:47.471475 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m14:23:47.471780 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m14:23:47.472028 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:23:47.472269 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:23:47.476448 [debug] [ThreadPool]: Postgres adapter: Got a retryable error when attempting to open a postgres connection.
1 attempts remaining. Retrying in 0 seconds.
Error:
could not translate host name "postgres" to address: Temporary failure in name resolution

[0m14:23:47.476775 [debug] [ThreadPool]: Postgres adapter: Got a retryable error when attempting to open a postgres connection.
1 attempts remaining. Retrying in 0 seconds.
Error:
could not translate host name "postgres" to address: Temporary failure in name resolution

[0m14:23:47.480916 [debug] [ThreadPool]: Postgres adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m14:23:47.481201 [debug] [ThreadPool]: Postgres adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m14:23:47.481552 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m14:23:47.481850 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m14:23:47.482184 [debug] [ThreadPool]: Postgres adapter: Error running SQL: macro list_schemas
[0m14:23:47.482488 [debug] [ThreadPool]: Postgres adapter: Error running SQL: macro list_schemas
[0m14:23:47.482786 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m14:23:47.483035 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m14:23:47.483305 [debug] [ThreadPool]: On list_bank_rates: No close available on handle
[0m14:23:47.483593 [debug] [ThreadPool]: On list_bank_rates: No close available on handle
[0m14:23:47.485645 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m14:23:47.486249 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m14:23:47.486469 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:23:47.490140 [debug] [ThreadPool]: Postgres adapter: Got a retryable error when attempting to open a postgres connection.
1 attempts remaining. Retrying in 0 seconds.
Error:
could not translate host name "postgres" to address: Temporary failure in name resolution

[0m14:23:47.493368 [debug] [ThreadPool]: Postgres adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m14:23:47.493627 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m14:23:47.493874 [debug] [ThreadPool]: Postgres adapter: Error running SQL: macro list_schemas
[0m14:23:47.494087 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m14:23:47.494300 [debug] [ThreadPool]: On list_bank_rates: No close available on handle
[0m14:23:47.495017 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:23:47.495248 [debug] [MainThread]: Connection 'list_bank_rates' was properly closed.
[0m14:23:47.495451 [debug] [MainThread]: Connection 'list_bank_rates' was properly closed.
[0m14:23:47.495729 [info ] [MainThread]: 
[0m14:23:47.496052 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 0.04 seconds (0.04s).
[0m14:23:47.496422 [error] [MainThread]: Encountered an error:
Database Error
  could not translate host name "postgres" to address: Temporary failure in name resolution
  
[0m14:23:47.496898 [debug] [MainThread]: Command `dbt run` failed at 14:23:47.496806 after 0.45 seconds
[0m14:23:47.497156 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73d9aef313c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73d9ac9d1480>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73d9ac9d1570>]}
[0m14:23:47.497473 [debug] [MainThread]: Flushing usage events
[0m14:25:37.593918 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x756b3dfbd4e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x756b3c9f1ff0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x756b3c9f1f60>]}


============================== 14:25:37.598230 | 7d571956-f305-44a7-9658-32cd8cbc2031 ==============================
[0m14:25:37.598230 [info ] [MainThread]: Running with dbt=1.5.0
[0m14:25:37.598684 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'partial_parse': 'True', 'no_print': 'None', 'log_format': 'default', 'printer_width': '80', 'use_colors': 'True', 'use_experimental_parser': 'False', 'warn_error': 'None', 'indirect_selection': 'eager', 'profiles_dir': '.', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_cache_events': 'False', 'version_check': 'True', 'debug': 'False', 'write_json': 'True', 'quiet': 'False', 'cache_selected_only': 'False', 'introspect': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/logs', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True'}
[0m14:25:37.678185 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7d571956-f305-44a7-9658-32cd8cbc2031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x756b3c850850>]}
[0m14:25:37.691710 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7d571956-f305-44a7-9658-32cd8cbc2031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x756b3cb710f0>]}
[0m14:25:37.699337 [debug] [MainThread]: checksum: 4568eb639a77b8fcb3a1f4a07856f42b1ff63f1376652889143968e1dbdafbda, vars: {}, profile: , target: , version: 1.5.0
[0m14:25:37.717539 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:25:37.717816 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:25:37.721927 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7d571956-f305-44a7-9658-32cd8cbc2031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x756b3b95c0d0>]}
[0m14:25:37.726411 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7d571956-f305-44a7-9658-32cd8cbc2031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x756b3cbd7700>]}
[0m14:25:37.726783 [info ] [MainThread]: Found 4 models, 3 tests, 0 snapshots, 0 analyses, 308 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m14:25:37.727105 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7d571956-f305-44a7-9658-32cd8cbc2031', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x756b3cbd7af0>]}
[0m14:25:37.728182 [info ] [MainThread]: 
[0m14:25:37.728766 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:25:37.729829 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m14:25:37.735600 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m14:25:37.738746 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m14:25:37.740265 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m14:25:37.740577 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m14:25:37.740863 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m14:25:37.741127 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:25:37.741401 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:25:37.745966 [debug] [ThreadPool]: Postgres adapter: Got a retryable error when attempting to open a postgres connection.
1 attempts remaining. Retrying in 0 seconds.
Error:
could not translate host name "postgres" to address: Temporary failure in name resolution

[0m14:25:37.746253 [debug] [ThreadPool]: Postgres adapter: Got a retryable error when attempting to open a postgres connection.
1 attempts remaining. Retrying in 0 seconds.
Error:
could not translate host name "postgres" to address: Temporary failure in name resolution

[0m14:25:37.750085 [debug] [ThreadPool]: Postgres adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m14:25:37.750384 [debug] [ThreadPool]: Postgres adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m14:25:37.750641 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m14:25:37.750912 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m14:25:37.751214 [debug] [ThreadPool]: Postgres adapter: Error running SQL: macro list_schemas
[0m14:25:37.751534 [debug] [ThreadPool]: Postgres adapter: Error running SQL: macro list_schemas
[0m14:25:37.751834 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m14:25:37.752088 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m14:25:37.752354 [debug] [ThreadPool]: On list_bank_rates: No close available on handle
[0m14:25:37.752652 [debug] [ThreadPool]: On list_bank_rates: No close available on handle
[0m14:25:37.754424 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m14:25:37.755094 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m14:25:37.755317 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:25:37.758555 [debug] [ThreadPool]: Postgres adapter: Got a retryable error when attempting to open a postgres connection.
1 attempts remaining. Retrying in 0 seconds.
Error:
could not translate host name "postgres" to address: Temporary failure in name resolution

[0m14:25:37.762193 [debug] [ThreadPool]: Postgres adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m14:25:37.762442 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m14:25:37.762740 [debug] [ThreadPool]: Postgres adapter: Error running SQL: macro list_schemas
[0m14:25:37.762962 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m14:25:37.763184 [debug] [ThreadPool]: On list_bank_rates: No close available on handle
[0m14:25:37.763878 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:25:37.764109 [debug] [MainThread]: Connection 'list_bank_rates' was properly closed.
[0m14:25:37.764315 [debug] [MainThread]: Connection 'list_bank_rates' was properly closed.
[0m14:25:37.764561 [info ] [MainThread]: 
[0m14:25:37.764901 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 0.04 seconds (0.04s).
[0m14:25:37.765281 [error] [MainThread]: Encountered an error:
Database Error
  could not translate host name "postgres" to address: Temporary failure in name resolution
  
[0m14:25:37.765782 [debug] [MainThread]: Command `dbt run` failed at 14:25:37.765689 after 0.18 seconds
[0m14:25:37.766037 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x756b3dfbd4e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x756b3b99d4e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x756b3b99d570>]}
[0m14:25:37.766307 [debug] [MainThread]: Flushing usage events
[0m14:25:52.111278 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7de3c2cb53c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7de3c151a050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7de3c1519fc0>]}


============================== 14:25:52.115811 | 40d56543-1e57-4757-86ce-520613c176ac ==============================
[0m14:25:52.115811 [info ] [MainThread]: Running with dbt=1.5.0
[0m14:25:52.116263 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'indirect_selection': 'eager', 'printer_width': '80', 'log_cache_events': 'False', 'warn_error': 'None', 'use_colors': 'True', 'cache_selected_only': 'False', 'write_json': 'True', 'partial_parse': 'True', 'version_check': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'no_print': 'None', 'introspect': 'True', 'quiet': 'False', 'debug': 'False', 'use_experimental_parser': 'False', 'target_path': 'None', 'profiles_dir': '.', 'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/logs'}
[0m14:25:52.194906 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '40d56543-1e57-4757-86ce-520613c176ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7de3c156c850>]}
[0m14:25:52.208257 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '40d56543-1e57-4757-86ce-520613c176ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7de3c1881030>]}
[0m14:25:52.216007 [debug] [MainThread]: checksum: 4568eb639a77b8fcb3a1f4a07856f42b1ff63f1376652889143968e1dbdafbda, vars: {}, profile: , target: , version: 1.5.0
[0m14:25:52.234671 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:25:52.234951 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:25:52.239164 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '40d56543-1e57-4757-86ce-520613c176ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7de3c09840d0>]}
[0m14:25:52.243741 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '40d56543-1e57-4757-86ce-520613c176ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7de3c18ff6a0>]}
[0m14:25:52.244061 [info ] [MainThread]: Found 4 models, 3 tests, 0 snapshots, 0 analyses, 308 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m14:25:52.244344 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '40d56543-1e57-4757-86ce-520613c176ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7de3c18ffa90>]}
[0m14:25:52.245438 [info ] [MainThread]: 
[0m14:25:52.246043 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:25:52.247063 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m14:25:52.252857 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m14:25:52.255829 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m14:25:52.257206 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m14:25:52.257544 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m14:25:52.257831 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m14:25:52.258080 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:25:52.258325 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:25:52.262833 [debug] [ThreadPool]: Postgres adapter: Got a retryable error when attempting to open a postgres connection.
1 attempts remaining. Retrying in 0 seconds.
Error:
could not translate host name "postgres" to address: Temporary failure in name resolution

[0m14:25:52.263107 [debug] [ThreadPool]: Postgres adapter: Got a retryable error when attempting to open a postgres connection.
1 attempts remaining. Retrying in 0 seconds.
Error:
could not translate host name "postgres" to address: Temporary failure in name resolution

[0m14:25:52.266904 [debug] [ThreadPool]: Postgres adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m14:25:52.267195 [debug] [ThreadPool]: Postgres adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m14:25:52.267411 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m14:25:52.267717 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m14:25:52.268006 [debug] [ThreadPool]: Postgres adapter: Error running SQL: macro list_schemas
[0m14:25:52.268289 [debug] [ThreadPool]: Postgres adapter: Error running SQL: macro list_schemas
[0m14:25:52.268567 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m14:25:52.268824 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m14:25:52.269079 [debug] [ThreadPool]: On list_bank_rates: No close available on handle
[0m14:25:52.269341 [debug] [ThreadPool]: On list_bank_rates: No close available on handle
[0m14:25:52.271071 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m14:25:52.271743 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m14:25:52.271959 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:25:52.275415 [debug] [ThreadPool]: Postgres adapter: Got a retryable error when attempting to open a postgres connection.
1 attempts remaining. Retrying in 0 seconds.
Error:
could not translate host name "postgres" to address: Temporary failure in name resolution

[0m14:25:52.278684 [debug] [ThreadPool]: Postgres adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m14:25:52.278933 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m14:25:52.279186 [debug] [ThreadPool]: Postgres adapter: Error running SQL: macro list_schemas
[0m14:25:52.279400 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m14:25:52.279661 [debug] [ThreadPool]: On list_bank_rates: No close available on handle
[0m14:25:52.280333 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:25:52.280568 [debug] [MainThread]: Connection 'list_bank_rates' was properly closed.
[0m14:25:52.280778 [debug] [MainThread]: Connection 'list_bank_rates' was properly closed.
[0m14:25:52.280998 [info ] [MainThread]: 
[0m14:25:52.281281 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 0.04 seconds (0.04s).
[0m14:25:52.281676 [error] [MainThread]: Encountered an error:
Database Error
  could not translate host name "postgres" to address: Temporary failure in name resolution
  
[0m14:25:52.282076 [debug] [MainThread]: Command `dbt run` failed at 14:25:52.281987 after 0.18 seconds
[0m14:25:52.282325 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7de3c2cb53c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7de3c09c9480>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7de3c09c9570>]}
[0m14:25:52.282606 [debug] [MainThread]: Flushing usage events
[0m14:27:41.200248 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70c5f7255270>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70c5f5cf4400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70c5f5cf4370>]}


============================== 14:27:41.204582 | 68b50764-8f08-483d-ad78-1c49cf1ae554 ==============================
[0m14:27:41.204582 [info ] [MainThread]: Running with dbt=1.5.0
[0m14:27:41.204971 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'warn_error': 'None', 'partial_parse': 'True', 'profiles_dir': '.', 'use_colors': 'True', 'introspect': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'log_path': '/usr/app/logs', 'log_format': 'default', 'write_json': 'True', 'cache_selected_only': 'False', 'target_path': 'None', 'fail_fast': 'False', 'version_check': 'True', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'debug': 'False'}
[0m14:27:41.282397 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '68b50764-8f08-483d-ad78-1c49cf1ae554', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70c5f68a9b40>]}
[0m14:27:41.296063 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '68b50764-8f08-483d-ad78-1c49cf1ae554', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70c5f5e76cb0>]}
[0m14:27:41.303621 [debug] [MainThread]: checksum: 4568eb639a77b8fcb3a1f4a07856f42b1ff63f1376652889143968e1dbdafbda, vars: {}, profile: , target: , version: 1.5.0
[0m14:27:41.321992 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:27:41.322242 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:27:41.326462 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '68b50764-8f08-483d-ad78-1c49cf1ae554', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70c5f5cf4850>]}
[0m14:27:41.330983 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '68b50764-8f08-483d-ad78-1c49cf1ae554', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70c5f5f49360>]}
[0m14:27:41.331302 [info ] [MainThread]: Found 4 models, 3 tests, 0 snapshots, 0 analyses, 308 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m14:27:41.331602 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '68b50764-8f08-483d-ad78-1c49cf1ae554', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70c5f5f49300>]}
[0m14:27:41.332680 [info ] [MainThread]: 
[0m14:27:41.333201 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:27:41.334245 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m14:27:41.340037 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m14:27:41.343009 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m14:27:41.344417 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m14:27:41.344719 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m14:27:41.344980 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m14:27:41.345226 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:27:41.345478 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:27:41.349288 [debug] [ThreadPool]: Postgres adapter: Got a retryable error when attempting to open a postgres connection.
1 attempts remaining. Retrying in 0 seconds.
Error:
could not translate host name "postgres" to address: Temporary failure in name resolution

[0m14:27:41.349602 [debug] [ThreadPool]: Postgres adapter: Got a retryable error when attempting to open a postgres connection.
1 attempts remaining. Retrying in 0 seconds.
Error:
could not translate host name "postgres" to address: Temporary failure in name resolution

[0m14:27:41.354711 [debug] [ThreadPool]: Postgres adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m14:27:41.354999 [debug] [ThreadPool]: Postgres adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m14:27:41.355215 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m14:27:41.355467 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m14:27:41.355788 [debug] [ThreadPool]: Postgres adapter: Error running SQL: macro list_schemas
[0m14:27:41.356072 [debug] [ThreadPool]: Postgres adapter: Error running SQL: macro list_schemas
[0m14:27:41.356320 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m14:27:41.356621 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m14:27:41.356885 [debug] [ThreadPool]: On list_bank_rates: No close available on handle
[0m14:27:41.357138 [debug] [ThreadPool]: On list_bank_rates: No close available on handle
[0m14:27:41.358949 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m14:27:41.359578 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m14:27:41.359812 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:27:41.363042 [debug] [ThreadPool]: Postgres adapter: Got a retryable error when attempting to open a postgres connection.
1 attempts remaining. Retrying in 0 seconds.
Error:
could not translate host name "postgres" to address: Temporary failure in name resolution

[0m14:27:41.366238 [debug] [ThreadPool]: Postgres adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m14:27:41.366490 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m14:27:41.366796 [debug] [ThreadPool]: Postgres adapter: Error running SQL: macro list_schemas
[0m14:27:41.367011 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m14:27:41.367227 [debug] [ThreadPool]: On list_bank_rates: No close available on handle
[0m14:27:41.367905 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:27:41.368124 [debug] [MainThread]: Connection 'list_bank_rates' was properly closed.
[0m14:27:41.368318 [debug] [MainThread]: Connection 'list_bank_rates' was properly closed.
[0m14:27:41.368548 [info ] [MainThread]: 
[0m14:27:41.368825 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 0.04 seconds (0.04s).
[0m14:27:41.369136 [error] [MainThread]: Encountered an error:
Database Error
  could not translate host name "postgres" to address: Temporary failure in name resolution
  
[0m14:27:41.369551 [debug] [MainThread]: Command `dbt run` failed at 14:27:41.369441 after 0.18 seconds
[0m14:27:41.369814 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70c5f7255270>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70c5f4f9d3f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70c5f4f9d4e0>]}
[0m14:27:41.370071 [debug] [MainThread]: Flushing usage events
[0m14:27:55.825654 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c144698d4e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c1445225ff0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c1445225f60>]}


============================== 14:27:55.829992 | c1da21c6-2b27-4ef6-9688-14c6d2e92239 ==============================
[0m14:27:55.829992 [info ] [MainThread]: Running with dbt=1.5.0
[0m14:27:55.830383 [debug] [MainThread]: running dbt with arguments {'fail_fast': 'False', 'target_path': 'None', 'printer_width': '80', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'debug': 'False', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'profiles_dir': '.', 'cache_selected_only': 'False', 'log_path': '/usr/app/logs', 'static_parser': 'True', 'write_json': 'True', 'log_cache_events': 'False', 'quiet': 'False', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'version_check': 'True', 'partial_parse': 'True', 'introspect': 'True', 'no_print': 'None', 'use_colors': 'True', 'warn_error': 'None'}
[0m14:27:55.908120 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c1da21c6-2b27-4ef6-9688-14c6d2e92239', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c1445278850>]}
[0m14:27:55.922141 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c1da21c6-2b27-4ef6-9688-14c6d2e92239', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c14455810f0>]}
[0m14:27:55.929866 [debug] [MainThread]: checksum: 4568eb639a77b8fcb3a1f4a07856f42b1ff63f1376652889143968e1dbdafbda, vars: {}, profile: , target: , version: 1.5.0
[0m14:27:55.948036 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:27:55.948278 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:27:55.952407 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c1da21c6-2b27-4ef6-9688-14c6d2e92239', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c144438c0d0>]}
[0m14:27:55.956941 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c1da21c6-2b27-4ef6-9688-14c6d2e92239', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c1445403700>]}
[0m14:27:55.957250 [info ] [MainThread]: Found 4 models, 3 tests, 0 snapshots, 0 analyses, 308 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m14:27:55.957559 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c1da21c6-2b27-4ef6-9688-14c6d2e92239', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c1445403af0>]}
[0m14:27:55.958707 [info ] [MainThread]: 
[0m14:27:55.959273 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:27:55.960288 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m14:27:55.966062 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m14:27:55.969045 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m14:27:55.970375 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m14:27:55.970669 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m14:27:55.970937 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m14:27:55.971187 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:27:55.971429 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:27:55.975854 [debug] [ThreadPool]: Postgres adapter: Got a retryable error when attempting to open a postgres connection.
1 attempts remaining. Retrying in 0 seconds.
Error:
could not translate host name "postgres" to address: Temporary failure in name resolution

[0m14:27:55.976125 [debug] [ThreadPool]: Postgres adapter: Got a retryable error when attempting to open a postgres connection.
1 attempts remaining. Retrying in 0 seconds.
Error:
could not translate host name "postgres" to address: Temporary failure in name resolution

[0m14:27:55.979428 [debug] [ThreadPool]: Postgres adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m14:27:55.979749 [debug] [ThreadPool]: Postgres adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m14:27:55.979967 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m14:27:55.980218 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m14:27:55.980502 [debug] [ThreadPool]: Postgres adapter: Error running SQL: macro list_schemas
[0m14:27:55.980810 [debug] [ThreadPool]: Postgres adapter: Error running SQL: macro list_schemas
[0m14:27:55.981055 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m14:27:55.981297 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m14:27:55.981603 [debug] [ThreadPool]: On list_bank_rates: No close available on handle
[0m14:27:55.981854 [debug] [ThreadPool]: On list_bank_rates: No close available on handle
[0m14:27:55.983541 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m14:27:55.984221 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m14:27:55.984435 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:27:55.987656 [debug] [ThreadPool]: Postgres adapter: Got a retryable error when attempting to open a postgres connection.
1 attempts remaining. Retrying in 0 seconds.
Error:
could not translate host name "postgres" to address: Temporary failure in name resolution

[0m14:27:55.990800 [debug] [ThreadPool]: Postgres adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m14:27:55.991034 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m14:27:55.991277 [debug] [ThreadPool]: Postgres adapter: Error running SQL: macro list_schemas
[0m14:27:55.991486 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m14:27:55.991762 [debug] [ThreadPool]: On list_bank_rates: No close available on handle
[0m14:27:55.992396 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:27:55.992637 [debug] [MainThread]: Connection 'list_bank_rates' was properly closed.
[0m14:27:55.992836 [debug] [MainThread]: Connection 'list_bank_rates' was properly closed.
[0m14:27:55.993054 [info ] [MainThread]: 
[0m14:27:55.993341 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 0.03 seconds (0.03s).
[0m14:27:55.993726 [error] [MainThread]: Encountered an error:
Database Error
  could not translate host name "postgres" to address: Temporary failure in name resolution
  
[0m14:27:55.994116 [debug] [MainThread]: Command `dbt run` failed at 14:27:55.994029 after 0.17 seconds
[0m14:27:55.994373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c144698d4e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c14443d14e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c14443d1570>]}
[0m14:27:55.994662 [debug] [MainThread]: Flushing usage events
[0m14:29:45.663894 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9da366d450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9da20f5090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9da20f5000>]}


============================== 14:29:45.668462 | 05f5e0e2-fa02-499b-801c-edcc27ff6eb2 ==============================
[0m14:29:45.668462 [info ] [MainThread]: Running with dbt=1.5.0
[0m14:29:45.668872 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'debug': 'False', 'cache_selected_only': 'False', 'write_json': 'True', 'log_format': 'default', 'warn_error': 'None', 'partial_parse': 'True', 'fail_fast': 'False', 'log_path': '/usr/app/logs', 'introspect': 'True', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'quiet': 'False', 'target_path': 'None', 'static_parser': 'True', 'profiles_dir': '.', 'use_experimental_parser': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'use_colors': 'True', 'version_check': 'True'}
[0m14:29:45.747456 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '05f5e0e2-fa02-499b-801c-edcc27ff6eb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9da5de7610>]}
[0m14:29:45.761148 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '05f5e0e2-fa02-499b-801c-edcc27ff6eb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9da226e1d0>]}
[0m14:29:45.768632 [debug] [MainThread]: checksum: 4568eb639a77b8fcb3a1f4a07856f42b1ff63f1376652889143968e1dbdafbda, vars: {}, profile: , target: , version: 1.5.0
[0m14:29:45.786984 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:29:45.787229 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:29:45.791498 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '05f5e0e2-fa02-499b-801c-edcc27ff6eb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9da135c0d0>]}
[0m14:29:45.796138 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '05f5e0e2-fa02-499b-801c-edcc27ff6eb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9da22d86a0>]}
[0m14:29:45.796464 [info ] [MainThread]: Found 4 models, 3 tests, 0 snapshots, 0 analyses, 308 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m14:29:45.796774 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '05f5e0e2-fa02-499b-801c-edcc27ff6eb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9da22d9900>]}
[0m14:29:45.797828 [info ] [MainThread]: 
[0m14:29:45.798370 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:29:45.799404 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m14:29:45.805171 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m14:29:45.808095 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m14:29:45.809620 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m14:29:45.809899 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m14:29:45.810160 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m14:29:45.810405 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:29:45.810668 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:29:45.814724 [debug] [ThreadPool]: Postgres adapter: Got a retryable error when attempting to open a postgres connection.
1 attempts remaining. Retrying in 0 seconds.
Error:
could not translate host name "postgres" to address: Temporary failure in name resolution

[0m14:29:45.814990 [debug] [ThreadPool]: Postgres adapter: Got a retryable error when attempting to open a postgres connection.
1 attempts remaining. Retrying in 0 seconds.
Error:
could not translate host name "postgres" to address: Temporary failure in name resolution

[0m14:29:45.818334 [debug] [ThreadPool]: Postgres adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m14:29:45.818645 [debug] [ThreadPool]: Postgres adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m14:29:45.818861 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m14:29:45.819113 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m14:29:45.819398 [debug] [ThreadPool]: Postgres adapter: Error running SQL: macro list_schemas
[0m14:29:45.819701 [debug] [ThreadPool]: Postgres adapter: Error running SQL: macro list_schemas
[0m14:29:45.819976 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m14:29:45.820214 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m14:29:45.820468 [debug] [ThreadPool]: On list_bank_rates: No close available on handle
[0m14:29:45.820756 [debug] [ThreadPool]: On list_bank_rates: No close available on handle
[0m14:29:45.822581 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m14:29:45.823212 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m14:29:45.823421 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:29:45.826554 [debug] [ThreadPool]: Postgres adapter: Got a retryable error when attempting to open a postgres connection.
1 attempts remaining. Retrying in 0 seconds.
Error:
could not translate host name "postgres" to address: Temporary failure in name resolution

[0m14:29:45.829819 [debug] [ThreadPool]: Postgres adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m14:29:45.830059 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m14:29:45.830308 [debug] [ThreadPool]: Postgres adapter: Error running SQL: macro list_schemas
[0m14:29:45.830559 [debug] [ThreadPool]: Postgres adapter: Rolling back transaction.
[0m14:29:45.830793 [debug] [ThreadPool]: On list_bank_rates: No close available on handle
[0m14:29:45.831442 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:29:45.831699 [debug] [MainThread]: Connection 'list_bank_rates' was properly closed.
[0m14:29:45.831899 [debug] [MainThread]: Connection 'list_bank_rates' was properly closed.
[0m14:29:45.832142 [info ] [MainThread]: 
[0m14:29:45.832427 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 0.03 seconds (0.03s).
[0m14:29:45.832787 [error] [MainThread]: Encountered an error:
Database Error
  could not translate host name "postgres" to address: Temporary failure in name resolution
  
[0m14:29:45.833185 [debug] [MainThread]: Command `dbt run` failed at 14:29:45.833097 after 0.18 seconds
[0m14:29:45.833448 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9da366d450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9da139d4b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f9da139d540>]}
[0m14:29:45.833758 [debug] [MainThread]: Flushing usage events
[0m14:31:49.232168 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff542e3d750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff5418f56f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff5418f5660>]}


============================== 14:31:49.236596 | 37d612e6-1d2e-4ed6-bcff-d774da0a8729 ==============================
[0m14:31:49.236596 [info ] [MainThread]: Running with dbt=1.5.0
[0m14:31:49.237028 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'quiet': 'False', 'use_colors': 'True', 'log_format': 'default', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'indirect_selection': 'eager', 'introspect': 'True', 'printer_width': '80', 'fail_fast': 'False', 'profiles_dir': '.', 'target_path': 'None', 'version_check': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'log_path': '/usr/app/logs', 'partial_parse': 'True'}
[0m14:31:49.314904 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '37d612e6-1d2e-4ed6-bcff-d774da0a8729', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff542077cd0>]}
[0m14:31:49.328195 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '37d612e6-1d2e-4ed6-bcff-d774da0a8729', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff541a6bd60>]}
[0m14:31:49.336065 [debug] [MainThread]: checksum: 4568eb639a77b8fcb3a1f4a07856f42b1ff63f1376652889143968e1dbdafbda, vars: {}, profile: , target: , version: 1.5.0
[0m14:31:49.354353 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:31:49.354632 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:31:49.358731 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '37d612e6-1d2e-4ed6-bcff-d774da0a8729', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff540b5c0d0>]}
[0m14:31:49.363229 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '37d612e6-1d2e-4ed6-bcff-d774da0a8729', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff541a52860>]}
[0m14:31:49.363574 [info ] [MainThread]: Found 4 models, 3 tests, 0 snapshots, 0 analyses, 308 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m14:31:49.363866 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '37d612e6-1d2e-4ed6-bcff-d774da0a8729', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff541a528c0>]}
[0m14:31:49.365116 [info ] [MainThread]: 
[0m14:31:49.365791 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:31:49.366805 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m14:31:49.372617 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates'
[0m14:31:49.375267 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m14:31:49.376696 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m14:31:49.376974 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m14:31:49.377248 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m14:31:49.377536 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:31:49.377798 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:31:49.420412 [debug] [ThreadPool]: SQL status: SELECT 11 in 0.0 seconds
[0m14:31:49.420760 [debug] [ThreadPool]: SQL status: SELECT 11 in 0.0 seconds
[0m14:31:49.421860 [debug] [ThreadPool]: On list_bank_rates: Close
[0m14:31:49.422728 [debug] [ThreadPool]: On list_bank_rates: Close
[0m14:31:49.424684 [debug] [ThreadPool]: Using postgres connection "list_bank_rates"
[0m14:31:49.425318 [debug] [ThreadPool]: On list_bank_rates: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates"} */

    select distinct nspname from pg_namespace
  
[0m14:31:49.425570 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:31:49.431952 [debug] [ThreadPool]: SQL status: SELECT 11 in 0.0 seconds
[0m14:31:49.432773 [debug] [ThreadPool]: On list_bank_rates: Close
[0m14:31:49.434082 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates, now list_bank_rates_mart)
[0m14:31:49.434638 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates, now list_bank_rates_dds)
[0m14:31:49.439244 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m14:31:49.440476 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m14:31:49.440800 [debug] [ThreadPool]: On list_bank_rates_mart: BEGIN
[0m14:31:49.441055 [debug] [ThreadPool]: On list_bank_rates_dds: BEGIN
[0m14:31:49.441306 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:31:49.441570 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:31:49.448005 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m14:31:49.448283 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m14:31:49.448501 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m14:31:49.448789 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m14:31:49.449042 [debug] [ThreadPool]: On list_bank_rates_mart: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_mart"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'mart'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'mart'
  
[0m14:31:49.449302 [debug] [ThreadPool]: On list_bank_rates_dds: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_dds"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dds'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dds'
  
[0m14:31:49.457266 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m14:31:49.457516 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m14:31:49.458407 [debug] [ThreadPool]: On list_bank_rates_dds: ROLLBACK
[0m14:31:49.459226 [debug] [ThreadPool]: On list_bank_rates_mart: ROLLBACK
[0m14:31:49.459604 [debug] [ThreadPool]: On list_bank_rates_dds: Close
[0m14:31:49.459822 [debug] [ThreadPool]: On list_bank_rates_mart: Close
[0m14:31:49.460495 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates_dds, now list_bank_rates_staging)
[0m14:31:49.462794 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m14:31:49.463023 [debug] [ThreadPool]: On list_bank_rates_staging: BEGIN
[0m14:31:49.463231 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:31:49.469019 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m14:31:49.469263 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m14:31:49.469521 [debug] [ThreadPool]: On list_bank_rates_staging: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_staging"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging'
  
[0m14:31:49.471554 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m14:31:49.472335 [debug] [ThreadPool]: On list_bank_rates_staging: ROLLBACK
[0m14:31:49.472661 [debug] [ThreadPool]: On list_bank_rates_staging: Close
[0m14:31:49.476079 [debug] [MainThread]: Using postgres connection "master"
[0m14:31:49.476325 [debug] [MainThread]: On master: BEGIN
[0m14:31:49.476553 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:31:49.482310 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m14:31:49.482565 [debug] [MainThread]: Using postgres connection "master"
[0m14:31:49.482830 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:31:49.491835 [debug] [MainThread]: SQL status: SELECT 3 in 0.0 seconds
[0m14:31:49.492712 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '37d612e6-1d2e-4ed6-bcff-d774da0a8729', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff541b484f0>]}
[0m14:31:49.493039 [debug] [MainThread]: On master: ROLLBACK
[0m14:31:49.493378 [debug] [MainThread]: Using postgres connection "master"
[0m14:31:49.493643 [debug] [MainThread]: On master: BEGIN
[0m14:31:49.494061 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m14:31:49.494276 [debug] [MainThread]: On master: COMMIT
[0m14:31:49.494486 [debug] [MainThread]: Using postgres connection "master"
[0m14:31:49.494734 [debug] [MainThread]: On master: COMMIT
[0m14:31:49.495034 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m14:31:49.495248 [debug] [MainThread]: On master: Close
[0m14:31:49.495729 [info ] [MainThread]: Concurrency: 2 threads (target='dev')
[0m14:31:49.496048 [info ] [MainThread]: 
[0m14:31:49.511434 [debug] [Thread-1 (]: Began running node model.bank_rates.stg_cbr_precious_metals
[0m14:31:49.511870 [info ] [Thread-1 (]: 1 of 4 START sql view model staging.stg_cbr_precious_metals .................... [RUN]
[0m14:31:49.512373 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_bank_rates_staging, now model.bank_rates.stg_cbr_precious_metals)
[0m14:31:49.512660 [debug] [Thread-1 (]: Began compiling node model.bank_rates.stg_cbr_precious_metals
[0m14:31:49.514921 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_rates.stg_cbr_precious_metals"
[0m14:31:49.515474 [debug] [Thread-1 (]: Timing info for model.bank_rates.stg_cbr_precious_metals (compile): 14:31:49.512834 => 14:31:49.515299
[0m14:31:49.515783 [debug] [Thread-1 (]: Began executing node model.bank_rates.stg_cbr_precious_metals
[0m14:31:49.541877 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_rates.stg_cbr_precious_metals"
[0m14:31:49.542415 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m14:31:49.542706 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: BEGIN
[0m14:31:49.542972 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:31:49.549377 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m14:31:49.549705 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m14:31:49.549995 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */

  create view "bank_rates"."staging"."stg_cbr_precious_metals__dbt_tmp"
    
    
  as (
    

WITH ranked_data AS (
    SELECT 
        id,
        record_date::DATE as trade_date,
        metal_code::INTEGER as metal_code,
        buy_price::DECIMAL(10,2) as buy_price_rub,
        sell_price::DECIMAL(10,2) as sell_price_rub,
        from_date::DATE as valid_from,
        to_date::DATE as valid_to,
        load_timestamp::TIMESTAMP as loaded_at,
        -- Ð’Ñ‹Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÑŽÑŽ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÑƒ Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð´Ð½Ñ Ð¸ Ð¼ÐµÑ‚Ð°Ð»Ð»Ð°
        ROW_NUMBER() OVER (
            PARTITION BY record_date, metal_code 
            ORDER BY load_timestamp DESC
        ) as rn
    FROM raw.cbr_precious_metals
    WHERE record_date IS NOT NULL
      AND metal_code IS NOT NULL
      AND buy_price IS NOT NULL
)
SELECT 
    trade_date,
    metal_code,
    CASE 
        WHEN metal_code = 1 THEN 'Ð—Ð¾Ð»Ð¾Ñ‚Ð¾'
        WHEN metal_code = 2 THEN 'Ð¡ÐµÑ€ÐµÐ±Ñ€Ð¾'
        WHEN metal_code = 3 THEN 'ÐŸÐ»Ð°Ñ‚Ð¸Ð½Ð°'
        WHEN metal_code = 4 THEN 'ÐŸÐ°Ð»Ð»Ð°Ð´Ð¸Ð¹'
        ELSE 'ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ð¹ Ð¼ÐµÑ‚Ð°Ð»Ð»'
    END as metal_name,
    buy_price_rub,
    sell_price_rub,
    valid_from,
    valid_to,
    loaded_at
FROM ranked_data
WHERE rn = 1
  );
[0m14:31:49.576773 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.0 seconds
[0m14:31:49.581323 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m14:31:49.581661 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
alter table "bank_rates"."staging"."stg_cbr_precious_metals" rename to "stg_cbr_precious_metals__dbt_backup"
[0m14:31:49.582200 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m14:31:49.584990 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m14:31:49.585270 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
alter table "bank_rates"."staging"."stg_cbr_precious_metals__dbt_tmp" rename to "stg_cbr_precious_metals"
[0m14:31:49.585819 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m14:31:49.598297 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: COMMIT
[0m14:31:49.598620 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m14:31:49.598888 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: COMMIT
[0m14:31:49.602023 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m14:31:49.605622 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.stg_cbr_precious_metals"
[0m14:31:49.605910 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.stg_cbr_precious_metals"} */
drop view if exists "bank_rates"."staging"."stg_cbr_precious_metals__dbt_backup" cascade
[0m14:31:49.642707 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.0 seconds
[0m14:31:49.643960 [debug] [Thread-1 (]: Timing info for model.bank_rates.stg_cbr_precious_metals (execute): 14:31:49.515951 => 14:31:49.643818
[0m14:31:49.644229 [debug] [Thread-1 (]: On model.bank_rates.stg_cbr_precious_metals: Close
[0m14:31:49.644823 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '37d612e6-1d2e-4ed6-bcff-d774da0a8729', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff540743f40>]}
[0m14:31:49.645293 [info ] [Thread-1 (]: 1 of 4 OK created sql view model staging.stg_cbr_precious_metals ............... [[32mCREATE VIEW[0m in 0.13s]
[0m14:31:49.645808 [debug] [Thread-1 (]: Finished running node model.bank_rates.stg_cbr_precious_metals
[0m14:31:49.646650 [debug] [Thread-2 (]: Began running node model.bank_rates.dim_metals
[0m14:31:49.646962 [debug] [Thread-1 (]: Began running node model.bank_rates.fact_metal_prices
[0m14:31:49.647280 [info ] [Thread-2 (]: 2 of 4 START sql table model dds.dim_metals .................................... [RUN]
[0m14:31:49.647823 [info ] [Thread-1 (]: 3 of 4 START sql table model dds.fact_metal_prices ............................. [RUN]
[0m14:31:49.648392 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_bank_rates_mart, now model.bank_rates.dim_metals)
[0m14:31:49.648876 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.bank_rates.stg_cbr_precious_metals, now model.bank_rates.fact_metal_prices)
[0m14:31:49.649193 [debug] [Thread-2 (]: Began compiling node model.bank_rates.dim_metals
[0m14:31:49.649537 [debug] [Thread-1 (]: Began compiling node model.bank_rates.fact_metal_prices
[0m14:31:49.651820 [debug] [Thread-2 (]: Writing injected SQL for node "model.bank_rates.dim_metals"
[0m14:31:49.653871 [debug] [Thread-1 (]: Writing injected SQL for node "model.bank_rates.fact_metal_prices"
[0m14:31:49.654523 [debug] [Thread-1 (]: Timing info for model.bank_rates.fact_metal_prices (compile): 14:31:49.652050 => 14:31:49.654336
[0m14:31:49.654878 [debug] [Thread-2 (]: Timing info for model.bank_rates.dim_metals (compile): 14:31:49.649760 => 14:31:49.654713
[0m14:31:49.655135 [debug] [Thread-1 (]: Began executing node model.bank_rates.fact_metal_prices
[0m14:31:49.655437 [debug] [Thread-2 (]: Began executing node model.bank_rates.dim_metals
[0m14:31:49.674881 [debug] [Thread-1 (]: Writing runtime sql for node "model.bank_rates.fact_metal_prices"
[0m14:31:49.675358 [debug] [Thread-2 (]: Writing runtime sql for node "model.bank_rates.dim_metals"
[0m14:31:49.675927 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m14:31:49.676216 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m14:31:49.676473 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: BEGIN
[0m14:31:49.676802 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: BEGIN
[0m14:31:49.677088 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:31:49.677372 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:31:49.684314 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m14:31:49.684604 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m14:31:49.684896 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m14:31:49.685189 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m14:31:49.685501 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */

  
    

  create  table "bank_rates"."dds"."dim_metals__dbt_tmp"
  
  
    as
  
  (
    

SELECT DISTINCT
    metal_code,
    metal_name
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
WHERE metal_code IS NOT NULL
  );
  
[0m14:31:49.685845 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */

  
    

  create  table "bank_rates"."dds"."fact_metal_prices__dbt_tmp"
  
  
    as
  
  (
    

SELECT 
    ROW_NUMBER() OVER (ORDER BY trade_date, metal_code) as price_id,
    trade_date,
    metal_code,
    metal_name,
    buy_price_rub,
    sell_price_rub,
    loaded_at,
    CURRENT_TIMESTAMP as dwh_loaded_at
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
WHERE trade_date IS NOT NULL
  AND metal_code IS NOT NULL
  );
  
[0m14:31:49.723535 [debug] [Thread-2 (]: SQL status: SELECT 4 in 0.0 seconds
[0m14:31:49.725931 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m14:31:49.726213 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
alter table "bank_rates"."dds"."dim_metals" rename to "dim_metals__dbt_backup"
[0m14:31:49.726744 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m14:31:49.728648 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m14:31:49.728926 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
alter table "bank_rates"."dds"."dim_metals__dbt_tmp" rename to "dim_metals"
[0m14:31:49.729376 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m14:31:49.733477 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: COMMIT
[0m14:31:49.733809 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m14:31:49.734063 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: COMMIT
[0m14:31:49.736414 [debug] [Thread-1 (]: SQL status: SELECT 16804 in 0.0 seconds
[0m14:31:49.739305 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m14:31:49.739631 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
alter table "bank_rates"."dds"."fact_metal_prices" rename to "fact_metal_prices__dbt_backup"
[0m14:31:49.740127 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m14:31:49.742060 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m14:31:49.742351 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
alter table "bank_rates"."dds"."fact_metal_prices__dbt_tmp" rename to "fact_metal_prices"
[0m14:31:49.742842 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m14:31:49.744115 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: COMMIT
[0m14:31:49.744384 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m14:31:49.744657 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: COMMIT
[0m14:31:49.758679 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m14:31:49.760381 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.dim_metals"
[0m14:31:49.760675 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.dim_metals"} */
drop table if exists "bank_rates"."dds"."dim_metals__dbt_backup" cascade
[0m14:31:49.766878 [debug] [Thread-1 (]: SQL status: COMMIT in 0.0 seconds
[0m14:31:49.768535 [debug] [Thread-1 (]: Using postgres connection "model.bank_rates.fact_metal_prices"
[0m14:31:49.768815 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m14:31:49.769135 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.fact_metal_prices"} */
drop table if exists "bank_rates"."dds"."fact_metal_prices__dbt_backup" cascade
[0m14:31:49.770266 [debug] [Thread-2 (]: Timing info for model.bank_rates.dim_metals (execute): 14:31:49.665953 => 14:31:49.770126
[0m14:31:49.770650 [debug] [Thread-2 (]: On model.bank_rates.dim_metals: Close
[0m14:31:49.771205 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '37d612e6-1d2e-4ed6-bcff-d774da0a8729', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff540bfe320>]}
[0m14:31:49.771673 [info ] [Thread-2 (]: 2 of 4 OK created sql table model dds.dim_metals ............................... [[32mSELECT 4[0m in 0.12s]
[0m14:31:49.772221 [debug] [Thread-2 (]: Finished running node model.bank_rates.dim_metals
[0m14:31:49.772494 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.0 seconds
[0m14:31:49.773823 [debug] [Thread-1 (]: Timing info for model.bank_rates.fact_metal_prices (execute): 14:31:49.655672 => 14:31:49.773691
[0m14:31:49.774079 [debug] [Thread-1 (]: On model.bank_rates.fact_metal_prices: Close
[0m14:31:49.774639 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '37d612e6-1d2e-4ed6-bcff-d774da0a8729', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff54198c730>]}
[0m14:31:49.775053 [info ] [Thread-1 (]: 3 of 4 OK created sql table model dds.fact_metal_prices ........................ [[32mSELECT 16804[0m in 0.13s]
[0m14:31:49.775675 [debug] [Thread-1 (]: Finished running node model.bank_rates.fact_metal_prices
[0m14:31:49.776374 [debug] [Thread-2 (]: Began running node model.bank_rates.metal_prices_analytics
[0m14:31:49.776737 [info ] [Thread-2 (]: 4 of 4 START sql table model mart.metal_prices_analytics ....................... [RUN]
[0m14:31:49.777259 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bank_rates.dim_metals, now model.bank_rates.metal_prices_analytics)
[0m14:31:49.777565 [debug] [Thread-2 (]: Began compiling node model.bank_rates.metal_prices_analytics
[0m14:31:49.779786 [debug] [Thread-2 (]: Writing injected SQL for node "model.bank_rates.metal_prices_analytics"
[0m14:31:49.780310 [debug] [Thread-2 (]: Timing info for model.bank_rates.metal_prices_analytics (compile): 14:31:49.777740 => 14:31:49.780143
[0m14:31:49.780590 [debug] [Thread-2 (]: Began executing node model.bank_rates.metal_prices_analytics
[0m14:31:49.783279 [debug] [Thread-2 (]: Writing runtime sql for node "model.bank_rates.metal_prices_analytics"
[0m14:31:49.783766 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m14:31:49.784032 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: BEGIN
[0m14:31:49.784298 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:31:49.790708 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m14:31:49.790986 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m14:31:49.791267 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */

  
    

  create  table "bank_rates"."mart"."metal_prices_analytics__dbt_tmp"
  
  
    as
  
  (
    

SELECT 
    f.trade_date,
    f.metal_name,
    f.buy_price_rub,
    f.sell_price_rub,
    ROUND((f.buy_price_rub + f.sell_price_rub) / 2, 2) as avg_price_rub,
    LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) as prev_buy_price,
    LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) as prev_sell_price,
    CASE 
        WHEN LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) IS NOT NULL 
        THEN ROUND((f.buy_price_rub - LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date)) / 
                   LAG(f.buy_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) * 100, 2)
        ELSE NULL 
    END as buy_price_change_percent,
    CASE 
        WHEN LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) IS NOT NULL 
        THEN ROUND((f.sell_price_rub - LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date)) / 
                   LAG(f.sell_price_rub) OVER (PARTITION BY f.metal_name ORDER BY f.trade_date) * 100, 2)
        ELSE NULL 
    END as sell_price_change_percent
FROM "bank_rates"."dds"."fact_metal_prices" f
ORDER BY f.trade_date DESC, f.metal_name
  );
  
[0m14:31:49.840231 [debug] [Thread-2 (]: SQL status: SELECT 16804 in 0.0 seconds
[0m14:31:49.842685 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m14:31:49.842976 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
alter table "bank_rates"."mart"."metal_prices_analytics" rename to "metal_prices_analytics__dbt_backup"
[0m14:31:49.843482 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m14:31:49.845534 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m14:31:49.845835 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
alter table "bank_rates"."mart"."metal_prices_analytics__dbt_tmp" rename to "metal_prices_analytics"
[0m14:31:49.846314 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.0 seconds
[0m14:31:49.847709 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: COMMIT
[0m14:31:49.847990 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m14:31:49.848248 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: COMMIT
[0m14:31:49.863464 [debug] [Thread-2 (]: SQL status: COMMIT in 0.0 seconds
[0m14:31:49.865229 [debug] [Thread-2 (]: Using postgres connection "model.bank_rates.metal_prices_analytics"
[0m14:31:49.865566 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "model.bank_rates.metal_prices_analytics"} */
drop table if exists "bank_rates"."mart"."metal_prices_analytics__dbt_backup" cascade
[0m14:31:49.867635 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.0 seconds
[0m14:31:49.868767 [debug] [Thread-2 (]: Timing info for model.bank_rates.metal_prices_analytics (execute): 14:31:49.780763 => 14:31:49.868609
[0m14:31:49.869038 [debug] [Thread-2 (]: On model.bank_rates.metal_prices_analytics: Close
[0m14:31:49.869633 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '37d612e6-1d2e-4ed6-bcff-d774da0a8729', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff540742530>]}
[0m14:31:49.870087 [info ] [Thread-2 (]: 4 of 4 OK created sql table model mart.metal_prices_analytics .................. [[32mSELECT 16804[0m in 0.09s]
[0m14:31:49.870653 [debug] [Thread-2 (]: Finished running node model.bank_rates.metal_prices_analytics
[0m14:31:49.871898 [debug] [MainThread]: Using postgres connection "master"
[0m14:31:49.872137 [debug] [MainThread]: On master: BEGIN
[0m14:31:49.872349 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:31:49.878721 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m14:31:49.878967 [debug] [MainThread]: On master: COMMIT
[0m14:31:49.879183 [debug] [MainThread]: Using postgres connection "master"
[0m14:31:49.879393 [debug] [MainThread]: On master: COMMIT
[0m14:31:49.879733 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m14:31:49.879953 [debug] [MainThread]: On master: Close
[0m14:31:49.880398 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:31:49.880639 [debug] [MainThread]: Connection 'model.bank_rates.fact_metal_prices' was properly closed.
[0m14:31:49.880839 [debug] [MainThread]: Connection 'model.bank_rates.metal_prices_analytics' was properly closed.
[0m14:31:49.881090 [info ] [MainThread]: 
[0m14:31:49.881384 [info ] [MainThread]: Finished running 1 view model, 3 table models in 0 hours 0 minutes and 0.52 seconds (0.52s).
[0m14:31:49.882199 [debug] [MainThread]: Command end result
[0m14:31:49.887758 [info ] [MainThread]: 
[0m14:31:49.888090 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:31:49.888361 [info ] [MainThread]: 
[0m14:31:49.888702 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m14:31:49.889136 [debug] [MainThread]: Command `dbt run` succeeded at 14:31:49.889049 after 0.66 seconds
[0m14:31:49.889390 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff542e3d750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff5407bb340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ff5407bbe20>]}
[0m14:31:49.889715 [debug] [MainThread]: Flushing usage events
[0m14:31:51.793677 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x786886fa9ae0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7868859dfb80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7868859dfc10>]}


============================== 14:31:51.796027 | 2608c9e1-6f05-49c6-b914-66541831fdda ==============================
[0m14:31:51.796027 [info ] [MainThread]: Running with dbt=1.5.0
[0m14:31:51.796413 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '.', 'warn_error': 'None', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_cache_events': 'False', 'debug': 'False', 'partial_parse': 'True', 'introspect': 'True', 'indirect_selection': 'eager', 'write_json': 'True', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'use_colors': 'True', 'fail_fast': 'False', 'no_print': 'None', 'printer_width': '80', 'log_format': 'default', 'log_path': '/usr/app/logs', 'target_path': 'None', 'static_parser': 'True', 'use_experimental_parser': 'False', 'version_check': 'True'}
[0m14:31:51.876065 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2608c9e1-6f05-49c6-b914-66541831fdda', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7868858fa350>]}
[0m14:31:51.889316 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2608c9e1-6f05-49c6-b914-66541831fdda', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7868858fa8f0>]}
[0m14:31:51.897002 [debug] [MainThread]: checksum: 4568eb639a77b8fcb3a1f4a07856f42b1ff63f1376652889143968e1dbdafbda, vars: {}, profile: , target: , version: 1.5.0
[0m14:31:51.914905 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:31:51.915157 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:31:51.919340 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2608c9e1-6f05-49c6-b914-66541831fdda', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x786884982800>]}
[0m14:31:51.924166 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2608c9e1-6f05-49c6-b914-66541831fdda', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7868849539a0>]}
[0m14:31:51.924483 [info ] [MainThread]: Found 4 models, 3 tests, 0 snapshots, 0 analyses, 308 macros, 0 operations, 0 seed files, 0 sources, 0 exposures, 0 metrics, 0 groups
[0m14:31:51.924806 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2608c9e1-6f05-49c6-b914-66541831fdda', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x786884953a30>]}
[0m14:31:51.925917 [info ] [MainThread]: 
[0m14:31:51.926440 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m14:31:51.927468 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates_dds'
[0m14:31:51.933282 [debug] [ThreadPool]: Acquiring new postgres connection 'list_bank_rates_staging'
[0m14:31:51.936245 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m14:31:51.937635 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m14:31:51.937916 [debug] [ThreadPool]: On list_bank_rates_dds: BEGIN
[0m14:31:51.938177 [debug] [ThreadPool]: On list_bank_rates_staging: BEGIN
[0m14:31:51.938420 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:31:51.938698 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:31:51.948427 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m14:31:51.948734 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m14:31:51.948963 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_dds"
[0m14:31:51.949216 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_staging"
[0m14:31:51.949484 [debug] [ThreadPool]: On list_bank_rates_dds: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_dds"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dds'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dds'
  
[0m14:31:51.949793 [debug] [ThreadPool]: On list_bank_rates_staging: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_staging"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging'
  
[0m14:31:51.952120 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.0 seconds
[0m14:31:51.952341 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m14:31:51.953383 [debug] [ThreadPool]: On list_bank_rates_dds: ROLLBACK
[0m14:31:51.954284 [debug] [ThreadPool]: On list_bank_rates_staging: ROLLBACK
[0m14:31:51.954663 [debug] [ThreadPool]: On list_bank_rates_dds: Close
[0m14:31:51.954862 [debug] [ThreadPool]: On list_bank_rates_staging: Close
[0m14:31:51.955635 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_bank_rates_dds, now list_bank_rates_mart)
[0m14:31:51.957630 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m14:31:51.958059 [debug] [ThreadPool]: On list_bank_rates_mart: BEGIN
[0m14:31:51.958269 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:31:51.964151 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m14:31:51.964390 [debug] [ThreadPool]: Using postgres connection "list_bank_rates_mart"
[0m14:31:51.964635 [debug] [ThreadPool]: On list_bank_rates_mart: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "list_bank_rates_mart"} */
select
      'bank_rates' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'mart'
    union all
    select
      'bank_rates' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'mart'
  
[0m14:31:51.966648 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.0 seconds
[0m14:31:51.967448 [debug] [ThreadPool]: On list_bank_rates_mart: ROLLBACK
[0m14:31:51.967799 [debug] [ThreadPool]: On list_bank_rates_mart: Close
[0m14:31:51.971180 [debug] [MainThread]: Using postgres connection "master"
[0m14:31:51.971428 [debug] [MainThread]: On master: BEGIN
[0m14:31:51.971676 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:31:51.977398 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m14:31:51.977701 [debug] [MainThread]: Using postgres connection "master"
[0m14:31:51.977965 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m14:31:51.981697 [debug] [MainThread]: SQL status: SELECT 3 in 0.0 seconds
[0m14:31:51.982530 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2608c9e1-6f05-49c6-b914-66541831fdda', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7868849768f0>]}
[0m14:31:51.982870 [debug] [MainThread]: On master: ROLLBACK
[0m14:31:51.983200 [debug] [MainThread]: Using postgres connection "master"
[0m14:31:51.983416 [debug] [MainThread]: On master: BEGIN
[0m14:31:51.983871 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m14:31:51.984088 [debug] [MainThread]: On master: COMMIT
[0m14:31:51.984296 [debug] [MainThread]: Using postgres connection "master"
[0m14:31:51.984487 [debug] [MainThread]: On master: COMMIT
[0m14:31:51.984826 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m14:31:51.985045 [debug] [MainThread]: On master: Close
[0m14:31:51.985547 [info ] [MainThread]: Concurrency: 2 threads (target='dev')
[0m14:31:51.985838 [info ] [MainThread]: 
[0m14:31:51.989019 [debug] [Thread-1 (]: Began running node test.bank_rates.not_null_key_columns
[0m14:31:51.989318 [debug] [Thread-2 (]: Began running node test.bank_rates.positive_prices
[0m14:31:51.989663 [info ] [Thread-1 (]: 1 of 3 START test not_null_key_columns ......................................... [RUN]
[0m14:31:51.990075 [info ] [Thread-2 (]: 2 of 3 START test positive_prices .............................................. [RUN]
[0m14:31:51.990618 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_bank_rates_mart, now test.bank_rates.not_null_key_columns)
[0m14:31:51.991072 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_bank_rates_staging, now test.bank_rates.positive_prices)
[0m14:31:51.991376 [debug] [Thread-1 (]: Began compiling node test.bank_rates.not_null_key_columns
[0m14:31:51.991689 [debug] [Thread-2 (]: Began compiling node test.bank_rates.positive_prices
[0m14:31:51.993744 [debug] [Thread-1 (]: Writing injected SQL for node "test.bank_rates.not_null_key_columns"
[0m14:31:51.995502 [debug] [Thread-2 (]: Writing injected SQL for node "test.bank_rates.positive_prices"
[0m14:31:51.996175 [debug] [Thread-1 (]: Timing info for test.bank_rates.not_null_key_columns (compile): 14:31:51.991895 => 14:31:51.995999
[0m14:31:51.996534 [debug] [Thread-2 (]: Timing info for test.bank_rates.positive_prices (compile): 14:31:51.993982 => 14:31:51.996340
[0m14:31:51.996806 [debug] [Thread-1 (]: Began executing node test.bank_rates.not_null_key_columns
[0m14:31:51.997108 [debug] [Thread-2 (]: Began executing node test.bank_rates.positive_prices
[0m14:31:52.010448 [debug] [Thread-2 (]: Writing runtime sql for node "test.bank_rates.positive_prices"
[0m14:31:52.011502 [debug] [Thread-1 (]: Writing runtime sql for node "test.bank_rates.not_null_key_columns"
[0m14:31:52.012095 [debug] [Thread-2 (]: Using postgres connection "test.bank_rates.positive_prices"
[0m14:31:52.012390 [debug] [Thread-1 (]: Using postgres connection "test.bank_rates.not_null_key_columns"
[0m14:31:52.012663 [debug] [Thread-2 (]: On test.bank_rates.positive_prices: BEGIN
[0m14:31:52.012952 [debug] [Thread-1 (]: On test.bank_rates.not_null_key_columns: BEGIN
[0m14:31:52.013233 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:31:52.013560 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:31:52.020773 [debug] [Thread-2 (]: SQL status: BEGIN in 0.0 seconds
[0m14:31:52.021063 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m14:31:52.021353 [debug] [Thread-2 (]: Using postgres connection "test.bank_rates.positive_prices"
[0m14:31:52.021686 [debug] [Thread-1 (]: Using postgres connection "test.bank_rates.not_null_key_columns"
[0m14:31:52.021981 [debug] [Thread-2 (]: On test.bank_rates.positive_prices: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "test.bank_rates.positive_prices"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      SELECT 
    trade_date,
    metal_code,
    buy_price_rub,
    sell_price_rub
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
WHERE buy_price_rub <= 0 OR sell_price_rub <= 0
      
    ) dbt_internal_test
[0m14:31:52.022284 [debug] [Thread-1 (]: On test.bank_rates.not_null_key_columns: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "test.bank_rates.not_null_key_columns"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      SELECT 
    trade_date,
    metal_code
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
WHERE trade_date IS NULL 
   OR metal_code IS NULL 
   OR buy_price_rub IS NULL 
   OR sell_price_rub IS NULL
      
    ) dbt_internal_test
[0m14:31:52.034214 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m14:31:52.036054 [debug] [Thread-1 (]: Timing info for test.bank_rates.not_null_key_columns (execute): 14:31:51.997307 => 14:31:52.035878
[0m14:31:52.036325 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.0 seconds
[0m14:31:52.036613 [debug] [Thread-1 (]: On test.bank_rates.not_null_key_columns: ROLLBACK
[0m14:31:52.037654 [debug] [Thread-2 (]: Timing info for test.bank_rates.positive_prices (execute): 14:31:52.007582 => 14:31:52.037439
[0m14:31:52.038010 [debug] [Thread-2 (]: On test.bank_rates.positive_prices: ROLLBACK
[0m14:31:52.038263 [debug] [Thread-1 (]: On test.bank_rates.not_null_key_columns: Close
[0m14:31:52.038609 [debug] [Thread-2 (]: On test.bank_rates.positive_prices: Close
[0m14:31:52.039138 [info ] [Thread-1 (]: 1 of 3 PASS not_null_key_columns ............................................... [[32mPASS[0m in 0.05s]
[0m14:31:52.039845 [info ] [Thread-2 (]: 2 of 3 PASS positive_prices .................................................... [[32mPASS[0m in 0.05s]
[0m14:31:52.040399 [debug] [Thread-1 (]: Finished running node test.bank_rates.not_null_key_columns
[0m14:31:52.040882 [debug] [Thread-2 (]: Finished running node test.bank_rates.positive_prices
[0m14:31:52.041301 [debug] [Thread-1 (]: Began running node test.bank_rates.unique_trade_date_metal_code
[0m14:31:52.041860 [info ] [Thread-1 (]: 3 of 3 START test unique_trade_date_metal_code ................................. [RUN]
[0m14:31:52.042434 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.bank_rates.not_null_key_columns, now test.bank_rates.unique_trade_date_metal_code)
[0m14:31:52.042745 [debug] [Thread-1 (]: Began compiling node test.bank_rates.unique_trade_date_metal_code
[0m14:31:52.045012 [debug] [Thread-1 (]: Writing injected SQL for node "test.bank_rates.unique_trade_date_metal_code"
[0m14:31:52.045717 [debug] [Thread-1 (]: Timing info for test.bank_rates.unique_trade_date_metal_code (compile): 14:31:52.042959 => 14:31:52.045437
[0m14:31:52.046052 [debug] [Thread-1 (]: Began executing node test.bank_rates.unique_trade_date_metal_code
[0m14:31:52.048022 [debug] [Thread-1 (]: Writing runtime sql for node "test.bank_rates.unique_trade_date_metal_code"
[0m14:31:52.048559 [debug] [Thread-1 (]: Using postgres connection "test.bank_rates.unique_trade_date_metal_code"
[0m14:31:52.048865 [debug] [Thread-1 (]: On test.bank_rates.unique_trade_date_metal_code: BEGIN
[0m14:31:52.049157 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:31:52.055810 [debug] [Thread-1 (]: SQL status: BEGIN in 0.0 seconds
[0m14:31:52.056178 [debug] [Thread-1 (]: Using postgres connection "test.bank_rates.unique_trade_date_metal_code"
[0m14:31:52.056546 [debug] [Thread-1 (]: On test.bank_rates.unique_trade_date_metal_code: /* {"app": "dbt", "dbt_version": "1.5.0", "profile_name": "bank_rates", "target_name": "dev", "node_id": "test.bank_rates.unique_trade_date_metal_code"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      SELECT 
    trade_date,
    metal_code,
    COUNT(*) as count
FROM "bank_rates"."staging"."stg_cbr_precious_metals"
GROUP BY trade_date, metal_code
HAVING COUNT(*) > 1
      
    ) dbt_internal_test
[0m14:31:52.073805 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.0 seconds
[0m14:31:52.075148 [debug] [Thread-1 (]: Timing info for test.bank_rates.unique_trade_date_metal_code (execute): 14:31:52.046224 => 14:31:52.074977
[0m14:31:52.075424 [debug] [Thread-1 (]: On test.bank_rates.unique_trade_date_metal_code: ROLLBACK
[0m14:31:52.075827 [debug] [Thread-1 (]: On test.bank_rates.unique_trade_date_metal_code: Close
[0m14:31:52.076441 [info ] [Thread-1 (]: 3 of 3 PASS unique_trade_date_metal_code ....................................... [[32mPASS[0m in 0.03s]
[0m14:31:52.076949 [debug] [Thread-1 (]: Finished running node test.bank_rates.unique_trade_date_metal_code
[0m14:31:52.078100 [debug] [MainThread]: Using postgres connection "master"
[0m14:31:52.078349 [debug] [MainThread]: On master: BEGIN
[0m14:31:52.078596 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:31:52.085619 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m14:31:52.085879 [debug] [MainThread]: On master: COMMIT
[0m14:31:52.086097 [debug] [MainThread]: Using postgres connection "master"
[0m14:31:52.086306 [debug] [MainThread]: On master: COMMIT
[0m14:31:52.086630 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m14:31:52.086837 [debug] [MainThread]: On master: Close
[0m14:31:52.087270 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:31:52.087480 [debug] [MainThread]: Connection 'test.bank_rates.unique_trade_date_metal_code' was properly closed.
[0m14:31:52.087714 [debug] [MainThread]: Connection 'test.bank_rates.positive_prices' was properly closed.
[0m14:31:52.087956 [info ] [MainThread]: 
[0m14:31:52.088242 [info ] [MainThread]: Finished running 3 tests in 0 hours 0 minutes and 0.16 seconds (0.16s).
[0m14:31:52.088929 [debug] [MainThread]: Command end result
[0m14:31:52.093417 [info ] [MainThread]: 
[0m14:31:52.093803 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:31:52.094072 [info ] [MainThread]: 
[0m14:31:52.094405 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m14:31:52.094831 [debug] [MainThread]: Command `dbt test` succeeded at 14:31:52.094742 after 0.31 seconds
[0m14:31:52.095093 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x786886fa9ae0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7868858fa8f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x786884953a90>]}
[0m14:31:52.095371 [debug] [MainThread]: Flushing usage events
